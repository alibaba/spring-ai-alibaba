# MySQL 初始化脚本 ConfigMap
# 这个 ConfigMap 包含数据库初始化 SQL 脚本
# MySQL 容器启动时会将此 ConfigMap 挂载到 /docker-entrypoint-initdb.d 目录
# MySQL 官方镜像会在首次初始化数据库时自动执行该目录下的所有 .sql 文件
#
# 使用方法：
# 1. 从项目根目录执行：kubectl apply -f deploy/middleware/mysql/mysql-init-configmap.yaml
# 2. 或者使用 kubectl create 命令（推荐，可以自动从文件创建）：
#    kubectl create configmap mysql-init-scripts \
#      --from-file=admin-schema.sql=docker/middleware/init/mysql/admin-schema.sql \
#      --from-file=agentscope-schema.sql=docker/middleware/init/mysql/agentscope-schema.sql \
#      -n spring-ai-admin \
#      --dry-run=client -o yaml | kubectl apply -f -
#
# 注意：
# - 必须在部署 MySQL Deployment 之前创建此 ConfigMap
# - 如果 MySQL 已经初始化过，再次创建 ConfigMap 不会重新执行脚本
# - 如果需要重新初始化，需要删除 MySQL 的 PVC 和数据

apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-init-scripts
  namespace: spring-ai-admin
data:
  # 注意：这里需要手动将 SQL 文件内容粘贴进来，或者使用上面的 kubectl create 命令
  # 因为 ConfigMap 不能直接引用外部文件路径
  admin-schema.sql: |
    # 请使用 kubectl create 命令从文件创建，而不是直接使用此 YAML
    # 或者将 docker/middleware/init/mysql/admin-schema.sql 的内容粘贴到这里
  agentscope-schema.sql: |
    # 请使用 kubectl create 命令从文件创建，而不是直接使用此 YAML
    # 或者将 docker/middleware/init/mysql/agentscope-schema.sql 的内容粘贴到这里


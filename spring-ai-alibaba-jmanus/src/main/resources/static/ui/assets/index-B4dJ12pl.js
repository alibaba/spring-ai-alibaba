var pt=Object.defineProperty;var ht=(T,t,n)=>t in T?pt(T,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):T[t]=n;var $e=(T,t,n)=>ht(T,typeof t!="symbol"?t+"":t,n);import{d as Ce,u as xe,c as ke,o as we,a as h,b as p,n as oe,i as o,e,f as q,t as s,g as v,h as ne,F as be,q as _e,j as de,w as re,m as pe,A as ct,r as I,B as Ee,y as Ne,l as me,C as mt,D as ye,z as ue,T as Fe,p as Ue,E as rt,G as Ve,H as vt,x as dt,I as gt}from"./index-DJFiNt1E.js";import{I as b,_ as Se}from"./_plugin-vue_export-helper-YLxhGeUR.js";import{s as P,P as qe,u as ut}from"./sidebar-CP-ocnUW.js";import{L as ft}from"./llm-check-BVkAKrj3.js";import{L as bt}from"./index-D0EWVqE8.js";import{u as kt,a as $t}from"./useMessage-CMjMb1Ar.js";const _t={class:"sidebar-content"},yt={class:"sidebar-content-header"},Pt={class:"sidebar-content-title"},Ct={class:"tab-switcher"},St=["disabled"],wt={key:0,class:"tab-content"},Et={class:"new-task-section"},Tt={class:"sidebar-content-list"},It={key:0,class:"loading-state"},Dt={key:1,class:"error-state"},xt={key:2,class:"empty-state"},Rt=["onClick"],At={class:"task-icon"},Mt={class:"task-details"},Ft={class:"task-title"},Ut={class:"task-preview"},Nt={class:"task-time"},qt={class:"task-actions"},Lt=["title","onClick"],Vt={key:1,class:"tab-content config-tab"},Bt={key:0,class:"config-container"},Wt={class:"template-info-header"},jt={class:"template-info"},Ot={class:"template-id"},zt={class:"config-section"},Ht={class:"section-header"},Jt={class:"generator-content"},Gt=["placeholder"],Kt={class:"generator-actions"},Xt=["disabled"],Qt=["disabled"],Yt={class:"config-section"},Zt={class:"section-header"},en={class:"section-actions"},tn=["disabled","title"],nn=["disabled","title"],on=["disabled"],sn=["placeholder"],an={class:"config-section"},ln={class:"section-header"},cn={class:"execution-content"},rn={class:"params-input-group"},dn={class:"params-help-text"},un={class:"params-input-container"},pn=["placeholder"],hn=["title"],mn={class:"api-url-display"},vn={class:"api-url-label"},gn={class:"api-url"},fn={class:"api-url-display"},bn={class:"api-url-label"},kn=["disabled"],$n=Ce({__name:"index",emits:["planExecutionRequested"],setup(T,{expose:t,emit:n}){const{t:r}=xe(),g=["currentPlanId","userRequest","rootPlanId"],k=ke({get(){try{if(!P.jsonContent)return"";const f={...JSON.parse(P.jsonContent)};return g.forEach(C=>{delete f[C]}),JSON.stringify(f,null,2)}catch{return P.jsonContent}},set(a){try{if(!a.trim()){P.jsonContent="";return}const f=JSON.parse(a);let C={};try{C=JSON.parse(P.jsonContent||"{}")}catch{}const J={...f};g.forEach(w=>{C[w]!==void 0&&(J[w]=C[w])}),P.jsonContent=JSON.stringify(J)}catch{P.jsonContent=a}}}),u=n,E=async()=>{try{const a=await P.saveTemplate();a!=null&&a.duplicate?alert(r("sidebar.saveCompleted",{message:a.message,versionCount:a.versionCount})):a!=null&&a.saved?alert(r("sidebar.saveSuccess",{message:a.message,versionCount:a.versionCount})):a!=null&&a.message&&alert(r("sidebar.saveStatus",{message:a.message}))}catch(a){console.error("Failed to save plan modifications:",a),alert(a.message||r("sidebar.saveFailed"))}},V=async()=>{var a;try{await P.generatePlan(),alert(r("sidebar.generateSuccess",{templateId:((a=P.selectedTemplate)==null?void 0:a.id)??r("sidebar.unknown")}))}catch(f){console.error("Failed to generate plan:",f),alert(r("sidebar.generateFailed")+": "+f.message)}},S=async()=>{try{await P.updatePlan(),alert(r("sidebar.updateSuccess"))}catch(a){console.error("Failed to update plan:",a),alert(r("sidebar.updateFailed")+": "+a.message)}},M=async()=>{console.log("[Sidebar] handleExecutePlan called");try{const a=P.preparePlanExecution();if(!a){console.log("[Sidebar] No plan data available, returning");return}console.log("[Sidebar] Triggering plan execution request:",a),console.log("[Sidebar] Emitting planExecutionRequested event"),u("planExecutionRequested",a),console.log("[Sidebar] Event emitted")}catch(a){console.error("Error executing plan:",a),alert(r("sidebar.executeFailed")+": "+a.message)}finally{P.finishPlanExecution()}},z=a=>{if(isNaN(a.getTime()))return console.warn("Invalid date received:",a),r("time.unknown");const C=new Date().getTime()-a.getTime(),J=Math.floor(C/6e4),w=Math.floor(C/36e5),D=Math.floor(C/864e5);return J<1?r("time.now"):J<60?r("time.minuteAgo",{count:J}):w<24?r("time.hourAgo",{count:w}):D<30?r("time.dayAgo",{count:D}):a.toLocaleDateString("zh-CN")},L=(a,f)=>!a||a.length<=f?a:a.substring(0,f)+"...";return we(()=>{P.loadPlanTemplateList()}),t({loadPlanTemplateList:P.loadPlanTemplateList,toggleSidebar:P.toggleSidebar,currentPlanTemplateId:P.currentPlanTemplateId}),(a,f)=>(p(),h("div",{class:oe(["sidebar-wrapper",{"sidebar-wrapper-collapsed":o(P).isCollapsed}])},[e("div",_t,[e("div",yt,[e("div",Pt,s(a.$t("sidebar.title")),1)]),e("div",Ct,[e("button",{class:oe(["tab-button",{active:o(P).currentTab==="list"}]),onClick:f[0]||(f[0]=C=>o(P).switchToTab("list"))},[v(o(b),{icon:"carbon:list",width:"16"}),ne(" "+s(a.$t("sidebar.templateList")),1)],2),e("button",{class:oe(["tab-button",{active:o(P).currentTab==="config"}]),onClick:f[1]||(f[1]=C=>o(P).switchToTab("config")),disabled:!o(P).selectedTemplate},[v(o(b),{icon:"carbon:settings",width:"16"}),ne(" "+s(a.$t("sidebar.configuration")),1)],10,St)]),o(P).currentTab==="list"?(p(),h("div",wt,[e("div",Et,[e("button",{class:"new-task-btn",onClick:f[2]||(f[2]=C=>o(P).createNewTemplate())},[v(o(b),{icon:"carbon:add",width:"16"}),ne(" "+s(a.$t("sidebar.newPlan"))+" ",1),f[11]||(f[11]=e("span",{class:"shortcut"},"âŒ˜ K",-1))])]),e("div",Tt,[o(P).isLoading?(p(),h("div",It,[v(o(b),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),e("span",null,s(a.$t("sidebar.loading")),1)])):o(P).errorMessage?(p(),h("div",Dt,[v(o(b),{icon:"carbon:warning",width:"20"}),e("span",null,s(o(P).errorMessage),1),e("button",{onClick:f[3]||(f[3]=(...C)=>o(P).loadPlanTemplateList&&o(P).loadPlanTemplateList(...C)),class:"retry-btn"},s(a.$t("sidebar.retry")),1)])):o(P).planTemplateList.length===0?(p(),h("div",xt,[v(o(b),{icon:"carbon:document",width:"32"}),e("span",null,s(a.$t("sidebar.noTemplates")),1)])):(p(!0),h(be,{key:3},_e(o(P).sortedTemplates,C=>(p(),h("div",{key:C.id,class:oe(["sidebar-content-list-item",{"sidebar-content-list-item-active":C.id===o(P).currentPlanTemplateId}]),onClick:J=>o(P).selectTemplate(C)},[e("div",At,[v(o(b),{icon:"carbon:document",width:"20"})]),e("div",Mt,[e("div",Ft,s(C.title||a.$t("sidebar.unnamedPlan")),1),e("div",Ut,s(L(C.description||a.$t("sidebar.noDescription"),40)),1)]),e("div",Nt,s(z(o(P).parseDateTime(C.updateTime||C.createTime))),1),e("div",qt,[e("button",{class:"delete-task-btn",title:a.$t("sidebar.deleteTemplate"),onClick:de(J=>o(P).deleteTemplate(C),["stop"])},[v(o(b),{icon:"carbon:close",width:"16"})],8,Lt)])],10,Rt))),128))])])):o(P).currentTab==="config"?(p(),h("div",Vt,[o(P).selectedTemplate?(p(),h("div",Bt,[e("div",Wt,[e("div",jt,[e("h3",null,s(o(P).selectedTemplate.title||a.$t("sidebar.unnamedPlan")),1),e("span",Ot,"ID: "+s(o(P).selectedTemplate.id),1)]),e("button",{class:"back-to-list-btn",onClick:f[4]||(f[4]=C=>o(P).switchToTab("list"))},[v(o(b),{icon:"carbon:arrow-left",width:"16"})])]),e("div",zt,[e("div",Ht,[v(o(b),{icon:"carbon:generate",width:"16"}),e("span",null,s(a.$t("sidebar.planGenerator")),1)]),e("div",Jt,[re(e("textarea",{"onUpdate:modelValue":f[5]||(f[5]=C=>o(P).generatorPrompt=C),class:"prompt-input",placeholder:a.$t("sidebar.generatorPlaceholder"),rows:"3"},null,8,Gt),[[pe,o(P).generatorPrompt]]),e("div",Kt,[e("button",{class:"btn btn-primary btn-sm",onClick:V,disabled:o(P).isGenerating||!o(P).generatorPrompt.trim()},[v(o(b),{icon:o(P).isGenerating?"carbon:circle-dash":"carbon:generate",width:"14",class:oe({spinning:o(P).isGenerating})},null,8,["icon","class"]),ne(" "+s(o(P).isGenerating?a.$t("sidebar.generating"):a.$t("sidebar.generatePlan")),1)],8,Xt),e("button",{class:"btn btn-secondary btn-sm",onClick:S,disabled:o(P).isGenerating||!o(P).generatorPrompt.trim()||!o(P).jsonContent.trim()},[v(o(b),{icon:"carbon:edit",width:"14"}),ne(" "+s(a.$t("sidebar.updatePlan")),1)],8,Qt)])])]),e("div",Yt,[e("div",Zt,[v(o(b),{icon:"carbon:code",width:"16"}),e("span",null,s(a.$t("sidebar.jsonTemplate")),1),e("div",en,[e("button",{class:"btn btn-sm",onClick:f[6]||(f[6]=(...C)=>o(P).rollbackVersion&&o(P).rollbackVersion(...C)),disabled:!o(P).canRollback,title:a.$t("sidebar.rollback")},[v(o(b),{icon:"carbon:undo",width:"14"})],8,tn),e("button",{class:"btn btn-sm",onClick:f[7]||(f[7]=(...C)=>o(P).restoreVersion&&o(P).restoreVersion(...C)),disabled:!o(P).canRestore,title:a.$t("sidebar.restore")},[v(o(b),{icon:"carbon:redo",width:"14"})],8,nn),e("button",{class:"btn btn-primary btn-sm",onClick:E,disabled:o(P).isGenerating||o(P).isExecuting},[v(o(b),{icon:"carbon:save",width:"14"})],8,on)])]),re(e("textarea",{"onUpdate:modelValue":f[8]||(f[8]=C=>k.value=C),class:"json-editor",placeholder:a.$t("sidebar.jsonPlaceholder"),rows:"12"},null,8,sn),[[pe,k.value]])]),e("div",an,[e("div",ln,[v(o(b),{icon:"carbon:play",width:"16"}),e("span",null,s(a.$t("sidebar.executionController")),1)]),e("div",cn,[e("div",rn,[e("label",null,s(a.$t("sidebar.executionParams")),1),e("div",dn,s(a.$t("sidebar.executionParamsHelp")),1),e("div",un,[re(e("input",{"onUpdate:modelValue":f[9]||(f[9]=C=>o(P).executionParams=C),class:"params-input",placeholder:a.$t("sidebar.executionParamsPlaceholder")},null,8,pn),[[pe,o(P).executionParams]]),e("button",{class:"clear-params-btn",onClick:f[10]||(f[10]=(...C)=>o(P).clearExecutionParams&&o(P).clearExecutionParams(...C)),title:a.$t("sidebar.clearParams")},[v(o(b),{icon:"carbon:close",width:"12"})],8,hn)])]),e("div",mn,[e("span",vn,s(a.$t("sidebar.apiUrl"))+":",1),e("code",gn,s(o(P).computedApiUrl),1)]),e("div",fn,[e("span",bn,s(a.$t("sidebar.statusApiUrl"))+":",1),f[12]||(f[12]=e("code",{class:"api-url"},"/api/executor/details/{planId}",-1))]),e("button",{class:"btn btn-primary execute-btn",onClick:M,disabled:o(P).isExecuting||o(P).isGenerating},[v(o(b),{icon:o(P).isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:oe({spinning:o(P).isExecuting})},null,8,["icon","class"]),ne(" "+s(o(P).isExecuting?a.$t("sidebar.executing"):a.$t("sidebar.executePlan")),1)],8,kn)])])])):q("",!0)])):q("",!0)])],2))}}),_n=Se($n,[["__scopeId","data-v-32d3c579"]]);class We{static async sendMessage(t){return ft.withLlmCheck(async()=>{const n=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!n.ok)throw new Error(`API request failed: ${n.status}`);return await n.json()})}}$e(We,"BASE_URL","/api/executor");class je{static async getDetails(t){try{const n=await fetch(`${this.BASE_URL}/details/${t}`);if(n.status===404)return null;if(!n.ok){const k=await n.text();throw new Error(`Failed to get detailed information: ${n.status} - ${k}`)}const r=await n.text(),g=JSON.parse(r);return g&&typeof g=="object"&&!g.currentPlanId&&(g.currentPlanId=t),g}catch(n){return console.error("[CommonApiService] Failed to get plan details:",n),{currentPlanId:t,status:"failed",message:n instanceof Error?n.message:"Failed to save, please retry"}}}static async submitFormInput(t,n){const r=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){let k;try{k=await r.json()}catch{k={message:`Failed to submit form input: ${r.status}`}}throw new Error(k.message||`Failed to submit form input: ${r.status}`)}const g=r.headers.get("content-type");return g&&g.indexOf("application/json")!==-1?await r.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const n=await t.json();throw new Error(n.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}$e(je,"BASE_URL","/api/executor");const De=class De{constructor(){$e(this,"POLL_INTERVAL",5e3);$e(this,"state",ct({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));$e(this,"callbacks",{});$e(this,"planExecutionCache",new Map);$e(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(t){return this.planExecutionCache.get(t)}getCachedUIState(t){return this.uiStateCache.get(t)}setCachedUIState(t,n){this.uiStateCache.set(t,n),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${t}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(t){return this.planExecutionCache.has(t)}setCachedPlanRecord(t,n){this.planExecutionCache.set(t,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${t}`)}clearCachedPlanRecord(t){const n=this.planExecutionCache.delete(t);return n&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${t}`),n}clearAllCachedRecords(){const t=this.planExecutionCache.size,n=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${t}, UI States: ${n}`)}static getInstance(){return De.instance||(De.instance=new De),De.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(t){this.callbacks={...this.callbacks,...t},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(t))}async handleUserMessageSendRequested(t){if(this.validateAndPrepareUIForNewRequest(t))try{if(await this.sendUserMessageAndSetPlanId(t),this.state.activePlanId)this.initiatePlanExecutionSequence(t,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(n){console.error("[PlanExecutionManager] Failed to send user message:",n);const r=this.state.activePlanId??"error";this.setCachedUIState(r,{enabled:!0}),this.emitChatInputUpdateState(r),this.state.activePlanId=null}}handlePlanExecutionRequested(t,n){console.log("[PlanExecutionManager] Received plan execution request:",{planId:t,query:n}),t?(this.state.activePlanId=t,this.initiatePlanExecutionSequence(n??"Execute Plan",t)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(t,n){const r=this.getCachedPlanRecord(t);return r!=null&&r.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${t}`),this.handlePlanExecutionRequested(r.currentPlanId,n),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${t}`),!1)}validateAndPrepareUIForNewRequest(t){if(!t)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const n=this.state.activePlanId??"ui-state";return this.setCachedUIState(n,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(n),!0}async sendUserMessageAndSetPlanId(t){try{const n=await We.sendMessage(t);if(n!=null&&n.planId)return this.state.activePlanId=n.planId,n;if(n!=null&&n.planTemplateId)return this.state.activePlanId=n.planTemplateId,{...n,planId:n.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",n),new Error("Failed to get valid planId from API response")}catch(n){throw console.error("[PlanExecutionManager] API call failed:",n),n}}initiatePlanExecutionSequence(t,n){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${t}", planId: ${n}`);const r=n;this.emitDialogRoundStart(r),this.startPolling()}handlePlanCompletion(t){this.emitPlanCompleted(t.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await qe.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}t.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(t.rootPlanId??""))}handlePlanError(t){this.emitPlanError(t.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await qe.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const t=await this.getPlanDetails(this.state.activePlanId);if(!t){console.warn("[PlanExecutionManager] No details received from API");return}if(t.status&&t.status==="failed"){this.handlePlanError(t);return}if(t.rootPlanId&&this.setCachedPlanRecord(t.rootPlanId,t),!t.steps||t.steps.length===0){console.log("[PlanExecutionManager] Simple response without steps detected, handling as completed"),this.emitPlanUpdate(t.rootPlanId??""),this.handlePlanCompletion(t);return}this.emitPlanUpdate(t.rootPlanId??""),t.completed&&this.handlePlanCompletion(t)}catch(t){console.error("[PlanExecutionManager] Failed to poll plan status:",t)}finally{this.state.isPolling=!1}}}async getPlanDetails(t){try{const n=await je.getDetails(t);return n!=null&&n.rootPlanId&&(this.planExecutionCache.set(n.rootPlanId,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${n.rootPlanId}`)),n}catch(n){return console.error("[PlanExecutionManager] Failed to get plan details:",n),{currentPlanId:t,status:"failed",message:n instanceof Error?n.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(t){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(t)}emitDialogRoundStart(t){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(t)}emitPlanUpdate(t){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(t)}emitPlanCompleted(t){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(t)}emitPlanError(t){this.callbacks.onPlanError&&this.callbacks.onPlanError(t)}};$e(De,"instance",null);let Be=De;const he=Be.getInstance();class Ie{static async handleResponse(t){if(!t.ok)try{const n=await t.json();throw new Error(n.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const n=await fetch(`${this.BASE_URL}/tree/${t}`),g=await(await this.handleResponse(n)).json();if(!g.success)throw new Error(g.message||"Failed to get file tree");return g.data}catch(n){throw console.error("Failed to get file tree:",n),n}}static async getFileContent(t,n){try{const r=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(n)}`),k=await(await this.handleResponse(r)).json();if(!k.success)throw new Error(k.message||"Failed to get file content");return k.data}catch(r){throw console.error("Failed to get file content:",r),r}}static async downloadFile(t,n,r){try{const g=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(n)}`);await this.handleResponse(g);const k=await g.blob(),u=window.URL.createObjectURL(k),E=document.createElement("a");E.href=u,E.download=r||n.split("/").pop()||"download",document.body.appendChild(E),E.click(),window.URL.revokeObjectURL(u),document.body.removeChild(E)}catch(g){throw console.error("Failed to download file:",g),g}}static isTextFile(t,n){const r=["text/","application/json","application/xml","application/javascript","application/typescript"],g=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(r.some(u=>t.startsWith(u)))return!0;const k=n.toLowerCase();return g.some(u=>k.endsWith(u))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const n=t.name.toLowerCase();return n.endsWith(".js")?"vscode-icons:file-type-js":n.endsWith(".ts")?"vscode-icons:file-type-typescript":n.endsWith(".vue")?"vscode-icons:file-type-vue":n.endsWith(".java")?"vscode-icons:file-type-java":n.endsWith(".py")?"vscode-icons:file-type-python":n.endsWith(".json")?"vscode-icons:file-type-json":n.endsWith(".xml")?"vscode-icons:file-type-xml":n.endsWith(".html")?"vscode-icons:file-type-html":n.endsWith(".css")?"vscode-icons:file-type-css":n.endsWith(".md")?"vscode-icons:file-type-markdown":n.endsWith(".yml")||n.endsWith(".yaml")?"vscode-icons:file-type-yaml":n.endsWith(".pdf")?"vscode-icons:file-type-pdf2":n.endsWith(".doc")||n.endsWith(".docx")?"vscode-icons:file-type-word":n.endsWith(".xls")||n.endsWith(".xlsx")?"vscode-icons:file-type-excel":n.endsWith(".ppt")||n.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":n.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":n.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}$e(Ie,"BASE_URL","/api/file-browser");const yn={class:"file-tree-node"},Pn={class:"node-icon"},Cn={class:"node-name"},Sn={key:1,class:"file-size"},wn={key:2,class:"node-actions"},En={key:0,class:"children"},Tn=Ce({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(T,{emit:t}){const n=T,r=t,g=I(n.level===0),k=I(!1),u=I(!1),E=I({}),V=()=>{n.node.type==="directory"&&(g.value=!g.value)},S=()=>{n.node.type==="directory"?V():M()},M=()=>{n.node.type==="file"&&r("file-selected",n.node),a()},z=()=>{r("download-file",n.node),a()},L=w=>{w.preventDefault(),u.value=!0,E.value={position:"fixed",top:`${w.clientY}px`,left:`${w.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",a)},0)},a=()=>{u.value=!1,document.removeEventListener("click",a)},f=async()=>{try{await navigator.clipboard.writeText(n.node.path)}catch(w){console.error("Failed to copy path:",w)}a()},C=()=>n.node.type==="directory"?g.value?"carbon:folder-open":"carbon:folder":Ie.getFileIcon(n.node),J=w=>{if(w===0)return"0 B";const D=1024,B=["B","KB","MB","GB"],G=Math.floor(Math.log(w)/Math.log(D));return parseFloat((w/Math.pow(D,G)).toFixed(1))+" "+B[G]};return Ee(()=>{document.removeEventListener("click",a)}),(w,D)=>{const B=mt("FileTreeNode",!0);return p(),h("div",yn,[e("div",{class:oe(["node-content",{"is-directory":w.node.type==="directory","is-file":w.node.type==="file","is-expanded":g.value}]),style:Ne({paddingLeft:`${w.level*16+12}px`}),onClick:S,onContextmenu:de(L,["prevent"])},[w.node.type==="directory"?(p(),h("div",{key:0,class:"expand-icon",onClick:de(V,["stop"])},[v(o(b),{icon:g.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):q("",!0),e("div",Pn,[v(o(b),{icon:C()},null,8,["icon"])]),e("span",Cn,s(w.node.name),1),w.node.type==="file"?(p(),h("span",Sn,s(J(w.node.size)),1)):q("",!0),k.value?(p(),h("div",wn,[w.node.type==="file"?(p(),h("button",{key:0,onClick:D[0]||(D[0]=de(G=>w.$emit("download-file",w.node),["stop"])),class:"action-btn download-btn",title:"Download"},[v(o(b),{icon:"carbon:download"})])):q("",!0)])):q("",!0)],38),w.node.type==="directory"&&g.value&&w.node.children?(p(),h("div",En,[(p(!0),h(be,null,_e(w.node.children,G=>(p(),me(B,{key:G.path,node:G,level:w.level+1,onFileSelected:D[1]||(D[1]=A=>w.$emit("file-selected",A)),onDownloadFile:D[2]||(D[2]=A=>w.$emit("download-file",A))},null,8,["node","level"]))),128))])):q("",!0),u.value?(p(),h("div",{key:1,class:"context-menu",style:Ne(E.value),onClick:D[3]||(D[3]=de(()=>{},["stop"]))},[e("div",{class:"context-menu-item",onClick:M},[v(o(b),{icon:"carbon:view"}),D[4]||(D[4]=e("span",null,"Open",-1))]),w.node.type==="file"?(p(),h("div",{key:0,class:"context-menu-item",onClick:z},[v(o(b),{icon:"carbon:download"}),D[5]||(D[5]=e("span",null,"Download",-1))])):q("",!0),D[7]||(D[7]=e("div",{class:"context-menu-divider"},null,-1)),e("div",{class:"context-menu-item",onClick:f},[v(o(b),{icon:"carbon:copy"}),D[6]||(D[6]=e("span",null,"Copy Path",-1))])],4)):q("",!0)])}}}),In=Se(Tn,[["__scopeId","data-v-4c2c30c7"]]),Dn={class:"file-browser"},xn={class:"file-browser-header"},Rn={class:"header-actions"},An=["disabled","title"],Mn={class:"file-browser-content"},Fn={class:"file-tree-panel"},Un={key:0,class:"loading-state"},Nn={key:1,class:"error-state"},qn={key:0,class:"waiting-for-files"},Ln={class:"message-content"},Vn={class:"tips"},Bn=["disabled"],Wn={key:1,class:"actual-error"},jn={key:2,class:"empty-state"},On={key:3,class:"file-tree"},zn={key:0,class:"file-content-panel"},Hn={class:"file-content-header"},Jn={class:"file-info"},Gn={class:"file-name"},Kn={class:"file-size"},Xn={class:"file-actions"},Qn=["title"],Yn=["title"],Zn={class:"file-content-body"},eo={key:0,class:"loading-content"},to={key:1,class:"content-error"},no={key:2,class:"file-content"},oo={key:0,class:"text-content"},so={key:1,class:"binary-content"},ao=Ce({__name:"index",props:{planId:{}},setup(T){const t=T,{t:n}=xe(),r=I(!1),g=I(null),k=I(null),u=I(null),E=I(null),V=I(!1),S=I(null),M=I(null),z=ke(()=>!E.value||!u.value?!1:Ie.isTextFile(E.value.mimeType,u.value.name)),L=ke(()=>g.value&&(g.value.includes("Plan directory not found")||g.value.includes("not found"))),a=()=>{M.value&&(clearTimeout(M.value),M.value=null)},f=()=>{a(),M.value=window.setTimeout(()=>{L.value&&C()},5e3)},C=async()=>{if(t.planId){r.value=!0,g.value=null,a();try{k.value=await Ie.getFileTree(t.planId)}catch(A){g.value=A instanceof Error?A.message:n("fileBrowser.loadError"),console.error("Failed to load file tree:",A);const ee=A instanceof Error?A.message:"";(ee.includes("Plan directory not found")||ee.includes("not found"))&&f()}finally{r.value=!1}}},J=async A=>{if(A.type!=="directory"){u.value=A,E.value=null,V.value=!0,S.value=null;try{E.value=await Ie.getFileContent(t.planId,A.path)}catch(ee){S.value=ee instanceof Error?ee.message:n("fileBrowser.contentLoadError"),console.error("Failed to load file content:",ee)}finally{V.value=!1}}},w=async A=>{try{await Ie.downloadFile(t.planId,A.path,A.name)}catch(ee){console.error("Failed to download file:",ee)}},D=()=>{u.value=null,E.value=null,S.value=null},B=A=>Ie.getFileIcon(A),G=A=>{if(A===0)return"0 B";const ee=1024,ae=["B","KB","MB","GB"],ce=Math.floor(Math.log(A)/Math.log(ee));return parseFloat((A/Math.pow(ee,ce)).toFixed(1))+" "+ae[ce]};return ye(()=>t.planId,A=>{A&&(u.value=null,E.value=null,C())},{immediate:!0}),we(()=>{t.planId&&C()}),Ee(()=>{a()}),(A,ee)=>(p(),h("div",Dn,[e("div",xn,[e("h3",null,s(A.$t("fileBrowser.title")),1),e("div",Rn,[e("button",{class:"refresh-btn",onClick:C,disabled:r.value,title:A.$t("fileBrowser.refresh")},[v(o(b),{icon:"carbon:refresh",class:oe({rotating:r.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,An)])]),e("div",Mn,[e("div",Fn,[r.value?(p(),h("div",Un,[v(o(b),{icon:"carbon:loading",class:"rotating"}),e("span",null,s(A.$t("fileBrowser.loading")),1)])):g.value?(p(),h("div",Nn,[L.value?(p(),h("div",qn,[v(o(b),{icon:"carbon:time",class:"rotating"}),e("div",Ln,[e("h3",null,s(A.$t("fileBrowser.waitingForGeneration")),1),e("p",null,s(A.$t("fileBrowser.planExecuting")),1),e("div",Vn,[v(o(b),{icon:"carbon:information"}),e("span",null,s(A.$t("fileBrowser.filesTip")),1)])]),e("button",{onClick:C,class:"retry-btn",disabled:r.value},[v(o(b),{icon:"carbon:refresh",class:oe({rotating:r.value})},null,8,["class"]),ne(" "+s(r.value?A.$t("fileBrowser.checking"):A.$t("fileBrowser.checkNow")),1)],8,Bn)])):(p(),h("div",Wn,[v(o(b),{icon:"carbon:warning"}),e("span",null,s(g.value),1),e("button",{onClick:C,class:"retry-btn"},s(A.$t("fileBrowser.retry")),1)]))])):k.value?(p(),h("div",On,[v(In,{node:k.value,level:0,onFileSelected:J,onDownloadFile:w},null,8,["node"])])):(p(),h("div",jn,[v(o(b),{icon:"carbon:folder-off"}),e("span",null,s(A.$t("fileBrowser.noFiles")),1)]))]),u.value?(p(),h("div",zn,[e("div",Hn,[e("div",Jn,[v(o(b),{icon:B(u.value)},null,8,["icon"]),e("span",Gn,s(u.value.name),1),e("span",Kn,"("+s(G(u.value.size))+")",1)]),e("div",Xn,[e("button",{onClick:ee[0]||(ee[0]=ae=>w(u.value)),class:"download-btn",title:A.$t("fileBrowser.download")},[v(o(b),{icon:"carbon:download"})],8,Qn),e("button",{onClick:D,class:"close-btn",title:A.$t("common.close")},[v(o(b),{icon:"carbon:close"})],8,Yn)])]),e("div",Zn,[V.value?(p(),h("div",eo,[v(o(b),{icon:"carbon:loading",class:"rotating"}),e("span",null,s(A.$t("fileBrowser.loadingContent")),1)])):S.value?(p(),h("div",to,[v(o(b),{icon:"carbon:warning"}),e("span",null,s(S.value),1)])):E.value?(p(),h("div",no,[z.value?(p(),h("div",oo,[e("pre",null,[e("code",null,s(E.value.content),1)])])):(p(),h("div",so,[v(o(b),{icon:"carbon:document-unknown"}),e("p",null,s(A.$t("fileBrowser.binaryFile")),1),e("button",{onClick:ee[1]||(ee[1]=ae=>w(u.value)),class:"download-btn-large"},[v(o(b),{icon:"carbon:download"}),ne(" "+s(A.$t("fileBrowser.downloadToView")),1)])]))])):q("",!0)])])):q("",!0)])]))}}),lo=Se(ao,[["__scopeId","data-v-2a488cd0"]]),io={class:"right-panel"},co={class:"preview-header"},ro={class:"preview-tabs"},uo={class:"preview-content"},po={key:0,class:"step-details"},ho={key:0,class:"step-info-fixed"},mo={key:0,class:"agent-info"},vo={class:"info-item"},go={class:"label"},fo={class:"value"},bo={class:"info-item"},ko={class:"label"},$o={class:"value"},_o={class:"info-item"},yo={class:"label"},Po={class:"value"},Co={class:"info-item"},So={class:"label"},wo={class:"value"},Eo={class:"info-item"},To={class:"label"},Io={class:"execution-status"},Do={class:"status-item"},xo={class:"status-text"},Ro={key:0},Ao={key:0,class:"think-act-steps"},Mo={class:"steps-container"},Fo={class:"step-header"},Uo={class:"step-number"},No={class:"think-section"},qo={class:"think-content"},Lo={class:"input"},Vo={class:"label"},Bo={class:"output"},Wo={class:"label"},jo={key:0,class:"action-section"},Oo={class:"action-content"},zo={class:"tool-info"},Ho={class:"label"},Jo={class:"value"},Go={class:"input"},Ko={class:"label"},Xo={class:"output"},Qo={class:"label"},Yo={key:0,class:"sub-plan-section"},Zo={class:"sub-plan-content"},es={class:"sub-plan-header"},ts={class:"sub-plan-info"},ns={class:"label"},os={class:"value"},ss={key:0,class:"sub-plan-info"},as={class:"label"},ls={class:"value"},is={class:"sub-plan-status"},cs={class:"status-text"},rs={key:0,class:"no-steps-message"},ds={key:1,class:"no-execution-message"},us={class:"step-basic-info"},ps={class:"info-item"},hs={class:"label"},ms={class:"value"},vs={key:0,class:"info-item"},gs={class:"label"},fs={class:"value"},bs={class:"info-item"},ks={class:"label"},$s={class:"no-execution-hint"},_s={key:2,class:"execution-indicator"},ys={class:"execution-text"},Ps={key:1,class:"no-selection"},Cs=["title"],Ss={key:1,class:"file-browser-container"},ws={key:1,class:"no-plan-message"},Es={class:"message-content"},Ts={class:"tips"},Is=Ce({__name:"index",props:{currentRootPlanId:{}},setup(T,{expose:t}){const n=T,{t:r}=xe(),g=I(),k=I(),u=I(),E=I("details"),V=I(localStorage.getItem("jmanus-last-plan-id")),S=I(localStorage.getItem("jmanus-has-executed-plan")==="true"),M=I(null),z=I(!1),L=I(!0),a=I(!0),f=ke(()=>u.value?u.value.completed?r("rightPanel.status.completed"):u.value.current?r("rightPanel.status.executing"):r("rightPanel.status.waiting"):""),C=ke(()=>n.currentRootPlanId?n.currentRootPlanId:V.value),J=ke(()=>!C.value&&!S.value),w=_=>{var O;if(console.log(`[RightPanel] updateDisplayedPlanProgress called with rootPlanId: ${_}`),u.value&&M.value){const W=M.value.rootPlanId??k.value;if(W&&W!==_){console.log(`[RightPanel] Plan ID mismatch - skipping update. Current: ${W}, Requested: ${_}`);return}}console.log(`[RightPanel] Plan ID validation passed - proceeding with update for rootPlanId: ${_}`);const R=he.getCachedPlanRecord(_);if(!R){console.warn(`[RightPanel] Plan data not found for rootPlanId: ${_}`);return}if(R.steps&&R.steps.length>0){const W=R.steps.length,x=(R.currentStepIndex??0)+1;console.log(`[RightPanel] Progress: ${x} / ${W}`)}if(u.value&&k.value&&(k.value===_||((O=M.value)==null?void 0:O.rootPlanId)===_)&&(console.log(`[RightPanel] Refreshing selected step details for plan: ${_}`),M.value)){const x=M.value,m=B(x.planId,x.rootPlanId,x.subPlanId);m?(G(m,x.stepIndex,x.planId,x.isSubPlan),Pe()):console.warn("[RightPanel] Could not find plan record for refresh:",x)}},D=(_,R,O,W,x)=>{console.log("[RightPanel] Step selected:",{planId:_,stepIndex:R,rootPlanId:O,subPlanId:W,subStepIndex:x});const m=!!(O&&W&&x!==void 0);M.value={planId:_,stepIndex:R,isSubPlan:m,...m&&{rootPlanId:O,subPlanId:W,subStepIndex:x}};const c=B(_,O,W);if(!c){console.warn("[RightPanel] Plan data not found:",{planId:_,rootPlanId:O,subPlanId:W}),u.value=null,M.value=null;return}G(c,R,_,m)},B=(_,R,O)=>{var m;if(!R||!O)return he.getCachedPlanRecord(_)??null;const W=he.getCachedPlanRecord(_);if(W)return W;const x=he.getCachedPlanRecord(R);if(!(x!=null&&x.agentExecutionSequence))return null;for(const c of x.agentExecutionSequence)if(c.thinkActSteps){for(const y of c.thinkActSteps)if(((m=y.subPlanExecutionRecord)==null?void 0:m.currentPlanId)===O)return y.subPlanExecutionRecord}return null},G=(_,R,O,W)=>{var Z,se,l,i,d;if(!_.steps||R>=_.steps.length){u.value=null,M.value=null,console.warn("[RightPanel] Invalid step data:",{planId:O,stepIndex:R,hasSteps:!!_.steps,stepsLength:(Z=_.steps)==null?void 0:Z.length,message:"Invalid step index"});return}k.value=O;const x=_.steps[R],m=(se=_.agentExecutionSequence)==null?void 0:se[R];console.log("[RightPanel] Step data details:",{planId:O,stepIndex:R,step:x,hasAgentExecutionSequence:!!_.agentExecutionSequence,agentExecutionSequenceLength:(l=_.agentExecutionSequence)==null?void 0:l.length,agentExecution:m,hasThinkActSteps:!!(m!=null&&m.thinkActSteps),thinkActStepsLength:(i=m==null?void 0:m.thinkActSteps)==null?void 0:i.length,isSubPlan:W});const c=(m==null?void 0:m.status)==="FINISHED",y=!c&&R===_.currentStepIndex&&!_.completed,F={planId:O,index:R,title:typeof x=="string"?x:x.title||x.description||x.name||`${W?"Sub ":""}Step ${R+1}`,description:typeof x=="string"?x:x.description||x,completed:c,current:y};m&&(F.agentExecution=m),u.value=F,console.log("[RightPanel] Step details updated:",{planId:O,stepIndex:R,stepTitle:u.value.title,hasAgentExecution:!!m,hasThinkActSteps:(((d=m==null?void 0:m.thinkActSteps)==null?void 0:d.length)??0)>0,completed:c,current:y,planCurrentStep:_.currentStepIndex,planCompleted:_.completed,isSubPlan:W}),m!=null&&m.thinkActSteps&&m.thinkActSteps.forEach(($,H)=>{$.subPlanExecutionRecord&&console.log(`[RightPanel] Found sub-plan in thinkActStep ${H}:`,$.subPlanExecutionRecord)}),setTimeout(()=>{ae()},100),Pe()},A=(_,R,O,W)=>{console.log("[RightPanel] Sub plan step selected (delegating to unified handler):",{rootPlanId:_,subPlanId:R,stepIndex:O,subStepIndex:W}),D(R,W,_,R,W)},ee=_=>{g.value=_??void 0},ae=()=>{if(!g.value)return;const{scrollTop:_,scrollHeight:R,clientHeight:O}=g.value,W=R-_-O<50,x=R>O;L.value=W,z.value=x&&!W,W?a.value=!0:R-_-O>100&&(a.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:_,scrollHeight:R,clientHeight:O,isAtBottom:W,hasScrollableContent:x,showButton:z.value,shouldAutoScroll:a.value})},ce=()=>{g.value&&(g.value.scrollTo({top:g.value.scrollHeight,behavior:"smooth"}),ue(()=>{a.value=!0,ae()}))},Pe=()=>{!a.value||!g.value||ue(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},ve=_=>{if(_===null||typeof _>"u"||_==="")return"N/A";try{const R=typeof _=="object"?_:JSON.parse(_);return JSON.stringify(R,null,2)}catch{return String(_)}},ge=()=>{u.value=null,k.value=void 0,a.value=!0,g.value&&g.value.removeEventListener("scroll",ae)},Te=()=>{const _=()=>{const R=g.value;return R?(ee(R),R.addEventListener("scroll",ae),a.value=!0,ae(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ue(()=>{_()||setTimeout(()=>{_()},100)})};return ye(()=>n.currentRootPlanId,(_,R)=>{_&&_!==R?(V.value=_,S.value=!0,localStorage.setItem("jmanus-last-plan-id",_),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",_)):!_&&R&&console.log("[RightPanel] Plan execution finished, keeping last plan:",V.value)},{immediate:!0}),we(()=>{console.log("[RightPanel] Component mounted"),ue(()=>{Te()})}),Ee(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),M.value=null,ge()}),t({updateDisplayedPlanProgress:w,handleStepSelected:D,handleSubPlanStepSelected:A}),(_,R)=>{var O,W;return p(),h("div",io,[e("div",co,[e("div",ro,[e("div",{class:oe(["tab-item",{active:E.value==="details"}]),onClick:R[0]||(R[0]=x=>E.value="details")},[v(o(b),{icon:"carbon:events"}),e("span",null,s(o(r)("rightPanel.stepExecutionDetails")),1)],2),e("div",{class:oe(["tab-item",{active:E.value==="files"}]),onClick:R[1]||(R[1]=x=>E.value="files")},[v(o(b),{icon:"carbon:folder"}),e("span",null,s(o(r)("fileBrowser.title")),1)],2)])]),e("div",uo,[E.value==="details"?(p(),h("div",po,[u.value?(p(),h("div",ho,[e("h3",null,s(u.value.title||u.value.description||o(r)("rightPanel.defaultStepTitle",{number:u.value.index+1})),1),u.value.agentExecution?(p(),h("div",mo,[e("div",vo,[e("span",go,s(o(r)("rightPanel.executingAgent"))+":",1),e("span",fo,s(u.value.agentExecution.agentName),1)]),e("div",bo,[e("span",ko,s(o(r)("rightPanel.description"))+":",1),e("span",$o,s(u.value.agentExecution.agentDescription||""),1)]),e("div",_o,[e("span",yo,s(o(r)("rightPanel.callingModel"))+":",1),e("span",Po,s(u.value.agentExecution.modelName),1)]),e("div",Co,[e("span",So,s(o(r)("rightPanel.request"))+":",1),e("span",wo,s(u.value.agentExecution.agentRequest||""),1)]),e("div",Eo,[e("span",To,s(o(r)("rightPanel.executionResult"))+":",1),e("span",{class:oe(["value",{success:u.value.agentExecution.status==="FINISHED"}])},s(u.value.agentExecution.status||o(r)("rightPanel.executing")),3)])])):q("",!0),e("div",Io,[e("div",Do,[u.value.completed?(p(),me(o(b),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):u.value.current?(p(),me(o(b),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),me(o(b),{key:2,icon:"carbon:time",class:"status-icon pending"})),e("span",xo,s(f.value),1)])])])):q("",!0),e("div",{ref_key:"scrollContainer",ref:g,class:"step-details-scroll-container",onScroll:ae},[u.value?(p(),h("div",Ro,[(O=u.value.agentExecution)!=null&&O.thinkActSteps&&u.value.agentExecution.thinkActSteps.length>0?(p(),h("div",Ao,[e("h4",null,s(o(r)("rightPanel.thinkAndActionSteps")),1),e("div",Mo,[(p(!0),h(be,null,_e(u.value.agentExecution.thinkActSteps,(x,m)=>(p(),h("div",{key:m,class:"think-act-step"},[e("div",Fo,[e("span",Uo,"#"+s(m+1),1),e("span",{class:oe(["step-status",x.status])},s(x.status||o(r)("rightPanel.executing")),3)]),e("div",No,[e("h5",null,[v(o(b),{icon:"carbon:thinking"}),ne(" "+s(o(r)("rightPanel.thinking")),1)]),e("div",qo,[e("div",Lo,[e("span",Vo,s(o(r)("rightPanel.input"))+":",1),e("pre",null,s(ve(x.thinkInput)),1)]),e("div",Bo,[e("span",Wo,s(o(r)("rightPanel.output"))+":",1),e("pre",null,s(ve(x.thinkOutput)),1)])])]),x.actionNeeded?(p(),h("div",jo,[e("h5",null,[v(o(b),{icon:"carbon:play"}),ne(" "+s(o(r)("rightPanel.action")),1)]),e("div",Oo,[(p(!0),h(be,null,_e(x.actToolInfoList,(c,y)=>(p(),h("div",{key:y},[e("div",zo,[e("span",Ho,s(o(r)("rightPanel.tool"))+":",1),e("span",Jo,s(c.name||""),1)]),e("div",Go,[e("span",Ko,s(o(r)("rightPanel.toolParameters"))+":",1),e("pre",null,s(ve(c.parameters)),1)]),e("div",Xo,[e("span",Qo,s(o(r)("rightPanel.executionResult"))+":",1),e("pre",null,s(ve(c.result)),1)])]))),128))]),x.subPlanExecutionRecord?(p(),h("div",Yo,[e("h5",null,[v(o(b),{icon:"carbon:tree-view"}),ne(" "+s(o(r)("rightPanel.subPlan")),1)]),e("div",Zo,[e("div",es,[e("div",ts,[e("span",ns,s(_.$t("rightPanel.subPlanId"))+":",1),e("span",os,s(x.subPlanExecutionRecord.currentPlanId),1)]),x.subPlanExecutionRecord.title?(p(),h("div",ss,[e("span",as,s(_.$t("rightPanel.title"))+":",1),e("span",ls,s(x.subPlanExecutionRecord.title),1)])):q("",!0),e("div",is,[x.subPlanExecutionRecord.completed?(p(),me(o(b),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),me(o(b),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),e("span",cs,s(x.subPlanExecutionRecord.completed?_.$t("rightPanel.status.completed"):_.$t("rightPanel.status.executing")),1)])])])])):q("",!0)])):q("",!0)]))),128))]),u.value.agentExecution&&!((W=u.value.agentExecution.thinkActSteps)!=null&&W.length)?(p(),h("div",rs,[e("p",null,s(o(r)("rightPanel.noStepDetails")),1)])):u.value.agentExecution?q("",!0):(p(),h("div",ds,[v(o(b),{icon:"carbon:information",class:"info-icon"}),e("h4",null,s(o(r)("rightPanel.stepInfo")),1),e("div",us,[e("div",ps,[e("span",hs,s(o(r)("rightPanel.stepName"))+":",1),e("span",ms,s(u.value.title||u.value.description||_.$t("rightPanel.stepNumber",{number:u.value.index+1})),1)]),u.value.description?(p(),h("div",vs,[e("span",gs,s(_.$t("rightPanel.description"))+":",1),e("span",fs,s(u.value.description),1)])):q("",!0),e("div",bs,[e("span",ks,s(_.$t("rightPanel.status.label"))+":",1),e("span",{class:oe(["value",{"status-completed":u.value.completed,"status-current":u.value.current,"status-pending":!u.value.completed&&!u.value.current}])},s(u.value.completed?_.$t("rightPanel.status.completed"):u.value.current?_.$t("rightPanel.status.executing"):_.$t("rightPanel.status.pending")),3)])]),e("p",$s,s(o(r)("rightPanel.noExecutionInfo")),1)])),u.value.current&&!u.value.completed?(p(),h("div",_s,[R[2]||(R[2]=e("div",{class:"execution-waves"},[e("div",{class:"wave wave-1"}),e("div",{class:"wave wave-2"}),e("div",{class:"wave wave-3"})],-1)),e("p",ys,[v(o(b),{icon:"carbon:in-progress",class:"rotating-icon"}),ne(" "+s(o(r)("rightPanel.stepExecuting")),1)])])):q("",!0)])):(p(),h("div",Ps,[v(o(b),{icon:"carbon:events",class:"empty-icon"}),e("h3",null,s(o(r)("rightPanel.noStepSelected")),1),e("p",null,s(o(r)("rightPanel.selectStepHint")),1)]))])):q("",!0),v(Fe,{name:"scroll-button"},{default:Ue(()=>[z.value?(p(),h("button",{key:0,onClick:ce,class:"scroll-to-bottom-btn",title:o(r)("rightPanel.scrollToBottom")},[v(o(b),{icon:"carbon:chevron-down"})],8,Cs)):q("",!0)]),_:1})],544)])):q("",!0),E.value==="files"?(p(),h("div",Ss,[C.value?(p(),me(lo,{key:0,"plan-id":C.value},null,8,["plan-id"])):J.value?(p(),h("div",ws,[v(o(b),{icon:"carbon:folder-off"}),e("div",Es,[e("h3",null,s(o(r)("fileBrowser.noFilesYet")),1),e("p",null,s(o(r)("fileBrowser.noPlanExecuting")),1),e("div",Ts,[v(o(b),{icon:"carbon:information"}),e("span",null,s(o(r)("fileBrowser.startTaskTip")),1)])])])):q("",!0)])):q("",!0)])])}}}),Ds=Se(Is,[["__scopeId","data-v-1f1365f7"]]);function xs(){const T=he,t=ke(()=>T.getActivePlanId()),n=ke(()=>T.getState()),r=ke(()=>n.value.isPolling),g=ke(()=>!!t.value),k=(S,M)=>{T.initiatePlanExecutionSequence(S,M)},u=()=>{T.stopPolling()},E=()=>{T.startPolling()},V=()=>{T.cleanup()};return Ee(()=>{V()}),{activePlanId:t,state:n,isPolling:r,hasActivePlan:g,startExecution:k,stopPolling:u,startPolling:E,cleanup:V}}const Rs={class:"chat-container"},As={class:"message-content"},Ms={key:0,class:"user-message"},Fs={key:1,class:"assistant-message"},Us={key:0,class:"thinking-section"},Ns={class:"thinking-header"},qs={class:"thinking-avatar"},Ls={class:"thinking-label"},Vs={class:"thinking-content"},Bs={key:0,class:"thinking"},Ws={key:1,class:"progress"},js={class:"progress-bar"},Os={class:"progress-text"},zs={key:2,class:"steps-container"},Hs={class:"steps-title"},Js=["onClick"],Gs={class:"section-header"},Ks={class:"step-icon"},Xs={class:"step-title"},Qs={key:0,class:"step-status current"},Ys={key:1,class:"step-status completed"},Zs={key:2,class:"step-status pending"},ea={key:0,class:"action-info"},ta={class:"action-description"},na={class:"action-icon"},oa={key:0,class:"tool-params"},sa={class:"param-label"},aa={class:"param-content"},la={key:1,class:"think-details"},ia={class:"think-header"},ca={class:"think-label"},ra={class:"think-output"},da={class:"think-content"},ua={key:1,class:"sub-plan-steps"},pa={class:"sub-plan-header"},ha={class:"sub-plan-title"},ma={class:"sub-plan-step-list"},va=["onClick"],ga={class:"sub-step-indicator"},fa={class:"sub-step-icon"},ba={class:"sub-step-number"},ka={class:"sub-step-content"},$a={class:"sub-step-title"},_a={class:"sub-step-badge"},ya={key:2,class:"user-input-form-container"},Pa={class:"user-input-message"},Ca={key:0,class:"form-description"},Sa=["onSubmit"],wa={key:0,class:"form-grid"},Ea=["for"],Ta=["id","name","placeholder","required","onUpdate:modelValue"],Ia=["id","name","placeholder","required","onUpdate:modelValue"],Da=["id","name","placeholder","required","onUpdate:modelValue"],xa=["id","name","placeholder","required","onUpdate:modelValue"],Ra=["id","name","placeholder","required","onUpdate:modelValue"],Aa=["id","name","required","onUpdate:modelValue"],Ma={value:""},Fa=["value"],Ua=["id","name","placeholder","required","onUpdate:modelValue"],Na={key:1,class:"form-group"},qa={for:"form-input-genericInput"},La=["onUpdate:modelValue"],Va={type:"submit",class:"submit-user-input-btn"},Ba={key:3,class:"default-processing"},Wa={class:"processing-indicator"},ja={class:"response-section"},Oa={class:"response-header"},za={class:"response-avatar"},Ha={class:"response-name"},Ja={class:"response-content"},Ga={key:0,class:"final-response"},Ka=["innerHTML"],Xa={key:1,class:"response-placeholder"},Qa={class:"typing-indicator"},Ya={class:"typing-text"},Za={key:0,class:"message assistant"},el={class:"message-content"},tl={class:"assistant-message"},nl={class:"thinking-section"},ol={class:"thinking-header"},sl={class:"thinking-avatar"},al={class:"thinking-label"},ll={class:"thinking-content"},il={class:"default-processing"},cl={class:"processing-indicator"},rl={class:"response-section"},dl={class:"response-header"},ul={class:"response-avatar"},pl={class:"response-name"},hl={class:"response-content"},ml={class:"response-placeholder"},vl={class:"typing-indicator"},gl={class:"typing-text"},fl=["title"],bl=Ce({__name:"index",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected","sub-plan-step-selected"],setup(T,{expose:t,emit:n}){const r=T,g=n,{t:k}=xe(),u=xs(),E=I(),V=I(!1),S=I([]),M=I(),z=I(!1),L=ct({}),a=(l,i,d)=>{const $={id:Date.now().toString(),type:l,content:i,timestamp:new Date,...d};return l==="assistant"&&!$.thinking&&!$.content&&($.thinking=k("chat.thinking")),S.value.push($),$},f=l=>{const i=S.value[S.value.length-1];i.type==="assistant"&&Object.assign(i,l)},C=async l=>{try{V.value=!0;const i=a("assistant","",{thinking:k("chat.thinkingProcessing")}),d=await We.sendMessage(l);if(d.planId)console.log("[ChatComponent] Received planId from direct execution:",d.planId),i.planExecution||(i.planExecution={}),i.planExecution.currentPlanId=d.planId,he.handlePlanExecutionRequested(d.planId,l),delete i.thinking,console.log("[ChatComponent] Started polling for plan execution updates");else{delete i.thinking;const $=J(d,l);i.content=$}}catch(i){console.error("Direct mode error:",i),f({content:w(i)})}finally{V.value=!1}},J=(l,i)=>l.result??l.message??l.content??"",w=l=>{const i=(l==null?void 0:l.message)??(l==null?void 0:l.toString())??k("chat.unknownError");return i.includes("network")||i.includes("timeout")?k("chat.networkError"):i.includes("auth")||i.includes("unauthorized")?k("chat.authError"):i.includes("invalid")||i.includes("format")||i.includes("parameter")?k("chat.formatError"):`${k("chat.unknownError")} (${i})`},D=(l=!1)=>{ue(()=>{if(E.value){const i=E.value;(l||i.scrollHeight-i.scrollTop-i.clientHeight<150)&&i.scrollTo({top:i.scrollHeight,behavior:l?"auto":"smooth"})}})},B=()=>{D(!0),z.value=!1},G=()=>{if(E.value){const l=E.value,i=l.scrollHeight-l.scrollTop-l.clientHeight<150;z.value=!i&&S.value.length>0}},A=()=>{E.value&&E.value.addEventListener("scroll",G)},ee=()=>{E.value&&E.value.removeEventListener("scroll",G)},ae=l=>{a("user",l),r.mode==="plan"?console.log("[ChatComponent] Plan mode message sent, parent should handle:",l):C(l)},ce=(l,i)=>{var H;const d=((H=l.planExecution)==null?void 0:H.agentExecutionSequence)??[];return i<0||i>=d.length?"IDLE":d[i].status??"IDLE"},Pe=(l,i)=>{var d,$;if(!((d=l.planExecution)!=null&&d.currentPlanId)){console.warn("[ChatComponent] Cannot handle step click: missing currentPlanId");return}console.log("[ChatComponent] Step clicked:",{planId:l.planExecution.currentPlanId,stepIndex:i,stepTitle:($=l.planExecution.steps)==null?void 0:$[i]}),g("step-selected",l.planExecution.currentPlanId,i)},ve=(l,i)=>{var d;try{const $=(d=l.planExecution)==null?void 0:d.agentExecutionSequence;if(!($!=null&&$.length))return console.log("[ChatComponent] No agentExecutionSequence found"),[];const H=$[i];if(!H)return console.log(`[ChatComponent] No agentExecution found for step ${i}`),[];if(!H.thinkActSteps)return console.log(`[ChatComponent] No thinkActSteps found for step ${i}`),[];for(const j of H.thinkActSteps)if(j.subPlanExecutionRecord)return console.log(`[ChatComponent] Found sub-plan for step ${i}:`,j.subPlanExecutionRecord),(j.subPlanExecutionRecord.steps??[]).map(K=>typeof K=="string"?K:typeof K=="object"&&K!==null&&(K.title||K.description)||k("rightPanel.subStep"));return[]}catch($){return console.warn("[ChatComponent] Error getting sub-plan steps:",$),[]}},ge=(l,i,d)=>{var $;try{const H=($=l.planExecution)==null?void 0:$.agentExecutionSequence;if(!(H!=null&&H.length))return"pending";const j=H[i];if(!j||!j.thinkActSteps)return"pending";let le=null;for(const X of j.thinkActSteps)if(X.subPlanExecutionRecord){le=X.subPlanExecutionRecord;break}if(!le)return"pending";const K=le.currentStepIndex;return le.completed?"completed":K==null?d===0?"current":"pending":d<K?"completed":d===K?"current":"pending"}catch(H){return console.warn("[ChatComponent] Error getting sub-plan step status:",H),"pending"}},Te=(l,i,d)=>{var $,H;try{const j=($=l.planExecution)==null?void 0:$.agentExecutionSequence;if(!(j!=null&&j.length)){console.warn("[ChatComponent] No agentExecutionSequence data for sub-plan step click");return}const le=j[i];if(!le){console.warn("[ChatComponent] No agentExecution found for step",i);return}if(!le.thinkActSteps){console.warn("[ChatComponent] No thinkActSteps found for step",i);return}let K=null;for(const X of le.thinkActSteps)if(X.subPlanExecutionRecord){K=X.subPlanExecutionRecord;break}if(!(K!=null&&K.currentPlanId)){console.warn("[ChatComponent] No sub-plan data for step click");return}g("sub-plan-step-selected",((H=l.planExecution)==null?void 0:H.currentPlanId)??"",K.currentPlanId,i,d)}catch(j){console.error("[ChatComponent] Error handling sub-plan step click:",j)}},_=(l,i)=>{var $,H,j,le;if(!(($=l.planExecution)!=null&&$.steps))return;console.log("[ChatComponent] Starting to update step actions, steps count:",l.planExecution.steps.length,"execution sequence:",((H=i.agentExecutionSequence)==null?void 0:H.length)??0);const d=new Array(l.planExecution.steps.length).fill(null);if((j=i.agentExecutionSequence)!=null&&j.length){const K=Math.min(i.agentExecutionSequence.length,l.planExecution.steps.length);for(let X=0;X<K;X++){const U=i.agentExecutionSequence[X];if((le=U.thinkActSteps)!=null&&le.length){const Q=U.thinkActSteps[U.thinkActSteps.length-1];Q.actionDescription&&Q.toolParameters?(d[X]={actionDescription:Q.actionDescription,toolParameters:typeof Q.toolParameters=="string"?Q.toolParameters:JSON.stringify(Q.toolParameters,null,2),thinkInput:Q.thinkInput??"",thinkOutput:Q.thinkOutput??"",status:i.currentStepIndex!==void 0&&X<i.currentStepIndex?"completed":i.currentStepIndex!==void 0&&X===i.currentStepIndex?"current":"pending"},console.log(`[ChatComponent] Step ${X} action set: ${d[X].actionDescription}`)):(d[X]={actionDescription:k("chat.thinking"),toolParameters:k("chat.waitingDecision"),thinkInput:Q.thinkInput??"",thinkOutput:Q.thinkOutput??"",status:i.currentStepIndex!==void 0&&X===i.currentStepIndex?"current":"pending"},console.log(`[ChatComponent] Step ${X} is thinking`))}else d[X]={actionDescription:i.currentStepIndex!==void 0&&X<i.currentStepIndex?k("chat.status.completed"):k("chat.status.pending"),toolParameters:k("chat.noToolParameters"),thinkInput:"",thinkOutput:"",status:i.currentStepIndex!==void 0&&X<i.currentStepIndex?"completed":"pending"},console.log(`[ChatComponent] Step ${X} has no execution details, status set to: ${d[X].status}`)}}else console.log("[ChatComponent] No execution sequence data");l.stepActions=[...d],console.log("[ChatComponent] Step actions update completed:",JSON.stringify(d.map(K=>K==null?void 0:K.actionDescription))),ue(()=>{console.log("[ChatComponent] UI update completed via reactivity")})},R=l=>{console.log("[ChatComponent] Starting dialog round with planId:",l),l&&(S.value.findIndex(d=>{var $;return(($=d.planExecution)==null?void 0:$.currentPlanId)===l&&d.type==="assistant"})===-1?(a("assistant","",{planExecution:{currentPlanId:l},thinking:k("chat.preparingExecution")}),console.log("[ChatComponent] Created new assistant message for planId:",l)):console.log("[ChatComponent] Found existing assistant message for planId:",l))},O=l=>{var j,le,K,X;console.log("[ChatComponent] Processing plan update with rootPlanId:",l);const i=he.getCachedPlanRecord(l);if(!i){console.warn("[ChatComponent] No cached plan data found for rootPlanId:",l);return}if(console.log("[ChatComponent] Retrieved plan details from cache:",i),console.log("[ChatComponent] Plan steps:",i.steps),console.log("[ChatComponent] Plan completed:",i.completed),!i.currentPlanId){console.warn("[ChatComponent] Plan update missing currentPlanId");return}const d=S.value.findIndex(U=>{var Q;return((Q=U.planExecution)==null?void 0:Q.currentPlanId)===i.currentPlanId&&U.type==="assistant"});let $;if(d!==-1)$=S.value[d],console.log("[ChatComponent] Found existing assistant message for currentPlanId:",i.currentPlanId);else{console.warn("[ChatComponent] No existing assistant message found for currentPlanId:",i.currentPlanId),console.log("[ChatComponent] Current messages:",S.value.map(Q=>{var fe;return{type:Q.type,planId:(fe=Q.planExecution)==null?void 0:fe.currentPlanId,content:Q.content.substring(0,50)}}));let U=-1;for(let Q=S.value.length-1;Q>=0;Q--)if(S.value[Q].type==="assistant"){U=Q;break}if(U!==-1)$=S.value[U],$.planExecution||($.planExecution={}),$.planExecution.currentPlanId=i.currentPlanId,console.log("[ChatComponent] Using last assistant message and updating planExecution.currentPlanId to:",i.currentPlanId);else{console.error("[ChatComponent] No assistant message found at all, this should not happen");return}}if($.planExecution||($.planExecution={}),$.planExecution=JSON.parse(JSON.stringify(i)),!i.steps||i.steps.length===0){if(console.log("[ChatComponent] Handling simple response without steps"),i.completed){delete $.thinking;const U=i.summary??i.result??i.message??k("chat.executionCompleted");$.content=W(U),console.log("[ChatComponent] Set simple response content:",$.content)}else i.title&&($.thinking=`${k("chat.thinkingExecuting",{title:i.title})}`);return}delete $.thinking;const H=i.steps.map(U=>typeof U=="string"?U:typeof U=="object"&&U!==null&&(U.title||U.description)||k("chat.step"));if($.planExecution&&($.planExecution.steps=H),i.agentExecutionSequence&&i.agentExecutionSequence.length>0){console.log("[ChatComponent] Found execution sequence data, count:",i.agentExecutionSequence.length),_($,i);const U=i.currentStepIndex??0;if(U>=0&&U<i.agentExecutionSequence.length){const fe=i.agentExecutionSequence[U].thinkActSteps;if(fe&&fe.length>0){const Re=fe[fe.length-1];if(Re.thinkOutput){const Le=Re.thinkOutput.length>150?Re.thinkOutput.substring(0,150)+"...":Re.thinkOutput;$.thinking=`${k("chat.thinking")}: ${Le}`}}}}else if($.planExecution){const U=$.planExecution.currentStepIndex??0,Q=(j=$.planExecution.steps)==null?void 0:j[U],fe=typeof Q=="string"?Q:"";$.thinking=`${k("chat.thinkingExecuting",{title:fe})}`}if(i.userInputWaitState&&$.planExecution?(console.log("[ChatComponent] User input required:",i.userInputWaitState),$.planExecution.userInputWaitState||($.planExecution.userInputWaitState={}),$.planExecution.userInputWaitState={message:i.userInputWaitState.message??"",formDescription:i.userInputWaitState.formDescription??"",formInputs:((le=i.userInputWaitState.formInputs)==null?void 0:le.map(U=>({label:U.label,value:U.value||"",type:U.type||"text",required:U.required==="true"||U.required===!0,placeholder:U.placeholder||"",name:U.name||U.label,options:U.options||void 0})))??[]},L[K=$.id]??(L[K]={}),$.thinking=k("input.waiting")):(X=$.planExecution)!=null&&X.userInputWaitState&&delete $.planExecution.userInputWaitState,i.completed??i.status==="completed"){console.log("[ChatComponent] Plan is completed, updating final response"),delete $.thinking;let U="";i.summary?U=i.summary:i.result?U=i.result:U=k("chat.executionCompleted"),$.content=x(U),console.log("[ChatComponent] Updated completed message:",$.content)}ue(()=>{console.log("[ChatComponent] Plan update UI refresh completed via reactivity")})},W=l=>l?l.includes("I ")||l.includes("you")||l.includes("hello")||l.includes("can")||l.includes("I")||l.includes("you")||l.includes("can")?l:l.length<10?`${l}! ${k("chat.anythingElse")}`:l.length<50?`${k("chat.okayDone",{text:l})}. ${k("chat.ifOtherQuestions")}`:`${l}

${k("chat.hopeHelpful")} ${k("chat.anythingElse")}`:k("chat.defaultResponse"),x=l=>l?`${l}`:`${k("chat.executionCompleted")}! ${k("chat.anythingElse")}`,m=l=>{console.log("[ChatComponent] Plan completed with rootPlanId:",l);const i=he.getCachedPlanRecord(l);if(!i){console.warn("[ChatComponent] No cached plan data found for rootPlanId:",l);return}if(console.log("[ChatComponent] Plan details:",i),i.rootPlanId){const d=S.value.findIndex($=>{var H;return((H=$.planExecution)==null?void 0:H.currentPlanId)===i.rootPlanId});if(d!==-1){const $=S.value[d];delete $.thinking;let j=i.summary??i.result??k("chat.executionCompleted");!j.includes("I")&&!j.includes("you")&&(j.includes("success")||j.includes("complete")||j.includes("finished")?j=`${k("chat.great")}${j}. ${k("chat.ifOtherHelp")}`:j=`${k("chat.completedRequest",{result:j})}`),$.content=j,console.log("[ChatComponent] Updated completed message:",$.content)}else console.warn("[ChatComponent] No message found for completed rootPlanId:",i.rootPlanId)}},c=l=>{V.value=!1,S.value[S.value.length-1]={id:Date.now().toString(),type:"assistant",content:l,timestamp:new Date}},y=l=>{if(!l)return"";let i=l.replace(/\n\n/g,"<br><br>").replace(/\n/g,"<br>");return i=i.replace(/(<br><br>)/g,"</p><p>"),i.includes("</p><p>")&&(i=`<p>${i}</p>`),i},F=async l=>{var i;if(!((i=l.planExecution)!=null&&i.currentPlanId)||!l.planExecution.userInputWaitState){console.error("[ChatComponent] Missing planExecution.currentPlanId or userInputWaitState");return}try{const d={},$=l.planExecution.userInputWaitState.formInputs;$&&$.length>0?Object.entries(L[l.id]).forEach(([j,le])=>{var U;const K=parseInt(j,10),X=((U=$[K])==null?void 0:U.label)||`input_${j}`;d[X]=le}):d.genericInput=l.genericInput??"",console.log("[ChatComponent] Submitting user input:",d);const H=await je.submitFormInput(l.planExecution.currentPlanId,d);delete l.planExecution.userInputWaitState,delete l.genericInput,delete L[l.id],u.startPolling(),console.log("[ChatComponent] User input submitted successfully:",H)}catch(d){console.error("[ChatComponent] User input submission failed:",d),alert(`${k("common.submitFailed")}: ${(d==null?void 0:d.message)||k("common.unknownError")}`)}};ye(()=>r.initialPrompt,(l,i)=>{console.log("[ChatComponent] initialPrompt changed from:",i,"to:",l),l&&typeof l=="string"&&l.trim()&&l!==i&&(console.log("[ChatComponent] Processing changed initial prompt:",l),ue(()=>{ae(l)}))},{immediate:!1}),we(()=>{console.log("[ChatComponent] Mounted, setting up event listeners"),he.setEventCallbacks({onPlanUpdate:O,onPlanCompleted:m,onDialogRoundStart:R,onChatInputUpdateState:l=>{console.log("[ChatComponent] Chat input state update for rootPlanId:",l)},onChatInputClear:()=>{console.log("[ChatComponent] Chat input clear requested")},onPlanError:c}),ue(()=>{A()}),r.initialPrompt&&typeof r.initialPrompt=="string"&&r.initialPrompt.trim()&&(console.log("[ChatComponent] Processing initial prompt:",r.initialPrompt),ue(()=>{ae(r.initialPrompt)}))}),Ee(()=>{console.log("[ChatComponent] Unmounting, cleaning up resources"),ee(),M.value&&clearInterval(M.value),u.cleanup(),Object.keys(L).forEach(l=>delete L[l])});const Z=l=>l?Array.isArray(l)?l:typeof l=="string"?l.split(",").map(i=>i.trim()).filter(i=>i.length>0):[]:[],se=l=>typeof l=="boolean"?l:typeof l=="string"?l==="true":!1;return t({handleSendMessage:ae,handlePlanUpdate:O,handlePlanCompleted:m,handleDialogRoundStart:R,addMessage:a,handlePlanError:c}),(l,i)=>(p(),h("div",Rs,[e("div",{class:"messages",ref_key:"messagesRef",ref:E},[(p(!0),h(be,null,_e(S.value,d=>{var $,H,j,le,K,X,U,Q,fe;return p(),h("div",{key:d.id,class:oe(["message",{user:d.type==="user",assistant:d.type==="assistant"}])},[e("div",As,[d.type==="user"?(p(),h("div",Ms,s(d.content),1)):(p(),h("div",Fs,[d.thinking||(($=d.planExecution)==null?void 0:$.progress)!==void 0||(((j=(H=d.planExecution)==null?void 0:H.steps)==null?void 0:j.length)??0)>0?(p(),h("div",Us,[e("div",Ns,[e("div",qs,[v(o(b),{icon:"carbon:thinking",class:"thinking-icon"})]),e("div",Ls,s(l.$t("chat.thinkingLabel")),1)]),e("div",Vs,[d.thinking?(p(),h("div",Bs,[v(o(b),{icon:"carbon:thinking",class:"thinking-icon"}),e("span",null,s(d.thinking),1)])):q("",!0),((le=d.planExecution)==null?void 0:le.progress)!==void 0?(p(),h("div",Ws,[e("div",js,[e("div",{class:"progress-fill",style:Ne({width:d.planExecution.progress+"%"})},null,4)]),e("span",Os,s(d.planExecution.progressText??l.$t("chat.processing")+"..."),1)])):q("",!0),(((X=(K=d.planExecution)==null?void 0:K.steps)==null?void 0:X.length)??0)>0?(p(),h("div",zs,[e("h4",Hs,s(l.$t("chat.stepExecutionDetails")),1),(p(!0),h(be,null,_e((U=d.planExecution)==null?void 0:U.steps,(Re,Y)=>{var Le,Oe,ze,He,Je,Ge,Ke,Xe,Qe,Ye,Ze,et,tt,nt,ot,st,at,lt,it;return p(),h("div",{key:Y,class:oe(["ai-section",{running:ce(d,Y)==="RUNNING",completed:ce(d,Y)==="FINISHED",pending:ce(d,Y)==="IDLE"}]),onClick:de(N=>Pe(d,Y),["stop"])},[e("div",Gs,[e("span",Ks,s(ce(d,Y)==="FINISHED"?"âœ“":ce(d,Y)==="RUNNING"?"â–¶":"â—‹"),1),e("span",Xs,s(Re||`${l.$t("chat.step")} ${Y+1}`),1),ce(d,Y)==="RUNNING"?(p(),h("span",Qs,s(l.$t("chat.status.executing")),1)):ce(d,Y)==="FINISHED"?(p(),h("span",Ys,s(l.$t("chat.status.completed")),1)):(p(),h("span",Zs,s(l.$t("chat.status.pending")),1))]),d.stepActions&&d.stepActions[Y]?(p(),h("div",ea,[e("div",ta,[e("span",na,s(((Le=d.stepActions[Y])==null?void 0:Le.status)==="current"?"ðŸ”„":((Oe=d.stepActions[Y])==null?void 0:Oe.status)==="completed"?"âœ“":"â³"),1),e("strong",null,s((ze=d.stepActions[Y])==null?void 0:ze.actionDescription),1)]),(He=d.stepActions[Y])!=null&&He.toolParameters?(p(),h("div",oa,[i[0]||(i[0]=e("span",{class:"tool-icon"},"âš™ï¸",-1)),e("span",sa,s(l.$t("common.parameters"))+":",1),e("pre",aa,s((Je=d.stepActions[Y])==null?void 0:Je.toolParameters),1)])):q("",!0),(Ge=d.stepActions[Y])!=null&&Ge.thinkOutput?(p(),h("div",la,[e("div",ia,[i[1]||(i[1]=e("span",{class:"think-icon"},"ðŸ’­",-1)),e("span",ca,s(l.$t("chat.thinkingOutput"))+":",1)]),e("div",ra,[e("pre",da,s((Ke=d.stepActions[Y])==null?void 0:Ke.thinkOutput),1)])])):q("",!0)])):q("",!0),((Xe=ve(d,Y))==null?void 0:Xe.length)>0?(p(),h("div",ua,[e("div",pa,[v(o(b),{icon:"carbon:tree-view",class:"sub-plan-icon"}),e("span",ha,s(l.$t("rightPanel.subPlan")),1)]),e("div",ma,[(p(!0),h(be,null,_e(ve(d,Y),(N,te)=>(p(),h("div",{key:`sub-${Y}-${te}`,class:oe(["sub-plan-step-item",{completed:ge(d,Y,te)==="completed",current:ge(d,Y,te)==="current",pending:ge(d,Y,te)==="pending"}]),onClick:de(ie=>Te(d,Y,te),["stop"])},[e("div",ga,[e("span",fa,s(ge(d,Y,te)==="completed"?"âœ“":ge(d,Y,te)==="current"?"â–¶":"â—‹"),1),e("span",ba,s(te+1),1)]),e("div",ka,[e("span",$a,s(N),1),e("span",_a,s(l.$t("rightPanel.subStep")),1)])],10,va))),128))])])):q("",!0),(Qe=d.planExecution)!=null&&Qe.userInputWaitState&&ce(d,Y)==="RUNNING"?(p(),h("div",ya,[e("p",Pa,s(((Ze=(Ye=d.planExecution)==null?void 0:Ye.userInputWaitState)==null?void 0:Ze.message)??l.$t("chat.userInput.message")),1),(tt=(et=d.planExecution)==null?void 0:et.userInputWaitState)!=null&&tt.formDescription?(p(),h("p",Ca,s((ot=(nt=d.planExecution)==null?void 0:nt.userInputWaitState)==null?void 0:ot.formDescription),1)):q("",!0),e("form",{onSubmit:de(N=>F(d),["prevent"]),class:"user-input-form"},[(at=(st=d.planExecution)==null?void 0:st.userInputWaitState)!=null&&at.formInputs&&d.planExecution.userInputWaitState.formInputs.length>0?(p(),h("div",wa,[(p(!0),h(be,null,_e((it=(lt=d.planExecution)==null?void 0:lt.userInputWaitState)==null?void 0:it.formInputs,(N,te)=>(p(),h("div",{key:te,class:"form-group"},[e("label",{for:`form-input-${N.label.replace(/\W+/g,"_")}`},s(N.label)+s(se(N.required)?" *":"")+": ",9,Ea),!N.type||N.type==="text"?re((p(),h("input",{key:0,type:"text",id:`form-input-${N.label.replace(/\W+/g,"_")}`,name:N.label,placeholder:N.placeholder||"",required:se(N.required),"onUpdate:modelValue":ie=>L[d.id][te]=ie,class:"form-input"},null,8,Ta)),[[pe,L[d.id][te]]]):N.type==="email"?re((p(),h("input",{key:1,type:"email",id:`form-input-${N.label.replace(/\W+/g,"_")}`,name:N.label,placeholder:N.placeholder||"",required:se(N.required),"onUpdate:modelValue":ie=>L[d.id][te]=ie,class:"form-input"},null,8,Ia)),[[pe,L[d.id][te]]]):N.type==="number"?re((p(),h("input",{key:2,type:"number",id:`form-input-${N.label.replace(/\W+/g,"_")}`,name:N.label,placeholder:N.placeholder||"",required:se(N.required),"onUpdate:modelValue":ie=>L[d.id][te]=ie,class:"form-input"},null,8,Da)),[[pe,L[d.id][te]]]):N.type==="password"?re((p(),h("input",{key:3,type:"password",id:`form-input-${N.label.replace(/\W+/g,"_")}`,name:N.label,placeholder:N.placeholder||"",required:se(N.required),"onUpdate:modelValue":ie=>L[d.id][te]=ie,class:"form-input"},null,8,xa)),[[pe,L[d.id][te]]]):N.type==="textarea"?re((p(),h("textarea",{key:4,id:`form-input-${N.label.replace(/\W+/g,"_")}`,name:N.label,placeholder:N.placeholder||"",required:se(N.required),"onUpdate:modelValue":ie=>L[d.id][te]=ie,class:"form-input form-textarea",rows:"3"},null,8,Ra)),[[pe,L[d.id][te]]]):N.type==="select"&&N.options?re((p(),h("select",{key:5,id:`form-input-${N.label.replace(/\W+/g,"_")}`,name:N.label,required:se(N.required),"onUpdate:modelValue":ie=>L[d.id][te]=ie,class:"form-input form-select"},[e("option",Ma,s(l.$t("selectCommon.pleaseSelect")),1),(p(!0),h(be,null,_e(Z(N.options),ie=>(p(),h("option",{key:ie,value:ie},s(ie),9,Fa))),128))],8,Aa)),[[rt,L[d.id][te]]]):re((p(),h("input",{key:6,type:"text",id:`form-input-${N.label.replace(/\W+/g,"_")}`,name:N.label,placeholder:N.placeholder||"",required:se(N.required),"onUpdate:modelValue":ie=>L[d.id][te]=ie,class:"form-input"},null,8,Ua)),[[pe,L[d.id][te]]])]))),128))])):(p(),h("div",Na,[e("label",qa,s(l.$t("common.input"))+":",1),re(e("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":N=>d.genericInput=N,class:"form-input"},null,8,La),[[pe,d.genericInput]])])),e("button",Va,s(l.$t("chat.userInput.submit")),1)],40,Sa)])):q("",!0)],10,Js)}),128))])):!d.content&&(d.thinking||((Q=d.planExecution)==null?void 0:Q.progress)!==void 0&&(((fe=d.planExecution)==null?void 0:fe.progress)??0)<100)?(p(),h("div",Ba,[e("div",Wa,[i[2]||(i[2]=e("div",{class:"thinking-dots"},[e("span"),e("span"),e("span")],-1)),e("span",null,s(d.thinking??l.$t("chat.thinkingProcessing")),1)])])):q("",!0)])])):q("",!0),e("div",ja,[e("div",Oa,[e("div",za,[v(o(b),{icon:"carbon:bot",class:"bot-icon"})]),e("div",Ha,s(l.$t("chat.botName")),1)]),e("div",Ja,[d.content?(p(),h("div",Ga,[e("div",{class:"response-text",innerHTML:y(d.content)},null,8,Ka)])):(p(),h("div",Xa,[e("div",Qa,[i[3]||(i[3]=e("div",{class:"typing-dots"},[e("span"),e("span"),e("span")],-1)),e("span",Ya,s(l.$t("chat.thinkingResponse")),1)])]))])])]))])],2)}),128)),V.value?(p(),h("div",Za,[e("div",el,[e("div",tl,[e("div",nl,[e("div",ol,[e("div",sl,[v(o(b),{icon:"carbon:thinking",class:"thinking-icon"})]),e("div",al,s(l.$t("chat.thinkingLabel")),1)]),e("div",ll,[e("div",il,[e("div",cl,[i[4]||(i[4]=e("div",{class:"thinking-dots"},[e("span"),e("span"),e("span")],-1)),e("span",null,s(l.$t("chat.thinking")),1)])])])]),e("div",rl,[e("div",dl,[e("div",ul,[v(o(b),{icon:"carbon:bot",class:"bot-icon"})]),e("div",pl,s(l.$t("chat.botName")),1)]),e("div",hl,[e("div",ml,[e("div",vl,[i[5]||(i[5]=e("div",{class:"typing-dots"},[e("span"),e("span"),e("span")],-1)),e("span",gl,s(l.$t("chat.thinkingResponse")),1)])])])])])])])):q("",!0)],512),z.value?(p(),h("div",{key:0,class:"scroll-to-bottom-btn",onClick:B,title:l.$t("chat.scrollToBottom")},[v(o(b),{icon:"carbon:chevron-down"})],8,fl)):q("",!0)]))}}),kl=Se(bl,[["__scopeId","data-v-4a11a2f9"]]),$l={class:"input-area"},_l={class:"input-container"},yl=["title"],Pl=["placeholder","disabled"],Cl=["title"],Sl=["disabled","title"],wl=Ce({__name:"index",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(T,{expose:t,emit:n}){const{t:r}=xe(),g=T,k=n,u=I(),E=I(""),V=ke(()=>g.placeholder||r("input.placeholder")),S=I(V.value),M=ke(()=>!!g.disabled),z=()=>{ue(()=>{u.value&&(u.value.style.height="auto",u.value.style.height=Math.min(u.value.scrollHeight,120)+"px")})},L=B=>{B.key==="Enter"&&!B.shiftKey&&(B.preventDefault(),a())},a=()=>{if(!E.value.trim()||M.value)return;const B=E.value.trim();k("send",B),C()},f=()=>{k("plan-mode-clicked")},C=()=>{E.value="",z(),k("clear")},J=(B,G)=>{G&&(S.value=B?G:r("input.waiting")),k("update-state",B,G)},w=B=>{E.value=B,z()},D=()=>E.value.trim();return ye(()=>g.initialValue,B=>{B&&B.trim()&&(E.value=B,z())},{immediate:!0}),t({clearInput:C,updateState:J,setInputValue:w,getQuery:D,focus:()=>{var B;return(B=u.value)==null?void 0:B.focus()}}),we(()=>{}),Ee(()=>{}),(B,G)=>(p(),h("div",$l,[e("div",_l,[e("button",{class:"attach-btn",title:B.$t("input.attachFile")},[v(o(b),{icon:"carbon:attachment"})],8,yl),re(e("textarea",{"onUpdate:modelValue":G[0]||(G[0]=A=>E.value=A),ref_key:"inputRef",ref:u,class:"chat-input",placeholder:S.value,disabled:M.value,onKeydown:L,onInput:z},null,40,Pl),[[pe,E.value]]),e("button",{class:"plan-mode-btn",title:B.$t("input.planMode"),onClick:f},[v(o(b),{icon:"carbon:document"}),ne(" "+s(B.$t("input.planMode")),1)],8,Cl),e("button",{class:"send-button",disabled:!E.value.trim()||M.value,onClick:a,title:B.$t("input.send")},[v(o(b),{icon:"carbon:send-alt"}),ne(" "+s(B.$t("input.send")),1)],8,Sl)])]))}}),El=Se(wl,[["__scopeId","data-v-4faf9f8d"]]);class Ae{static async getAllCronTasks(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get cron tasks:",t),t}}static async getCronTaskById(t){try{const n=await fetch(`${this.BASE_URL}/${t}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to get cron task by id:",n),n}}static async createCronTask(t){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create cron task:",n),n}}static async updateCronTask(t,n){try{const r=await fetch(`${this.BASE_URL}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await(await this.handleResponse(r)).json()}catch(r){throw console.error("Failed to update cron task:",r),r}}static async updateTaskStatus(t,n){try{const r=await fetch(`${this.BASE_URL}/${t}/status?status=${n}`,{method:"PUT"});await this.handleResponse(r)}catch(r){throw console.error("Failed to update task status:",r),r}}static async deleteCronTask(t){try{const n=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(n)}catch(n){throw console.error("Failed to delete cron task:",n),n}}static async handleResponse(t){if(!t.ok)try{const n=await t.json();throw new Error(n.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}$e(Ae,"BASE_URL","/api/cron-tasks");const Me={validateCronExpression(T){const t=T.trim().split(/\s+/);return t.length>=5&&t.length<=6},formatTime(T){return new Date(T).toLocaleString()},async saveTask(T){try{let t;return T.id?t=await Ae.updateCronTask(Number(T.id),T):t=await Ae.createCronTask(T),t}catch(t){throw console.error("Failed to save cron task:",t),t}},async deleteTask(T){try{await Ae.deleteCronTask(String(T))}catch(t){throw console.error("Failed to delete cron task:",t),t}},async toggleTaskStatus(T){if(!T.id)throw new Error("Task ID is required");const t=T.status===0?1:0;return await Ae.updateCronTask(Number(T.id),{...T,status:t})},prepareTaskExecution(T){return T.planTemplateId?{useTemplate:!0,planData:{title:T.cronName||"Scheduled Task Execution",planData:{id:T.planTemplateId,planTemplateId:T.planTemplateId,planId:T.planTemplateId},params:T.executionParams||void 0}}:{useTemplate:!1,taskContent:T.planDesc||T.cronName||""}}},Tl={class:"modal-header"},Il={class:"header-actions"},Dl={class:"status-switch"},xl={class:"status-label"},Rl={class:"toggle-switch"},Al=["checked"],Ml={class:"modal-content"},Fl={class:"form-group"},Ul={class:"form-label"},Nl=["placeholder"],ql={class:"form-group"},Ll={class:"form-label"},Vl=["placeholder"],Bl={class:"form-help"},Wl={class:"form-group"},jl={class:"form-label"},Ol=["placeholder"],zl={class:"form-group"},Hl={class:"form-label"},Jl={class:"template-toggle"},Gl={key:0,class:"template-selector"},Kl={value:""},Xl=["value"],Ql={class:"form-help"},Yl={key:0,class:"form-group"},Zl={class:"time-info"},ei={class:"time-label"},ti={class:"time-value"},ni={key:1,class:"form-group"},oi={class:"time-info"},si={class:"time-label"},ai={class:"time-value"},li={class:"modal-footer"},ii=["disabled"],ci=Ce({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(T,{emit:t}){const n=T,r=t,g=I(!1),k=I([]),u=I({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""});we(async()=>{try{const a=await qe.getAllPlanTemplates();a&&a.templates&&(k.value=a.templates.map(f=>({id:f.id,name:f.title||"Unnamed Template"})))}catch(a){console.error("Failed to get template list:",a)}});const V=a=>{a.target===a.currentTarget&&r("update:modelValue",!1)},S=()=>{u.value.linkTemplate=!1,u.value.templateId="",u.value.planTemplateId=""},M=()=>u.value.cronName.trim()?u.value.cronTime.trim()?Me.validateCronExpression(u.value.cronTime)?u.value.planDesc.trim()?u.value.linkTemplate&&!u.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),z=a=>Me.formatTime(a),L=async()=>{var a;if(M()){g.value=!0;try{const f={...u.value,...((a=n.task)==null?void 0:a.id)!==void 0&&{id:n.task.id},cronName:u.value.cronName.trim(),cronTime:u.value.cronTime.trim(),planDesc:u.value.planDesc.trim(),status:u.value.status,planTemplateId:u.value.linkTemplate&&u.value.templateId||""};r("save",f)}finally{g.value=!1}}};return ye(()=>n.task,a=>{if(a){const f=a.templateId||a.planTemplateId||"";u.value={cronName:a.cronName||"",cronTime:a.cronTime||"",planDesc:a.planDesc||"",status:a.status??1,linkTemplate:!!f,templateId:f,planTemplateId:f}}else u.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),ye(()=>n.modelValue,a=>{a||(u.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(a,f)=>(p(),me(Ve,{to:"body"},[v(Fe,{name:"modal"},{default:Ue(()=>{var C,J,w;return[a.modelValue?(p(),h("div",{key:0,class:"modal-overlay",onClick:V},[e("div",{class:"modal-container",onClick:f[8]||(f[8]=de(()=>{},["stop"]))},[e("div",Tl,[e("h3",null,s(a.$t("cronTask.taskDetail")),1),e("div",Il,[e("div",Dl,[e("span",xl,s(a.$t("cronTask.taskStatus")),1),e("label",Rl,[e("input",{type:"checkbox",checked:u.value.status===0,onChange:f[0]||(f[0]=D=>u.value.status=u.value.status===0?1:0)},null,40,Al),f[9]||(f[9]=e("span",{class:"toggle-slider"},null,-1))])]),e("button",{class:"close-btn",onClick:f[1]||(f[1]=D=>a.$emit("update:modelValue",!1))},[v(o(b),{icon:"carbon:close"})])])]),e("div",Ml,[e("form",{onSubmit:de(L,["prevent"]),class:"task-form"},[e("div",Fl,[e("label",Ul,s(a.$t("cronTask.taskName")),1),re(e("input",{"onUpdate:modelValue":f[2]||(f[2]=D=>u.value.cronName=D),type:"text",class:"form-input",placeholder:a.$t("cronTask.taskNamePlaceholder"),required:""},null,8,Nl),[[pe,u.value.cronName]])]),e("div",ql,[e("label",Ll,s(a.$t("cronTask.cronExpression")),1),re(e("input",{"onUpdate:modelValue":f[3]||(f[3]=D=>u.value.cronTime=D),type:"text",class:"form-input",placeholder:a.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Vl),[[pe,u.value.cronTime]]),e("div",Bl,s(a.$t("cronTask.cronExpressionHelp")),1)]),e("div",Wl,[e("label",jl,s(a.$t("cronTask.taskDescription")),1),re(e("textarea",{"onUpdate:modelValue":f[4]||(f[4]=D=>u.value.planDesc=D),class:"form-textarea",placeholder:a.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,Ol),[[pe,u.value.planDesc]])]),e("div",zl,[e("label",Hl,s(a.$t("cronTask.planTemplate")),1),e("div",Jl,[e("button",{type:"button",class:oe(["template-btn",u.value.linkTemplate?"active":""]),onClick:f[5]||(f[5]=D=>u.value.linkTemplate=!0)},[v(o(b),{icon:"carbon:checkmark"}),ne(" "+s(a.$t("cronTask.linkTemplate")),1)],2),e("button",{type:"button",class:oe(["template-btn",u.value.linkTemplate?"":"active"]),onClick:S},[v(o(b),{icon:"carbon:close"}),ne(" "+s(a.$t("cronTask.noTemplate")),1)],2)]),u.value.linkTemplate?(p(),h("div",Gl,[re(e("select",{"onUpdate:modelValue":f[6]||(f[6]=D=>u.value.templateId=D),class:"form-select"},[e("option",Kl,s(a.$t("cronTask.selectTemplate")),1),(p(!0),h(be,null,_e(k.value,D=>(p(),h("option",{key:D.id,value:D.id},s(D.name),9,Xl))),128))],512),[[rt,u.value.templateId]]),e("div",Ql,s(a.$t("cronTask.templateHelpText")),1)])):q("",!0)]),(C=a.task)!=null&&C.createTime?(p(),h("div",Yl,[e("div",Zl,[e("span",ei,s(a.$t("cronTask.createTime"))+":",1),e("span",ti,s(z(a.task.createTime)),1)])])):q("",!0),(J=a.task)!=null&&J.updateTime?(p(),h("div",ni,[e("div",oi,[e("span",si,s(a.$t("cronTask.updateTime"))+":",1),e("span",ai,s(z(a.task.updateTime)),1)])])):q("",!0)],32)]),e("div",li,[e("button",{type:"button",class:"cancel-btn",onClick:f[7]||(f[7]=D=>a.$emit("update:modelValue",!1))},s(a.$t("common.cancel")),1),e("button",{type:"button",class:"save-btn",onClick:L,disabled:g.value},[g.value?(p(),me(o(b),{key:0,icon:"carbon:loading",class:"loading-icon"})):q("",!0),ne(" "+s((w=n.task)!=null&&w.id?a.$t("common.save"):a.$t("common.create")),1)],8,ii)])])])):q("",!0)]}),_:1})]))}}),ri=Se(ci,[["__scopeId","data-v-1ac463d9"]]),di={class:"modal-header"},ui={class:"header-actions"},pi={class:"modal-content"},hi={key:0,class:"loading-container"},mi={key:1,class:"empty-container"},vi={key:2,class:"task-list"},gi=["onClick"],fi={class:"task-main"},bi={class:"task-info"},ki={class:"task-header"},$i={class:"task-name"},_i={class:"task-description"},yi={class:"task-time"},Pi=["onClick"],Ci=["onClick","disabled","title"],Si=["onClick","title"],wi={class:"dropdown-menu"},Ei=["onClick"],Ti=["onClick","disabled"],Ii=["onClick","disabled"],Di={class:"confirm-header"},xi={class:"confirm-content"},Ri={class:"confirm-actions"},Ai=["disabled"],Mi={class:"confirm-header"},Fi={class:"confirm-content"},Ui={class:"create-options"},Ni={class:"option-content"},qi={class:"option-title"},Li={class:"option-desc"},Vi={class:"option-content"},Bi={class:"option-title"},Wi={class:"option-desc"},ji={class:"confirm-actions"},Oi=Ce({__name:"index",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(T,{emit:t}){const n=dt(),r=ut(),g=kt(),{t:k}=xe(),u=T,E=t,V=I([]),S=I(!1),M=I(null),z=I(null),L=I(null),a=I(null),f=I(!1),C=I(null),J=I(!1),w=I(null),D=I(!1),B=c=>{c.target===c.currentTarget&&E("update:modelValue",!1)},G=async()=>{S.value=!0;try{V.value=await Ae.getAllCronTasks()}catch(c){console.error("Failed to load cron tasks:",c),g.error(`Failed to load tasks: ${c instanceof Error?c.message:String(c)}`)}finally{S.value=!1}},A=async c=>{M.value=c;try{const y=V.value.find(se=>se.id===c);if(!y){console.error("Task not found:",c);return}E("update:modelValue",!1);const F=Date.now().toString();await n.push({name:"direct",params:{id:F}}),await new Promise(se=>setTimeout(se,100));const Z=Me.prepareTaskExecution(y);Z.useTemplate&&Z.planData?r.emitPlanExecutionRequested(Z.planData):Z.taskContent&&r.setTask(Z.taskContent)}catch(y){console.error("Failed to execute task:",y),g.error(`Execution failed: ${y instanceof Error?y.message:String(y)}`)}finally{M.value=null}},ee=c=>{C.value={...c},f.value=!0,a.value=null},ae=async c=>{try{await Me.saveTask(c),await G(),f.value=!1,g.success("Task saved successfully")}catch(y){console.error("Failed to save task:",y),g.error(`Save failed: ${y instanceof Error?y.message:String(y)}`)}},ce=c=>{w.value=c,J.value=!0},Pe=async()=>{var c;if((c=w.value)!=null&&c.id){z.value=w.value.id;try{await Me.deleteTask(w.value.id),await G(),J.value=!1,w.value=null,g.success("Task deleted successfully")}catch(y){console.error("Failed to delete task:",y),g.error(`Delete failed: ${y instanceof Error?y.message:String(y)}`)}finally{z.value=null}}},ve=()=>{J.value=!1,w.value=null},ge=c=>{a.value=a.value===c?null:c},Te=async c=>{if(c.id){L.value=c.id;try{await Me.toggleTaskStatus(c),await G(),a.value=null,g.success(`Task ${c.status===0?"disabled":"enabled"} successfully`)}catch(y){console.error("Failed to toggle task status:",y),g.error(`Status toggle failed: ${y instanceof Error?y.message:String(y)}`)}finally{L.value=null}}},_=async c=>{try{await navigator.clipboard.writeText(c),g.success("Cron expression copied successfully")}catch(y){g.error(`Copy failed: ${y instanceof Error?y.message:String(y)}`)}},R=()=>{D.value=!0},O=()=>{D.value=!1;try{E("update:modelValue",!1);const c=k("cronTask.template");r.setTaskToInput(c);const y=Date.now().toString();n.push({name:"direct",params:{id:y}})}catch(c){console.error("Error in createWithJmanus:",c),g.error(`Creation failed: ${c instanceof Error?c.message:String(c)}`)}},W=()=>{D.value=!1,C.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},f.value=!0},x=()=>{D.value=!1},m=c=>{const y=c.target;!y.closest(".action-dropdown")&&!y.closest(".dropdown-menu")&&(a.value=null)};return we(()=>{document.addEventListener("click",m,!0)}),Ee(()=>{document.removeEventListener("click",m,!0)}),ye(()=>u.modelValue,c=>{c&&G()}),(c,y)=>(p(),h(be,null,[(p(),me(Ve,{to:"body"},[v(Fe,{name:"modal"},{default:Ue(()=>[T.modelValue?(p(),h("div",{key:0,class:"modal-overlay",onClick:B},[e("div",{class:"modal-container",onClick:y[3]||(y[3]=de(()=>{},["stop"]))},[e("div",di,[e("h3",null,s(c.$t("cronTask.title")),1),e("div",ui,[e("button",{class:"add-task-btn",onClick:[R,y[0]||(y[0]=de(()=>{},["stop"]))]},[v(o(b),{icon:"carbon:add"}),ne(" "+s(c.$t("cronTask.addTask")),1)]),e("button",{class:"close-btn",onClick:y[1]||(y[1]=F=>c.$emit("update:modelValue",!1))},[v(o(b),{icon:"carbon:close"})])])]),e("div",pi,[S.value?(p(),h("div",hi,[v(o(b),{icon:"carbon:loading",class:"loading-icon"}),e("span",null,s(c.$t("common.loading")),1)])):V.value.length===0?(p(),h("div",mi,[v(o(b),{icon:"carbon:time",class:"empty-icon"}),e("span",null,s(c.$t("cronTask.noTasks")),1)])):(p(),h("div",vi,[(p(!0),h(be,null,_e(V.value,F=>(p(),h("div",{key:F.id||"",class:"task-item",onClick:Z=>ee(F)},[e("div",fi,[e("div",bi,[e("div",ki,[e("div",$i,s(F.cronName),1),e("div",{class:oe(["task-status-badge",F.status===0?"active":"inactive"])},[v(o(b),{icon:F.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),e("span",null,s(F.status===0?c.$t("cronTask.active"):c.$t("cronTask.inactive")),1)],2)]),e("div",_i,s(F.planDesc),1),e("div",yi,[v(o(b),{icon:"carbon:time"}),e("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:de(Z=>_(F.cronTime),["stop"])},s(F.cronTime),9,Pi)])])]),e("div",{class:"task-actions",onClick:y[2]||(y[2]=de(()=>{},["stop"]))},[e("button",{class:"action-btn execute-btn",onClick:Z=>A(F.id),disabled:M.value===F.id,title:c.$t("cronTask.executeOnce")},[v(o(b),{icon:M.value===F.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),ne(" "+s(c.$t("cronTask.executeOnce")),1)],8,Ci),e("div",{class:oe(["action-dropdown",{active:a.value===F.id}])},[e("button",{class:"action-btn dropdown-btn",onClick:Z=>ge(F.id),title:c.$t("cronTask.operations")},[v(o(b),{icon:"carbon:overflow-menu-horizontal"}),ne(" "+s(c.$t("cronTask.operations")),1)],8,Si),re(e("div",wi,[e("button",{class:"dropdown-item edit-btn",onClick:Z=>ee(F)},[v(o(b),{icon:"carbon:edit"}),ne(" "+s(c.$t("cronTask.edit")),1)],8,Ei),e("button",{class:"dropdown-item toggle-btn",onClick:Z=>Te(F),disabled:L.value===F.id},[v(o(b),{icon:L.value===F.id?"carbon:loading":F.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),ne(" "+s(F.status===0?c.$t("cronTask.disable"):c.$t("cronTask.enable")),1)],8,Ti),e("button",{class:"dropdown-item delete-btn",onClick:Z=>ce(F),disabled:z.value===F.id},[v(o(b),{icon:z.value===F.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+s(c.$t("cronTask.delete")),1)],8,Ii)],512),[[vt,a.value===F.id]])],2)])],8,gi))),128))]))])])])):q("",!0)]),_:1})])),v(ri,{modelValue:f.value,"onUpdate:modelValue":y[4]||(y[4]=F=>f.value=F),task:C.value,onSave:ae},null,8,["modelValue","task"]),(p(),me(Ve,{to:"body"},[v(Fe,{name:"modal"},{default:Ue(()=>{var F,Z,se,l;return[J.value?(p(),h("div",{key:0,class:"modal-overlay",onClick:ve},[e("div",{class:"confirm-modal",onClick:y[5]||(y[5]=de(()=>{},["stop"]))},[e("div",Di,[v(o(b),{icon:"carbon:warning",class:"warning-icon"}),e("h3",null,s(c.$t("cronTask.deleteConfirm")),1)]),e("div",xi,[e("p",null,s(c.$t("cronTask.deleteConfirmMessage",{taskName:((F=w.value)==null?void 0:F.cronName)||((Z=w.value)==null?void 0:Z.planDesc)||""})),1)]),e("div",Ri,[e("button",{class:"confirm-btn cancel-btn",onClick:ve},s(c.$t("common.cancel")),1),e("button",{class:"confirm-btn delete-btn",onClick:Pe,disabled:z.value===((se=w.value)==null?void 0:se.id)},[v(o(b),{icon:z.value===((l=w.value)==null?void 0:l.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+s(c.$t("cronTask.delete")),1)],8,Ai)])])])):q("",!0)]}),_:1})])),(p(),me(Ve,{to:"body"},[v(Fe,{name:"modal"},{default:Ue(()=>[D.value?(p(),h("div",{key:0,class:"modal-overlay",onClick:x},[e("div",{class:"confirm-modal create-options-modal",onClick:y[6]||(y[6]=de(()=>{},["stop"]))},[e("div",Mi,[v(o(b),{icon:"carbon:time",class:"create-icon"}),e("h3",null,s(c.$t("cronTask.createTask")),1)]),e("div",Fi,[e("p",null,s(c.$t("cronTask.selectCreateMethod")),1),e("div",Ui,[e("button",{class:"create-option-btn jmanus-btn",onClick:O},[v(o(b),{icon:"carbon:ai-status"}),e("div",Ni,[e("span",qi,s(c.$t("cronTask.createWithJmanus")),1),e("span",Li,s(c.$t("cronTask.createWithJmanusDesc")),1)])]),e("button",{class:"create-option-btn manual-btn",onClick:W},[v(o(b),{icon:"carbon:edit"}),e("div",Vi,[e("span",Bi,s(c.$t("cronTask.createManually")),1),e("span",Wi,s(c.$t("cronTask.createManuallyDesc")),1)])])])]),e("div",ji,[e("button",{class:"confirm-btn cancel-btn",onClick:x},s(c.$t("common.cancel")),1)])])])):q("",!0)]),_:1})]))],64))}}),zi=Se(Oi,[["__scopeId","data-v-848c7703"]]),Hi={class:"direct-page"},Ji={class:"direct-chat"},Gi={class:"chat-header"},Ki={class:"header-actions"},Xi=["title"],Qi=["title"],Yi={class:"chat-content"},Zi=["title"],ec={class:"message-content"},tc=Ce({__name:"index",setup(T){const t=gt(),n=dt(),r=ut(),{t:g}=xe(),{message:k}=$t(),u=I(""),E=I(""),V=I(),S=I(),M=I(),z=I(!1),L=I(!1),a=I(null),f=I(!1),C=I(50),J=I(!1),w=I(0),D=I(0);we(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",r.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",r.hasUnprocessedTask()),he.setEventCallbacks({onPlanUpdate:c=>{console.log("[Direct] Plan update event received for rootPlanId:",c),ae(c)&&(console.log("[Direct] Processing plan update for current rootPlanId:",c),S.value&&typeof S.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",c),S.value.handlePlanUpdate(c)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),V.value&&typeof V.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",c),V.value.updateDisplayedPlanProgress(c)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:c=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",c),!!ae(c)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",c),S.value&&typeof S.value.handlePlanCompleted=="function"){const y=he.getCachedPlanRecord(c);console.log("[Direct] Calling chatRef.handlePlanCompleted with details:",y),S.value.handlePlanCompleted(y??{planId:c})}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");a.value=null,console.log("[Direct] Cleared currentRootPlanId after plan completion")}},onDialogRoundStart:c=>{console.log("[Direct] Dialog round start event received for rootPlanId:",c),a.value=c,console.log("[Direct] Set currentRootPlanId to:",c),S.value&&typeof S.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",c),S.value.handleDialogRoundStart(c)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),Pe()},onChatInputUpdateState:c=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",c),!ae(c,!0))return;const y=he.getCachedUIState(c);y&&ge(y.enabled,y.placeholder)},onPlanError:c=>{S.value.handlePlanError(c)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),P.loadPlanTemplateList(),r.hasUnprocessedTask()&&r.currentTask){const c=r.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",c),r.markTaskAsProcessed(),ue(()=>{S.value&&typeof S.value.handleSendMessage=="function"?(console.log("[Direct] Directly executing task via chatRef.handleSendMessage:",c),S.value.handleSendMessage(c)):(console.warn("[Direct] chatRef.handleSendMessage method not available, falling back to prompt"),u.value=c)})}else{const c=r.getAndClearTaskToInput();c?(E.value=c,console.log("[Direct] Setting inputOnlyContent for input only:",E.value)):(u.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",u.value),console.log("[Direct] No unprocessed task in store"))}const m=localStorage.getItem("directPanelWidth");m&&(C.value=parseFloat(m)),console.log("[Direct] Final prompt value:",u.value),E.value&&ue(()=>{M.value&&typeof M.value.setInputValue=="function"&&(M.value.setInputValue(E.value),console.log("[Direct] Set input value:",E.value),E.value="")}),window.addEventListener("plan-execution-requested",c=>{console.log("[DirectView] Received plan-execution-requested event:",c.detail),x(c.detail)})}),ye(()=>r.currentTask,m=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",m),m&&!m.processed){const c=m.prompt;r.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",c),ue(()=>{S.value&&typeof S.value.handleSendMessage=="function"?(console.log("[Direct] Directly executing new task via chatRef.handleSendMessage:",c),S.value.handleSendMessage(c)):console.warn("[Direct] chatRef.handleSendMessage method not available for new task")})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),ye(()=>u.value,(m,c)=>{console.log("[Direct] prompt value changed from:",c,"to:",m)},{immediate:!1}),ye(()=>r.taskToInput,m=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",m),m&&m.trim()&&(console.log("[Direct] Setting input value from taskToInput:",m),ue(()=>{M.value&&typeof M.value.setInputValue=="function"&&(M.value.setInputValue(m.trim()),console.log("[Direct] Input value set from taskToInput watch:",m.trim()),r.getAndClearTaskToInput())}))},{immediate:!1}),Ee(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),a.value=null,he.cleanup(),document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",A),window.removeEventListener("plan-execution-requested",m=>{x(m.detail)})});const B=m=>{J.value=!0,w.value=m.clientX,D.value=C.value,document.addEventListener("mousemove",G),document.addEventListener("mouseup",A),document.body.style.cursor="col-resize",document.body.style.userSelect="none",m.preventDefault()},G=m=>{if(!J.value)return;const c=window.innerWidth,F=(m.clientX-w.value)/c*100;let Z=D.value+F;Z=Math.max(20,Math.min(80,Z)),C.value=Z},A=()=>{J.value=!1,document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",A),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",C.value.toString())},ee=()=>{C.value=50,localStorage.setItem("directPanelWidth","50")},ae=(m,c=!1)=>!a.value||m===a.value||c&&(m==="ui-state"||m==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",m,"current:",a.value),!1),ce=m=>{console.log("[DirectView] Send message from input:",m),S.value&&typeof S.value.handleSendMessage=="function"?(console.log("[DirectView] Calling chatRef.handleSendMessage:",m),S.value.handleSendMessage(m)):console.warn("[DirectView] chatRef.handleSendMessage method not available")},Pe=()=>{console.log("[DirectView] Input cleared"),M.value&&typeof M.value.clear=="function"&&M.value.clear()},ve=()=>{console.log("[DirectView] Input focused")},ge=(m,c)=>{console.log("[DirectView] Input state updated:",m,c),L.value=!m},Te=(m,c)=>{console.log("[DirectView] Step selected:",m,c),V.value&&typeof V.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",m,c),V.value.handleStepSelected(m,c)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},_=(m,c,y,F)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:m,subPlanId:c,stepIndex:y,subStepIndex:F}),V.value&&typeof V.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:m,subPlanId:c,stepIndex:y,subStepIndex:F}),V.value.handleSubPlanStepSelected(m,c,y,F)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},R=()=>{console.log("[DirectView] Plan mode button clicked"),P.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",P.isCollapsed)},O=()=>{n.push("/home")},W=()=>{n.push("/configs")},x=async m=>{var y,F,Z,se;if(console.log("[DirectView] Plan execution requested:",m),z.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}z.value=!0;let c=!1;S.value&&typeof S.value.addMessage=="function"?(console.log("[DirectView] Calling chatRef.addMessage for plan execution:",m.title),S.value.addMessage("user",m.title),c=!0):console.warn("[DirectView] chatRef.addMessage method not available");try{const l=((y=m.planData)==null?void 0:y.planTemplateId)||((F=m.planData)==null?void 0:F.id)||((Z=m.planData)==null?void 0:Z.planId);if(!l)throw new Error(g("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",l,"params:",m.params),console.log("[Direct] About to call PlanActApiService.executePlan");let i;if((se=m.params)!=null&&se.trim()?(console.log("[Direct] Calling executePlan with params:",m.params.trim()),i=await qe.executePlan(l,m.params.trim())):(console.log("[Direct] Calling executePlan without params"),i=await qe.executePlan(l)),console.log("[Direct] Plan execution API response:",i),i.planId)console.log("[Direct] Got planId from response:",i.planId,"starting plan execution"),a.value=i.planId,console.log("[Direct] Set currentRootPlanId to:",i.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),he.handlePlanExecutionRequested(i.planId,m.title);else throw console.error("[Direct] No planId in response:",i),new Error(g("direct.executionFailedNoPlanId"))}catch(l){console.error("[Direct] Plan execution failed:",l),console.error("[Direct] Error details:",{message:l.message,stack:l.stack}),a.value=null,S.value&&typeof S.value.addMessage=="function"?(console.log("[Direct] Adding error messages to chat"),c||S.value.addMessage("user",m.title),S.value.addMessage("assistant",`${g("direct.executionFailed")}: ${l.message||g("common.unknownError")}`,{thinking:void 0})):(console.error("[Direct] Chat ref not available, showing alert"),alert(`${g("direct.executionFailed")}: ${l.message||g("common.unknownError")}`))}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),z.value=!1}};return(m,c)=>(p(),h("div",Hi,[e("div",Ji,[v(_n,{onPlanExecutionRequested:x}),e("div",{class:"left-panel",style:Ne({width:C.value+"%"})},[e("div",Gi,[e("button",{class:"back-button",onClick:O},[v(o(b),{icon:"carbon:arrow-left"})]),e("h2",null,s(m.$t("conversation")),1),e("div",Ki,[v(bt),e("button",{class:"config-button",onClick:W,title:m.$t("direct.configuration")},[v(o(b),{icon:"carbon:settings-adjust",width:"20"})],8,Xi),e("button",{class:"cron-task-btn",onClick:c[0]||(c[0]=y=>f.value=!0),title:m.$t("cronTask.title")},[v(o(b),{icon:"carbon:alarm",width:"20"})],8,Qi)])]),e("div",Yi,[v(kl,{ref_key:"chatRef",ref:S,mode:"direct","initial-prompt":u.value||"",onStepSelected:Te,onSubPlanStepSelected:_},null,8,["initial-prompt"])]),(p(),me(El,{key:m.$i18n.locale,ref_key:"inputRef",ref:M,disabled:L.value,placeholder:L.value?o(g)("input.waiting"):o(g)("input.placeholder"),"initial-value":u.value,onSend:ce,onClear:Pe,onFocus:ve,onUpdateState:ge,onPlanModeClicked:R},null,8,["disabled","placeholder","initial-value"]))],4),e("div",{class:"panel-resizer",onMousedown:B,onDblclick:ee,title:m.$t("direct.panelResizeHint")},c[2]||(c[2]=[e("div",{class:"resizer-line"},null,-1)]),40,Zi),v(Ds,{ref_key:"rightPanelRef",ref:V,style:Ne({width:100-C.value+"%"}),"current-root-plan-id":a.value},null,8,["style","current-root-plan-id"])]),v(zi,{modelValue:f.value,"onUpdate:modelValue":c[1]||(c[1]=y=>f.value=y)},null,8,["modelValue"]),o(k).show?(p(),h("div",{key:0,class:oe(["message-toast",o(k).type])},[e("div",ec,[e("span",null,s(o(k).text),1)])],2)):q("",!0)]))}}),rc=Se(tc,[["__scopeId","data-v-b96c8e72"]]);export{rc as default};

var Me=Object.defineProperty;var xe=(j,s,t)=>s in j?Me(j,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):j[s]=t;var ve=(j,s,t)=>xe(j,typeof s!="symbol"?s+"":s,t);import{_ as ie,I as V}from"./_plugin-vue_export-helper-D5GCsmf1.js";import{d as re,c,o as i,e,t as h,r as I,y as le,m as Z,f as he,h as S,b as O,q as A,w as F,v as z,F as X,i as Q,p as se,C as Ee,a as pe,A as oe,T as we,D as Ve,u as U,E as ke,s as _e,x as be,G as Ue,j as Pe,g as Be,H as Ce}from"./index-Tf7Hnpv7.js";const Oe={class:"switch"},Le=["checked"],Re={class:"switch-label"},Ie=re({__name:"index",props:{enabled:{type:Boolean},label:{}},emits:["update:switchValue"],setup(j,{emit:s}){const t=s,f=d=>{const n=d.target.checked;t("update:switchValue",n)};return(d,n)=>(i(),c("label",Oe,[e("input",{type:"checkbox",checked:d.enabled,onChange:f},null,40,Le),n[0]||(n[0]=e("span",{class:"slider"},null,-1)),e("span",Re,h(d.label),1)]))}}),Se=ie(Ie,[["__scopeId","data-v-7775bd2b"]]);class fe{static async getConfigsByGroup(s){try{const t=await fetch(`${this.BASE_URL}/group/${s}`);if(!t.ok)throw new Error(`Failed to get ${s} group configuration: ${t.status}`);return await t.json()}catch(t){throw console.error(`Failed to get ${s} group configuration:`,t),t}}static async batchUpdateConfigs(s){if(!s||s.length===0)return{success:!0,message:"No configuration needs to be updated"};try{const t=await fetch(`${this.BASE_URL}/batch-update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new Error(`Batch update configuration failed: ${t.status}`);return{success:!0,message:"Configuration saved successfully"}}catch(t){return console.error("Batch update configuration failed:",t),{success:!1,message:t instanceof Error?t.message:"Update failed, please try again"}}}static async getConfigById(s){try{const t=await fetch(`${this.BASE_URL}/${s}`);if(!t.ok)throw new Error(`Failed to get configuration item: ${t.status}`);return await t.json()}catch(t){throw console.error(`Failed to get configuration item[${s}]:`,t),t}}static async updateConfig(s){try{const t=await fetch(`${this.BASE_URL}/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new Error(`Failed to update configuration item: ${t.status}`);return{success:!0,message:"Configuration updated successfully"}}catch(t){return console.error("Failed to update configuration item:",t),{success:!1,message:t instanceof Error?t.message:"Update failed, please try again"}}}}ve(fe,"BASE_URL","/api/config");const Ge={class:"config-panel"},Ne={class:"config-header"},De={class:"header-left"},je={class:"config-stats"},Fe={class:"stat-item"},qe={class:"stat-value"},Je={key:0,class:"stat-item"},Ke={class:"stat-value modified"},ze={class:"header-right"},Ye={class:"import-export-actions"},He={class:"action-btn",title:"导入配置"},Xe={class:"search-box"},Qe={key:0,class:"loading-container"},We={key:1,class:"config-groups"},Ze={class:"group-header"},et={class:"group-info"},tt={class:"group-icon"},st={class:"group-actions"},ot=["onClick","disabled"],nt={class:"sub-groups"},at=["onClick"],lt={class:"sub-group-info"},it={class:"sub-group-title"},rt={class:"item-count"},ct={class:"config-items"},dt={key:0,class:"config-item-content vertical-layout"},ut={class:"config-item-info"},pt={class:"config-item-header"},vt={class:"config-label"},ft={class:"type-badge boolean"},gt={key:0,class:"modified-badge"},mt=["title"],ht={class:"config-control"},yt=["value","onChange"],bt=["value"],_t={key:1,class:"config-item-content vertical-layout"},wt={class:"config-item-info"},$t={class:"config-item-header"},kt={class:"config-label"},Ct={key:0,class:"modified-badge"},St=["title"],Tt={class:"config-control"},At=["value","onChange"],Mt=["value"],xt={key:2,class:"config-item-content vertical-layout"},Et={class:"config-item-info"},Vt={class:"config-item-header"},Ut={class:"config-label"},Pt={key:0,class:"modified-badge"},Bt=["title"],Ot={class:"config-control"},Lt=["value","onInput"],Rt={key:3,class:"config-item-content vertical-layout"},It={class:"config-item-info"},Gt={class:"config-item-header"},Nt={class:"config-label"},Dt={key:0,class:"modified-badge"},jt=["title"],Ft={key:0,class:"config-meta"},qt={class:"range-info"},Jt={class:"config-control"},Kt=["value","onInput","min","max"],zt={key:4,class:"config-item-content vertical-layout"},Yt={class:"config-item-info"},Ht={class:"config-item-header"},Xt={class:"config-label"},Qt={class:"type-badge string"},Wt={key:0,class:"modified-badge"},Zt=["title"],es={class:"config-control"},ts=["value","onInput"],ss={key:2,class:"empty-state"},os=re({__name:"basicConfig",setup(j){const s=I(!0),t=I(!1),f=I([]),d=I(new Map),n=I(new Set),P=le({show:!1,text:"",type:"success"}),G=I(""),k={maxSteps:"智能体执行最大步数",resetAllAgents:"重置所有agent",headlessBrowser:"是否使用无头浏览器模式",browserTimeout:"浏览器请求超时时间(秒)",browserDebug:"浏览器debug模式",autoOpenBrowser:"启动时自动打开浏览器",consoleInteractive:"启用控制台交互模式",systemName:"系统名称",language:"默认语言",maxThreads:"最大线程数",timeoutSeconds:"请求超时时间(秒)"},x={manus:"智能体设置",browser:"浏览器设置",interaction:"交互设置",system:"系统设置",performance:"性能设置"},K={manus:"🤖",browser:"🌐",interaction:"🖥️",system:"⚙️",performance:"⚡"},q={agent:"智能体设置",browser:"浏览器设置",interaction:"交互设置",system:"系统设置",performance:"性能设置",general:"常规设置"},N=Z(()=>f.value.some(p=>p.subGroups.some(u=>u.items.some(_=>d.value.get(_.id)!==_.configValue)))),ee=p=>p==="true",L=p=>parseFloat(p)||0,g=p=>({maxSteps:1,browserTimeout:1,maxThreads:1,timeoutSeconds:5})[p]||1,T=p=>({maxSteps:100,browserTimeout:600,maxThreads:32,timeoutSeconds:300})[p]||1e4,W=p=>typeof p=="string"?p:p.value,ne=p=>typeof p=="string"?p:p.label,$=(p,u)=>{if(typeof u=="boolean")return u.toString();if(typeof u=="string"){if(p.options&&p.options.length>0){const _=p.options.find(b=>(typeof b=="string"?b:b.label)===u||(typeof b=="string"?b:b.value)===u);if(_)return typeof _=="string"?_:_.value}return u}return String(u)},a=(p,u,_=!1)=>{let b;p.inputType==="BOOLEAN"||p.inputType==="CHECKBOX"?b=$(p,u):b=String(u),p.configValue!==b&&(p.configValue=b,p._modified=!0,(_||p.inputType==="BOOLEAN"||p.inputType==="CHECKBOX"||p.inputType==="SELECT")&&v())};let C=null;const v=()=>{C&&clearTimeout(C),C=window.setTimeout(()=>{D()},500)},r=(p,u="success")=>{P.text=p,P.type=u,P.show=!0,setTimeout(()=>{P.show=!1},3e3)},w=async()=>{try{s.value=!0;const u=["manus","browser","interaction","system","performance"].map(async b=>{try{const l=await fe.getConfigsByGroup(b);if(l.length===0)return null;const M=l.map(J=>({...J,displayName:J.description||k[J.configKey]||J.configKey,min:g(J.configKey),max:T(J.configKey)}));M.forEach(J=>{d.value.set(J.id,J.configValue)});const B=new Map;M.forEach(J=>{const te=J.configSubGroup||"general";B.has(te)||B.set(te,[]),B.get(te).push(J)});const H=Array.from(B.entries()).map(([J,te])=>({name:J,displayName:q[J]||J,items:te}));return{name:b,displayName:x[b]||b,subGroups:H}}catch(l){return console.warn(`加载配置组 ${b} 失败，跳过:`,l),null}}),_=await Promise.all(u);f.value=_.filter(b=>b!==null),console.log("配置加载完成:",f.value)}catch(p){console.error("加载配置失败:",p),r("加载配置失败，请刷新重试","error")}finally{s.value=!1}},D=async()=>{if(!(t.value||!N.value))try{t.value=!0;const p=[];if(f.value.forEach(_=>{_.subGroups.forEach(b=>{const l=b.items.filter(M=>M._modified);p.push(...l)})}),p.length===0){r("没有需要保存的修改");return}const u=await fe.batchUpdateConfigs(p);u.success?(p.forEach(_=>{d.value.set(_.id,_.configValue),_._modified=!1}),r("配置保存成功")):r(u.message||"保存失败","error")}catch(p){console.error("保存配置失败:",p),r("保存失败，请重试","error")}finally{t.value=!1}},E=async p=>{if(confirm(`确定要重置 "${x[p]||p}" 组的所有配置吗？`))try{t.value=!0;const _=f.value.find(M=>M.name===p);if(!_)return;const b=[];if(_.subGroups.forEach(M=>{M.items.forEach(B=>{const H=Y(B.configKey);H!==B.configValue&&b.push({...B,configValue:H})})}),b.length===0){r("该组配置已是默认值");return}const l=await fe.batchUpdateConfigs(b);l.success?(await w(),r(`成功重置 ${b.length} 项配置`)):r(l.message||"重置失败","error")}catch(_){console.error("重置组配置失败:",_),r("重置失败，请重试","error")}finally{t.value=!1}},Y=p=>({systemName:"JTaskPilot",language:"zh-CN",maxThreads:"8",timeoutSeconds:"60",autoOpenBrowser:"false",headlessBrowser:"true"})[p]||"",m=(p,u)=>{const _=`${p}-${u}`;n.value.has(_)?n.value.delete(_):n.value.add(_)},o=(p,u)=>n.value.has(`${p}-${u}`),R=Z(()=>{const p=f.value.reduce((_,b)=>_+b.subGroups.reduce((l,M)=>l+M.items.length,0),0),u=f.value.reduce((_,b)=>_+b.subGroups.reduce((l,M)=>l+M.items.filter(B=>d.value.get(B.id)!==B.configValue).length,0),0);return{total:p,modified:u}}),y=Z(()=>{if(!G.value.trim())return f.value;const p=G.value.toLowerCase();return f.value.map(u=>({...u,subGroups:u.subGroups.map(_=>({..._,items:_.items.filter(b=>b.displayName.toLowerCase().includes(p)||b.configKey.toLowerCase().includes(p)||b.description&&b.description.toLowerCase().includes(p))})).filter(_=>_.items.length>0)})).filter(u=>u.subGroups.length>0)}),ce=()=>{try{const p={timestamp:new Date().toISOString(),version:"1.0",configs:f.value.reduce((l,M)=>(M.subGroups.forEach(B=>{B.items.forEach(H=>{l[H.configKey]=H.configValue})}),l),{})},u=JSON.stringify(p,null,2),_=new Blob([u],{type:"application/json"}),b=document.createElement("a");b.href=URL.createObjectURL(_),b.download=`config-export-${new Date().toISOString().split("T")[0]}.json`,b.click(),r("配置导出成功")}catch(p){console.error("导出配置失败:",p),r("导出失败","error")}},de=p=>{var l;const u=p.target,_=(l=u.files)==null?void 0:l[0];if(!_)return;const b=new FileReader;b.onload=async M=>{var B;try{const H=JSON.parse((B=M.target)==null?void 0:B.result);if(!H.configs)throw new Error("无效的配置文件格式");if(!confirm("确定要导入配置吗？这将覆盖当前配置。"))return;t.value=!0;const te=[];if(f.value.forEach(Te=>{Te.subGroups.forEach(Ae=>{Ae.items.forEach(ye=>{H.configs.hasOwnProperty(ye.configKey)&&te.push({...ye,configValue:H.configs[ye.configKey]})})})}),te.length===0){r("没有找到可导入的配置项");return}const $e=await fe.batchUpdateConfigs(te);$e.success?(await w(),r(`成功导入 ${te.length} 项配置`)):r($e.message||"导入失败","error")}catch(H){console.error("导入配置失败:",H),r("导入失败，请检查文件格式","error")}finally{t.value=!1,u.value=""}},b.readAsText(_)};return he(()=>{w()}),(p,u)=>(i(),c("div",Ge,[e("div",Ne,[e("div",De,[u[3]||(u[3]=e("h2",null,"基础配置",-1)),e("div",je,[e("span",Fe,[u[1]||(u[1]=e("span",{class:"stat-label"},"总配置项:",-1)),e("span",qe,h(R.value.total),1)]),R.value.modified>0?(i(),c("span",Je,[u[2]||(u[2]=e("span",{class:"stat-label"},"已修改:",-1)),e("span",Ke,h(R.value.modified),1)])):O("",!0)])]),e("div",ze,[e("div",Ye,[e("button",{onClick:ce,class:"action-btn",title:"导出配置"}," 📤 "),e("label",He,[u[4]||(u[4]=A(" 📥 ")),e("input",{type:"file",accept:".json",onChange:de,style:{display:"none"}},null,32)])]),e("div",Xe,[F(e("input",{"onUpdate:modelValue":u[0]||(u[0]=_=>G.value=_),type:"text",placeholder:"搜索配置项...",class:"search-input"},null,512),[[z,G.value]]),u[5]||(u[5]=e("span",{class:"search-icon"},"🔍",-1))])])]),s.value?(i(),c("div",Qe,u[6]||(u[6]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在加载配置...",-1)]))):y.value.length>0?(i(),c("div",We,[(i(!0),c(X,null,Q(y.value,_=>(i(),c("div",{key:_.name,class:"config-group"},[e("div",Ze,[e("div",et,[e("span",tt,h(K[_.name]||"⚙️"),1)]),e("div",st,[e("button",{onClick:b=>E(_.name),class:"reset-btn",disabled:t.value,title:"重置该组所有配置为默认值"}," 重置 ",8,ot)]),u[7]||(u[7]=e("div",{class:"group-divider"},null,-1))]),e("div",nt,[(i(!0),c(X,null,Q(_.subGroups,b=>(i(),c("div",{key:b.name,class:"sub-group"},[e("div",{class:"sub-group-header",onClick:l=>m(_.name,b.name)},[e("div",lt,[u[8]||(u[8]=e("span",{class:"sub-group-icon"},"📁",-1)),e("h4",it,h(b.displayName),1),e("span",rt,"("+h(b.items.length)+")",1)]),e("span",{class:se(["collapse-icon",{collapsed:o(_.name,b.name)}])}," ▼ ",2)],8,at),F(e("div",ct,[(i(!0),c(X,null,Q(b.items,l=>(i(),c("div",{key:l.id,class:se(["config-item",{modified:d.value.get(l.id)!==l.configValue}])},[l.inputType==="BOOLEAN"||l.inputType==="CHECKBOX"?(i(),c("div",dt,[e("div",ut,[e("div",pt,[e("label",vt,[A(h(l.description||l.displayName)+" ",1),e("span",ft,h(l.inputType==="CHECKBOX"?"选择":"布尔"),1),d.value.get(l.id)!==l.configValue?(i(),c("span",gt,"已修改")):O("",!0)]),e("span",{class:"config-key",title:l.configKey},h(l.configKey),9,mt)])]),e("div",ht,[l.options&&l.options.length>0?(i(),c("select",{key:0,class:"config-input select-input",value:l.configValue,onChange:M=>{var B;return a(l,((B=M.target)==null?void 0:B.value)||"")}},[(i(!0),c(X,null,Q(l.options,M=>(i(),c("option",{key:W(M),value:W(M)},h(ne(M)),9,bt))),128))],40,yt)):(i(),pe(Se,{key:1,enabled:ee(l.configValue),label:"","onUpdate:switchValue":M=>a(l,M)},null,8,["enabled","onUpdate:switchValue"]))])])):l.inputType==="SELECT"?(i(),c("div",_t,[e("div",wt,[e("div",$t,[e("label",kt,[A(h(l.description||l.displayName)+" ",1),u[9]||(u[9]=e("span",{class:"type-badge select"},"选择",-1)),d.value.get(l.id)!==l.configValue?(i(),c("span",Ct,"已修改")):O("",!0)]),e("span",{class:"config-key",title:l.configKey},h(l.configKey),9,St)])]),e("div",Tt,[e("select",{class:"config-input select-input",value:l.configValue,onChange:M=>{var B;return a(l,((B=M.target)==null?void 0:B.value)||"")}},[(i(!0),c(X,null,Q(l.options||[],M=>(i(),c("option",{key:W(M),value:W(M)},h(ne(M)),9,Mt))),128))],40,At)])])):l.inputType==="TEXTAREA"?(i(),c("div",xt,[e("div",Et,[e("div",Vt,[e("label",Ut,[A(h(l.description||l.displayName)+" ",1),u[10]||(u[10]=e("span",{class:"type-badge textarea"},"多行",-1)),d.value.get(l.id)!==l.configValue?(i(),c("span",Pt,"已修改")):O("",!0)]),e("span",{class:"config-key",title:l.configKey},h(l.configKey),9,Bt)])]),e("div",Ot,[e("textarea",{class:"config-input textarea-input",value:l.configValue,onInput:M=>{var B;return a(l,((B=M.target)==null?void 0:B.value)||"")},onBlur:v,rows:"3"},null,40,Lt)])])):l.inputType==="NUMBER"?(i(),c("div",Rt,[e("div",It,[e("div",Gt,[e("label",Nt,[A(h(l.description||l.displayName)+" ",1),u[11]||(u[11]=e("span",{class:"type-badge number"},"数值",-1)),d.value.get(l.id)!==l.configValue?(i(),c("span",Dt,"已修改")):O("",!0)]),e("span",{class:"config-key",title:l.configKey},h(l.configKey),9,jt),l.min||l.max?(i(),c("div",Ft,[e("span",qt," 范围: "+h(l.min||0)+" - "+h(l.max||"∞"),1)])):O("",!0)])]),e("div",Jt,[e("input",{type:"number",class:"config-input number-input",value:L(l.configValue),onInput:M=>{var B;return a(l,((B=M.target)==null?void 0:B.value)||"")},onBlur:v,min:l.min||1,max:l.max||1e4},null,40,Kt)])])):(i(),c("div",zt,[e("div",Yt,[e("div",Ht,[e("label",Xt,[A(h(l.description||l.displayName)+" ",1),e("span",Qt,h(l.inputType==="TEXT"?"文本":"字符串"),1),d.value.get(l.id)!==l.configValue?(i(),c("span",Wt,"已修改")):O("",!0)]),e("span",{class:"config-key",title:l.configKey},h(l.configKey),9,Zt)])]),e("div",es,[e("input",{type:"text",class:"config-input text-input",value:l.configValue,onInput:M=>{var B;return a(l,((B=M.target)==null?void 0:B.value)||"")},onBlur:v},null,40,ts)])]))],2))),128))],512),[[Ee,!o(_.name,b.name)]])]))),128))])]))),128))])):(i(),c("div",ss,u[12]||(u[12]=[e("p",null,"未找到配置项",-1)]))),S(we,{name:"message-fade"},{default:oe(()=>[P.show?(i(),c("div",{key:0,class:se(["message-toast",P.type])},h(P.text),3)):O("",!0)]),_:1})]))}}),ns=ie(os,[["__scopeId","data-v-e98a5347"]]),as={class:"modal-header"},ls={class:"modal-content"},is={class:"modal-footer"},rs=re({__name:"index",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""}},emits:["update:modelValue","confirm"],setup(j){const s=t=>{t.target===t.currentTarget&&(t.stopPropagation(),t.preventDefault())};return(t,f)=>(i(),pe(Ve,{to:"body"},[S(we,{name:"modal"},{default:oe(()=>[j.modelValue?(i(),c("div",{key:0,class:"modal-overlay",onClick:s},[e("div",{class:"modal-container",onClick:f[3]||(f[3]=_e(()=>{},["stop"]))},[e("div",as,[e("h3",null,h(j.title),1),e("button",{class:"close-btn",onClick:f[0]||(f[0]=d=>t.$emit("update:modelValue",!1))},[S(U(V),{icon:"carbon:close"})])]),e("div",ls,[ke(t.$slots,"default",{},void 0,!0)]),e("div",is,[ke(t.$slots,"footer",{},()=>[e("button",{class:"cancel-btn",onClick:f[1]||(f[1]=d=>t.$emit("update:modelValue",!1))},"取消"),e("button",{class:"confirm-btn",onClick:f[2]||(f[2]=d=>t.$emit("confirm"))},"确认")],!0)])])])):O("",!0)]),_:3})]))}}),ge=ie(rs,[["__scopeId","data-v-59b7bca6"]]),cs={class:"tool-selection-content"},ds={class:"tool-controls"},us={class:"search-container"},ps={class:"sort-container"},vs={class:"tool-summary"},fs={class:"summary-text"},gs={key:0,class:"tool-groups"},ms=["onClick"],hs={class:"group-title-area"},ys={class:"group-name"},bs={class:"group-count"},_s={class:"group-enable-all"},ws=["checked","onChange","data-group"],$s={class:"tool-info"},ks={class:"tool-selection-name"},Cs={key:0,class:"tool-selection-desc"},Ss={class:"tool-actions"},Ts=["checked","onChange"],As={key:1,class:"empty-state"},Ms=re({__name:"index",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(j,{emit:s}){const t=j,f=s,d=Z({get:()=>t.modelValue,set:v=>f("update:modelValue",v)}),n=I(""),P=I("group"),G=I(new Set),k=I([]),x=(v,r)=>{const w=document.querySelector(`input[data-group="${v}"]`);w&&(w.indeterminate=W(r))};be(()=>t.selectedToolIds,v=>{k.value=[...v]},{immediate:!0});const K=Z(()=>{let v=t.tools.filter(r=>r&&r.key);if(n.value){const r=n.value.toLowerCase();v=v.filter(w=>w.name.toLowerCase().includes(r)||w.description.toLowerCase().includes(r)||w.serviceGroup&&w.serviceGroup.toLowerCase().includes(r))}switch(P.value){case"name":v=[...v].sort((r,w)=>r.name.localeCompare(w.name));break;case"enabled":v=[...v].sort((r,w)=>{const D=k.value.includes(r.key),E=k.value.includes(w.key);return D&&!E?-1:!D&&E?1:r.name.localeCompare(w.name)});break;case"group":default:v=[...v].sort((r,w)=>{const D=r.serviceGroup||"未分组",E=w.serviceGroup||"未分组";return D!==E?D.localeCompare(E):r.name.localeCompare(w.name)});break}return v}),q=Z(()=>{const v=new Map;return K.value.forEach(r=>{const w=r.serviceGroup||"未分组";v.has(w)||v.set(w,[]),v.get(w).push(r)}),new Map([...v.entries()].sort())}),N=Z(()=>K.value.length);be([k,q],()=>{Pe(()=>{for(const[v,r]of q.value)x(v,r)})},{flush:"post",deep:!1});const ee=v=>k.value.includes(v),L=(v,r)=>{r.stopPropagation();const D=r.target.checked;if(!v){console.error("toolKey is undefined, cannot proceed");return}D?k.value.includes(v)||(k.value=[...k.value,v]):k.value=k.value.filter(E=>E!==v)},g=v=>v.filter(r=>k.value.includes(r.key)),T=v=>v.length>0&&v.every(r=>k.value.includes(r.key)),W=v=>{const r=g(v).length;return r>0&&r<v.length},ne=(v,r)=>{r.stopPropagation();const D=r.target.checked,E=v.map(Y=>Y.key);if(D){const Y=[...k.value];E.forEach(m=>{Y.includes(m)||Y.push(m)}),k.value=Y}else k.value=k.value.filter(Y=>!E.includes(Y))},$=v=>{G.value.has(v)?G.value.delete(v):G.value.add(v)},a=()=>{f("confirm",[...k.value]),f("update:modelValue",!1)},C=()=>{k.value=[...t.selectedToolIds],f("update:modelValue",!1)};return be(d,v=>{if(v){G.value.clear();const r=Array.from(q.value.keys());r.length>1&&r.slice(1).forEach(w=>{G.value.add(w)})}}),(v,r)=>(i(),pe(ge,{modelValue:d.value,"onUpdate:modelValue":[r[4]||(r[4]=w=>d.value=w),C],title:"选择工具",onConfirm:a},{default:oe(()=>[e("div",cs,[e("div",ds,[e("div",us,[F(e("input",{"onUpdate:modelValue":r[0]||(r[0]=w=>n.value=w),type:"text",class:"search-input",placeholder:"搜索工具..."},null,512),[[z,n.value]])]),e("div",ps,[F(e("select",{"onUpdate:modelValue":r[1]||(r[1]=w=>P.value=w),class:"sort-select"},r[5]||(r[5]=[e("option",{value:"group"},"按服务组排序",-1),e("option",{value:"name"},"按名称排序",-1),e("option",{value:"enabled"},"按启用状态排序",-1)]),512),[[Ue,P.value]])])]),e("div",vs,[e("span",fs," 共 "+h(q.value.size)+" 个服务组，"+h(N.value)+" 个工具 (已选择 "+h(k.value.length)+" 个) ",1)]),q.value.size>0?(i(),c("div",gs,[(i(!0),c(X,null,Q(q.value,([w,D])=>(i(),c("div",{key:w,class:"tool-group"},[e("div",{class:se(["tool-group-header",{collapsed:G.value.has(w)}]),onClick:E=>$(w)},[e("div",hs,[S(U(V),{icon:G.value.has(w)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),S(U(V),{icon:"carbon:folder",class:"group-icon"}),e("span",ys,h(w),1),e("span",bs," ("+h(g(D).length)+"/"+h(D.length)+") ",1)]),e("div",{class:"group-actions",onClick:r[2]||(r[2]=_e(()=>{},["stop"]))},[e("label",_s,[e("input",{type:"checkbox",class:"group-enable-checkbox",checked:T(D),onChange:E=>ne(D,E),"data-group":w},null,40,ws),r[6]||(r[6]=e("span",{class:"enable-label"},"启用全部",-1))])])],10,ms),e("div",{class:se(["tool-group-content",{collapsed:G.value.has(w)}])},[(i(!0),c(X,null,Q(D.filter(E=>E&&E.key),E=>(i(),c("div",{key:E.key,class:"tool-selection-item"},[e("div",$s,[e("div",ks,h(E.name),1),E.description?(i(),c("div",Cs,h(E.description),1)):O("",!0)]),e("div",Ss,[e("label",{class:"tool-enable-switch",onClick:r[3]||(r[3]=_e(()=>{},["stop"]))},[e("input",{type:"checkbox",class:"tool-enable-checkbox",checked:ee(E.key),onChange:Y=>L(E.key,Y)},null,40,Ts),r[7]||(r[7]=e("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(i(),c("div",As,[S(U(V),{icon:"carbon:tools",class:"empty-icon"}),r[8]||(r[8]=e("p",null,"没有找到工具",-1))]))])]),_:1},8,["modelValue"]))}}),xs=ie(Ms,[["__scopeId","data-v-af1bc450"]]);class ae{static async handleResponse(s){if(!s.ok)try{const t=await s.json();throw new Error(t.message||`API request failed: ${s.status}`)}catch{throw new Error(`API request failed: ${s.status} ${s.statusText}`)}return s}static async getAllAgents(){try{const s=await fetch(this.BASE_URL);return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to get Agent list:",s),s}}static async getAgentById(s){try{const t=await fetch(`${this.BASE_URL}/${s}`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error(`Failed to get Agent[${s}] details:`,t),t}}static async createAgent(s){try{const t=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to create Agent:",t),t}}static async updateAgent(s,t){try{const f=await fetch(`${this.BASE_URL}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(f)).json()}catch(f){throw console.error(`Failed to update Agent[${s}]:`,f),f}}static async deleteAgent(s){try{const t=await fetch(`${this.BASE_URL}/${s}`,{method:"DELETE"});if(t.status===400)throw new Error("Cannot delete default Agent");await this.handleResponse(t)}catch(t){throw console.error(`Failed to delete Agent[${s}]:`,t),t}}static async getAvailableTools(){try{const s=await fetch(`${this.BASE_URL}/tools`);return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to get available tools list:",s),s}}}ve(ae,"BASE_URL","/api/agents");const Es={class:"config-panel"},Vs={class:"panel-header"},Us={class:"panel-actions"},Ps=["disabled"],Bs={class:"agent-layout"},Os={class:"agent-list"},Ls={class:"list-header"},Rs={class:"agent-count"},Is={key:0,class:"agents-container"},Gs=["onClick"],Ns={class:"agent-card-header"},Ds={class:"agent-name"},js={class:"agent-desc"},Fs={key:0,class:"agent-tools"},qs={key:0,class:"tool-more"},Js={key:1,class:"loading-state"},Ks={key:2,class:"empty-state"},zs={key:0,class:"agent-detail"},Ys={class:"detail-header"},Hs={class:"detail-actions"},Xs={class:"form-item"},Qs={class:"form-item"},Ws={class:"form-item"},Zs={class:"tools-section"},eo={class:"form-item"},to={key:0,class:"form-item"},so={class:"tools-section"},oo={class:"assigned-tools"},no={class:"section-header"},ao={class:"tools-grid"},lo={class:"tool-info"},io={class:"tool-name"},ro={class:"tool-desc"},co={key:0,class:"no-tools"},uo={key:1,class:"no-selection"},po={class:"modal-form"},vo={class:"form-item"},fo={class:"form-item"},go={class:"form-item"},mo={class:"delete-confirm"},ho=re({__name:"agentConfig",setup(j){const s=I(!1),t=I(""),f=I(""),d=le([]),n=I(null),P=le([]),G=I(!1),k=I(!1),x=I(!1),K=I(!1),q=I(!1),N=le({name:"",description:"",nextStepPrompt:"",modelName:"",modelControlledByPlan:!1}),ee=m=>{q.value=m,K.value=!m,n.value&&(n.value.modelControlledByPlan=m)};Z(()=>!n.value||!n.value.availableTools||!Array.isArray(n.value.availableTools)?P:P.filter(m=>!n.value.availableTools.includes(m.key)));const L=m=>{const o=P.find(R=>R.key===m);return o?o.name:m},g=m=>{const o=P.find(R=>R.key===m);return o?o.description:""},T=(m,o)=>{o==="success"?(f.value=m,setTimeout(()=>{f.value=""},3e3)):(t.value=m,setTimeout(()=>{t.value=""},5e3))},W=async()=>{s.value=!0;try{const[m,o]=await Promise.all([ae.getAllAgents(),ae.getAvailableTools()]),R=m.map(y=>({...y,availableTools:Array.isArray(y.availableTools)?y.availableTools:[]}));d.splice(0,d.length,...R),P.splice(0,P.length,...o),R.length>0&&await ne(R[0])}catch(m){console.error("加载数据失败:",m),T("加载数据失败: "+m.message,"error");const o=[{key:"search-web",name:"网络搜索",description:"在互联网上搜索信息",enabled:!0,serviceGroup:"搜索服务"},{key:"search-local",name:"本地搜索",description:"在本地文件中搜索内容",enabled:!0,serviceGroup:"搜索服务"},{key:"file-read",name:"读取文件",description:"读取本地或远程文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-write",name:"写入文件",description:"创建或修改文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-delete",name:"删除文件",description:"删除指定的文件",enabled:!1,serviceGroup:"文件服务"},{key:"calculator",name:"计算器",description:"执行数学计算",enabled:!0,serviceGroup:"计算服务"},{key:"code-execute",name:"代码执行",description:"执行Python或JavaScript代码",enabled:!0,serviceGroup:"计算服务"},{key:"weather",name:"天气查询",description:"获取指定地区的天气信息",enabled:!0,serviceGroup:"信息服务"},{key:"currency",name:"汇率查询",description:"查询货币汇率信息",enabled:!0,serviceGroup:"信息服务"},{key:"email",name:"发送邮件",description:"发送电子邮件",enabled:!1,serviceGroup:"通信服务"},{key:"sms",name:"发送短信",description:"发送短信消息",enabled:!1,serviceGroup:"通信服务"}],R=[{id:"demo-1",name:"通用助手",description:"一个能够处理各种任务的智能助手",nextStepPrompt:"You are a helpful assistant that can answer questions and help with various tasks. What would you like me to help you with next?",availableTools:["search-web","calculator","weather"],modelControlledByPlan:!1},{id:"demo-2",name:"数据分析师",description:"专门用于数据分析和可视化的Agent",nextStepPrompt:"You are a data analyst assistant specialized in analyzing data and creating visualizations. Please provide the data you would like me to analyze.",availableTools:["file-read","file-write","calculator","code-execute"],modelControlledByPlan:!1}];P.splice(0,P.length,...o),d.splice(0,d.length,...R),R.length>0&&(n.value=R[0])}finally{s.value=!1}},ne=async m=>{if(m)try{const o=await ae.getAgentById(m.id);console.log("加载Agent详情:",o),n.value={...o,availableTools:Array.isArray(o.availableTools)?o.availableTools:[]},K.value=!o.modelControlledByPlan,q.value=o.modelControlledByPlan}catch(o){console.error("加载Agent详情失败:",o),T("加载Agent详情失败: "+o.message,"error"),n.value={...m,availableTools:Array.isArray(m.availableTools)?m.availableTools:[]},K.value=!m.modelControlledByPlan,q.value=m.modelControlledByPlan}},$=()=>{N.name="",N.description="",N.nextStepPrompt="",G.value=!0},a=async()=>{var m;if(!N.name.trim()||!N.description.trim()){T("请填写必要的字段","error");return}try{const o={name:N.name.trim(),description:N.description.trim(),nextStepPrompt:((m=N.nextStepPrompt)==null?void 0:m.trim())||"",availableTools:[]},R=await ae.createAgent(o);d.push(R),n.value=R,G.value=!1,T("Agent创建成功","success")}catch(o){T("创建Agent失败: "+o.message,"error")}},C=()=>{x.value=!0},v=m=>{n.value&&(n.value.availableTools=[...m])},r=async()=>{if(n.value){if(!n.value.name.trim()||!n.value.description.trim()){T("请填写必要的字段","error");return}try{const m=await ae.updateAgent(n.value.id,n.value),o=d.findIndex(R=>R.id===m.id);o!==-1&&(d[o]=m),n.value=m,T("Agent保存成功","success")}catch(m){T("保存Agent失败: "+m.message,"error")}}},w=()=>{k.value=!0},D=async()=>{if(n.value)try{await ae.deleteAgent(n.value.id);const m=d.findIndex(o=>o.id===n.value.id);m!==-1&&d.splice(m,1),n.value=d.length>0?d[0]:null,k.value=!1,T("Agent删除成功","success")}catch(m){T("删除Agent失败: "+m.message,"error")}},E=()=>{const m=document.createElement("input");m.type="file",m.accept=".json",m.onchange=o=>{var y;const R=(y=o.target.files)==null?void 0:y[0];if(R){const ce=new FileReader;ce.onload=async de=>{var p;try{const u=JSON.parse((p=de.target)==null?void 0:p.result);if(!u.name||!u.description)throw new Error("Agent配置格式不正确：缺少必要字段");const{id:_,...b}=u,l=await ae.createAgent(b);d.push(l),n.value=l,T("Agent导入成功","success")}catch(u){T("导入Agent失败: "+u.message,"error")}},ce.readAsText(R)}},m.click()},Y=()=>{if(n.value)try{const m=JSON.stringify(n.value,null,2),o=new Blob([m],{type:"application/json"}),R=URL.createObjectURL(o),y=document.createElement("a");y.href=R,y.download=`agent-${n.value.name}-${new Date().toISOString().split("T")[0]}.json`,y.click(),URL.revokeObjectURL(R),T("Agent导出成功","success")}catch(m){T("导出Agent失败: "+m.message,"error")}};return he(()=>{W()}),(m,o)=>{var R;return i(),c("div",Es,[e("div",Vs,[o[16]||(o[16]=e("h2",null,"Agent配置",-1)),e("div",Us,[e("button",{class:"action-btn",onClick:E},[S(U(V),{icon:"carbon:upload"}),o[14]||(o[14]=A(" 导入 "))]),e("button",{class:"action-btn",onClick:Y,disabled:!n.value},[S(U(V),{icon:"carbon:download"}),o[15]||(o[15]=A(" 导出 "))],8,Ps)])]),e("div",Bs,[e("div",Os,[e("div",Ls,[o[17]||(o[17]=e("h3",null,"已配置的Agent",-1)),e("span",Rs,"("+h(d.length)+")",1)]),s.value?O("",!0):(i(),c("div",Is,[(i(!0),c(X,null,Q(d,y=>{var ce;return i(),c("div",{key:y.id,class:se(["agent-card",{active:((ce=n.value)==null?void 0:ce.id)===y.id}]),onClick:de=>ne(y)},[e("div",Ns,[e("span",Ds,h(y.name),1),S(U(V),{icon:"carbon:chevron-right"})]),e("p",js,h(y.description),1),y.availableTools&&Array.isArray(y.availableTools)&&y.availableTools.length>0?(i(),c("div",Fs,[(i(!0),c(X,null,Q(y.availableTools.slice(0,3),de=>(i(),c("span",{key:de,class:"tool-tag"},h(L(de)),1))),128)),y.availableTools.length>3?(i(),c("span",qs," +"+h(y.availableTools.length-3),1)):O("",!0)])):O("",!0)],10,Gs)}),128))])),s.value?(i(),c("div",Js,[S(U(V),{icon:"carbon:loading",class:"loading-icon"}),o[18]||(o[18]=A(" 加载中... "))])):O("",!0),!s.value&&d.length===0?(i(),c("div",Ks,[S(U(V),{icon:"carbon:bot",class:"empty-icon"}),o[19]||(o[19]=e("p",null,"暂无Agent配置",-1))])):O("",!0),e("button",{class:"add-btn",onClick:$},[S(U(V),{icon:"carbon:add"}),o[20]||(o[20]=A(" 新建Agent "))])]),n.value?(i(),c("div",zs,[e("div",Ys,[e("h3",null,h(n.value.name),1),e("div",Hs,[e("button",{class:"action-btn primary",onClick:r},[S(U(V),{icon:"carbon:save"}),o[21]||(o[21]=A(" 保存 "))]),e("button",{class:"action-btn danger",onClick:w},[S(U(V),{icon:"carbon:trash-can"}),o[22]||(o[22]=A(" 删除 "))])])]),e("div",Xs,[o[23]||(o[23]=e("label",null,[A("Agent名称 "),e("span",{class:"required"},"*")],-1)),F(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=y=>n.value.name=y),placeholder:"输入Agent名称",required:""},null,512),[[z,n.value.name]])]),e("div",Qs,[o[24]||(o[24]=e("label",null,[A("描述 "),e("span",{class:"required"},"*")],-1)),F(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=y=>n.value.description=y),rows:"3",placeholder:"描述这个Agent的功能和用途",required:""},null,512),[[z,n.value.description]])]),e("div",Ws,[o[25]||(o[25]=e("label",null,"Agent提示词（人设，要求，以及下一步动作的指导）",-1)),F(e("textarea",{"onUpdate:modelValue":o[2]||(o[2]=y=>n.value.nextStepPrompt=y),rows:"8",placeholder:"设置Agent的人设、要求以及下一步动作的指导..."},null,512),[[z,n.value.nextStepPrompt]])]),e("div",Zs,[o[28]||(o[28]=e("h4",null,"模型配置",-1)),e("div",eo,[o[26]||(o[26]=e("label",null,"模型选择",-1)),S(Se,{enabled:q.value,label:"由计划控制（根据Model配置，由计划控制模型调用）","onUpdate:switchValue":o[3]||(o[3]=y=>ee(y))},null,8,["enabled"])]),K.value?(i(),c("div",to,[o[27]||(o[27]=e("label",null,"模型名称",-1)),F(e("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=y=>n.value.modelName=y),placeholder:"输入Model名称（为空时调用默认Model）",required:""},null,512),[[z,n.value.modelName]])])):O("",!0)]),e("div",so,[o[31]||(o[31]=e("h4",null,"工具配置",-1)),e("div",oo,[e("div",no,[e("span",null,"已分配工具 ("+h((n.value.availableTools||[]).length)+")",1),P.length>0?(i(),c("button",{key:0,class:"action-btn small",onClick:C},[S(U(V),{icon:"carbon:add"}),o[29]||(o[29]=A(" 添加/删除工具 "))])):O("",!0)]),e("div",ao,[(i(!0),c(X,null,Q(n.value.availableTools||[],y=>(i(),c("div",{key:y,class:"tool-item assigned"},[e("div",lo,[e("span",io,h(L(y)),1),e("span",ro,h(g(y)),1)])]))),128)),!n.value.availableTools||n.value.availableTools.length===0?(i(),c("div",co,[S(U(V),{icon:"carbon:tool-box"}),o[30]||(o[30]=e("span",null,"暂无分配的工具",-1))])):O("",!0)])])])])):(i(),c("div",uo,[S(U(V),{icon:"carbon:bot",class:"placeholder-icon"}),o[32]||(o[32]=e("p",null,"请选择一个Agent进行配置",-1))]))]),S(ge,{modelValue:G.value,"onUpdate:modelValue":o[8]||(o[8]=y=>G.value=y),title:"新建Agent",onConfirm:a},{default:oe(()=>[e("div",po,[e("div",vo,[o[33]||(o[33]=e("label",null,[A("Agent名称 "),e("span",{class:"required"},"*")],-1)),F(e("input",{type:"text","onUpdate:modelValue":o[5]||(o[5]=y=>N.name=y),placeholder:"输入Agent名称",required:""},null,512),[[z,N.name]])]),e("div",fo,[o[34]||(o[34]=e("label",null,[A("描述 "),e("span",{class:"required"},"*")],-1)),F(e("textarea",{"onUpdate:modelValue":o[6]||(o[6]=y=>N.description=y),rows:"3",placeholder:"描述这个Agent的功能和用途",required:""},null,512),[[z,N.description]])]),e("div",go,[o[35]||(o[35]=e("label",null,"Agent提示词（人设，要求，以及下一步动作的指导）",-1)),F(e("textarea",{"onUpdate:modelValue":o[7]||(o[7]=y=>N.nextStepPrompt=y),rows:"8",placeholder:"设置Agent的人设、要求以及下一步动作的指导..."},null,512),[[z,N.nextStepPrompt]])])])]),_:1},8,["modelValue"]),S(xs,{modelValue:x.value,"onUpdate:modelValue":o[9]||(o[9]=y=>x.value=y),tools:P,"selected-tool-ids":((R=n.value)==null?void 0:R.availableTools)||[],onConfirm:v},null,8,["modelValue","tools","selected-tool-ids"]),S(ge,{modelValue:k.value,"onUpdate:modelValue":o[11]||(o[11]=y=>k.value=y),title:"删除确认"},{footer:oe(()=>[e("button",{class:"cancel-btn",onClick:o[10]||(o[10]=y=>k.value=!1)},"取消"),e("button",{class:"confirm-btn danger",onClick:D},"删除")]),default:oe(()=>{var y;return[e("div",mo,[S(U(V),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[o[36]||(o[36]=A("确定要删除 ")),e("strong",null,h((y=n.value)==null?void 0:y.name),1),o[37]||(o[37]=A(" 吗？"))]),o[38]||(o[38]=e("p",{class:"warning-text"},"此操作不可恢复。",-1))])]}),_:1},8,["modelValue"]),t.value?(i(),c("div",{key:0,class:"error-toast",onClick:o[12]||(o[12]=y=>t.value="")},[S(U(V),{icon:"carbon:error"}),A(" "+h(t.value),1)])):O("",!0),f.value?(i(),c("div",{key:1,class:"success-toast",onClick:o[13]||(o[13]=y=>f.value="")},[S(U(V),{icon:"carbon:checkmark"}),A(" "+h(f.value),1)])):O("",!0)])}}}),yo=ie(ho,[["__scopeId","data-v-bebdfc2c"]]);class ue{static async handleResponse(s){if(!s.ok)try{const t=await s.json();throw new Error(t.message||`API request failed: ${s.status}`)}catch{throw new Error(`API request failed: ${s.status} ${s.statusText}`)}return s}static async getAllModels(){try{const s=await fetch(this.BASE_URL);return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to get Model list:",s),s}}static async getModelById(s){try{const t=await fetch(`${this.BASE_URL}/${s}`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error(`Failed to get Model[${s}] details:`,t),t}}static async createModel(s){try{const t=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to create Model:",t),t}}static async updateModel(s,t){try{const f=await fetch(`${this.BASE_URL}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(f)).json()}catch(f){throw console.error(`Failed to update Model[${s}]:`,f),f}}static async deleteModel(s){try{const t=await fetch(`${this.BASE_URL}/${s}`,{method:"DELETE"});if(t.status===400)throw new Error("Cannot delete default Model");await this.handleResponse(t)}catch(t){throw console.error(`Failed to delete Model[${s}]:`,t),t}}}ve(ue,"BASE_URL","/api/models");const bo={class:"config-panel"},_o={class:"panel-header"},wo={class:"panel-actions"},$o=["disabled"],ko={class:"model-layout"},Co={class:"model-list"},So={class:"list-header"},To={class:"model-count"},Ao={key:0,class:"models-container"},Mo=["onClick"],xo={class:"model-card-header"},Eo={class:"model-name"},Vo={class:"model-desc"},Uo={key:1,class:"loading-state"},Po={key:2,class:"empty-state"},Bo={key:0,class:"model-detail"},Oo={class:"detail-header"},Lo={class:"detail-actions"},Ro={class:"form-item"},Io={class:"form-item"},Go={key:1,class:"no-selection"},No={class:"modal-form"},Do={class:"form-item"},jo={class:"form-item"},Fo={class:"delete-confirm"},qo=re({__name:"modelConfig",setup(j){const s=I(!1),t=I(""),f=I(""),d=le([]),n=I(null),P=I(!1),G=I(!1),k=le({name:"",description:""}),x=($,a)=>{a==="success"?(f.value=$,setTimeout(()=>{f.value=""},3e3)):(t.value=$,setTimeout(()=>{t.value=""},5e3))},K=async()=>{s.value=!0;try{const[$]=await Promise.all([ue.getAllModels()]),a=$.map(C=>({...C}));d.splice(0,d.length,...a),a.length>0&&await q(a[0])}catch($){console.error("加载数据失败:",$),x("加载数据失败: "+$.message,"error");const a=[{id:"demo-1",name:"通用助手",description:"一个能够处理各种任务的智能助手"},{id:"demo-2",name:"数据分析师",description:"专门用于数据分析和可视化的Model"}];d.splice(0,d.length,...a),a.length>0&&(n.value=a[0])}finally{s.value=!1}},q=async $=>{if($)try{const a=await ue.getModelById($.id);n.value={...a}}catch(a){console.error("加载Model详情失败:",a),x("加载Model详情失败: "+a.message,"error"),n.value={...$}}},N=()=>{k.name="",k.description="",k.nextStepPrompt="",P.value=!0},ee=async()=>{if(!k.name.trim()||!k.description.trim()){x("请填写必要的字段","error");return}try{const $={name:k.name.trim(),description:k.description.trim()},a=await ue.createModel($);d.push(a),n.value=a,P.value=!1,x("Model创建成功","success")}catch($){x("创建Model失败: "+$.message,"error")}},L=async()=>{if(n.value){if(!n.value.name.trim()||!n.value.description.trim()){x("请填写必要的字段","error");return}try{const $=await ue.updateModel(n.value.id,n.value),a=d.findIndex(C=>C.id===$.id);a!==-1&&(d[a]=$),n.value=$,x("Model保存成功","success")}catch($){x("保存Model失败: "+$.message,"error")}}},g=()=>{G.value=!0},T=async()=>{if(n.value)try{await ue.deleteModel(n.value.id);const $=d.findIndex(a=>a.id===n.value.id);$!==-1&&d.splice($,1),n.value=d.length>0?d[0]:null,G.value=!1,x("Model删除成功","success")}catch($){x("删除Model失败: "+$.message,"error")}},W=()=>{const $=document.createElement("input");$.type="file",$.accept=".json",$.onchange=a=>{var v;const C=(v=a.target.files)==null?void 0:v[0];if(C){const r=new FileReader;r.onload=async w=>{var D;try{const E=JSON.parse((D=w.target)==null?void 0:D.result);if(!E.name||!E.description)throw new Error("Model配置格式不正确：缺少必要字段");const{id:Y,...m}=E,o=await ue.createModel(m);d.push(o),n.value=o,x("Model导入成功","success")}catch(E){x("导入Model失败: "+E.message,"error")}},r.readAsText(C)}},$.click()},ne=()=>{if(n.value)try{const $=JSON.stringify(n.value,null,2),a=new Blob([$],{type:"application/json"}),C=URL.createObjectURL(a),v=document.createElement("a");v.href=C,v.download=`model-${n.value.name}-${new Date().toISOString().split("T")[0]}.json`,v.click(),URL.revokeObjectURL(C),x("Model导出成功","success")}catch($){x("导出Model失败: "+$.message,"error")}};return he(()=>{K()}),($,a)=>(i(),c("div",bo,[e("div",_o,[a[11]||(a[11]=e("h2",null,"Model配置",-1)),e("div",wo,[e("button",{class:"action-btn",onClick:W},[S(U(V),{icon:"carbon:upload"}),a[9]||(a[9]=A(" 导入 "))]),e("button",{class:"action-btn",onClick:ne,disabled:!n.value},[S(U(V),{icon:"carbon:download"}),a[10]||(a[10]=A(" 导出 "))],8,$o)])]),e("div",ko,[e("div",Co,[e("div",So,[a[12]||(a[12]=e("h3",null,"已配置的Model",-1)),e("span",To,"("+h(d.length)+")",1)]),s.value?O("",!0):(i(),c("div",Ao,[(i(!0),c(X,null,Q(d,C=>{var v;return i(),c("div",{key:C.id,class:se(["model-card",{active:((v=n.value)==null?void 0:v.id)===C.id}]),onClick:r=>q(C)},[e("div",xo,[e("span",Eo,h(C.name),1),S(U(V),{icon:"carbon:chevron-right"})]),e("p",Vo,h(C.description),1)],10,Mo)}),128))])),s.value?(i(),c("div",Uo,[S(U(V),{icon:"carbon:loading",class:"loading-icon"}),a[13]||(a[13]=A(" 加载中... "))])):O("",!0),!s.value&&d.length===0?(i(),c("div",Po,[S(U(V),{icon:"carbon:bot",class:"empty-icon"}),a[14]||(a[14]=e("p",null,"暂无Model配置",-1))])):O("",!0),e("button",{class:"add-btn",onClick:N},[S(U(V),{icon:"carbon:add"}),a[15]||(a[15]=A(" 新建Model "))])]),n.value?(i(),c("div",Bo,[e("div",Oo,[e("h3",null,h(n.value.name),1),e("div",Lo,[e("button",{class:"action-btn primary",onClick:L},[S(U(V),{icon:"carbon:save"}),a[16]||(a[16]=A(" 保存 "))]),e("button",{class:"action-btn danger",onClick:g},[S(U(V),{icon:"carbon:trash-can"}),a[17]||(a[17]=A(" 删除 "))])])]),e("div",Ro,[a[18]||(a[18]=e("label",null,[A("Model名称 "),e("span",{class:"required"},"*")],-1)),F(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=C=>n.value.name=C),placeholder:"输入Model名称",required:""},null,512),[[z,n.value.name]])]),e("div",Io,[a[19]||(a[19]=e("label",null,[A("描述 "),e("span",{class:"required"},"*")],-1)),F(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=C=>n.value.description=C),rows:"3",placeholder:"描述这个Model及适用场景",required:""},null,512),[[z,n.value.description]])])])):(i(),c("div",Go,[S(U(V),{icon:"carbon:bot",class:"placeholder-icon"}),a[20]||(a[20]=e("p",null,"请选择一个Model进行配置",-1))]))]),S(ge,{modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=C=>P.value=C),title:"新建Model",onConfirm:ee},{default:oe(()=>[e("div",No,[e("div",Do,[a[21]||(a[21]=e("label",null,[A("Model名称 "),e("span",{class:"required"},"*")],-1)),F(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=C=>k.name=C),placeholder:"输入Model名称",required:""},null,512),[[z,k.name]])]),e("div",jo,[a[22]||(a[22]=e("label",null,[A("描述 "),e("span",{class:"required"},"*")],-1)),F(e("textarea",{"onUpdate:modelValue":a[3]||(a[3]=C=>k.description=C),rows:"3",placeholder:"描述这个Model及适用场景",required:""},null,512),[[z,k.description]])])])]),_:1},8,["modelValue"]),S(ge,{modelValue:G.value,"onUpdate:modelValue":a[6]||(a[6]=C=>G.value=C),title:"删除确认"},{footer:oe(()=>[e("button",{class:"cancel-btn",onClick:a[5]||(a[5]=C=>G.value=!1)},"取消"),e("button",{class:"confirm-btn danger",onClick:T},"删除")]),default:oe(()=>{var C;return[e("div",Fo,[S(U(V),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[a[23]||(a[23]=A("确定要删除 ")),e("strong",null,h((C=n.value)==null?void 0:C.name),1),a[24]||(a[24]=A(" 吗？"))]),a[25]||(a[25]=e("p",{class:"warning-text"},"此操作不可恢复。",-1))])]}),_:1},8,["modelValue"]),t.value?(i(),c("div",{key:0,class:"error-toast",onClick:a[7]||(a[7]=C=>t.value="")},[S(U(V),{icon:"carbon:error"}),A(" "+h(t.value),1)])):O("",!0),f.value?(i(),c("div",{key:1,class:"success-toast",onClick:a[8]||(a[8]=C=>f.value="")},[S(U(V),{icon:"carbon:checkmark"}),A(" "+h(f.value),1)])):O("",!0)]))}}),Jo=ie(qo,[["__scopeId","data-v-7965562f"]]);class me{static async getAllMcpServers(){const s=await fetch(`${this.BASE_URL}/list`);if(!s.ok)throw new Error(`Failed to get MCP server list: ${s.status}`);return await s.json()}static async addMcpServer(s){try{const t=await fetch(`${this.BASE_URL}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new Error(`Failed to add MCP server: ${t.status}`);return{success:!0,message:"Successfully added MCP server"}}catch(t){return console.error("Failed to add MCP server:",t),{success:!1,message:t instanceof Error?t.message:"Failed to add, please retry"}}}static async removeMcpServer(s){try{const t=await fetch(`${this.BASE_URL}/remove?id=${s}`);if(!t.ok)throw new Error(`Failed to delete MCP server: ${t.status}`);return{success:!0,message:"Successfully deleted MCP server"}}catch(t){return console.error(`Failed to delete MCP server[${s}]:`,t),{success:!1,message:t instanceof Error?t.message:"Failed to delete, please retry"}}}}ve(me,"BASE_URL","/api/mcp");const Ko={class:"mcp-config-panel"},zo={class:"mcp-header"},Yo={class:"header-left"},Ho={class:"mcp-stats"},Xo={class:"stat-item"},Qo={class:"stat-value"},Wo={class:"header-right"},Zo={class:"search-box"},en={key:0,class:"loading-container"},tn={key:1,class:"mcp-layout"},sn={class:"mcp-table-container"},on={key:0,class:"empty-state"},nn={class:"empty-state-text"},an={key:1,class:"mcp-table-wrapper"},ln={class:"mcp-table"},rn={class:"mcp-id"},cn={class:"mcp-server-name"},dn={class:"server-name-content"},un={class:"mcp-connection-type"},pn={class:"mcp-config"},vn=["title"],fn={class:"mcp-actions"},gn=["onClick","disabled"],mn={class:"add-mcp-container"},hn={class:"mcp-form"},yn={class:"mcp-form-group"},bn={class:"connection-type-options"},_n={class:"connection-type-option"},wn={class:"connection-type-option"},$n={class:"mcp-form-group"},kn={class:"mcp-form-actions"},Cn=["disabled"],Sn=["disabled"],Tn=re({__name:"mcpConfig",setup(j){const s=I(!1),t=I([]),f=I(""),d=le({connectionType:"STUDIO",configJson:""}),n=le({show:!1,text:"",type:"success"});Z(()=>d.connectionType==="STUDIO"?`请输入MCP服务器配置JSON。

        例如：
        {
        "mcpServers": {
            "github": {
            "command": "npx",
            "args": [
                "-y",
                "@modelcontextprotocol/server-github"
            ],
            "env": {
                "GITHUB_PERSONAL_ACCESS_TOKEN": "<YOUR_TOKEN>"
            }
            }
        }
        }`:`请输入SSE MCP服务器配置JSON。

例如：
{
  "mcpServers": {
    "remote-server": {
      "url": "https://example.com/mcp",
      "headers": {
        "Authorization": "Bearer <YOUR_TOKEN>"
      }
    }
  }
}`);const P=Z(()=>d.configJson.trim().length>0),G=Z(()=>{if(!f.value.trim())return t.value;const L=f.value.toLowerCase();return t.value.filter(g=>g.mcpServerName.toLowerCase().includes(L)||g.connectionType.toLowerCase().includes(L)||g.connectionConfig.toLowerCase().includes(L))}),k=L=>L?L.length>50?L.substring(0,50)+"...":L:"",x=(L,g="success")=>{n.text=L,n.type=g,n.show=!0,setTimeout(()=>{n.show=!1},3e3)},K=async()=>{try{s.value=!0,t.value=await me.getAllMcpServers()}catch(L){console.error("加载MCP服务器列表失败:",L),x("加载MCP服务器列表失败","error")}finally{s.value=!1}},q=async()=>{if(!P.value){x("请输入MCP服务器配置","error");return}try{JSON.parse(d.configJson)}catch{x("配置JSON格式不正确，请检查语法","error");return}try{s.value=!0;const L={connectionType:d.connectionType,configJson:d.configJson},g=await me.addMcpServer(L);g.success?(x("添加MCP服务器成功"),ee(),await K()):x(g.message||"添加MCP服务器失败","error")}catch(L){console.error("添加MCP服务器失败:",L),x("添加MCP服务器失败，请重试","error")}finally{s.value=!1}},N=async L=>{if(confirm("确定要删除这个MCP服务器配置吗？此操作不可恢复。"))try{s.value=!0;const g=await me.removeMcpServer(L);g.success?(x("删除MCP服务器成功"),await K()):x(g.message||"删除MCP服务器失败","error")}catch(g){console.error("删除MCP服务器失败:",g),x("删除MCP服务器失败，请重试","error")}finally{s.value=!1}},ee=()=>{d.connectionType="STUDIO",d.configJson=""};return he(()=>{K()}),(L,g)=>(i(),c("div",Ko,[e("div",zo,[e("div",Yo,[g[5]||(g[5]=e("h2",null,"MCP配置",-1)),e("div",Ho,[e("span",Xo,[g[4]||(g[4]=e("span",{class:"stat-label"},"总服务器:",-1)),e("span",Qo,h(t.value.length),1)])])]),e("div",Wo,[e("div",Zo,[F(e("input",{"onUpdate:modelValue":g[0]||(g[0]=T=>f.value=T),type:"text",placeholder:"搜索MCP服务器...",class:"search-input"},null,512),[[z,f.value]]),g[6]||(g[6]=e("span",{class:"search-icon"},"🔍",-1))])])]),s.value?(i(),c("div",en,g[7]||(g[7]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在加载MCP服务器...",-1)]))):(i(),c("div",tn,[e("div",sn,[g[11]||(g[11]=e("h3",{class:"section-title"},"已配置的MCP服务器",-1)),G.value.length===0?(i(),c("div",on,[g[8]||(g[8]=e("div",{class:"empty-state-icon"},"📂",-1)),e("div",nn,h(f.value?"未找到匹配的MCP服务器":"暂无MCP服务器配置"),1)])):(i(),c("div",an,[e("table",ln,[g[10]||(g[10]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"服务器名称"),e("th",null,"连接类型"),e("th",null,"连接配置"),e("th",null,"操作")])],-1)),e("tbody",null,[(i(!0),c(X,null,Q(G.value,T=>(i(),c("tr",{key:T.id,class:"mcp-row"},[e("td",rn,h(T.id),1),e("td",cn,[e("div",dn,[g[9]||(g[9]=e("span",{class:"server-icon"},"🔌",-1)),A(" "+h(T.mcpServerName),1)])]),e("td",un,[e("span",{class:se(["connection-type-badge",T.connectionType.toLowerCase()])},h(T.connectionType),3)]),e("td",pn,[e("div",{class:"config-preview",title:T.connectionConfig},h(k(T.connectionConfig)),9,vn)]),e("td",fn,[e("button",{onClick:W=>N(T.id),class:"action-btn delete-btn",disabled:s.value}," 删除 ",8,gn)])]))),128))])])]))]),e("div",mn,[g[16]||(g[16]=e("div",{class:"add-mcp-header"},[e("h3",{class:"add-mcp-title"},"添加MCP服务器")],-1)),e("div",hn,[e("div",yn,[g[14]||(g[14]=e("label",{class:"form-label"},"连接类型：",-1)),e("div",bn,[e("div",_n,[F(e("input",{type:"radio",id:"mcp-connection-type-studio","onUpdate:modelValue":g[1]||(g[1]=T=>d.connectionType=T),value:"STUDIO"},null,512),[[Ce,d.connectionType]]),g[12]||(g[12]=e("label",{for:"mcp-connection-type-studio",class:"radio-label"},[e("span",{class:"radio-title"},"STUDIO"),e("span",{class:"connection-type-desc"},"本地mcp server，目前市面上主流的是这个")],-1))]),e("div",wn,[F(e("input",{type:"radio",id:"mcp-connection-type-sse","onUpdate:modelValue":g[2]||(g[2]=T=>d.connectionType=T),value:"SSE"},null,512),[[Ce,d.connectionType]]),g[13]||(g[13]=e("label",{for:"mcp-connection-type-sse",class:"radio-label"},[e("span",{class:"radio-title"},"SSE"),e("span",{class:"connection-type-desc"},"通过http server等提供的，目前网络上比较少见")],-1))])])]),e("div",$n,[g[15]||(g[15]=e("label",{class:"form-label"},"mcp json配置：",-1)),F(e("textarea",{"onUpdate:modelValue":g[3]||(g[3]=T=>d.configJson=T),placeholder:"请输入MCP服务器的配置(JSON格式)...",class:"config-textarea",rows:"6"},null,512),[[z,d.configJson]])]),e("div",kn,[e("button",{onClick:q,class:"action-btn add-btn",disabled:s.value}," 添加 ",8,Cn),e("button",{onClick:ee,class:"action-btn reset-btn",disabled:s.value}," 重置 ",8,Sn)])]),g[17]||(g[17]=Be('<div class="mcp-form-instructions" data-v-5877709b><h4 data-v-5877709b>使用说明：</h4><ol data-v-5877709b><li data-v-5877709b>找到你要用的mcp server的配置json： <ul class="indented-list" data-v-5877709b><li data-v-5877709b><strong data-v-5877709b>本地(STDIO)</strong>：可以在<a href="https://mcp.so" target="_blank" rel="noopener" data-v-5877709b>mcp.so</a>上找到，需要你有Node.js环境并理解你要配置的json里面的每一个项，做对应调整比如配置ak</li><li data-v-5877709b><strong data-v-5877709b>远程服务(SSE)</strong>：<a href="https://mcp.higress.ai/" target="_blank" rel="noopener" data-v-5877709b>mcp.higress.ai/</a>上可以找到，有SSE和STREAMING两种，目前SSE协议更完备一些</li></ul></li><li data-v-5877709b>将json配置复制到上面的输入框，本地选STUDIO，远程选STREAMING或SSE，提交</li><li data-v-5877709b>这样mcp tools就注册成功了。</li><li data-v-5877709b>然后需要在Agent配置里面，新建一个agent，然后增加指定你刚才添加的mcp tools，这样可以极大减少冲突，增强tools被agent选择的准确性</li></ol></div>',1))])])),S(we,{name:"message-fade"},{default:oe(()=>[n.show?(i(),c("div",{key:0,class:se(["message-toast",n.type])},h(n.text),3)):O("",!0)]),_:1})]))}}),An=ie(Tn,[["__scopeId","data-v-5877709b"]]),Mn={class:"config-container"},xn={class:"config-header"},En={class:"header-actions"},Vn={class:"config-content"},Un={class:"config-nav"},Pn=["onClick"],Bn={class:"config-details"},On=re({__name:"index",setup(j){const s=I("basic"),t=[{key:"basic",label:"基础配置",icon:"carbon:settings"},{key:"agent",label:"Agent配置",icon:"carbon:bot"},{key:"model",label:"Model配置",icon:"carbon:build-image"},{key:"mcp",label:"Tools/MCP配置",icon:"carbon:tool-box"}];return(f,d)=>(i(),c("div",Mn,[e("div",xn,[e("div",En,[e("button",{class:"action-btn",onClick:d[0]||(d[0]=n=>f.$router.push("/"))},[S(U(V),{icon:"carbon:arrow-left"}),d[1]||(d[1]=A(" 返回主页 "))])])]),e("div",Vn,[e("nav",Un,[(i(),c(X,null,Q(t,(n,P)=>e("div",{key:P,class:se(["nav-item",{active:s.value===n.key}]),onClick:G=>s.value=n.key},[S(U(V),{icon:n.icon,width:"20"},null,8,["icon"]),e("span",null,h(n.label),1)],10,Pn)),64))]),e("div",Bn,[s.value==="basic"?(i(),pe(ns,{key:0})):O("",!0),s.value==="agent"?(i(),pe(yo,{key:1})):O("",!0),s.value==="model"?(i(),pe(Jo,{key:2})):O("",!0),s.value==="mcp"?(i(),pe(An,{key:3})):O("",!0)])])]))}}),Gn=ie(On,[["__scopeId","data-v-6fe5ae19"]]);export{Gn as default};

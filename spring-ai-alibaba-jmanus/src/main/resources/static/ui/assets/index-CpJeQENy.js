var xe=Object.defineProperty;var Ee=(F,t,s)=>t in F?xe(F,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):F[t]=s;var ge=(F,t,s)=>Ee(F,typeof t!="symbol"?t+"":t,s);import{_ as le,I}from"./_plugin-vue_export-helper-RAZI8S-g.js";import{d as ie,c as r,o as i,e,t as o,f as ve,r as L,x as re,g as H,h as be,i as E,u as g,b as U,q as P,w as K,v as se,F as D,j,p as Q,C as Ve,a as de,z as ae,T as Ce,D as Me,E as ke,s as ye,B as me,G as Pe,k as Ue,H as Be,I as Se}from"./index-TKwppHjL.js";import{L as Ge}from"./index-DA3M1Mbf.js";const Le={class:"switch"},Ie=["checked"],Oe={class:"switch-label"},Fe=ie({__name:"index",props:{enabled:{type:Boolean},label:{}},emits:["update:switchValue"],setup(F,{emit:t}){const s=t,C=$=>{const h=$.target.checked;s("update:switchValue",h)};return($,h)=>(i(),r("label",Le,[e("input",{type:"checkbox",checked:$.enabled,onChange:C},null,40,Ie),h[0]||(h[0]=e("span",{class:"slider"},null,-1)),e("span",Oe,o($.label),1)]))}}),Re=le(Fe,[["__scopeId","data-v-d484b4a3"]]);class pe{static async getConfigsByGroup(t){try{const s=await fetch(`${this.BASE_URL}/group/${t}`);if(!s.ok)throw new Error(`Failed to get ${t} group configuration: ${s.status}`);return await s.json()}catch(s){throw console.error(`Failed to get ${t} group configuration:`,s),s}}static async batchUpdateConfigs(t){if(t.length===0)return{success:!0,message:"No configuration needs to be updated"};try{const s=await fetch(`${this.BASE_URL}/batch-update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Batch update configuration failed: ${s.status}`);return{success:!0,message:"Configuration saved successfully"}}catch(s){return console.error("Batch update configuration failed:",s),{success:!1,message:s instanceof Error?s.message:"Update failed, please try again"}}}static async getConfigById(t){try{const s=await fetch(`${this.BASE_URL}/${t}`);if(!s.ok)throw new Error(`Failed to get configuration item: ${s.status}`);return await s.json()}catch(s){throw console.error(`Failed to get configuration item[${t}]:`,s),s}}static async updateConfig(t){try{const s=await fetch(`${this.BASE_URL}/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Failed to update configuration item: ${s.status}`);return{success:!0,message:"Configuration updated successfully"}}catch(s){return console.error("Failed to update configuration item:",s),{success:!1,message:s instanceof Error?s.message:"Update failed, please try again"}}}}ge(pe,"BASE_URL","/api/config");const Ne={class:"config-panel"},De={class:"config-header"},je={class:"header-left"},Ke={class:"config-stats"},qe={class:"stat-item"},Je={class:"stat-value"},ze={key:0,class:"stat-item"},He={class:"stat-value modified"},Xe={class:"header-right"},Ye={class:"import-export-actions"},Qe={class:"action-btn",title:"导入配置"},We={class:"search-box"},Ze=["placeholder"],et={key:0,class:"loading-container"},tt={key:1,class:"config-groups"},st={class:"group-header"},ot={class:"group-info"},nt={class:"group-icon"},at={class:"group-actions"},lt=["onClick","disabled","title"],it={class:"sub-groups"},ct=["onClick"],rt={class:"sub-group-info"},dt={class:"sub-group-title"},ut={class:"item-count"},pt={class:"config-items"},gt={key:0,class:"config-item-content vertical-layout"},ft={class:"config-item-info"},vt={class:"config-item-header"},ht={class:"config-label"},mt={class:"type-badge boolean"},yt={key:0,class:"modified-badge"},_t=["title"],bt={class:"config-control"},Ct=["value","onChange"],$t=["value"],wt={key:1,class:"config-item-content vertical-layout"},kt={class:"config-item-info"},St={class:"config-item-header"},Tt={class:"config-label"},At={class:"type-badge select"},xt={key:0,class:"modified-badge"},Et=["title"],Vt={class:"config-control"},Mt=["value","onChange"],Pt=["value"],Ut={key:2,class:"config-item-content vertical-layout"},Bt={class:"config-item-info"},Gt={class:"config-item-header"},Lt={class:"config-label"},It={class:"type-badge textarea"},Ot={key:0,class:"modified-badge"},Ft=["title"],Rt={class:"config-control"},Nt=["value","onInput"],Dt={key:3,class:"config-item-content vertical-layout"},jt={class:"config-item-info"},Kt={class:"config-item-header"},qt={class:"config-label"},Jt={class:"type-badge number"},zt={key:0,class:"modified-badge"},Ht=["title"],Xt={key:0,class:"config-meta"},Yt={class:"range-info"},Qt={class:"config-control"},Wt=["value","onInput","min","max"],Zt={key:4,class:"config-item-content vertical-layout"},es={class:"config-item-info"},ts={class:"config-item-header"},ss={class:"config-label"},os={class:"type-badge string"},ns={key:0,class:"modified-badge"},as=["title"],ls={class:"config-control"},is=["value","onInput"],cs={key:2,class:"empty-state"},rs=ie({__name:"basicConfig",setup(F){const{t}=ve(),s=L(!0),C=L(!1),$=L([]),h=L(new Map),p=L(new Set),A=re({show:!1,text:"",type:"success"}),k=L(""),q={maxSteps:"智能体执行最大步数",resetAllAgents:"重置所有agent",maxMemory:"能记住的最大消息数",headlessBrowser:"是否使用无头浏览器模式",browserTimeout:t("config.basicConfig.browserTimeout"),browserDebug:"浏览器debug模式",autoOpenBrowser:"启动时自动打开浏览器",consoleInteractive:"启用控制台交互模式",systemName:"系统名称",language:"默认语言",maxThreads:"最大线程数",timeoutSeconds:t("config.basicConfig.requestTimeout")},O={manus:"智能体设置",browser:"浏览器设置",interaction:"交互设置",system:"系统设置",performance:"性能设置"},x={manus:"🤖",browser:"🌐",interaction:"🖥️",system:"⚙️",performance:"⚡"},W={agent:"智能体设置",browser:"浏览器设置",interaction:"交互设置",system:"系统设置",performance:"性能设置",general:"常规设置"},oe=H(()=>$.value.some(n=>n.subGroups.some(u=>u.items.some(_=>h.value.get(_.id)!==_.configValue)))),G=n=>n==="true",V=n=>parseFloat(n)||0,f=n=>({maxSteps:1,browserTimeout:1,maxThreads:1,timeoutSeconds:5,maxMemory:1})[n]||1,B=n=>({maxSteps:100,browserTimeout:600,maxThreads:32,timeoutSeconds:300,maxMemory:1e3})[n]||1e4,X=n=>typeof n=="string"?n:n.value,ce=n=>typeof n=="string"?n:n.label,ue=(n,u)=>{if(typeof u=="boolean")return u.toString();if(typeof u=="string"){if(n.options&&n.options.length>0){const _=n.options.find(y=>(typeof y=="string"?y:y.label)===u||(typeof y=="string"?y:y.value)===u);if(_)return typeof _=="string"?_:_.value}return u}return String(u)},J=(n,u,_=!1)=>{let y;n.inputType==="BOOLEAN"||n.inputType==="CHECKBOX"?y=ue(n,u):y=String(u),n.configValue!==y&&(n.configValue=y,n._modified=!0,(_||n.inputType==="BOOLEAN"||n.inputType==="CHECKBOX"||n.inputType==="SELECT")&&d())};let m=null;const d=()=>{m&&clearTimeout(m),m=window.setTimeout(()=>{c()},500)},v=(n,u="success")=>{A.text=n,A.type=u,A.show=!0,setTimeout(()=>{A.show=!1},3e3)},M=async()=>{try{s.value=!0;const u=["manus","browser","interaction","system","performance"].map(async y=>{try{const a=await pe.getConfigsByGroup(y);if(a.length===0)return null;const w=a.map(R=>({...R,displayName:R.description??(q[R.configKey]||R.configKey),min:f(R.configKey),max:B(R.configKey)}));w.forEach(R=>{h.value.set(R.id,R.configValue)});const S=new Map;w.forEach(R=>{const z=R.configSubGroup??"general";S.has(z)||S.set(z,[]),S.get(z).push(R)});const N=Array.from(S.entries()).map(([R,z])=>({name:R,displayName:W[R]||R,items:z}));return{name:y,displayName:O[y]||y,subGroups:N}}catch(a){return console.warn(`加载配置组 ${y} 失败，跳过:`,a),null}}),_=await Promise.all(u);$.value=_.filter(y=>y!==null),console.log("配置加载完成:",$.value)}catch(n){console.error("加载配置失败:",n),v(t("config.basicConfig.loadConfigFailed"),"error")}finally{s.value=!1}},c=async()=>{if(!(C.value||!oe.value))try{C.value=!0;const n=[];if($.value.forEach(_=>{_.subGroups.forEach(y=>{const a=y.items.filter(w=>w._modified);n.push(...a)})}),n.length===0){v("没有需要保存的修改");return}const u=await pe.batchUpdateConfigs(n);u.success?(n.forEach(_=>{h.value.set(_.id,_.configValue),_._modified=!1}),v("配置保存成功")):v(u.message||"保存失败","error")}catch(n){console.error("保存配置失败:",n),v(t("config.basicConfig.saveFailed"),"error")}finally{C.value=!1}},l=async n=>{if(confirm(`确定要重置 "${O[n]||n}" 组的所有配置吗？`))try{C.value=!0;const _=$.value.find(w=>w.name===n);if(!_)return;const y=[];if(_.subGroups.forEach(w=>{w.items.forEach(S=>{const N=T(S.configKey);N!==S.configValue&&y.push({...S,configValue:N})})}),y.length===0){v("该组配置已是默认值");return}const a=await pe.batchUpdateConfigs(y);a.success?(await M(),v(`成功重置 ${y.length} 项配置`)):v(a.message||"重置失败","error")}catch(_){console.error("重置组配置失败:",_),v(t("config.basicConfig.resetFailed"),"error")}finally{C.value=!1}},T=n=>({systemName:"JTaskPilot",language:"zh-CN",maxThreads:"8",timeoutSeconds:"60",autoOpenBrowser:"false",headlessBrowser:"true",maxMemory:"1000"})[n]||"",b=(n,u)=>{const _=`${n}-${u}`;p.value.has(_)?p.value.delete(_):p.value.add(_)},Z=(n,u)=>p.value.has(`${n}-${u}`),ee=H(()=>{const n=$.value.reduce((_,y)=>_+y.subGroups.reduce((a,w)=>a+w.items.length,0),0),u=$.value.reduce((_,y)=>_+y.subGroups.reduce((a,w)=>a+w.items.filter(S=>h.value.get(S.id)!==S.configValue).length,0),0);return{total:n,modified:u}}),Y=H(()=>{if(!k.value.trim())return $.value;const n=k.value.toLowerCase();return $.value.map(u=>({...u,subGroups:u.subGroups.map(_=>({..._,items:_.items.filter(y=>y.displayName.toLowerCase().includes(n)||y.configKey.toLowerCase().includes(n)||y.description&&y.description.toLowerCase().includes(n))})).filter(_=>_.items.length>0)})).filter(u=>u.subGroups.length>0)}),ne=()=>{try{const n={timestamp:new Date().toISOString(),version:"1.0",configs:$.value.reduce((a,w)=>(w.subGroups.forEach(S=>{S.items.forEach(N=>{a[N.configKey]=N.configValue})}),a),{})},u=JSON.stringify(n,null,2),_=new Blob([u],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(_),y.download=`config-export-${new Date().toISOString().split("T")[0]}.json`,y.click(),v("配置导出成功")}catch(n){console.error("导出配置失败:",n),v("导出失败","error")}},$e=n=>{var a;const u=n.target,_=(a=u.files)==null?void 0:a[0];if(!_)return;const y=new FileReader;y.onload=async w=>{var S;try{const N=JSON.parse((S=w.target)==null?void 0:S.result);if(!N.configs)throw new Error("无效的配置文件格式");if(!confirm("确定要导入配置吗？这将覆盖当前配置。"))return;C.value=!0;const z=[];if($.value.forEach(Te=>{Te.subGroups.forEach(Ae=>{Ae.items.forEach(he=>{Object.prototype.hasOwnProperty.call(N.configs,he.configKey)&&z.push({...he,configValue:N.configs[he.configKey]})})})}),z.length===0){v("没有找到可导入的配置项");return}const we=await pe.batchUpdateConfigs(z);we.success?(await M(),v(`成功导入 ${z.length} 项配置`)):v(we.message||"导入失败","error")}catch(N){console.error("导入配置失败:",N),v(t("config.basicConfig.importFailed"),"error")}finally{C.value=!1,u.value=""}},y.readAsText(_)};return be(()=>{M()}),(n,u)=>(i(),r("div",Ne,[e("div",De,[e("div",je,[e("h2",null,o(g(t)("config.basicConfig.title")),1),e("div",Ke,[e("span",qe,[u[1]||(u[1]=e("span",{class:"stat-label"},"总配置项:",-1)),e("span",Je,o(ee.value.total),1)]),ee.value.modified>0?(i(),r("span",ze,[u[2]||(u[2]=e("span",{class:"stat-label"},"已修改:",-1)),e("span",He,o(ee.value.modified),1)])):U("",!0)])]),e("div",Xe,[e("div",Ye,[e("button",{onClick:ne,class:"action-btn",title:"导出配置"}," 📤 "),e("label",Qe,[u[3]||(u[3]=P(" 📥 ")),e("input",{type:"file",accept:".json",onChange:$e,style:{display:"none"}},null,32)])]),e("div",We,[K(e("input",{"onUpdate:modelValue":u[0]||(u[0]=_=>k.value=_),type:"text",placeholder:n.$t("config.search"),class:"search-input"},null,8,Ze),[[se,k.value]]),u[4]||(u[4]=e("span",{class:"search-icon"},"🔍",-1))])])]),s.value?(i(),r("div",et,[u[5]||(u[5]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,o(n.$t("config.loading")),1)])):Y.value.length>0?(i(),r("div",tt,[(i(!0),r(D,null,j(Y.value,_=>(i(),r("div",{key:_.name,class:"config-group"},[e("div",st,[e("div",ot,[e("span",nt,o(x[_.name]||"⚙️"),1)]),e("div",at,[e("button",{onClick:y=>l(_.name),class:"reset-btn",disabled:C.value,title:n.$t("config.resetGroupConfirm")},o(n.$t("config.reset")),9,lt)]),u[6]||(u[6]=e("div",{class:"group-divider"},null,-1))]),e("div",it,[(i(!0),r(D,null,j(_.subGroups,y=>(i(),r("div",{key:y.name,class:"sub-group"},[e("div",{class:"sub-group-header",onClick:a=>b(_.name,y.name)},[e("div",rt,[u[7]||(u[7]=e("span",{class:"sub-group-icon"},"📁",-1)),e("h4",dt,o(y.displayName),1),e("span",ut,"("+o(y.items.length)+")",1)]),e("span",{class:Q(["collapse-icon",{collapsed:Z(_.name,y.name)}])}," ▼ ",2)],8,ct),K(e("div",pt,[(i(!0),r(D,null,j(y.items,a=>(i(),r("div",{key:a.id,class:Q(["config-item",{modified:h.value.get(a.id)!==a.configValue}])},[a.inputType==="BOOLEAN"||a.inputType==="CHECKBOX"?(i(),r("div",gt,[e("div",ft,[e("div",vt,[e("label",ht,[P(o(a.description||a.displayName)+" ",1),e("span",mt,o(a.inputType==="CHECKBOX"?n.$t("config.types.checkbox"):n.$t("config.types.boolean")),1),h.value.get(a.id)!==a.configValue?(i(),r("span",yt,o(n.$t("config.modified")),1)):U("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,_t)])]),e("div",bt,[a.options&&a.options.length>0?(i(),r("select",{key:0,class:"config-input select-input",value:a.configValue,onChange:w=>{var S;return J(a,((S=w.target)==null?void 0:S.value)||"")}},[(i(!0),r(D,null,j(a.options,w=>(i(),r("option",{key:X(w),value:X(w)},o(ce(w)),9,$t))),128))],40,Ct)):(i(),de(Re,{key:1,enabled:G(a.configValue),label:"","onUpdate:switchValue":w=>J(a,w)},null,8,["enabled","onUpdate:switchValue"]))])])):a.inputType==="SELECT"?(i(),r("div",wt,[e("div",kt,[e("div",St,[e("label",Tt,[P(o(a.description||a.displayName)+" ",1),e("span",At,o(n.$t("config.types.select")),1),h.value.get(a.id)!==a.configValue?(i(),r("span",xt,o(n.$t("config.modified")),1)):U("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,Et)])]),e("div",Vt,[e("select",{class:"config-input select-input",value:a.configValue,onChange:w=>{var S;return J(a,((S=w.target)==null?void 0:S.value)||"")}},[(i(!0),r(D,null,j(a.options||[],w=>(i(),r("option",{key:X(w),value:X(w)},o(ce(w)),9,Pt))),128))],40,Mt)])])):a.inputType==="TEXTAREA"?(i(),r("div",Ut,[e("div",Bt,[e("div",Gt,[e("label",Lt,[P(o(a.description||a.displayName)+" ",1),e("span",It,o(n.$t("config.types.textarea")),1),h.value.get(a.id)!==a.configValue?(i(),r("span",Ot,o(n.$t("config.modified")),1)):U("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,Ft)])]),e("div",Rt,[e("textarea",{class:"config-input textarea-input",value:a.configValue,onInput:w=>{var S;return J(a,((S=w.target)==null?void 0:S.value)||"")},onBlur:d,rows:"3"},null,40,Nt)])])):a.inputType==="NUMBER"?(i(),r("div",Dt,[e("div",jt,[e("div",Kt,[e("label",qt,[P(o(a.description||a.displayName)+" ",1),e("span",Jt,o(n.$t("config.types.number")),1),h.value.get(a.id)!==a.configValue?(i(),r("span",zt,o(n.$t("config.modified")),1)):U("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,Ht),a.min||a.max?(i(),r("div",Xt,[e("span",Yt,o(n.$t("config.range"))+": "+o(a.min||0)+" - "+o(a.max||"∞"),1)])):U("",!0)])]),e("div",Qt,[e("input",{type:"number",class:"config-input number-input",value:V(a.configValue),onInput:w=>{var S;return J(a,((S=w.target)==null?void 0:S.value)||"")},onBlur:d,min:a.min||1,max:a.max||1e4},null,40,Wt)])])):(i(),r("div",Zt,[e("div",es,[e("div",ts,[e("label",ss,[P(o(a.description||a.displayName)+" ",1),e("span",os,o(a.inputType==="TEXT"?n.$t("config.types.text"):n.$t("config.types.string")),1),h.value.get(a.id)!==a.configValue?(i(),r("span",ns,o(n.$t("config.modified")),1)):U("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,as)])]),e("div",ls,[e("input",{type:"text",class:"config-input text-input",value:a.configValue,onInput:w=>{var S;return J(a,((S=w.target)==null?void 0:S.value)||"")},onBlur:d},null,40,is)])]))],2))),128))],512),[[Ve,!Z(_.name,y.name)]])]))),128))])]))),128))])):(i(),r("div",cs,[e("p",null,o(n.$t("config.notFound")),1)])),E(Ce,{name:"message-fade"},{default:ae(()=>[A.show?(i(),r("div",{key:0,class:Q(["message-toast",A.type])},o(A.text),3)):U("",!0)]),_:1})]))}}),ds=le(rs,[["__scopeId","data-v-99a0498e"]]),us={class:"modal-header"},ps={class:"modal-content"},gs={class:"modal-footer"},fs=ie({__name:"index",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""}},emits:["update:modelValue","confirm"],setup(F){const t=s=>{s.target===s.currentTarget&&(s.stopPropagation(),s.preventDefault())};return(s,C)=>(i(),de(Me,{to:"body"},[E(Ce,{name:"modal"},{default:ae(()=>[F.modelValue?(i(),r("div",{key:0,class:"modal-overlay",onClick:t},[e("div",{class:"modal-container",onClick:C[3]||(C[3]=ye(()=>{},["stop"]))},[e("div",us,[e("h3",null,o(F.title),1),e("button",{class:"close-btn",onClick:C[0]||(C[0]=$=>s.$emit("update:modelValue",!1))},[E(g(I),{icon:"carbon:close"})])]),e("div",ps,[ke(s.$slots,"default",{},void 0,!0)]),e("div",gs,[ke(s.$slots,"footer",{},()=>[e("button",{class:"cancel-btn",onClick:C[1]||(C[1]=$=>s.$emit("update:modelValue",!1))},o(s.$t("common.cancel")),1),e("button",{class:"confirm-btn",onClick:C[2]||(C[2]=$=>s.$emit("confirm"))},o(s.$t("common.confirm")),1)],!0)])])])):U("",!0)]),_:3})]))}}),_e=le(fs,[["__scopeId","data-v-baaf1c89"]]),vs={class:"tool-selection-content"},hs={class:"tool-controls"},ms={class:"search-container"},ys={class:"sort-container"},_s={class:"tool-summary"},bs={class:"summary-text"},Cs={key:0,class:"tool-groups"},$s=["onClick"],ws={class:"group-title-area"},ks={class:"group-name"},Ss={class:"group-count"},Ts={class:"group-enable-all"},As=["checked","onChange","data-group"],xs={class:"tool-info"},Es={class:"tool-selection-name"},Vs={key:0,class:"tool-selection-desc"},Ms={class:"tool-actions"},Ps=["checked","onChange"],Us={key:1,class:"empty-state"},Bs=ie({__name:"index",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(F,{emit:t}){const s=F,C=t,$=H({get:()=>s.modelValue,set:m=>C("update:modelValue",m)}),h=L(""),p=L("group"),A=L(new Set),k=L([]),q=(m,d)=>{const v=document.querySelector(`input[data-group="${m}"]`);v&&(v.indeterminate=B(d))};me(()=>s.selectedToolIds,m=>{k.value=[...m]},{immediate:!0});const O=H(()=>{let m=s.tools.filter(d=>d.key);if(h.value){const d=h.value.toLowerCase();m=m.filter(v=>{var M;return v.name.toLowerCase().includes(d)||v.description.toLowerCase().includes(d)||(((M=v.serviceGroup)==null?void 0:M.toLowerCase().includes(d))??!1)})}switch(p.value){case"name":m=[...m].sort((d,v)=>d.name.localeCompare(v.name));break;case"enabled":m=[...m].sort((d,v)=>{const M=k.value.includes(d.key),c=k.value.includes(v.key);return M&&!c?-1:!M&&c?1:d.name.localeCompare(v.name)});break;case"group":default:m=[...m].sort((d,v)=>{const M=d.serviceGroup??"未分组",c=v.serviceGroup??"未分组";return M!==c?M.localeCompare(c):d.name.localeCompare(v.name)});break}return m}),x=H(()=>{const m=new Map;return O.value.forEach(d=>{const v=d.serviceGroup??"未分组";m.has(v)||m.set(v,[]),m.get(v).push(d)}),new Map([...m.entries()].sort())}),W=H(()=>O.value.length);me([k,x],()=>{Ue(()=>{for(const[m,d]of x.value)q(m,d)})},{flush:"post",deep:!1});const oe=m=>k.value.includes(m),G=(m,d)=>{d.stopPropagation();const M=d.target.checked;if(!m){console.error("toolKey is undefined, cannot proceed");return}M?k.value.includes(m)||(k.value=[...k.value,m]):k.value=k.value.filter(c=>c!==m)},V=m=>m.filter(d=>k.value.includes(d.key)),f=m=>m.length>0&&m.every(d=>k.value.includes(d.key)),B=m=>{const d=V(m).length;return d>0&&d<m.length},X=(m,d)=>{d.stopPropagation();const M=d.target.checked,c=m.map(l=>l.key);if(M){const l=[...k.value];c.forEach(T=>{l.includes(T)||l.push(T)}),k.value=l}else k.value=k.value.filter(l=>!c.includes(l))},ce=m=>{A.value.has(m)?A.value.delete(m):A.value.add(m)},ue=()=>{C("confirm",[...k.value]),C("update:modelValue",!1)},J=()=>{k.value=[...s.selectedToolIds],C("update:modelValue",!1)};return me($,m=>{if(m){A.value.clear();const d=Array.from(x.value.keys());d.length>1&&d.slice(1).forEach(v=>{A.value.add(v)})}}),(m,d)=>(i(),de(_e,{modelValue:$.value,"onUpdate:modelValue":[d[4]||(d[4]=v=>$.value=v),J],title:"选择工具",onConfirm:ue},{default:ae(()=>[e("div",vs,[e("div",hs,[e("div",ms,[K(e("input",{"onUpdate:modelValue":d[0]||(d[0]=v=>h.value=v),type:"text",class:"search-input",placeholder:"搜索工具..."},null,512),[[se,h.value]])]),e("div",ys,[K(e("select",{"onUpdate:modelValue":d[1]||(d[1]=v=>p.value=v),class:"sort-select"},d[5]||(d[5]=[e("option",{value:"group"},"按服务组排序",-1),e("option",{value:"name"},"按名称排序",-1),e("option",{value:"enabled"},"按启用状态排序",-1)]),512),[[Pe,p.value]])])]),e("div",_s,[e("span",bs," 共 "+o(x.value.size)+" 个服务组，"+o(W.value)+" 个工具 (已选择 "+o(k.value.length)+" 个) ",1)]),x.value.size>0?(i(),r("div",Cs,[(i(!0),r(D,null,j(x.value,([v,M])=>(i(),r("div",{key:v,class:"tool-group"},[e("div",{class:Q(["tool-group-header",{collapsed:A.value.has(v)}]),onClick:c=>ce(v)},[e("div",ws,[E(g(I),{icon:A.value.has(v)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),E(g(I),{icon:"carbon:folder",class:"group-icon"}),e("span",ks,o(v),1),e("span",Ss," ("+o(V(M).length)+"/"+o(M.length)+") ",1)]),e("div",{class:"group-actions",onClick:d[2]||(d[2]=ye(()=>{},["stop"]))},[e("label",Ts,[e("input",{type:"checkbox",class:"group-enable-checkbox",checked:f(M),onChange:c=>X(M,c),"data-group":v},null,40,As),d[6]||(d[6]=e("span",{class:"enable-label"},"启用全部",-1))])])],10,$s),e("div",{class:Q(["tool-group-content",{collapsed:A.value.has(v)}])},[(i(!0),r(D,null,j(M.filter(c=>c&&c.key),c=>(i(),r("div",{key:c.key,class:"tool-selection-item"},[e("div",xs,[e("div",Es,o(c.name),1),c.description?(i(),r("div",Vs,o(c.description),1)):U("",!0)]),e("div",Ms,[e("label",{class:"tool-enable-switch",onClick:d[3]||(d[3]=ye(()=>{},["stop"]))},[e("input",{type:"checkbox",class:"tool-enable-checkbox",checked:oe(c.key),onChange:l=>G(c.key,l)},null,40,Ps),d[7]||(d[7]=e("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(i(),r("div",Us,[E(g(I),{icon:"carbon:tools",class:"empty-icon"}),d[8]||(d[8]=e("p",null,"没有找到工具",-1))]))])]),_:1},8,["modelValue"]))}}),Gs=le(Bs,[["__scopeId","data-v-c30d6872"]]);class te{static async handleResponse(t){if(!t.ok)try{const s=await t.json();throw new Error(s.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAllAgents(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Agent list:",t),t}}static async getAgentById(t){try{const s=await fetch(`${this.BASE_URL}/${t}`);return await(await this.handleResponse(s)).json()}catch(s){throw console.error(`Failed to get Agent[${t}] details:`,s),s}}static async createAgent(t){try{const s=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to create Agent:",s),s}}static async updateAgent(t,s){try{const C=await fetch(`${this.BASE_URL}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await(await this.handleResponse(C)).json()}catch(C){throw console.error(`Failed to update Agent[${t}]:`,C),C}}static async deleteAgent(t){try{const s=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});if(s.status===400)throw new Error("Cannot delete default Agent");await this.handleResponse(s)}catch(s){throw console.error(`Failed to delete Agent[${t}]:`,s),s}}static async getAvailableTools(){try{const t=await fetch(`${this.BASE_URL}/tools`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools list:",t),t}}}ge(te,"BASE_URL","/api/agents");const Ls={class:"config-panel"},Is={class:"panel-header"},Os={class:"panel-actions"},Fs=["disabled"],Rs={class:"agent-layout"},Ns={class:"agent-list"},Ds={class:"list-header"},js={class:"agent-count"},Ks={key:0,class:"agents-container"},qs=["onClick"],Js={class:"agent-card-header"},zs={class:"agent-name"},Hs={class:"agent-desc"},Xs={key:0,class:"agent-tools"},Ys={key:0,class:"tool-more"},Qs={key:1,class:"loading-state"},Ws={key:2,class:"empty-state"},Zs={key:0,class:"agent-detail"},eo={class:"detail-header"},to={class:"detail-actions"},so={class:"form-item"},oo=["placeholder"],no={class:"form-item"},ao=["placeholder"],lo={class:"form-item"},io=["value","placeholder"],co={class:"tools-section"},ro={class:"assigned-tools"},uo={class:"section-header"},po={class:"tools-grid"},go={class:"tool-info"},fo={class:"tool-name"},vo={class:"tool-desc"},ho={key:0,class:"no-tools"},mo={key:1,class:"no-selection"},yo={class:"modal-form"},_o={class:"form-item"},bo=["placeholder"],Co={class:"form-item"},$o=["placeholder"],wo={class:"form-item"},ko=["value","placeholder"],So={class:"delete-confirm"},To={class:"warning-text"},Ao=ie({__name:"agentConfig",setup(F){const{t}=ve(),s=L(!1),C=L(""),$=L(""),h=re([]),p=L(null),A=re([]),k=L(!1),q=L(!1),O=L(!1),x=re({name:"",description:"",nextStepPrompt:""}),W=c=>{const l=A.find(T=>T.key===c);return l?l.name:c},oe=c=>{const l=A.find(T=>T.key===c);return l?l.description:""},G=(c,l)=>{l==="success"?($.value=c,setTimeout(()=>{$.value=""},3e3)):(C.value=c,setTimeout(()=>{C.value=""},5e3))},V=async()=>{s.value=!0;try{const[c,l]=await Promise.all([te.getAllAgents(),te.getAvailableTools()]),T=c.map(b=>({...b,availableTools:b.availableTools}));h.splice(0,h.length,...T),A.splice(0,A.length,...l),T.length>0&&await f(T[0])}catch(c){console.error("加载数据失败:",c),G(t("config.agentConfig.loadDataFailed")+": "+c.message,"error");const l=[{key:"search-web",name:"网络搜索",description:"在互联网上搜索信息",enabled:!0,serviceGroup:"搜索服务"},{key:"search-local",name:"本地搜索",description:"在本地文件中搜索内容",enabled:!0,serviceGroup:"搜索服务"},{key:"file-read",name:"读取文件",description:"读取本地或远程文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-write",name:"写入文件",description:"创建或修改文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-delete",name:"删除文件",description:"删除指定的文件",enabled:!1,serviceGroup:"文件服务"},{key:"calculator",name:"计算器",description:"执行数学计算",enabled:!0,serviceGroup:"计算服务"},{key:"code-execute",name:"代码执行",description:"执行Python或JavaScript代码",enabled:!0,serviceGroup:"计算服务"},{key:"weather",name:"天气查询",description:"获取指定地区的天气信息",enabled:!0,serviceGroup:"信息服务"},{key:"currency",name:"汇率查询",description:"查询货币汇率信息",enabled:!0,serviceGroup:"信息服务"},{key:"email",name:"发送邮件",description:"发送电子邮件",enabled:!1,serviceGroup:"通信服务"},{key:"sms",name:"发送短信",description:"发送短信消息",enabled:!1,serviceGroup:"通信服务"}],T=[{id:"demo-1",name:"通用助手",description:"一个能够处理各种任务的智能助手",nextStepPrompt:"You are a helpful assistant that can answer questions and help with various tasks. What would you like me to help you with next?",availableTools:["search-web","calculator","weather"]},{id:"demo-2",name:"数据分析师",description:"专门用于数据分析和可视化的Agent",nextStepPrompt:"You are a data analyst assistant specialized in analyzing data and creating visualizations. Please provide the data you would like me to analyze.",availableTools:["file-read","file-write","calculator","code-execute"]}];A.splice(0,A.length,...l),h.splice(0,h.length,...T),T.length>0&&(p.value=T[0])}finally{s.value=!1}},f=async c=>{try{const l=await te.getAgentById(c.id);p.value={...l,availableTools:l.availableTools}}catch(l){console.error("加载Agent详情失败:",l),G(t("config.agentConfig.loadDetailsFailed")+": "+l.message,"error"),p.value={...c,availableTools:c.availableTools}}},B=()=>{x.name="",x.description="",x.nextStepPrompt="",k.value=!0},X=async()=>{var c;if(!x.name.trim()||!x.description.trim()){G(t("config.agentConfig.requiredFields"),"error");return}try{const l={name:x.name.trim(),description:x.description.trim(),nextStepPrompt:((c=x.nextStepPrompt)==null?void 0:c.trim())??"",availableTools:[]},T=await te.createAgent(l);h.push(T),p.value=T,k.value=!1,G(t("config.agentConfig.createSuccess"),"success")}catch(l){G(t("config.agentConfig.createFailed")+": "+l.message,"error")}},ce=()=>{O.value=!0},ue=c=>{p.value&&(p.value.availableTools=[...c])},J=async()=>{if(p.value){if(!p.value.name.trim()||!p.value.description.trim()){G(t("config.agentConfig.requiredFields"),"error");return}try{const c=await te.updateAgent(p.value.id,p.value),l=h.findIndex(T=>T.id===c.id);l!==-1&&(h[l]=c),p.value=c,G(t("config.agentConfig.saveSuccess"),"success")}catch(c){G(t("config.agentConfig.saveFailed")+": "+c.message,"error")}}},m=()=>{q.value=!0},d=async()=>{if(p.value)try{await te.deleteAgent(p.value.id);const c=h.findIndex(l=>l.id===p.value.id);c!==-1&&h.splice(c,1),p.value=h.length>0?h[0]:null,q.value=!1,G(t("config.agentConfig.deleteSuccess"),"success")}catch(c){G(t("config.agentConfig.deleteFailed")+": "+c.message,"error")}},v=()=>{const c=document.createElement("input");c.type="file",c.accept=".json",c.onchange=l=>{var b;const T=(b=l.target.files)==null?void 0:b[0];if(T){const Z=new FileReader;Z.onload=async ee=>{var Y;try{const ne=JSON.parse((Y=ee.target)==null?void 0:Y.result);if(!ne.name||!ne.description)throw new Error(t("config.agentConfig.invalidFormat"));const{id:$e,...n}=ne,u=await te.createAgent(n);h.push(u),p.value=u,G(t("config.agentConfig.importSuccess"),"success")}catch(ne){G(t("config.agentConfig.importFailed")+": "+ne.message,"error")}},Z.readAsText(T)}},c.click()},M=()=>{if(p.value)try{const c=JSON.stringify(p.value,null,2),l=new Blob([c],{type:"application/json"}),T=URL.createObjectURL(l),b=document.createElement("a");b.href=T,b.download=`agent-${p.value.name}-${new Date().toISOString().split("T")[0]}.json`,b.click(),URL.revokeObjectURL(T),G(t("config.agentConfig.exportSuccess"),"success")}catch(c){G(t("config.agentConfig.exportFailed")+": "+c.message,"error")}};return be(()=>{V()}),(c,l)=>{var T;return i(),r("div",Ls,[e("div",Is,[e("h2",null,o(g(t)("config.agentConfig.title")),1),e("div",Os,[e("button",{class:"action-btn",onClick:v},[E(g(I),{icon:"carbon:upload"}),P(" "+o(g(t)("config.agentConfig.import")),1)]),e("button",{class:"action-btn",onClick:M,disabled:!p.value},[E(g(I),{icon:"carbon:download"}),P(" "+o(g(t)("config.agentConfig.export")),1)],8,Fs)])]),e("div",Rs,[e("div",Ns,[e("div",Ds,[e("h3",null,o(g(t)("config.agentConfig.configuredAgents")),1),e("span",js,"("+o(h.length)+o(g(t)("config.agentConfig.agentCount"))+")",1)]),s.value?U("",!0):(i(),r("div",Ks,[(i(!0),r(D,null,j(h,b=>{var Z,ee;return i(),r("div",{key:b.id,class:Q(["agent-card",{active:((Z=p.value)==null?void 0:Z.id)===b.id}]),onClick:Y=>f(b)},[e("div",Js,[e("span",zs,o(b.name),1),E(g(I),{icon:"carbon:chevron-right"})]),e("p",Hs,o(b.description),1),((ee=b.availableTools)==null?void 0:ee.length)>0?(i(),r("div",Xs,[(i(!0),r(D,null,j(b.availableTools.slice(0,3),Y=>(i(),r("span",{key:Y,class:"tool-tag"},o(W(Y)),1))),128)),b.availableTools.length>3?(i(),r("span",Ys," +"+o(b.availableTools.length-3),1)):U("",!0)])):U("",!0)],10,qs)}),128))])),s.value?(i(),r("div",Qs,[E(g(I),{icon:"carbon:loading",class:"loading-icon"}),P(" "+o(g(t)("common.loading")),1)])):U("",!0),!s.value&&h.length===0?(i(),r("div",Ws,[E(g(I),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,o(g(t)("config.agentConfig.noAgent")),1)])):U("",!0),e("button",{class:"add-btn",onClick:B},[E(g(I),{icon:"carbon:add"}),P(" "+o(g(t)("config.agentConfig.createNew")),1)])]),p.value?(i(),r("div",Zs,[e("div",eo,[e("h3",null,o(p.value.name),1),e("div",to,[e("button",{class:"action-btn primary",onClick:J},[E(g(I),{icon:"carbon:save"}),P(" "+o(g(t)("common.save")),1)]),e("button",{class:"action-btn danger",onClick:m},[E(g(I),{icon:"carbon:trash-can"}),P(" "+o(g(t)("common.delete")),1)])])]),e("div",so,[e("label",null,[P(o(g(t)("config.agentConfig.agentName"))+" ",1),l[12]||(l[12]=e("span",{class:"required"},"*",-1))]),K(e("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=b=>p.value.name=b),placeholder:g(t)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,oo),[[se,p.value.name]])]),e("div",no,[e("label",null,[P(o(g(t)("config.agentConfig.description"))+" ",1),l[13]||(l[13]=e("span",{class:"required"},"*",-1))]),K(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=b=>p.value.description=b),rows:"3",placeholder:g(t)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,ao),[[se,p.value.description]])]),e("div",lo,[e("label",null,o(g(t)("config.agentConfig.nextStepPrompt")),1),e("textarea",{value:p.value.nextStepPrompt||"",onInput:l[2]||(l[2]=b=>p.value.nextStepPrompt=b.target.value),rows:"8",placeholder:g(t)("config.agentConfig.nextStepPromptPlaceholder")},null,40,io)]),e("div",co,[e("h4",null,o(g(t)("config.agentConfig.toolConfiguration")),1),e("div",ro,[e("div",uo,[e("span",null,o(g(t)("config.agentConfig.assignedTools"))+" ("+o((p.value.availableTools||[]).length)+")",1),A.length>0?(i(),r("button",{key:0,class:"action-btn small",onClick:ce},[E(g(I),{icon:"carbon:add"}),P(" "+o(g(t)("config.agentConfig.addRemoveTools")),1)])):U("",!0)]),e("div",po,[(i(!0),r(D,null,j(p.value.availableTools||[],b=>(i(),r("div",{key:b,class:"tool-item assigned"},[e("div",go,[e("span",fo,o(W(b)),1),e("span",vo,o(oe(b)),1)])]))),128)),p.value.availableTools.length===0?(i(),r("div",ho,[E(g(I),{icon:"carbon:tool-box"}),e("span",null,o(g(t)("config.agentConfig.noAssignedTools")),1)])):U("",!0)])])])])):(i(),r("div",mo,[E(g(I),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,o(g(t)("config.agentConfig.selectAgentHint")),1)]))]),E(_e,{modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=b=>k.value=b),title:g(t)("config.agentConfig.newAgent"),onConfirm:X},{default:ae(()=>[e("div",yo,[e("div",_o,[e("label",null,[P(o(g(t)("config.agentConfig.agentName"))+" ",1),l[14]||(l[14]=e("span",{class:"required"},"*",-1))]),K(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=b=>x.name=b),placeholder:g(t)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,bo),[[se,x.name]])]),e("div",Co,[e("label",null,[P(o(g(t)("config.agentConfig.description"))+" ",1),l[15]||(l[15]=e("span",{class:"required"},"*",-1))]),K(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=b=>x.description=b),rows:"3",placeholder:g(t)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,$o),[[se,x.description]])]),e("div",wo,[e("label",null,o(g(t)("config.agentConfig.nextStepPrompt")),1),e("textarea",{value:x.nextStepPrompt||"",onInput:l[5]||(l[5]=b=>x.nextStepPrompt=b.target.value),rows:"8",placeholder:g(t)("config.agentConfig.nextStepPromptPlaceholder")},null,40,ko)])])]),_:1},8,["modelValue","title"]),E(Gs,{modelValue:O.value,"onUpdate:modelValue":l[7]||(l[7]=b=>O.value=b),tools:A,"selected-tool-ids":((T=p.value)==null?void 0:T.availableTools)||[],onConfirm:ue},null,8,["modelValue","tools","selected-tool-ids"]),E(_e,{modelValue:q.value,"onUpdate:modelValue":l[9]||(l[9]=b=>q.value=b),title:g(t)("config.agentConfig.deleteConfirm")},{footer:ae(()=>[e("button",{class:"cancel-btn",onClick:l[8]||(l[8]=b=>q.value=!1)},o(g(t)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:d},o(g(t)("common.delete")),1)]),default:ae(()=>{var b;return[e("div",So,[E(g(I),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[P(o(g(t)("config.agentConfig.deleteConfirmText"))+" ",1),e("strong",null,o((b=p.value)==null?void 0:b.name),1),P(" "+o(g(t)("common.confirm"))+"？",1)]),e("p",To,o(g(t)("config.agentConfig.deleteWarning")),1)])]}),_:1},8,["modelValue","title"]),C.value?(i(),r("div",{key:0,class:"error-toast",onClick:l[10]||(l[10]=b=>C.value="")},[E(g(I),{icon:"carbon:error"}),P(" "+o(C.value),1)])):U("",!0),$.value?(i(),r("div",{key:1,class:"success-toast",onClick:l[11]||(l[11]=b=>$.value="")},[E(g(I),{icon:"carbon:checkmark"}),P(" "+o($.value),1)])):U("",!0)])}}}),xo=le(Ao,[["__scopeId","data-v-edefd8f0"]]);class fe{static async getAllMcpServers(){const t=await fetch(`${this.BASE_URL}/list`);if(!t.ok)throw new Error(`Failed to get MCP server list: ${t.status}`);return await t.json()}static async addMcpServer(t){try{const s=await fetch(`${this.BASE_URL}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Failed to add MCP server: ${s.status}`);return{success:!0,message:"Successfully added MCP server"}}catch(s){return console.error("Failed to add MCP server:",s),{success:!1,message:s instanceof Error?s.message:"Failed to add, please retry"}}}static async removeMcpServer(t){try{const s=await fetch(`${this.BASE_URL}/remove?id=${t}`);if(!s.ok)throw new Error(`Failed to delete MCP server: ${s.status}`);return{success:!0,message:"Successfully deleted MCP server"}}catch(s){return console.error(`Failed to delete MCP server[${t}]:`,s),{success:!1,message:s instanceof Error?s.message:"Failed to delete, please retry"}}}}ge(fe,"BASE_URL","/api/mcp");const Eo={class:"mcp-config-panel"},Vo={class:"mcp-header"},Mo={class:"header-left"},Po={class:"mcp-stats"},Uo={class:"stat-item"},Bo={class:"stat-value"},Go={class:"header-right"},Lo={class:"search-box"},Io={key:0,class:"loading-container"},Oo={key:1,class:"mcp-layout"},Fo={class:"mcp-table-container"},Ro={key:0,class:"empty-state"},No={class:"empty-state-text"},Do={key:1,class:"mcp-table-wrapper"},jo={class:"mcp-table"},Ko={class:"mcp-id"},qo={class:"mcp-server-name"},Jo={class:"server-name-content"},zo={class:"mcp-connection-type"},Ho={class:"mcp-config"},Xo=["title"],Yo={class:"mcp-actions"},Qo=["onClick","disabled"],Wo={class:"add-mcp-container"},Zo={class:"mcp-form"},en={class:"mcp-form-group"},tn={class:"connection-type-options"},sn={class:"connection-type-option"},on={class:"connection-type-option"},nn={class:"mcp-form-group"},an=["placeholder"],ln={class:"mcp-form-actions"},cn=["disabled"],rn=["disabled"],dn=ie({__name:"mcpConfig",setup(F){const{t}=ve(),s=L(!1),C=L([]),$=L(""),h=re({connectionType:"STUDIO",configJson:""}),p=re({show:!1,text:"",type:"success"}),A=H(()=>h.configJson.trim().length>0),k=H(()=>{if(!$.value.trim())return C.value;const V=$.value.toLowerCase();return C.value.filter(f=>f.mcpServerName.toLowerCase().includes(V)||f.connectionType.toLowerCase().includes(V)||f.connectionConfig.toLowerCase().includes(V))}),q=V=>V?V.length>50?V.substring(0,50)+"...":V:"",O=(V,f="success")=>{p.text=V,p.type=f,p.show=!0,setTimeout(()=>{p.show=!1},3e3)},x=async()=>{try{s.value=!0,C.value=await fe.getAllMcpServers()}catch(V){console.error("加载MCP服务器列表失败:",V),O("加载MCP服务器列表失败","error")}finally{s.value=!1}},W=async()=>{if(!A.value){O(t("config.mcpConfig.configRequired"),"error");return}try{JSON.parse(h.configJson)}catch{O(t("config.mcpConfig.invalidJson"),"error");return}try{s.value=!0;const V={connectionType:h.connectionType,configJson:h.configJson},f=await fe.addMcpServer(V);f.success?(O("添加MCP服务器成功"),G(),await x()):O(f.message||t("config.mcpConfig.addFailed"),"error")}catch(V){console.error("添加MCP服务器失败:",V),O(t("config.mcpConfig.addFailed"),"error")}finally{s.value=!1}},oe=async V=>{if(confirm("确定要删除这个MCP服务器配置吗？此操作不可恢复。"))try{s.value=!0;const f=await fe.removeMcpServer(V);f.success?(O("删除MCP服务器成功"),await x()):O(f.message||t("config.mcpConfig.deleteFailed"),"error")}catch(f){console.error("删除MCP服务器失败:",f),O(t("config.mcpConfig.deleteFailed"),"error")}finally{s.value=!1}},G=()=>{h.connectionType="STUDIO",h.configJson=""};return be(()=>{x()}),(V,f)=>(i(),r("div",Eo,[e("div",Vo,[e("div",Mo,[f[5]||(f[5]=e("h2",null,"MCP配置",-1)),e("div",Po,[e("span",Uo,[f[4]||(f[4]=e("span",{class:"stat-label"},"总服务器:",-1)),e("span",Bo,o(C.value.length),1)])])]),e("div",Go,[e("div",Lo,[K(e("input",{"onUpdate:modelValue":f[0]||(f[0]=B=>$.value=B),type:"text",placeholder:"搜索MCP服务器...",class:"search-input"},null,512),[[se,$.value]]),f[6]||(f[6]=e("span",{class:"search-icon"},"🔍",-1))])])]),s.value?(i(),r("div",Io,f[7]||(f[7]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在加载MCP服务器...",-1)]))):(i(),r("div",Oo,[e("div",Fo,[f[11]||(f[11]=e("h3",{class:"section-title"},"已配置的MCP服务器",-1)),k.value.length===0?(i(),r("div",Ro,[f[8]||(f[8]=e("div",{class:"empty-state-icon"},"📂",-1)),e("div",No,o($.value?"未找到匹配的MCP服务器":"暂无MCP服务器配置"),1)])):(i(),r("div",Do,[e("table",jo,[f[10]||(f[10]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"服务器名称"),e("th",null,"连接类型"),e("th",null,"连接配置"),e("th",null,"操作")])],-1)),e("tbody",null,[(i(!0),r(D,null,j(k.value,B=>(i(),r("tr",{key:B.id,class:"mcp-row"},[e("td",Ko,o(B.id),1),e("td",qo,[e("div",Jo,[f[9]||(f[9]=e("span",{class:"server-icon"},"🔌",-1)),P(" "+o(B.mcpServerName),1)])]),e("td",zo,[e("span",{class:Q(["connection-type-badge",B.connectionType.toLowerCase()])},o(B.connectionType),3)]),e("td",Ho,[e("div",{class:"config-preview",title:B.connectionConfig},o(q(B.connectionConfig)),9,Xo)]),e("td",Yo,[e("button",{onClick:X=>oe(B.id),class:"action-btn delete-btn",disabled:s.value}," 删除 ",8,Qo)])]))),128))])])]))]),e("div",Wo,[f[16]||(f[16]=e("div",{class:"add-mcp-header"},[e("h3",{class:"add-mcp-title"},"添加MCP服务器")],-1)),e("div",Zo,[e("div",en,[f[14]||(f[14]=e("label",{class:"form-label"},"连接类型：",-1)),e("div",tn,[e("div",sn,[K(e("input",{type:"radio",id:"mcp-connection-type-studio","onUpdate:modelValue":f[1]||(f[1]=B=>h.connectionType=B),value:"STUDIO"},null,512),[[Se,h.connectionType]]),f[12]||(f[12]=e("label",{for:"mcp-connection-type-studio",class:"radio-label"},[e("span",{class:"radio-title"},"STUDIO"),e("span",{class:"connection-type-desc"},"本地mcp server，目前市面上主流的是这个")],-1))]),e("div",on,[K(e("input",{type:"radio",id:"mcp-connection-type-sse","onUpdate:modelValue":f[2]||(f[2]=B=>h.connectionType=B),value:"SSE"},null,512),[[Se,h.connectionType]]),f[13]||(f[13]=e("label",{for:"mcp-connection-type-sse",class:"radio-label"},[e("span",{class:"radio-title"},"SSE"),e("span",{class:"connection-type-desc"},"通过http server等提供的，目前网络上比较少见")],-1))])])]),e("div",nn,[f[15]||(f[15]=e("label",{class:"form-label"},"mcp json配置：",-1)),K(e("textarea",{"onUpdate:modelValue":f[3]||(f[3]=B=>h.configJson=B),placeholder:g(t)("config.mcpConfig.configJsonPlaceholder"),class:"config-textarea",rows:"6"},null,8,an),[[se,h.configJson]])]),e("div",ln,[e("button",{onClick:W,class:"action-btn add-btn",disabled:s.value},o(g(t)("common.add")),9,cn),e("button",{onClick:G,class:"action-btn reset-btn",disabled:s.value},o(g(t)("common.reset")),9,rn)])]),f[17]||(f[17]=Be('<div class="mcp-form-instructions" data-v-0ed0ce1e><h4 data-v-0ed0ce1e>使用说明：</h4><ol data-v-0ed0ce1e><li data-v-0ed0ce1e>找到你要用的mcp server的配置json： <ul class="indented-list" data-v-0ed0ce1e><li data-v-0ed0ce1e><strong data-v-0ed0ce1e>本地(STDIO)</strong>：可以在<a href="https://mcp.so" target="_blank" rel="noopener" data-v-0ed0ce1e>mcp.so</a>上找到，需要你有Node.js环境并理解你要配置的json里面的每一个项，做对应调整比如配置ak</li><li data-v-0ed0ce1e><strong data-v-0ed0ce1e>远程服务(SSE)</strong>：<a href="https://mcp.higress.ai/" target="_blank" rel="noopener" data-v-0ed0ce1e>mcp.higress.ai/</a>上可以找到，有SSE和STREAMING两种，目前SSE协议更完备一些</li></ul></li><li data-v-0ed0ce1e>将json配置复制到上面的输入框，本地选STUDIO，远程选STREAMING或SSE，提交</li><li data-v-0ed0ce1e>这样mcp tools就注册成功了。</li><li data-v-0ed0ce1e>然后需要在Agent配置里面，新建一个agent，然后增加指定你刚才添加的mcp tools，这样可以极大减少冲突，增强tools被agent选择的准确性</li></ol></div>',1))])])),E(Ce,{name:"message-fade"},{default:ae(()=>[p.show?(i(),r("div",{key:0,class:Q(["message-toast",p.type])},o(p.text),3)):U("",!0)]),_:1})]))}}),un=le(dn,[["__scopeId","data-v-0ed0ce1e"]]),pn={class:"config-container"},gn={class:"config-header"},fn={class:"header-actions"},vn={class:"config-content"},hn={class:"config-nav"},mn=["onClick"],yn={class:"config-details"},_n=ie({__name:"index",setup(F){const{t}=ve(),s=L("basic"),C=H(()=>[{key:"basic",label:t("config.categories.basic"),icon:"carbon:settings"},{key:"agent",label:t("config.categories.agent"),icon:"carbon:bot"},{key:"mcp",label:t("config.categories.mcp"),icon:"carbon:tool-box"}]);return($,h)=>(i(),r("div",pn,[e("div",gn,[e("div",fn,[E(Ge),e("button",{class:"action-btn",onClick:h[0]||(h[0]=p=>$.$router.push("/"))},[E(g(I),{icon:"carbon:arrow-left"}),P(" "+o($.$t("backHome")),1)])])]),e("div",vn,[e("nav",hn,[(i(!0),r(D,null,j(C.value,(p,A)=>(i(),r("div",{key:A,class:Q(["nav-item",{active:s.value===p.key}]),onClick:k=>s.value=p.key},[E(g(I),{icon:p.icon,width:"20"},null,8,["icon"]),e("span",null,o(p.label),1)],10,mn))),128))]),e("div",yn,[s.value==="basic"?(i(),de(ds,{key:0})):U("",!0),s.value==="agent"?(i(),de(xo,{key:1})):U("",!0),s.value==="mcp"?(i(),de(un,{key:2})):U("",!0)])])]))}}),kn=le(_n,[["__scopeId","data-v-109cfe5c"]]);export{kn as default};

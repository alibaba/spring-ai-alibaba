var Ls=Object.defineProperty;var Bs=(o,e,s)=>e in o?Ls(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var ge=(o,e,s)=>Bs(o,typeof e!="symbol"?e+"":e,s);import{d as ue,u as Pe,c as de,r as U,A as st,B as ie,o as we,a as f,b as p,F as oe,g as S,f as O,p as Me,h as se,i as r,t as c,e as t,w as te,m as le,n as ne,q as re,C as it,D as jt,l as ae,E as nt,G as ns,H as os,I as Te,y as ze,j as he,T as qe,J as Qe,K as as,z as ke,v as Os,M as ls,N as Ze,x as rs,O as qs,_ as js}from"./index-BVaHmPR6.js";import{I as P,_ as pe}from"./_plugin-vue_export-helper-C8HcJMy5.js";import{s as G,P as et,u as is}from"./sidebar-Ct4XAST_.js";import{M as Vs,A as Hs,T as Gs,u as cs,a as zs}from"./useMessage-DchMXc7f.js";import{L as Ws}from"./llm-check-BVkAKrj3.js";import{L as Js}from"./LanguageSwitcher-DF5DimfZ.js";class De{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("获取CoordinatorTool配置失败:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("获取endpoints失败:",e),new Error("获取endpoints失败: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] 开始获取协调器工具，planTemplateId:",e),console.log("[CoordinatorToolApiService] 请求URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const s=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] 响应状态:",s.status),console.log("[CoordinatorToolApiService] 响应状态文本:",s.statusText),s.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] 响应错误内容:",a),new Error(`Failed to get coordinator tools: ${s.status} - ${a}`)}const n=await s.json();return console.log("[CoordinatorToolApiService] 获取协调器工具成功，结果:",n),n}catch(s){throw console.error("[CoordinatorToolApiService] 获取协调器工具失败:",s),new Error("获取协调器工具失败: "+s.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] 开始获取或创建协调器工具，planTemplateId:",e),console.log("[CoordinatorToolApiService] 请求URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const s=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] 响应状态:",s.status),console.log("[CoordinatorToolApiService] 响应状态文本:",s.statusText),!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] 响应错误内容:",a),new Error(`Failed to get coordinator tools: ${s.status} - ${a}`)}const n=await s.json();return console.log("[CoordinatorToolApiService] 获取协调器工具成功，结果:",n),n}catch(s){throw console.error("[CoordinatorToolApiService] 获取协调器工具失败:",s),new Error("获取协调器工具失败: "+s.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] 开始创建协调器工具"),console.log("[CoordinatorToolApiService] 原始数据:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] 请求URL:",`${this.BASE_URL}`);const s={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] 清理后的发送数据:",JSON.stringify(s,null,2));try{const n=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("[CoordinatorToolApiService] 响应状态:",n.status),console.log("[CoordinatorToolApiService] 响应状态文本:",n.statusText),!n.ok){let l="Unknown error";try{const i=await n.json();l=i.message||i.error||l}catch{l=await n.text()||l}throw console.error("[CoordinatorToolApiService] 响应错误内容:",l),new Error(`Failed to create coordinator tool: ${n.status} - ${l}`)}const a=await n.json();return console.log("[CoordinatorToolApiService] 创建成功，结果:",a),a}catch(n){throw console.error("[CoordinatorToolApiService] 创建协调器工具失败:",n),new Error("创建协调器工具失败: "+n.message)}}static async updateCoordinatorTool(e,s){console.log("[CoordinatorToolApiService] 开始更新协调器工具，ID:",e),console.log("[CoordinatorToolApiService] 发送的数据:",s),console.log("[CoordinatorToolApiService] 请求URL:",`${this.BASE_URL}/${e}`);const n={id:s.id,toolName:s.toolName,toolDescription:s.toolDescription,inputSchema:s.inputSchema,planTemplateId:s.planTemplateId,httpEndpoint:s.httpEndpoint,mcpEndpoint:s.mcpEndpoint,serviceGroup:s.serviceGroup,enableInternalToolcall:s.enableInternalToolcall,enableHttpService:s.enableHttpService,enableMcpService:s.enableMcpService};console.log("[CoordinatorToolApiService] 清理后的发送数据:",n);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(console.log("[CoordinatorToolApiService] 响应状态:",a.status),console.log("[CoordinatorToolApiService] 响应状态文本:",a.statusText),!a.ok){let i="Unknown error";try{const h=await a.json();i=h.message||h.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] 响应错误内容:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] 更新成功，结果:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] 更新协调器工具失败:",a),new Error("更新协调器工具失败: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] 开始删除协调器工具，ID:",e),console.log("[CoordinatorToolApiService] 请求URL:",`${this.BASE_URL}/${e}`);try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] 响应状态:",s.status),console.log("[CoordinatorToolApiService] 响应状态文本:",s.statusText),!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] 响应错误内容:",a),new Error(`Failed to delete coordinator tool: ${s.status} - ${a}`)}const n=await s.json();return console.log("[CoordinatorToolApiService] 删除成功，结果:",n),n}catch(s){throw console.error("[CoordinatorToolApiService] 删除协调器工具失败:",s),new Error("删除协调器工具失败: "+s.message)}}}ge(De,"BASE_URL","/api/coordinator-tools");class Nt{static async getParameterRequirements(e){try{const s=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to get parameter requirements: ${s.statusText}`);return await s.json()}catch(s){throw console.error("Error getting parameter requirements:",s),s}}}ge(Nt,"BASE_URL","/api/plan-template");const Ks={class:"modal-form wide-modal"},Xs={class:"form-section"},Ys={class:"form-item"},Qs=["placeholder"],Zs={class:"field-description"},en={class:"form-section"},tn={class:"form-item"},sn=["placeholder"],nn={class:"field-description"},on={class:"form-section"},an={class:"form-item"},ln=["placeholder"],rn={class:"field-description"},cn={class:"form-section"},dn={class:"section-title"},un={key:0,class:"params-help-text"},pn={class:"parameter-table"},hn=["onUpdate:modelValue","placeholder","readonly"],mn=["onUpdate:modelValue","placeholder"],fn={class:"form-section"},vn={class:"service-publish-options"},gn={class:"internal-toolcall-publish-option"},bn={class:"checkbox-label"},yn={class:"checkbox-text"},_n={class:"checkbox-description"},$n={class:"http-publish-option"},wn={class:"checkbox-label"},Sn={class:"checkbox-text"},kn={class:"checkbox-description"},Tn={class:"mcp-publish-option"},Pn={class:"checkbox-label"},En={class:"checkbox-text"},Cn={class:"checkbox-description"},In={key:0,class:"form-section"},Rn={class:"form-item"},An={class:"endpoint-description"},xn={class:"endpoint-container"},Dn={class:"endpoint-row"},Mn={class:"custom-select"},Nn={class:"select-input-container"},Un={class:"input-content"},Fn=["placeholder"],Ln={class:"dropdown-header"},Bn={class:"select-options"},On=["onClick"],qn={class:"option-name"},jn={class:"manual-input-section"},Vn={class:"manual-input-container"},Hn=["placeholder"],Gn={key:0,class:"form-item url-item"},zn={class:"url-container"},Wn=["title"],Jn={class:"url-text"},Kn={class:"button-container"},Xn=["disabled"],Yn=["disabled"],Qn=ue({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(o,{expose:e,emit:s}){const{t:n}=Pe(),a=o,l=s,i=de({get:()=>a.modelValue,set:H=>l("update:modelValue",H)}),h=U(""),g=U(""),u=U(!1),d=U(!1),b=U([]),C=U(""),M=U(!1),_=U("bottom"),y=U(""),v=U(null),$=U(!1),E=U(!1),w=U(!1),R=U(!0),m=U({parameters:[],hasParameters:!1,requirements:""}),j=U(!1),x=st({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),J=de(()=>{const H=v.value&&v.value.id;return n(H?"mcpService.updateService":"mcpService.createService")}),k=()=>{x.serviceName="",x.userRequest=a.planDescription||"",x.endpoint="",x.serviceGroup="",m.value.hasParameters||(x.parameters=[]),v.value=null,C.value="",$.value=!1},N=async()=>{try{b.value=await De.getAllEndpoints()}catch(H){console.error("加载endpoints失败:",H),T(n("mcpService.loadEndpointsFailed")+": "+H.message,"error")}},z=async()=>{if(!a.planTemplateId){m.value={parameters:[],hasParameters:!1,requirements:""};return}j.value=!0;try{const H=await Nt.getParameterRequirements(a.planTemplateId);m.value=H,H.hasParameters&&(x.parameters=H.parameters.map(Y=>({name:Y,description:""})))}catch(H){console.error("[PublishModal] Failed to load parameter requirements:",H),H instanceof Error&&!H.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),m.value={parameters:[],hasParameters:!1,requirements:""}}finally{j.value=!1}},F=()=>{M.value||A(),M.value=!M.value},A=()=>{const H=document.querySelector(".custom-select");if(!H)return;const Y=H.getBoundingClientRect(),X=window.innerHeight;Y.bottom+200>X?_.value="top":_.value="bottom"},B=H=>{x.endpoint=H,M.value=!1,y.value=""},D=()=>{if(y.value.trim()){const H=y.value.trim().replace(/[^a-zA-Z0-9_/]/g,"");H&&(x.endpoint=H,b.value.includes(H)||b.value.push(H),M.value=!1,y.value="")}},Q=()=>{setTimeout(()=>{y.value.trim()&&D()},200)},Z=()=>{b.value.includes(x.endpoint)&&B(x.endpoint)},ce=()=>{b.value.includes(x.endpoint)&&B(x.endpoint)},fe=()=>{b.value.includes(x.endpoint)&&B(x.endpoint)},W=async()=>{if(C.value)try{await navigator.clipboard.writeText(C.value),T(n("common.copy")+" "+n("common.success"),"success")}catch(H){console.error("复制失败:",H),T(n("common.copy")+" "+n("common.error"),"error")}},T=(H,Y)=>{Y==="success"?(g.value=H,setTimeout(()=>{g.value=""},3e3)):Y==="error"&&(h.value=H,setTimeout(()=>{h.value=""},5e3))},V=()=>{if(!x.serviceName||!x.serviceName.trim())return T(n("mcpService.toolNameRequiredError"),"error"),!1;if(!x.userRequest||!x.userRequest.trim())return T(n("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!x.serviceGroup||!x.serviceGroup.trim())return T(n("mcpService.serviceGroupRequiredError"),"error"),!1;if(E.value&&(!x.endpoint||!x.endpoint.trim()))return T(n("mcpService.endpointRequiredError"),"error"),!1;if(!R.value&&!w.value&&!E.value)return T("请至少选择一种服务类型","error"),!1;for(let H=0;H<x.parameters.length;H++){const Y=x.parameters[H];if(Y.name&&!Y.description.trim())return T(`参数"${Y.name}"的描述不能为空`,"error"),!1;if(Y.description&&!Y.name.trim())return T(`参数描述"${Y.description}"对应的名称不能为空`,"error"),!1}return!0},L=async()=>{if(console.log("[PublishModal] 开始处理发布请求"),console.log("[PublishModal] 表单数据:",x),console.log("[PublishModal] 当前工具:",v.value),console.log("[PublishModal] 发布为MCP服务:",E.value),console.log("[PublishModal] 发布为HTTP服务:",w.value),!V()){console.log("[PublishModal] 表单验证失败");return}u.value=!0;try{v.value||(console.log("[PublishModal] 没有当前工具数据，先获取或创建"),v.value=await De.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] 更新工具信息"),v.value.toolName=x.serviceName.trim(),v.value.toolDescription=x.userRequest.trim(),v.value.serviceGroup=x.serviceGroup.trim(),v.value.planTemplateId=a.planTemplateId,v.value.enableInternalToolcall=R.value,v.value.enableHttpService=w.value,v.value.enableMcpService=E.value,E.value?v.value.mcpEndpoint=x.endpoint.trim():v.value.mcpEndpoint=void 0;const H=x.parameters.filter(X=>X.name.trim()&&X.description.trim()).map(X=>({name:X.name.trim(),description:X.description.trim(),type:"string"}));if(v.value.inputSchema=JSON.stringify(H),console.log("[PublishModal] 更新后的工具信息:",v.value),v.value.id)console.log("[PublishModal] 更新现有工具，ID:",v.value.id),await De.updateCoordinatorTool(v.value.id,v.value);else{console.log("[PublishModal] 创建新工具");const X=await De.createCoordinatorTool(v.value);v.value=X}const Y=[];if(R.value&&Y.push("内部方法调用"),w.value&&Y.push("HTTP服务"),E.value&&Y.push("MCP服务"),Y.length>0){console.log("[PublishModal] 步骤5: 发布服务，ID:",v.value.id,"启用服务:",Y.join(", "));const X=[];if(E.value&&v.value.mcpEndpoint){const ye=window.location.origin;X.push(`MCP: ${ye}/mcp${v.value.mcpEndpoint}`)}R.value&&X.push(`内部调用: ${x.serviceName}`),C.value=X.join(`
`),console.log("[PublishModal] 服务发布成功，服务URLs:",C.value),T(n("mcpService.publishSuccess"),"success"),l("published",v.value)}else console.log("[PublishModal] 仅保存工具，不发布为任何服务"),T(n("mcpService.saveSuccess"),"success"),l("published",v.value)}catch(H){console.error("[PublishModal] 发布服务失败:",H),T(n("mcpService.publishFailed")+": "+H.message,"error")}finally{u.value=!1}},q=async()=>{if(!d.value&&confirm(n("mcpService.deleteConfirmMessage"))){if(!v.value||!v.value.id){T(n("mcpService.deleteFailed")+": "+n("mcpService.selectPlanTemplateFirst"),"error");return}d.value=!0;try{console.log("[PublishModal] 开始删除MCP服务，ID:",v.value.id);const H=await De.deleteCoordinatorTool(v.value.id);if(H.success)console.log("[PublishModal] 删除成功"),T(n("mcpService.deleteSuccess"),"success"),i.value=!1,l("published",null);else throw new Error(H.message)}catch(H){console.error("[PublishModal] 删除MCP服务失败:",H),T(n("mcpService.deleteFailed")+": "+H.message,"error")}finally{d.value=!1}}},K=async()=>{i.value&&(console.log("[PublishModal] 模态框打开，开始初始化数据"),k(),await N(),await ve())},ve=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+n("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] 开始加载协调器工具数据，planTemplateId:",a.planTemplateId);const H=await De.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] 获取协调器工具数据结果:",H),v.value=H,$.value=!!H.id;const Y=[];if(H.enableMcpService&&H.mcpEndpoint){const X=window.location.origin;Y.push(`MCP: ${X}/mcp${H.mcpEndpoint}`)}H.enableInternalToolcall&&Y.push(`内部调用: ${H.toolName}`),C.value=Y.join(`
`),console.log("[PublishModal] 加载工具数据 - endpointUrl:",C.value),x.serviceName=H.toolName||"",x.userRequest=H.toolDescription||a.planDescription||"",x.serviceGroup=H.serviceGroup||"",E.value=H.enableMcpService||!1,w.value=H.enableHttpService||!1,R.value=H.enableInternalToolcall||!1,H.enableMcpService&&(x.endpoint=H.mcpEndpoint||"");try{if(H.inputSchema){const X=JSON.parse(H.inputSchema);Array.isArray(X)&&X.length>0?(x.parameters=X.map(ye=>({name:ye.name||"",description:ye.description||""})),console.log("[PublishModal] 从inputSchema加载参数:",x.parameters)):console.log("[PublishModal] inputSchema为空，保持现有参数:",x.parameters)}}catch(X){console.warn("[PublishModal] "+n("mcpService.parseInputSchemaFailed")+":",X),console.log("[PublishModal] 解析失败，保持现有参数:",x.parameters)}console.log("[PublishModal] 表单数据已填充:",x)}catch(H){console.error("[PublishModal] "+n("mcpService.loadToolDataFailed")+":",H),T(n("mcpService.loadToolDataFailed")+": "+H.message,"error")}};return ie(()=>a.modelValue,K),ie(()=>a.planTemplateId,(H,Y)=>{H&&H!==Y&&(Y&&H.startsWith("planTemplate-")?setTimeout(()=>{z()},1e3):z())}),we(async()=>{i.value&&(console.log("[PublishModal] 组件挂载时初始化"),k(),await N(),await ve(),await z())}),e({loadParameterRequirements:z}),(H,Y)=>(p(),f(oe,null,[S(Vs,{modelValue:i.value,"onUpdate:modelValue":Y[11]||(Y[11]=X=>i.value=X),title:J.value,onConfirm:L},{footer:Me(()=>{var X;return[t("div",Kn,[$.value&&((X=v.value)!=null&&X.id)?(p(),f("button",{key:0,class:"action-btn danger",onClick:q,disabled:d.value},[d.value?(p(),ae(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ae(r(P),{key:1,icon:"carbon:trash-can"})),se(" "+c(d.value?r(n)("mcpService.deleting"):r(n)("mcpService.delete")),1)],8,Xn)):O("",!0),t("button",{class:"action-btn primary",onClick:L,disabled:u.value},[u.value?(p(),ae(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ae(r(P),{key:1,icon:"carbon:cloud-upload"})),se(" "+c(u.value?r(n)("mcpService.publishing"):r(n)("mcpService.publishAsService")),1)],8,Yn)])]}),default:Me(()=>[t("div",Ks,[t("div",Xs,[t("div",Ys,[t("label",null,c(r(n)("mcpService.toolNameRequired")),1),te(t("input",{type:"text","onUpdate:modelValue":Y[0]||(Y[0]=X=>x.serviceName=X),placeholder:r(n)("mcpService.toolNamePlaceholder"),class:ne({error:!x.serviceName||!x.serviceName.trim()}),required:""},null,10,Qs),[[le,x.serviceName]]),t("div",Zs,c(r(n)("mcpService.toolNameDescription")),1)])]),t("div",en,[t("div",tn,[t("label",null,c(r(n)("mcpService.toolDescriptionRequired")),1),te(t("textarea",{"onUpdate:modelValue":Y[1]||(Y[1]=X=>x.userRequest=X),placeholder:r(n)("mcpService.toolDescriptionPlaceholder"),class:ne([{error:!x.userRequest||!x.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,sn),[[le,x.userRequest]]),t("div",nn,c(r(n)("mcpService.toolDescriptionDescription")),1)])]),t("div",on,[t("div",an,[t("label",null,c(r(n)("mcpService.serviceGroup")),1),te(t("input",{type:"text","onUpdate:modelValue":Y[2]||(Y[2]=X=>x.serviceGroup=X),placeholder:r(n)("mcpService.serviceGroupPlaceholder"),class:ne({error:!x.serviceGroup||!x.serviceGroup.trim()}),required:""},null,10,ln),[[le,x.serviceGroup]]),t("div",rn,c(r(n)("mcpService.serviceGroupDescription")),1)])]),t("div",cn,[t("div",dn,c(r(n)("mcpService.parameterConfig")),1),m.value.hasParameters?(p(),f("div",un,c(r(n)("sidebar.parameterRequirementsHelp")),1)):O("",!0),t("div",pn,[t("table",null,[t("thead",null,[t("tr",null,[t("th",null,c(r(n)("mcpService.parameterName")),1),t("th",null,c(r(n)("mcpService.parameterDescription")),1)])]),t("tbody",null,[(p(!0),f(oe,null,re(x.parameters,(X,ye)=>(p(),f("tr",{key:ye},[t("td",null,[te(t("input",{type:"text","onUpdate:modelValue":xe=>X.name=xe,placeholder:r(n)("mcpService.parameterName"),class:ne(["parameter-input",{"readonly-input":m.value.hasParameters}]),readonly:m.value.hasParameters,required:""},null,10,hn),[[le,X.name]])]),t("td",null,[te(t("input",{type:"text","onUpdate:modelValue":xe=>X.description=xe,placeholder:r(n)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,mn),[[le,X.description]])])]))),128))])])])]),t("div",fn,[t("div",vn,[t("div",gn,[t("label",bn,[te(t("input",{type:"checkbox","onUpdate:modelValue":Y[3]||(Y[3]=X=>R.value=X),class:"checkbox-input"},null,512),[[it,R.value]]),t("span",yn,c(r(n)("mcpService.publishAsInternalToolcall")),1)]),t("div",_n,c(r(n)("mcpService.publishAsInternalToolcallDescription")),1)]),t("div",$n,[t("label",wn,[te(t("input",{type:"checkbox","onUpdate:modelValue":Y[4]||(Y[4]=X=>w.value=X),class:"checkbox-input"},null,512),[[it,w.value]]),t("span",Sn,c(r(n)("mcpService.publishAsHttpService")),1)]),t("div",kn,c(r(n)("mcpService.publishAsHttpServiceDescription")),1)]),t("div",Tn,[t("label",Pn,[te(t("input",{type:"checkbox","onUpdate:modelValue":Y[5]||(Y[5]=X=>E.value=X),class:"checkbox-input"},null,512),[[it,E.value]]),t("span",En,c(r(n)("mcpService.publishAsMcpService")),1)]),t("div",Cn,c(r(n)("mcpService.publishAsMcpServiceDescription")),1),E.value?(p(),f("div",In,[t("div",Rn,[t("label",null,c(r(n)("mcpService.endpointRequired")),1),t("div",An,c(r(n)("mcpService.endpointDescription")),1),t("div",xn,[t("div",Dn,[t("div",Mn,[t("div",Nn,[t("div",Un,[S(r(P),{icon:"carbon:application",width:"16",class:"input-icon"}),te(t("input",{type:"text","onUpdate:modelValue":Y[6]||(Y[6]=X=>x.endpoint=X),placeholder:r(n)("mcpService.endpointPlaceholder"),class:"select-input",onFocus:Y[7]||(Y[7]=X=>M.value=!0),onInput:Z,onKeydown:jt(ce,["enter"]),onBlur:fe},null,40,Fn),[[le,x.endpoint]])]),t("button",{class:"select-arrow-btn",onClick:F,title:"展开选项"},[S(r(P),{icon:M.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])])]),M.value?(p(),f("div",{key:0,class:ne(["select-dropdown",{"dropdown-top":_.value==="top"}])},[t("div",Ln,[t("span",null,c(r(n)("mcpService.selectEndpoint")),1),t("button",{class:"close-btn",onClick:Y[8]||(Y[8]=X=>M.value=!1)},[S(r(P),{icon:"carbon:close",width:"12"})])]),t("div",Bn,[(p(!0),f(oe,null,re(b.value,X=>(p(),f("button",{key:X,class:ne(["select-option",{active:x.endpoint===X}]),onClick:ye=>B(X)},[t("span",qn,c(X),1),x.endpoint===X?(p(),ae(r(P),{key:0,icon:"carbon:checkmark",width:"14",class:"check-icon"})):O("",!0)],10,On))),128))]),t("div",jn,[t("div",Vn,[te(t("input",{type:"text","onUpdate:modelValue":Y[9]||(Y[9]=X=>y.value=X),placeholder:r(n)("mcpService.manualInput"),class:"manual-input",onKeydown:jt(D,["enter"]),onBlur:Q},null,40,Hn),[[le,y.value]]),t("button",{class:"add-manual-btn",onClick:D},[S(r(P),{icon:"carbon:add",width:"14"})])])])],2)):O("",!0),M.value?(p(),f("div",{key:1,class:"backdrop",onClick:Y[10]||(Y[10]=X=>M.value=!1)})):O("",!0)])])])]),C.value?(p(),f("div",Gn,[t("label",null,c(r(n)("mcpService.mcpStreamableUrl")),1),t("div",zn,[t("div",{class:"url-display",onDblclick:W,title:r(n)("mcpService.copyUrl")+": "+C.value},[t("span",Jn,c(C.value||r(n)("mcpService.mcpStreamableUrlPlaceholder")),1),S(r(P),{icon:"carbon:copy",width:"16",class:"copy-icon"})],40,Wn)])])):O("",!0)])):O("",!0)])])])])]),_:1},8,["modelValue","title"]),h.value?(p(),f("div",{key:0,class:"error-toast",onClick:Y[12]||(Y[12]=X=>h.value="")},[S(r(P),{icon:"carbon:error"}),se(" "+c(h.value),1)])):O("",!0),g.value?(p(),f("div",{key:1,class:"success-toast",onClick:Y[13]||(Y[13]=X=>g.value="")},[S(r(P),{icon:"carbon:checkmark"}),se(" "+c(g.value),1)])):O("",!0)],64))}}),Zn=pe(Qn,[["__scopeId","data-v-94004438"]]);function ds(o,e){const s=U(!1),n=st({title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=v=>{try{if(!v){Object.assign(n,{title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const $=JSON.parse(v);n.title=$.title||"",n.directResponse=!1,n.planTemplateId=$.planTemplateId||o.currentPlanTemplateId||"",n.planType=$.planType||"dynamic_agent",n.steps=($.steps||[]).map(E=>({stepRequirement:E.stepRequirement||"",agentName:E.agentName||"",modelName:E.modelName||null,selectedToolKeys:E.selectedToolKeys||[],terminateColumns:E.terminateColumns||""}))}catch($){console.warn("Failed to parse JSON content:",$)}},l=()=>{try{const v={title:n.title,steps:n.steps.map($=>({stepRequirement:$.stepRequirement,agentName:$.agentName,modelName:$.modelName||"",selectedToolKeys:$.selectedToolKeys,terminateColumns:$.terminateColumns})),directResponse:n.directResponse,planTemplateId:n.planTemplateId,planType:n.planType};return JSON.stringify(v,null,2)}catch(v){return console.error("Failed to convert visual data to JSON:",v),"{}"}},i=de(()=>l());return ie(()=>o.jsonContent,v=>{a(v)},{immediate:!0}),ie(n,()=>{const v=l();e("update:jsonContent",v)},{deep:!0}),ie(()=>o.currentPlanTemplateId,v=>{v&&(n.planTemplateId=v)}),{showJsonPreview:s,parsedData:n,formattedJsonOutput:i,addStep:()=>{const v={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};n.steps.push(v)},removeStep:v=>{v>=0&&v<n.steps.length&&n.steps.splice(v,1)},moveStepUp:v=>{if(v>0){const $=n.steps.splice(v,1)[0];n.steps.splice(v-1,0,$)}},moveStepDown:v=>{if(v<n.steps.length-1){const $=n.steps.splice(v,1)[0];n.steps.splice(v+1,0,$)}},toggleJsonPreview:()=>{s.value=!s.value},closeJsonPreview:()=>{s.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const eo={class:"config-section"},to={class:"section-header"},so={class:"visual-editor"},no={class:"plan-basic-info"},oo={class:"form-row"},ao={class:"form-label"},lo=["placeholder"],ro={class:"steps-section"},io={class:"steps-header"},co={class:"form-label"},uo={class:"steps-container"},po={class:"step-header"},ho={class:"step-number"},mo={class:"step-actions"},fo=["onClick","disabled","title"],vo=["onClick","disabled","title"],go=["onClick","title"],bo={class:"step-content"},yo={class:"form-row"},_o={class:"form-label"},$o={class:"agent-selector"},wo=["onUpdate:modelValue"],So={value:""},ko=["title"],To={class:"form-row"},Po={class:"form-label"},Eo=["onUpdate:modelValue","placeholder"],Co={class:"form-row"},Io={class:"form-label"},Ro=["onUpdate:modelValue","placeholder"],Ao={key:0,class:"empty-steps"},xo={class:"plan-id-section"},Do={class:"form-row"},Mo={class:"form-label"},No={key:0,class:"json-preview"},Uo={class:"preview-header"},Fo={class:"form-label"},Lo={class:"json-code"},Bo={class:"editor-footer"},Oo={class:"section-actions"},qo=["disabled","title"],jo=["disabled","title"],Vo=["disabled"],Ho=ue({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const s=o,n=e,{showJsonPreview:a,parsedData:l,formattedJsonOutput:i,addStep:h,removeStep:g,moveStepUp:u,moveStepDown:d,handleRollback:b,handleRestore:C,handleSave:M,toggleJsonPreview:_,closeJsonPreview:y}=ds(s,n),v=$=>{const E=$.target;if(!E)return;E.style.height="auto";const w=20,R=Math.ceil(E.scrollHeight/w),m=4,j=12,x=Math.max(m,Math.min(j,R)),J=x*w;E.style.height=`${J}px`,E.rows=x,R>j?E.style.overflowY="auto":E.style.overflowY="hidden"};return($,E)=>(p(),f("div",eo,[t("div",to,[S(r(P),{icon:"carbon:code",width:"16"}),t("span",null,c($.$t("sidebar.jsonTemplate")),1)]),t("div",so,[t("div",no,[t("div",oo,[t("label",ao,c($.$t("sidebar.title")),1),te(t("input",{"onUpdate:modelValue":E[0]||(E[0]=w=>r(l).title=w),type:"text",class:"form-input",placeholder:$.$t("sidebar.titlePlaceholder")},null,8,lo),[[le,r(l).title]])])]),t("div",ro,[t("div",io,[t("label",co,c($.$t("sidebar.tasks")),1)]),t("div",uo,[(p(!0),f(oe,null,re(r(l).steps,(w,R)=>(p(),f("div",{key:R,class:"step-item"},[t("div",po,[t("span",ho,c($.$t("sidebar.subtask"))+" "+c(R+1),1),t("div",mo,[t("button",{onClick:m=>r(u)(R),disabled:R===0,class:"btn btn-xs",title:$.$t("sidebar.moveUp")},[S(r(P),{icon:"carbon:chevron-up",width:"12"})],8,fo),t("button",{onClick:m=>r(d)(R),disabled:R===r(l).steps.length-1,class:"btn btn-xs",title:$.$t("sidebar.moveDown")},[S(r(P),{icon:"carbon:chevron-down",width:"12"})],8,vo),t("button",{onClick:m=>r(g)(R),class:"btn btn-xs btn-danger",title:$.$t("sidebar.removeStep")},[S(r(P),{icon:"carbon:trash-can",width:"12"})],8,go)])]),t("div",bo,[t("div",yo,[t("label",_o,c($.$t("sidebar.agent")),1),t("div",$o,[te(t("select",{"onUpdate:modelValue":m=>w.agentName=m,class:"form-select agent-select"},[t("option",So,c($.$t("sidebar.selectAgent")),1),E[10]||(E[10]=ns('<option value="DEFAULT_AGENT" data-v-9dac9f0f>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-9dac9f0f>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-9dac9f0f>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-9dac9f0f>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-9dac9f0f>FILE_MANAGER_AGENT</option>',5))],8,wo),[[nt,w.agentName]]),t("button",{onClick:E[1]||(E[1]=(...m)=>r(h)&&r(h)(...m)),class:"btn btn-sm btn-add-step",title:$.$t("sidebar.addStep")},[S(r(P),{icon:"carbon:add",width:"14"})],8,ko)])]),t("div",To,[t("label",Po,c($.$t("sidebar.stepRequirement")),1),te(t("textarea",{"onUpdate:modelValue":m=>w.stepContent=m,class:"form-textarea auto-resize",placeholder:$.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:E[2]||(E[2]=m=>v(m))},null,40,Eo),[[le,w.stepContent]])]),t("div",Co,[t("label",Io,c($.$t("sidebar.terminateColumns")),1),te(t("input",{"onUpdate:modelValue":m=>w.terminateColumns=m,type:"text",class:"form-input",placeholder:$.$t("sidebar.terminateColumnsPlaceholder")},null,8,Ro),[[le,w.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),f("div",Ao,[S(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),t("p",null,c($.$t("sidebar.noSteps")),1),t("button",{onClick:E[3]||(E[3]=(...w)=>r(h)&&r(h)(...w)),class:"btn btn-primary"},[S(r(P),{icon:"carbon:add",width:"14"}),se(" "+c($.$t("sidebar.addFirstStep")),1)])])):O("",!0)])]),t("div",xo,[t("div",Do,[t("label",Mo,c($.$t("sidebar.planId")),1),te(t("input",{"onUpdate:modelValue":E[4]||(E[4]=w=>r(l).planTemplateId=w),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[le,r(l).planTemplateId]])])]),r(a)?(p(),f("div",No,[t("div",Uo,[t("label",Fo,c($.$t("sidebar.jsonPreview")),1),t("button",{onClick:E[5]||(E[5]=(...w)=>r(y)&&r(y)(...w)),class:"btn btn-xs"},[S(r(P),{icon:"carbon:close",width:"12"})])]),t("pre",Lo,c(r(i)),1)])):O("",!0),t("div",Bo,[t("button",{onClick:E[6]||(E[6]=(...w)=>r(_)&&r(_)(...w)),class:"btn btn-sm btn-secondary"},[S(r(P),{icon:"carbon:code",width:"14"}),se(" "+c(r(a)?$.$t("sidebar.hideJson"):$.$t("sidebar.showJson")),1)]),t("div",Oo,[t("button",{class:"btn btn-sm",onClick:E[7]||(E[7]=(...w)=>r(b)&&r(b)(...w)),disabled:!($.canRollback??!1),title:$.$t("sidebar.rollback")},[S(r(P),{icon:"carbon:undo",width:"14"})],8,qo),t("button",{class:"btn btn-sm",onClick:E[8]||(E[8]=(...w)=>r(C)&&r(C)(...w)),disabled:!($.canRestore??!1),title:$.$t("sidebar.restore")},[S(r(P),{icon:"carbon:redo",width:"14"})],8,jo),t("button",{class:"btn btn-primary",onClick:E[9]||(E[9]=(...w)=>r(M)&&r(M)(...w)),disabled:$.isGenerating||$.isExecuting},[S(r(P),{icon:"carbon:save",width:"14"}),E[11]||(E[11]=se(" 保存 "))],8,Vo)])])])]))}}),Go=pe(Ho,[["__scopeId","data-v-9dac9f0f"]]);function us(o,e){return function(){return o.apply(e,arguments)}}const{toString:zo}=Object.prototype,{getPrototypeOf:Ut}=Object,{iterator:ft,toStringTag:ps}=Symbol,vt=(o=>e=>{const s=zo.call(e);return o[s]||(o[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),Ie=o=>(o=o.toLowerCase(),e=>vt(e)===o),gt=o=>e=>typeof e===o,{isArray:We}=Array,tt=gt("undefined");function Wo(o){return o!==null&&!tt(o)&&o.constructor!==null&&!tt(o.constructor)&&_e(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const hs=Ie("ArrayBuffer");function Jo(o){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(o):e=o&&o.buffer&&hs(o.buffer),e}const Ko=gt("string"),_e=gt("function"),ms=gt("number"),bt=o=>o!==null&&typeof o=="object",Xo=o=>o===!0||o===!1,ct=o=>{if(vt(o)!=="object")return!1;const e=Ut(o);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(ps in o)&&!(ft in o)},Yo=Ie("Date"),Qo=Ie("File"),Zo=Ie("Blob"),ea=Ie("FileList"),ta=o=>bt(o)&&_e(o.pipe),sa=o=>{let e;return o&&(typeof FormData=="function"&&o instanceof FormData||_e(o.append)&&((e=vt(o))==="formdata"||e==="object"&&_e(o.toString)&&o.toString()==="[object FormData]"))},na=Ie("URLSearchParams"),[oa,aa,la,ra]=["ReadableStream","Request","Response","Headers"].map(Ie),ia=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ot(o,e,{allOwnKeys:s=!1}={}){if(o===null||typeof o>"u")return;let n,a;if(typeof o!="object"&&(o=[o]),We(o))for(n=0,a=o.length;n<a;n++)e.call(null,o[n],n,o);else{const l=s?Object.getOwnPropertyNames(o):Object.keys(o),i=l.length;let h;for(n=0;n<i;n++)h=l[n],e.call(null,o[h],h,o)}}function fs(o,e){e=e.toLowerCase();const s=Object.keys(o);let n=s.length,a;for(;n-- >0;)if(a=s[n],e===a.toLowerCase())return a;return null}const Oe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,vs=o=>!tt(o)&&o!==Oe;function Et(){const{caseless:o}=vs(this)&&this||{},e={},s=(n,a)=>{const l=o&&fs(e,a)||a;ct(e[l])&&ct(n)?e[l]=Et(e[l],n):ct(n)?e[l]=Et({},n):We(n)?e[l]=n.slice():e[l]=n};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&ot(arguments[n],s);return e}const ca=(o,e,s,{allOwnKeys:n}={})=>(ot(e,(a,l)=>{s&&_e(a)?o[l]=us(a,s):o[l]=a},{allOwnKeys:n}),o),da=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),ua=(o,e,s,n)=>{o.prototype=Object.create(e.prototype,n),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:e.prototype}),s&&Object.assign(o.prototype,s)},pa=(o,e,s,n)=>{let a,l,i;const h={};if(e=e||{},o==null)return e;do{for(a=Object.getOwnPropertyNames(o),l=a.length;l-- >0;)i=a[l],(!n||n(i,o,e))&&!h[i]&&(e[i]=o[i],h[i]=!0);o=s!==!1&&Ut(o)}while(o&&(!s||s(o,e))&&o!==Object.prototype);return e},ha=(o,e,s)=>{o=String(o),(s===void 0||s>o.length)&&(s=o.length),s-=e.length;const n=o.indexOf(e,s);return n!==-1&&n===s},ma=o=>{if(!o)return null;if(We(o))return o;let e=o.length;if(!ms(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=o[e];return s},fa=(o=>e=>o&&e instanceof o)(typeof Uint8Array<"u"&&Ut(Uint8Array)),va=(o,e)=>{const n=(o&&o[ft]).call(o);let a;for(;(a=n.next())&&!a.done;){const l=a.value;e.call(o,l[0],l[1])}},ga=(o,e)=>{let s;const n=[];for(;(s=o.exec(e))!==null;)n.push(s);return n},ba=Ie("HTMLFormElement"),ya=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,n,a){return n.toUpperCase()+a}),Vt=(({hasOwnProperty:o})=>(e,s)=>o.call(e,s))(Object.prototype),_a=Ie("RegExp"),gs=(o,e)=>{const s=Object.getOwnPropertyDescriptors(o),n={};ot(s,(a,l)=>{let i;(i=e(a,l,o))!==!1&&(n[l]=i||a)}),Object.defineProperties(o,n)},$a=o=>{gs(o,(e,s)=>{if(_e(o)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const n=o[s];if(_e(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},wa=(o,e)=>{const s={},n=a=>{a.forEach(l=>{s[l]=!0})};return We(o)?n(o):n(String(o).split(e)),s},Sa=()=>{},ka=(o,e)=>o!=null&&Number.isFinite(o=+o)?o:e;function Ta(o){return!!(o&&_e(o.append)&&o[ps]==="FormData"&&o[ft])}const Pa=o=>{const e=new Array(10),s=(n,a)=>{if(bt(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[a]=n;const l=We(n)?[]:{};return ot(n,(i,h)=>{const g=s(i,a+1);!tt(g)&&(l[h]=g)}),e[a]=void 0,l}}return n};return s(o,0)},Ea=Ie("AsyncFunction"),Ca=o=>o&&(bt(o)||_e(o))&&_e(o.then)&&_e(o.catch),bs=((o,e)=>o?setImmediate:e?((s,n)=>(Oe.addEventListener("message",({source:a,data:l})=>{a===Oe&&l===s&&n.length&&n.shift()()},!1),a=>{n.push(a),Oe.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",_e(Oe.postMessage)),Ia=typeof queueMicrotask<"u"?queueMicrotask.bind(Oe):typeof process<"u"&&process.nextTick||bs,Ra=o=>o!=null&&_e(o[ft]),I={isArray:We,isArrayBuffer:hs,isBuffer:Wo,isFormData:sa,isArrayBufferView:Jo,isString:Ko,isNumber:ms,isBoolean:Xo,isObject:bt,isPlainObject:ct,isReadableStream:oa,isRequest:aa,isResponse:la,isHeaders:ra,isUndefined:tt,isDate:Yo,isFile:Qo,isBlob:Zo,isRegExp:_a,isFunction:_e,isStream:ta,isURLSearchParams:na,isTypedArray:fa,isFileList:ea,forEach:ot,merge:Et,extend:ca,trim:ia,stripBOM:da,inherits:ua,toFlatObject:pa,kindOf:vt,kindOfTest:Ie,endsWith:ha,toArray:ma,forEachEntry:va,matchAll:ga,isHTMLForm:ba,hasOwnProperty:Vt,hasOwnProp:Vt,reduceDescriptors:gs,freezeMethods:$a,toObjectSet:wa,toCamelCase:ya,noop:Sa,toFiniteNumber:ka,findKey:fs,global:Oe,isContextDefined:vs,isSpecCompliantForm:Ta,toJSONObject:Pa,isAsyncFn:Ea,isThenable:Ca,setImmediate:bs,asap:Ia,isIterable:Ra};function ee(o,e,s,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(ee,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const ys=ee.prototype,_s={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{_s[o]={value:o}});Object.defineProperties(ee,_s);Object.defineProperty(ys,"isAxiosError",{value:!0});ee.from=(o,e,s,n,a,l)=>{const i=Object.create(ys);return I.toFlatObject(o,i,function(g){return g!==Error.prototype},h=>h!=="isAxiosError"),ee.call(i,o.message,e,s,n,a),i.cause=o,i.name=o.name,l&&Object.assign(i,l),i};const Aa=null;function Ct(o){return I.isPlainObject(o)||I.isArray(o)}function $s(o){return I.endsWith(o,"[]")?o.slice(0,-2):o}function Ht(o,e,s){return o?o.concat(e).map(function(a,l){return a=$s(a),!s&&l?"["+a+"]":a}).join(s?".":""):e}function xa(o){return I.isArray(o)&&!o.some(Ct)}const Da=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function yt(o,e,s){if(!I.isObject(o))throw new TypeError("target must be an object");e=e||new FormData,s=I.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,v){return!I.isUndefined(v[y])});const n=s.metaTokens,a=s.visitor||d,l=s.dots,i=s.indexes,g=(s.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function u(_){if(_===null)return"";if(I.isDate(_))return _.toISOString();if(!g&&I.isBlob(_))throw new ee("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(_)||I.isTypedArray(_)?g&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function d(_,y,v){let $=_;if(_&&!v&&typeof _=="object"){if(I.endsWith(y,"{}"))y=n?y:y.slice(0,-2),_=JSON.stringify(_);else if(I.isArray(_)&&xa(_)||(I.isFileList(_)||I.endsWith(y,"[]"))&&($=I.toArray(_)))return y=$s(y),$.forEach(function(w,R){!(I.isUndefined(w)||w===null)&&e.append(i===!0?Ht([y],R,l):i===null?y:y+"[]",u(w))}),!1}return Ct(_)?!0:(e.append(Ht(v,y,l),u(_)),!1)}const b=[],C=Object.assign(Da,{defaultVisitor:d,convertValue:u,isVisitable:Ct});function M(_,y){if(!I.isUndefined(_)){if(b.indexOf(_)!==-1)throw Error("Circular reference detected in "+y.join("."));b.push(_),I.forEach(_,function($,E){(!(I.isUndefined($)||$===null)&&a.call(e,$,I.isString(E)?E.trim():E,y,C))===!0&&M($,y?y.concat(E):[E])}),b.pop()}}if(!I.isObject(o))throw new TypeError("data must be an object");return M(o),e}function Gt(o){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Ft(o,e){this._pairs=[],o&&yt(o,this,e)}const ws=Ft.prototype;ws.append=function(e,s){this._pairs.push([e,s])};ws.toString=function(e){const s=e?function(n){return e.call(this,n,Gt)}:Gt;return this._pairs.map(function(a){return s(a[0])+"="+s(a[1])},"").join("&")};function Ma(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ss(o,e,s){if(!e)return o;const n=s&&s.encode||Ma;I.isFunction(s)&&(s={serialize:s});const a=s&&s.serialize;let l;if(a?l=a(e,s):l=I.isURLSearchParams(e)?e.toString():new Ft(e,s).toString(n),l){const i=o.indexOf("#");i!==-1&&(o=o.slice(0,i)),o+=(o.indexOf("?")===-1?"?":"&")+l}return o}class zt{constructor(){this.handlers=[]}use(e,s,n){return this.handlers.push({fulfilled:e,rejected:s,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(n){n!==null&&e(n)})}}const ks={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Na=typeof URLSearchParams<"u"?URLSearchParams:Ft,Ua=typeof FormData<"u"?FormData:null,Fa=typeof Blob<"u"?Blob:null,La={isBrowser:!0,classes:{URLSearchParams:Na,FormData:Ua,Blob:Fa},protocols:["http","https","file","blob","url","data"]},Lt=typeof window<"u"&&typeof document<"u",It=typeof navigator=="object"&&navigator||void 0,Ba=Lt&&(!It||["ReactNative","NativeScript","NS"].indexOf(It.product)<0),Oa=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",qa=Lt&&window.location.href||"http://localhost",ja=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Lt,hasStandardBrowserEnv:Ba,hasStandardBrowserWebWorkerEnv:Oa,navigator:It,origin:qa},Symbol.toStringTag,{value:"Module"})),be={...ja,...La};function Va(o,e){return yt(o,new be.classes.URLSearchParams,Object.assign({visitor:function(s,n,a,l){return be.isNode&&I.isBuffer(s)?(this.append(n,s.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Ha(o){return I.matchAll(/\w+|\[(\w*)]/g,o).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Ga(o){const e={},s=Object.keys(o);let n;const a=s.length;let l;for(n=0;n<a;n++)l=s[n],e[l]=o[l];return e}function Ts(o){function e(s,n,a,l){let i=s[l++];if(i==="__proto__")return!0;const h=Number.isFinite(+i),g=l>=s.length;return i=!i&&I.isArray(a)?a.length:i,g?(I.hasOwnProp(a,i)?a[i]=[a[i],n]:a[i]=n,!h):((!a[i]||!I.isObject(a[i]))&&(a[i]=[]),e(s,n,a[i],l)&&I.isArray(a[i])&&(a[i]=Ga(a[i])),!h)}if(I.isFormData(o)&&I.isFunction(o.entries)){const s={};return I.forEachEntry(o,(n,a)=>{e(Ha(n),a,s,0)}),s}return null}function za(o,e,s){if(I.isString(o))try{return(e||JSON.parse)(o),I.trim(o)}catch(n){if(n.name!=="SyntaxError")throw n}return(s||JSON.stringify)(o)}const at={transitional:ks,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const n=s.getContentType()||"",a=n.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(Ts(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let h;if(l){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Va(e,this.formSerializer).toString();if((h=I.isFileList(e))||n.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return yt(h?{"files[]":e}:e,g&&new g,this.formSerializer)}}return l||a?(s.setContentType("application/json",!1),za(e)):e}],transformResponse:[function(e){const s=this.transitional||at.transitional,n=s&&s.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(n&&!this.responseType||a)){const i=!(s&&s.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(h){if(i)throw h.name==="SyntaxError"?ee.from(h,ee.ERR_BAD_RESPONSE,this,null,this.response):h}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:be.classes.FormData,Blob:be.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],o=>{at.headers[o]={}});const Wa=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ja=o=>{const e={};let s,n,a;return o&&o.split(`
`).forEach(function(i){a=i.indexOf(":"),s=i.substring(0,a).trim().toLowerCase(),n=i.substring(a+1).trim(),!(!s||e[s]&&Wa[s])&&(s==="set-cookie"?e[s]?e[s].push(n):e[s]=[n]:e[s]=e[s]?e[s]+", "+n:n)}),e},Wt=Symbol("internals");function Ye(o){return o&&String(o).trim().toLowerCase()}function dt(o){return o===!1||o==null?o:I.isArray(o)?o.map(dt):String(o)}function Ka(o){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(o);)e[n[1]]=n[2];return e}const Xa=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function St(o,e,s,n,a){if(I.isFunction(n))return n.call(this,e,s);if(a&&(e=s),!!I.isString(e)){if(I.isString(n))return e.indexOf(n)!==-1;if(I.isRegExp(n))return n.test(e)}}function Ya(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,n)=>s.toUpperCase()+n)}function Qa(o,e){const s=I.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(o,n+s,{value:function(a,l,i){return this[n].call(this,e,a,l,i)},configurable:!0})})}let $e=class{constructor(e){e&&this.set(e)}set(e,s,n){const a=this;function l(h,g,u){const d=Ye(g);if(!d)throw new Error("header name must be a non-empty string");const b=I.findKey(a,d);(!b||a[b]===void 0||u===!0||u===void 0&&a[b]!==!1)&&(a[b||g]=dt(h))}const i=(h,g)=>I.forEach(h,(u,d)=>l(u,d,g));if(I.isPlainObject(e)||e instanceof this.constructor)i(e,s);else if(I.isString(e)&&(e=e.trim())&&!Xa(e))i(Ja(e),s);else if(I.isObject(e)&&I.isIterable(e)){let h={},g,u;for(const d of e){if(!I.isArray(d))throw TypeError("Object iterator must return a key-value pair");h[u=d[0]]=(g=h[u])?I.isArray(g)?[...g,d[1]]:[g,d[1]]:d[1]}i(h,s)}else e!=null&&l(s,e,n);return this}get(e,s){if(e=Ye(e),e){const n=I.findKey(this,e);if(n){const a=this[n];if(!s)return a;if(s===!0)return Ka(a);if(I.isFunction(s))return s.call(this,a,n);if(I.isRegExp(s))return s.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=Ye(e),e){const n=I.findKey(this,e);return!!(n&&this[n]!==void 0&&(!s||St(this,this[n],n,s)))}return!1}delete(e,s){const n=this;let a=!1;function l(i){if(i=Ye(i),i){const h=I.findKey(n,i);h&&(!s||St(n,n[h],h,s))&&(delete n[h],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const s=Object.keys(this);let n=s.length,a=!1;for(;n--;){const l=s[n];(!e||St(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const s=this,n={};return I.forEach(this,(a,l)=>{const i=I.findKey(n,l);if(i){s[i]=dt(a),delete s[l];return}const h=e?Ya(l):String(l).trim();h!==l&&delete s[l],s[h]=dt(a),n[h]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return I.forEach(this,(n,a)=>{n!=null&&n!==!1&&(s[a]=e&&I.isArray(n)?n.join(", "):n)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const n=new this(e);return s.forEach(a=>n.set(a)),n}static accessor(e){const n=(this[Wt]=this[Wt]={accessors:{}}).accessors,a=this.prototype;function l(i){const h=Ye(i);n[h]||(Qa(a,i),n[h]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};$e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors($e.prototype,({value:o},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>o,set(n){this[s]=n}}});I.freezeMethods($e);function kt(o,e){const s=this||at,n=e||s,a=$e.from(n.headers);let l=n.data;return I.forEach(o,function(h){l=h.call(s,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Ps(o){return!!(o&&o.__CANCEL__)}function Je(o,e,s){ee.call(this,o??"canceled",ee.ERR_CANCELED,e,s),this.name="CanceledError"}I.inherits(Je,ee,{__CANCEL__:!0});function Es(o,e,s){const n=s.config.validateStatus;!s.status||!n||n(s.status)?o(s):e(new ee("Request failed with status code "+s.status,[ee.ERR_BAD_REQUEST,ee.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function Za(o){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return e&&e[1]||""}function el(o,e){o=o||10;const s=new Array(o),n=new Array(o);let a=0,l=0,i;return e=e!==void 0?e:1e3,function(g){const u=Date.now(),d=n[l];i||(i=u),s[a]=g,n[a]=u;let b=l,C=0;for(;b!==a;)C+=s[b++],b=b%o;if(a=(a+1)%o,a===l&&(l=(l+1)%o),u-i<e)return;const M=d&&u-d;return M?Math.round(C*1e3/M):void 0}}function tl(o,e){let s=0,n=1e3/e,a,l;const i=(u,d=Date.now())=>{s=d,a=null,l&&(clearTimeout(l),l=null),o.apply(null,u)};return[(...u)=>{const d=Date.now(),b=d-s;b>=n?i(u,d):(a=u,l||(l=setTimeout(()=>{l=null,i(a)},n-b)))},()=>a&&i(a)]}const ht=(o,e,s=3)=>{let n=0;const a=el(50,250);return tl(l=>{const i=l.loaded,h=l.lengthComputable?l.total:void 0,g=i-n,u=a(g),d=i<=h;n=i;const b={loaded:i,total:h,progress:h?i/h:void 0,bytes:g,rate:u||void 0,estimated:u&&h&&d?(h-i)/u:void 0,event:l,lengthComputable:h!=null,[e?"download":"upload"]:!0};o(b)},s)},Jt=(o,e)=>{const s=o!=null;return[n=>e[0]({lengthComputable:s,total:o,loaded:n}),e[1]]},Kt=o=>(...e)=>I.asap(()=>o(...e)),sl=be.hasStandardBrowserEnv?((o,e)=>s=>(s=new URL(s,be.origin),o.protocol===s.protocol&&o.host===s.host&&(e||o.port===s.port)))(new URL(be.origin),be.navigator&&/(msie|trident)/i.test(be.navigator.userAgent)):()=>!0,nl=be.hasStandardBrowserEnv?{write(o,e,s,n,a,l){const i=[o+"="+encodeURIComponent(e)];I.isNumber(s)&&i.push("expires="+new Date(s).toGMTString()),I.isString(n)&&i.push("path="+n),I.isString(a)&&i.push("domain="+a),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(o){const e=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ol(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function al(o,e){return e?o.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):o}function Cs(o,e,s){let n=!ol(e);return o&&(n||s==!1)?al(o,e):e}const Xt=o=>o instanceof $e?{...o}:o;function Ve(o,e){e=e||{};const s={};function n(u,d,b,C){return I.isPlainObject(u)&&I.isPlainObject(d)?I.merge.call({caseless:C},u,d):I.isPlainObject(d)?I.merge({},d):I.isArray(d)?d.slice():d}function a(u,d,b,C){if(I.isUndefined(d)){if(!I.isUndefined(u))return n(void 0,u,b,C)}else return n(u,d,b,C)}function l(u,d){if(!I.isUndefined(d))return n(void 0,d)}function i(u,d){if(I.isUndefined(d)){if(!I.isUndefined(u))return n(void 0,u)}else return n(void 0,d)}function h(u,d,b){if(b in e)return n(u,d);if(b in o)return n(void 0,u)}const g={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:h,headers:(u,d,b)=>a(Xt(u),Xt(d),b,!0)};return I.forEach(Object.keys(Object.assign({},o,e)),function(d){const b=g[d]||a,C=b(o[d],e[d],d);I.isUndefined(C)&&b!==h||(s[d]=C)}),s}const Is=o=>{const e=Ve({},o);let{data:s,withXSRFToken:n,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:h}=e;e.headers=i=$e.from(i),e.url=Ss(Cs(e.baseURL,e.url,e.allowAbsoluteUrls),o.params,o.paramsSerializer),h&&i.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):"")));let g;if(I.isFormData(s)){if(be.hasStandardBrowserEnv||be.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((g=i.getContentType())!==!1){const[u,...d]=g?g.split(";").map(b=>b.trim()).filter(Boolean):[];i.setContentType([u||"multipart/form-data",...d].join("; "))}}if(be.hasStandardBrowserEnv&&(n&&I.isFunction(n)&&(n=n(e)),n||n!==!1&&sl(e.url))){const u=a&&l&&nl.read(l);u&&i.set(a,u)}return e},ll=typeof XMLHttpRequest<"u",rl=ll&&function(o){return new Promise(function(s,n){const a=Is(o);let l=a.data;const i=$e.from(a.headers).normalize();let{responseType:h,onUploadProgress:g,onDownloadProgress:u}=a,d,b,C,M,_;function y(){M&&M(),_&&_(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let v=new XMLHttpRequest;v.open(a.method.toUpperCase(),a.url,!0),v.timeout=a.timeout;function $(){if(!v)return;const w=$e.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),m={data:!h||h==="text"||h==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:w,config:o,request:v};Es(function(x){s(x),y()},function(x){n(x),y()},m),v=null}"onloadend"in v?v.onloadend=$:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout($)},v.onabort=function(){v&&(n(new ee("Request aborted",ee.ECONNABORTED,o,v)),v=null)},v.onerror=function(){n(new ee("Network Error",ee.ERR_NETWORK,o,v)),v=null},v.ontimeout=function(){let R=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const m=a.transitional||ks;a.timeoutErrorMessage&&(R=a.timeoutErrorMessage),n(new ee(R,m.clarifyTimeoutError?ee.ETIMEDOUT:ee.ECONNABORTED,o,v)),v=null},l===void 0&&i.setContentType(null),"setRequestHeader"in v&&I.forEach(i.toJSON(),function(R,m){v.setRequestHeader(m,R)}),I.isUndefined(a.withCredentials)||(v.withCredentials=!!a.withCredentials),h&&h!=="json"&&(v.responseType=a.responseType),u&&([C,_]=ht(u,!0),v.addEventListener("progress",C)),g&&v.upload&&([b,M]=ht(g),v.upload.addEventListener("progress",b),v.upload.addEventListener("loadend",M)),(a.cancelToken||a.signal)&&(d=w=>{v&&(n(!w||w.type?new Je(null,o,v):w),v.abort(),v=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const E=Za(a.url);if(E&&be.protocols.indexOf(E)===-1){n(new ee("Unsupported protocol "+E+":",ee.ERR_BAD_REQUEST,o));return}v.send(l||null)})},il=(o,e)=>{const{length:s}=o=o?o.filter(Boolean):[];if(e||s){let n=new AbortController,a;const l=function(u){if(!a){a=!0,h();const d=u instanceof Error?u:this.reason;n.abort(d instanceof ee?d:new Je(d instanceof Error?d.message:d))}};let i=e&&setTimeout(()=>{i=null,l(new ee(`timeout ${e} of ms exceeded`,ee.ETIMEDOUT))},e);const h=()=>{o&&(i&&clearTimeout(i),i=null,o.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),o=null)};o.forEach(u=>u.addEventListener("abort",l));const{signal:g}=n;return g.unsubscribe=()=>I.asap(h),g}},cl=function*(o,e){let s=o.byteLength;if(s<e){yield o;return}let n=0,a;for(;n<s;)a=n+e,yield o.slice(n,a),n=a},dl=async function*(o,e){for await(const s of ul(o))yield*cl(s,e)},ul=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const e=o.getReader();try{for(;;){const{done:s,value:n}=await e.read();if(s)break;yield n}}finally{await e.cancel()}},Yt=(o,e,s,n)=>{const a=dl(o,e);let l=0,i,h=g=>{i||(i=!0,n&&n(g))};return new ReadableStream({async pull(g){try{const{done:u,value:d}=await a.next();if(u){h(),g.close();return}let b=d.byteLength;if(s){let C=l+=b;s(C)}g.enqueue(new Uint8Array(d))}catch(u){throw h(u),u}},cancel(g){return h(g),a.return()}},{highWaterMark:2})},_t=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Rs=_t&&typeof ReadableStream=="function",pl=_t&&(typeof TextEncoder=="function"?(o=>e=>o.encode(e))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),As=(o,...e)=>{try{return!!o(...e)}catch{return!1}},hl=Rs&&As(()=>{let o=!1;const e=new Request(be.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!e}),Qt=64*1024,Rt=Rs&&As(()=>I.isReadableStream(new Response("").body)),mt={stream:Rt&&(o=>o.body)};_t&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!mt[e]&&(mt[e]=I.isFunction(o[e])?s=>s[e]():(s,n)=>{throw new ee(`Response type '${e}' is not supported`,ee.ERR_NOT_SUPPORT,n)})})})(new Response);const ml=async o=>{if(o==null)return 0;if(I.isBlob(o))return o.size;if(I.isSpecCompliantForm(o))return(await new Request(be.origin,{method:"POST",body:o}).arrayBuffer()).byteLength;if(I.isArrayBufferView(o)||I.isArrayBuffer(o))return o.byteLength;if(I.isURLSearchParams(o)&&(o=o+""),I.isString(o))return(await pl(o)).byteLength},fl=async(o,e)=>{const s=I.toFiniteNumber(o.getContentLength());return s??ml(e)},vl=_t&&(async o=>{let{url:e,method:s,data:n,signal:a,cancelToken:l,timeout:i,onDownloadProgress:h,onUploadProgress:g,responseType:u,headers:d,withCredentials:b="same-origin",fetchOptions:C}=Is(o);u=u?(u+"").toLowerCase():"text";let M=il([a,l&&l.toAbortSignal()],i),_;const y=M&&M.unsubscribe&&(()=>{M.unsubscribe()});let v;try{if(g&&hl&&s!=="get"&&s!=="head"&&(v=await fl(d,n))!==0){let m=new Request(e,{method:"POST",body:n,duplex:"half"}),j;if(I.isFormData(n)&&(j=m.headers.get("content-type"))&&d.setContentType(j),m.body){const[x,J]=Jt(v,ht(Kt(g)));n=Yt(m.body,Qt,x,J)}}I.isString(b)||(b=b?"include":"omit");const $="credentials"in Request.prototype;_=new Request(e,{...C,signal:M,method:s.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:$?b:void 0});let E=await fetch(_);const w=Rt&&(u==="stream"||u==="response");if(Rt&&(h||w&&y)){const m={};["status","statusText","headers"].forEach(k=>{m[k]=E[k]});const j=I.toFiniteNumber(E.headers.get("content-length")),[x,J]=h&&Jt(j,ht(Kt(h),!0))||[];E=new Response(Yt(E.body,Qt,x,()=>{J&&J(),y&&y()}),m)}u=u||"text";let R=await mt[I.findKey(mt,u)||"text"](E,o);return!w&&y&&y(),await new Promise((m,j)=>{Es(m,j,{data:R,headers:$e.from(E.headers),status:E.status,statusText:E.statusText,config:o,request:_})})}catch($){throw y&&y(),$&&$.name==="TypeError"&&/Load failed|fetch/i.test($.message)?Object.assign(new ee("Network Error",ee.ERR_NETWORK,o,_),{cause:$.cause||$}):ee.from($,$&&$.code,o,_)}}),At={http:Aa,xhr:rl,fetch:vl};I.forEach(At,(o,e)=>{if(o){try{Object.defineProperty(o,"name",{value:e})}catch{}Object.defineProperty(o,"adapterName",{value:e})}});const Zt=o=>`- ${o}`,gl=o=>I.isFunction(o)||o===null||o===!1,xs={getAdapter:o=>{o=I.isArray(o)?o:[o];const{length:e}=o;let s,n;const a={};for(let l=0;l<e;l++){s=o[l];let i;if(n=s,!gl(s)&&(n=At[(i=String(s)).toLowerCase()],n===void 0))throw new ee(`Unknown adapter '${i}'`);if(n)break;a[i||"#"+l]=n}if(!n){const l=Object.entries(a).map(([h,g])=>`adapter ${h} `+(g===!1?"is not supported by the environment":"is not available in the build"));let i=e?l.length>1?`since :
`+l.map(Zt).join(`
`):" "+Zt(l[0]):"as no adapter specified";throw new ee("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return n},adapters:At};function Tt(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Je(null,o)}function es(o){return Tt(o),o.headers=$e.from(o.headers),o.data=kt.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),xs.getAdapter(o.adapter||at.adapter)(o).then(function(n){return Tt(o),n.data=kt.call(o,o.transformResponse,n),n.headers=$e.from(n.headers),n},function(n){return Ps(n)||(Tt(o),n&&n.response&&(n.response.data=kt.call(o,o.transformResponse,n.response),n.response.headers=$e.from(n.response.headers))),Promise.reject(n)})}const Ds="1.9.0",$t={};["object","boolean","number","function","string","symbol"].forEach((o,e)=>{$t[o]=function(n){return typeof n===o||"a"+(e<1?"n ":" ")+o}});const ts={};$t.transitional=function(e,s,n){function a(l,i){return"[Axios v"+Ds+"] Transitional option '"+l+"'"+i+(n?". "+n:"")}return(l,i,h)=>{if(e===!1)throw new ee(a(i," has been removed"+(s?" in "+s:"")),ee.ERR_DEPRECATED);return s&&!ts[i]&&(ts[i]=!0,console.warn(a(i," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(l,i,h):!0}};$t.spelling=function(e){return(s,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function bl(o,e,s){if(typeof o!="object")throw new ee("options must be an object",ee.ERR_BAD_OPTION_VALUE);const n=Object.keys(o);let a=n.length;for(;a-- >0;){const l=n[a],i=e[l];if(i){const h=o[l],g=h===void 0||i(h,l,o);if(g!==!0)throw new ee("option "+l+" must be "+g,ee.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new ee("Unknown option "+l,ee.ERR_BAD_OPTION)}}const ut={assertOptions:bl,validators:$t},Ae=ut.validators;let je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new zt,response:new zt}}async request(e,s){try{return await this._request(e,s)}catch(n){if(n instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?l&&!String(n.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+l):n.stack=l}catch{}}throw n}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=Ve(this.defaults,s);const{transitional:n,paramsSerializer:a,headers:l}=s;n!==void 0&&ut.assertOptions(n,{silentJSONParsing:Ae.transitional(Ae.boolean),forcedJSONParsing:Ae.transitional(Ae.boolean),clarifyTimeoutError:Ae.transitional(Ae.boolean)},!1),a!=null&&(I.isFunction(a)?s.paramsSerializer={serialize:a}:ut.assertOptions(a,{encode:Ae.function,serialize:Ae.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),ut.assertOptions(s,{baseUrl:Ae.spelling("baseURL"),withXsrfToken:Ae.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let i=l&&I.merge(l.common,l[s.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],_=>{delete l[_]}),s.headers=$e.concat(i,l);const h=[];let g=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(s)===!1||(g=g&&y.synchronous,h.unshift(y.fulfilled,y.rejected))});const u=[];this.interceptors.response.forEach(function(y){u.push(y.fulfilled,y.rejected)});let d,b=0,C;if(!g){const _=[es.bind(this),void 0];for(_.unshift.apply(_,h),_.push.apply(_,u),C=_.length,d=Promise.resolve(s);b<C;)d=d.then(_[b++],_[b++]);return d}C=h.length;let M=s;for(b=0;b<C;){const _=h[b++],y=h[b++];try{M=_(M)}catch(v){y.call(this,v);break}}try{d=es.call(this,M)}catch(_){return Promise.reject(_)}for(b=0,C=u.length;b<C;)d=d.then(u[b++],u[b++]);return d}getUri(e){e=Ve(this.defaults,e);const s=Cs(e.baseURL,e.url,e.allowAbsoluteUrls);return Ss(s,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){je.prototype[e]=function(s,n){return this.request(Ve(n||{},{method:e,url:s,data:(n||{}).data}))}});I.forEach(["post","put","patch"],function(e){function s(n){return function(l,i,h){return this.request(Ve(h||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}je.prototype[e]=s(),je.prototype[e+"Form"]=s(!0)});let yl=class Ms{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(l){s=l});const n=this;this.promise.then(a=>{if(!n._listeners)return;let l=n._listeners.length;for(;l-- >0;)n._listeners[l](a);n._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(h=>{n.subscribe(h),l=h}).then(a);return i.cancel=function(){n.unsubscribe(l)},i},e(function(l,i,h){n.reason||(n.reason=new Je(l,i,h),s(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=n=>{e.abort(n)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new Ms(function(a){e=a}),cancel:e}}};function _l(o){return function(s){return o.apply(null,s)}}function $l(o){return I.isObject(o)&&o.isAxiosError===!0}const xt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xt).forEach(([o,e])=>{xt[e]=o});function Ns(o){const e=new je(o),s=us(je.prototype.request,e);return I.extend(s,je.prototype,e,{allOwnKeys:!0}),I.extend(s,e,null,{allOwnKeys:!0}),s.create=function(a){return Ns(Ve(o,a))},s}const me=Ns(at);me.Axios=je;me.CanceledError=Je;me.CancelToken=yl;me.isCancel=Ps;me.VERSION=Ds;me.toFormData=yt;me.AxiosError=ee;me.Cancel=me.CanceledError;me.all=function(e){return Promise.all(e)};me.spread=_l;me.isAxiosError=$l;me.mergeConfig=Ve;me.AxiosHeaders=$e;me.formToJSON=o=>Ts(I.isHTMLForm(o)?new FormData(o):o);me.getAdapter=xs.getAdapter;me.HttpStatusCode=xt;me.default=me;const{Axios:Yv,AxiosError:Qv,CanceledError:Zv,isCancel:eg,CancelToken:tg,VERSION:sg,all:ng,Cancel:og,isAxiosError:ag,spread:lg,toFormData:rg,AxiosHeaders:ig,HttpStatusCode:cg,formToJSON:dg,getAdapter:ug,mergeConfig:pg}=me;class wl{static async getAvailableModels(){try{return(await me({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const Sl={class:"config-section"},kl={class:"section-header"},Tl={key:0,class:"error-section"},Pl={class:"error-message"},El={class:"error-content"},Cl={class:"error-title"},Il={class:"error-description"},Rl={key:1,class:"visual-editor"},Al={class:"plan-basic-info"},xl={class:"form-row"},Dl={class:"form-label"},Ml=["placeholder"],Nl={class:"form-row"},Ul={class:"form-label"},Fl=["value","placeholder"],Ll={class:"steps-section"},Bl={class:"steps-header"},Ol={class:"form-label"},ql={class:"steps-actions"},jl=["title"],Vl={class:"steps-container"},Hl={class:"step-header"},Gl={class:"step-number"},zl={class:"step-actions"},Wl=["onClick","disabled","title"],Jl=["onClick","disabled","title"],Kl=["onClick","title"],Xl={class:"step-content"},Yl={class:"form-row"},Ql={class:"form-label"},Zl=["onUpdate:modelValue","placeholder"],er={class:"form-row"},tr={class:"form-label"},sr=["onUpdate:modelValue","placeholder"],nr={class:"form-row"},or={class:"form-label"},ar={class:"model-selector"},lr=["onUpdate:modelValue","disabled"],rr={key:0,disabled:"",value:""},ir={key:1,disabled:"",value:""},cr={value:"",disabled:""},dr={value:""},ur=["value","title"],pr=["title"],hr={key:0,class:"error-message"},mr={class:"form-row"},fr={key:0,class:"empty-steps"},vr={key:0,class:"json-preview"},gr={class:"preview-header"},br={class:"form-label"},yr={class:"json-code"},_r={class:"editor-footer"},$r={class:"section-actions"},wr=["disabled","title"],Sr=["disabled","title"],kr=["disabled"],Tr=ue({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const s=o,n=e,{showJsonPreview:a,parsedData:l,formattedJsonOutput:i,addStep:h,removeStep:g,moveStepUp:u,moveStepDown:d,handleRollback:b,handleRestore:C,handleSave:M,toggleJsonPreview:_,closeJsonPreview:y}=ds(s,n),v=U(null),$=U([]),E=U(!1),w=U(""),R=U(!1),m=U(-1),j=async()=>{if(!E.value){E.value=!0,w.value="";try{const F=await wl.getAvailableModels();F&&F.options?$.value=F.options:$.value=[]}catch(F){console.error("Failed to load models:",F),w.value=F instanceof Error?F.message:"Failed to load models",$.value=[]}finally{E.value=!1}}},x=F=>{m.value=F,R.value=!0,console.log("[JsonEditorV2] Available tools from store:",G.availableTools)},J=F=>{m.value>=0&&m.value<l.steps.length&&(l.steps[m.value].selectedToolKeys=[...F]),R.value=!1,m.value=-1},k=(F,A)=>{F>=0&&F<l.steps.length&&(l.steps[F].selectedToolKeys=[...A])},N=()=>{try{v.value=null,l.title||(l.title=""),l.steps||(l.steps=[]),l.directResponse=!1}catch(F){const A=`Failed to initialize JsonEditorV2: ${F instanceof Error?F.message:"Unknown error"}`;v.value=A,console.error(A,F)}};ie(()=>l,F=>{try{F.title?v.value=null:v.value="Title is required field"}catch(A){v.value=`Invalid data structure: ${A instanceof Error?A.message:"Unknown error"}`}},{immediate:!0,deep:!0}),we(()=>{N(),j()});const z=F=>{const A=F.target;if(!A)return;A.style.height="auto";const B=20,D=Math.ceil(A.scrollHeight/B),Q=4,Z=12,ce=Math.max(Q,Math.min(Z,D)),fe=ce*B;A.style.height=`${fe}px`,A.rows=ce,D>Z?A.style.overflowY="auto":A.style.overflowY="hidden"};return(F,A)=>{var B;return p(),f("div",Sl,[t("div",kl,[S(r(P),{icon:"carbon:code",width:"16"}),t("span",null,c(F.$t("sidebar.dynamicAgentPlan")),1)]),v.value?(p(),f("div",Tl,[t("div",Pl,[S(r(P),{icon:"carbon:warning",width:"16"}),t("div",El,[t("div",Cl,c(F.$t("sidebar.planTypeError")),1),t("div",Il,c(v.value),1)])])])):(p(),f("div",Rl,[t("div",Al,[t("div",xl,[t("label",Dl,c(F.$t("sidebar.title")),1),te(t("input",{"onUpdate:modelValue":A[0]||(A[0]=D=>r(l).title=D),type:"text",class:"form-input",placeholder:F.$t("sidebar.titlePlaceholder")},null,8,Ml),[[le,r(l).title]])]),t("div",Nl,[t("label",Ul,c(F.$t("sidebar.planTemplateId")),1),t("input",{value:F.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:F.$t("sidebar.planTemplateIdPlaceholder")},null,8,Fl)])]),t("div",Ll,[t("div",Bl,[t("label",Ol,c(F.$t("sidebar.tasks")),1),t("div",ql,[t("button",{onClick:A[1]||(A[1]=(...D)=>r(h)&&r(h)(...D)),class:"btn btn-xs",title:F.$t("sidebar.addStep")},[S(r(P),{icon:"carbon:add",width:"12"})],8,jl)])]),t("div",Vl,[(p(!0),f(oe,null,re(r(l).steps,(D,Q)=>(p(),f("div",{key:Q,class:"step-item"},[t("div",Hl,[t("span",Gl,c(F.$t("sidebar.subtask"))+" "+c(Q+1),1),t("div",zl,[t("button",{onClick:Z=>r(u)(Q),disabled:Q===0,class:"btn btn-xs",title:F.$t("sidebar.moveUp")},[S(r(P),{icon:"carbon:chevron-up",width:"12"})],8,Wl),t("button",{onClick:Z=>r(d)(Q),disabled:Q===r(l).steps.length-1,class:"btn btn-xs",title:F.$t("sidebar.moveDown")},[S(r(P),{icon:"carbon:chevron-down",width:"12"})],8,Jl),t("button",{onClick:Z=>r(g)(Q),class:"btn btn-xs btn-danger",title:F.$t("sidebar.removeStep")},[S(r(P),{icon:"carbon:trash-can",width:"12"})],8,Kl)])]),t("div",Xl,[t("div",Yl,[t("label",Ql,c(F.$t("sidebar.stepRequirement")),1),te(t("textarea",{"onUpdate:modelValue":Z=>D.stepRequirement=Z,class:"form-textarea auto-resize",placeholder:F.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:A[2]||(A[2]=Z=>z(Z))},null,40,Zl),[[le,D.stepRequirement]])]),t("div",er,[t("label",tr,c(F.$t("sidebar.terminateColumns")),1),te(t("textarea",{"onUpdate:modelValue":Z=>D.terminateColumns=Z,class:"form-textarea auto-resize",placeholder:F.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:A[3]||(A[3]=Z=>z(Z))},null,40,sr),[[le,D.terminateColumns]])]),t("div",nr,[t("label",or,c(F.$t("sidebar.modelName")),1),t("div",ar,[te(t("select",{"onUpdate:modelValue":Z=>D.modelName=Z,class:"form-select model-select",disabled:E.value},[E.value?(p(),f("option",rr,c(F.$t("sidebar.loading")),1)):w.value?(p(),f("option",ir,c(F.$t("sidebar.modelLoadError")),1)):O("",!0),t("option",cr,c(F.$t("sidebar.modelNameDescription")),1),t("option",dr,c(F.$t("sidebar.noModelSelected")),1),(p(!0),f(oe,null,re($.value,Z=>(p(),f("option",{key:Z.value,value:Z.value,title:Z.label},c(Z.label),9,ur))),128))],8,lr),[[nt,D.modelName]]),w.value?(p(),f("button",{key:0,onClick:j,class:"btn btn-sm btn-danger",title:F.$t("sidebar.retryLoadModels")},[S(r(P),{icon:"carbon:warning",width:"14"}),se(" "+c(F.$t("sidebar.retry")),1)],8,pr)):O("",!0)]),w.value?(p(),f("div",hr,[S(r(P),{icon:"carbon:warning",width:"12"}),se(" "+c(w.value),1)])):O("",!0)]),t("div",mr,[S(Hs,{title:F.$t("sidebar.selectedTools"),"selected-tool-ids":D.selectedToolKeys,"available-tools":r(G).availableTools,"add-button-text":F.$t("sidebar.addRemoveTools"),"empty-text":F.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:Z=>x(Q),onToolsFiltered:Z=>k(Q,Z)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(l).steps.length===0?(p(),f("div",fr,[S(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),t("p",null,c(F.$t("sidebar.noSteps")),1),t("button",{onClick:A[4]||(A[4]=(...D)=>r(h)&&r(h)(...D)),class:"btn btn-primary"},[S(r(P),{icon:"carbon:add",width:"14"}),se(" "+c(F.$t("sidebar.addFirstStep")),1)])])):O("",!0)])]),r(a)?(p(),f("div",vr,[t("div",gr,[t("label",br,c(F.$t("sidebar.jsonPreview")),1),t("button",{onClick:A[5]||(A[5]=(...D)=>r(y)&&r(y)(...D)),class:"btn btn-xs"},[S(r(P),{icon:"carbon:close",width:"12"})])]),t("pre",yr,c(r(i)),1)])):O("",!0),t("div",_r,[t("button",{onClick:A[6]||(A[6]=(...D)=>r(_)&&r(_)(...D)),class:"btn btn-sm btn-secondary"},[S(r(P),{icon:"carbon:code",width:"14"}),se(" "+c(r(a)?F.$t("sidebar.hideJson"):F.$t("sidebar.showJson")),1)]),t("div",$r,[t("button",{class:"btn btn-sm",onClick:A[7]||(A[7]=(...D)=>r(b)&&r(b)(...D)),disabled:!(F.canRollback??!1),title:F.$t("sidebar.rollback")},[S(r(P),{icon:"carbon:undo",width:"14"})],8,wr),t("button",{class:"btn btn-sm",onClick:A[8]||(A[8]=(...D)=>r(C)&&r(C)(...D)),disabled:!(F.canRestore??!1),title:F.$t("sidebar.restore")},[S(r(P),{icon:"carbon:redo",width:"14"})],8,Sr),t("button",{class:"btn btn-primary",onClick:A[9]||(A[9]=(...D)=>r(M)&&r(M)(...D)),disabled:F.isGenerating||F.isExecuting},[S(r(P),{icon:"carbon:save",width:"14"}),A[11]||(A[11]=se(" 保存 "))],8,kr)])])])),S(Gs,{modelValue:R.value,"onUpdate:modelValue":A[10]||(A[10]=D=>R.value=D),tools:r(G).availableTools,"selected-tool-ids":m.value>=0?((B=r(l).steps[m.value])==null?void 0:B.selectedToolKeys)||[]:[],onConfirm:J},null,8,["modelValue","tools","selected-tool-ids"])])}}}),Pr=pe(Tr,[["__scopeId","data-v-11cf61de"]]),Er={class:"config-section"},Cr={class:"section-header"},Ir={class:"execution-content"},Rr={class:"params-requirements-group"},Ar={class:"params-help-text"},xr={key:0,class:"parameter-fields"},Dr={class:"parameter-label"},Mr=["onUpdate:modelValue","placeholder","onInput"],Nr={key:0,class:"parameter-error"},Ur={key:1,class:"validation-message"},Fr=["disabled"],Lr=["disabled"],Br={key:1,class:"call-example-wrapper"},Or={class:"internal-call-wrapper"},qr={class:"call-info"},jr={class:"call-endpoint"},Vr={key:0,class:"call-endpoint"},Hr={key:2,class:"call-example-wrapper"},Gr={class:"http-api-urls-wrapper"},zr={class:"tab-container"},Wr={class:"tab-header"},Jr=["onClick"],Kr={class:"tab-content"},Xr={class:"http-api-url-display"},Yr={class:"api-method"},Qr={class:"api-endpoint"},Zr={class:"api-description"},ei={key:0,class:"api-example"},ti={class:"example-code"},si={key:3,class:"call-example-wrapper"},ni=ue({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(o,{expose:e,emit:s}){const{t:n}=Pe(),a=o,l=s,i=U(""),h=U({parameters:[],hasParameters:!1,requirements:""}),g=U({}),u=U(!1),d=U("get-sync"),b=U({}),C=U(!1),M=U([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),_=de(()=>{var J,k,N;return((J=a.toolInfo)==null?void 0:J.enableInternalToolcall)||((k=a.toolInfo)==null?void 0:k.enableHttpService)||((N=a.toolInfo)==null?void 0:N.enableMcpService)}),y=de(()=>_.value?n("sidebar.updateServiceStatus"):n("sidebar.publishMcpService")),v=de(()=>a.isExecuting||a.isGenerating?!1:h.value.hasParameters?h.value.parameters.every(J=>{var k;return(k=g.value[J])==null?void 0:k.trim()}):!0),$=()=>{if(!j()){console.log("[ExecutionController] Parameter validation failed:",b.value);return}const J=h.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;l("executePlan",J)},E=()=>{l("publishMcpService")},w=()=>{i.value="",l("clearParams")},R=async()=>{if(!a.currentPlanTemplateId){h.value={parameters:[],hasParameters:!1,requirements:""},g.value={};return}u.value=!0;try{const J=await Nt.getParameterRequirements(a.currentPlanTemplateId);h.value=J;const k={};J.parameters.forEach(N=>{k[N]=g.value[N]||""}),g.value=k,x()}catch(J){console.error("Failed to load parameter requirements:",J),J instanceof Error&&!J.message.includes("404")&&console.warn("Parameter requirements not available yet, will retry later"),h.value={parameters:[],hasParameters:!1,requirements:""}}finally{u.value=!1}},m=(J,k)=>{g.value[J]=k,b.value[J]&&delete b.value[J],x()},j=()=>{if(b.value={},C.value=!1,!h.value.hasParameters)return!0;let J=!1;return h.value.parameters.forEach(k=>{var z;((z=g.value[k])==null?void 0:z.trim())||(b.value[k]=`${k} is required`,J=!0)}),C.value=J,!J},x=()=>{h.value.hasParameters?i.value=JSON.stringify(g.value,null,2):i.value="",l("updateExecutionParams",i.value)};return ie(()=>a.currentPlanTemplateId,(J,k)=>{J&&J!==k&&(k&&J.startsWith("planTemplate-")?setTimeout(()=>{R()},1e3):R())}),ie(()=>i.value,J=>{l("updateExecutionParams",J)}),we(()=>{R()}),e({executionParams:i,clearExecutionParams:w,loadParameterRequirements:R}),(J,k)=>{var N,z,F,A,B;return p(),f("div",Er,[t("div",Cr,[S(r(P),{icon:"carbon:play",width:"16"}),t("span",null,c(r(n)("sidebar.executionController")),1)]),t("div",Ir,[t("div",Rr,[t("label",null,c(r(n)("sidebar.parameterRequirements")),1),t("div",Ar,c(r(n)("sidebar.parameterRequirementsHelp")),1),h.value.hasParameters?(p(),f("div",xr,[(p(!0),f(oe,null,re(h.value.parameters,D=>(p(),f("div",{key:D,class:"parameter-field"},[t("label",Dr,[se(c(D)+" ",1),k[0]||(k[0]=t("span",{class:"required"},"*",-1))]),te(t("input",{"onUpdate:modelValue":Q=>g.value[D]=Q,class:ne(["parameter-input",{error:b.value[D]}]),placeholder:`Enter value for ${D}`,onInput:Q=>m(D,Q.target.value),required:""},null,42,Mr),[[le,g.value[D]]]),b.value[D]?(p(),f("div",Nr,c(b.value[D]),1)):O("",!0)]))),128))])):O("",!0),h.value.hasParameters&&!v.value&&!a.isExecuting&&!a.isGenerating?(p(),f("div",Ur,[S(r(P),{icon:"carbon:warning",width:"14"}),se(" "+c(r(n)("sidebar.fillAllRequiredParameters")),1)])):O("",!0)]),t("button",{class:"btn btn-primary execute-btn",onClick:$,disabled:!v.value},[S(r(P),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ne({spinning:a.isExecuting})},null,8,["icon","class"]),se(" "+c(a.isExecuting?r(n)("sidebar.executing"):r(n)("sidebar.executePlan")),1)],8,Fr),J.showPublishButton?(p(),f("button",{key:0,class:"btn publish-mcp-btn",onClick:E,disabled:!J.currentPlanTemplateId},[S(r(P),{icon:"carbon:application",width:"16"}),se(" "+c(y.value),1)],8,Lr)):O("",!0),(N=J.toolInfo)!=null&&N.enableInternalToolcall?(p(),f("div",Br,[k[4]||(k[4]=t("div",{class:"call-example-header"},[t("h4",{class:"call-example-title"},"内部调用"),t("p",{class:"call-example-description"},"你已经将这个plan-act 发布为内部方法，可以在agent配置的添加工具中，找到这个工具的方法并添加和使用。")],-1)),t("div",Or,[t("div",qr,[k[1]||(k[1]=t("div",{class:"call-method"},"内部方法调用",-1)),t("div",jr,"工具名称: "+c(((z=J.toolInfo)==null?void 0:z.toolName)||J.currentPlanTemplateId),1),(F=J.toolInfo)!=null&&F.serviceGroup?(p(),f("div",Vr,"服务组: "+c(J.toolInfo.serviceGroup),1)):O("",!0),k[2]||(k[2]=t("div",{class:"call-description"},"在agent配置中添加此工具后，可以直接在agent中调用此方法",-1)),k[3]||(k[3]=t("div",{class:"call-example"},[t("strong",null,"使用方式:"),t("pre",{class:"example-code"},'在agent配置的"添加工具"部分，搜索并添加此工具，然后在agent中直接调用')],-1))])])])):O("",!0),(A=J.toolInfo)!=null&&A.enableHttpService?(p(),f("div",Hr,[k[6]||(k[6]=t("div",{class:"call-example-header"},[t("h4",{class:"call-example-title"},"HTTP 调用示例"),t("p",{class:"call-example-description"},"你已经将这个plan-act发布为http服务，可以按照下面的例子进行调用。")],-1)),t("div",Gr,[t("div",zr,[t("div",Wr,[(p(!0),f(oe,null,re(M.value,D=>(p(),f("button",{key:D.id,class:ne(["tab-button",{active:d.value===D.id}]),onClick:Q=>d.value=D.id},c(D.label),11,Jr))),128))]),t("div",Kr,[(p(!0),f(oe,null,re(M.value,D=>te((p(),f("div",{key:D.id,class:"tab-panel"},[t("div",Xr,[t("div",Yr,c(D.method),1),t("div",Qr,c(D.endpoint),1),t("div",Zr,c(D.description),1),D.example?(p(),f("div",ei,[k[5]||(k[5]=t("strong",null,"Example:",-1)),t("pre",ti,c(D.example),1)])):O("",!0)])])),[[os,d.value===D.id]])),128))])])])])):O("",!0),(B=J.toolInfo)!=null&&B.enableMcpService?(p(),f("div",si,k[7]||(k[7]=[ns('<div class="call-example-header" data-v-41627040><h4 class="call-example-title" data-v-41627040>MCP 调用</h4><p class="call-example-description" data-v-41627040>你已经将这个plan-act 发布为mcp服务，可以通过 mcp streamable 或sse方式使用。</p></div><div class="mcp-call-wrapper" data-v-41627040><div class="call-info" data-v-41627040><div class="call-method" data-v-41627040>MCP 服务调用</div><div class="call-endpoint" data-v-41627040>MCP Endpoint: /mcp/execute</div><div class="call-description" data-v-41627040>通过MCP协议进行流式或SSE方式调用</div><div class="call-example" data-v-41627040><strong data-v-41627040>使用方式:</strong><pre class="example-code" data-v-41627040>通过MCP客户端连接到此服务，使用streamable或SSE方式进行调用</pre></div></div></div>',2)]))):O("",!0)])])}}}),oi=pe(ni,[["__scopeId","data-v-41627040"]]),ai={class:"config-section"},li={class:"section-header"},ri={class:"generator-content"},ii={class:"plan-type-selection"},ci={class:"form-label"},di={value:"simple"},ui={value:"dynamic_agent"},pi={key:0,class:"dynamic-agent-instruction"},hi=["placeholder"],mi={class:"generator-actions"},fi=["disabled"],vi=["disabled"],gi=ue({__name:"PlanGenerator",props:{generatorPrompt:{},jsonContent:{},isGenerating:{type:Boolean},planType:{default:"dynamic_agent"}},emits:["generatePlan","updatePlan","updateGeneratorPrompt","updatePlanType"],setup(o,{expose:e,emit:s}){const{t:n}=Pe(),a=o,l=s,i=U(a.generatorPrompt),h=U(a.planType);ie(()=>a.generatorPrompt,d=>{i.value=d}),ie(i,d=>{l("updateGeneratorPrompt",d)}),ie(()=>a.planType,d=>{h.value=d}),ie(h,d=>{l("updatePlanType",d)});const g=()=>{l("generatePlan")},u=()=>{l("updatePlan")};return e({generatorPrompt:i}),(d,b)=>(p(),f("div",ai,[t("div",li,[S(r(P),{icon:"carbon:generate",width:"16"}),t("span",null,c(r(n)("sidebar.planGenerator")),1)]),t("div",ri,[t("div",ii,[t("label",ci,c(r(n)("sidebar.planType")),1),te(t("select",{"onUpdate:modelValue":b[0]||(b[0]=C=>h.value=C),class:"form-select"},[t("option",di,c(r(n)("sidebar.simplePlan")),1),t("option",ui,c(r(n)("sidebar.dynamicAgentPlan")),1)],512),[[nt,h.value]])]),h.value==="dynamic_agent"?(p(),f("div",pi,b[2]||(b[2]=[t("textarea",{readonly:"",class:"instruction-textarea",rows:"2"},"使用动态智能体计划，只需要直接输入指令，不需要再走生成流程。请直接在动态智能体计划里面构建你的计划。",-1)]))):(p(),f(oe,{key:1},[te(t("textarea",{"onUpdate:modelValue":b[1]||(b[1]=C=>i.value=C),class:"prompt-input",placeholder:r(n)("sidebar.generatorPlaceholder"),rows:"3"},null,8,hi),[[le,i.value]]),t("div",mi,[t("button",{class:"btn btn-primary btn-sm",onClick:g,disabled:d.isGenerating||!i.value.trim()},[S(r(P),{icon:d.isGenerating?"carbon:circle-dash":"carbon:generate",width:"14",class:ne({spinning:d.isGenerating})},null,8,["icon","class"]),se(" "+c(d.isGenerating?r(n)("sidebar.generating"):r(n)("sidebar.generatePlan")),1)],8,fi),t("button",{class:"btn btn-secondary btn-sm",onClick:u,disabled:d.isGenerating||!i.value.trim()||!d.jsonContent.trim()},[S(r(P),{icon:"carbon:edit",width:"14"}),se(" "+c(r(n)("sidebar.updatePlan")),1)],8,vi)])],64))])]))}}),bi=pe(gi,[["__scopeId","data-v-65314db1"]]),yi={class:"sidebar-content"},_i={class:"sidebar-content-header"},$i={class:"sidebar-content-title"},wi={class:"tab-switcher"},Si=["disabled"],ki={key:0,class:"tab-content"},Ti={class:"new-task-section"},Pi={class:"sidebar-content-list"},Ei={key:0,class:"loading-state"},Ci={key:1,class:"error-state"},Ii={key:2,class:"empty-state"},Ri=["onClick"],Ai={class:"task-icon"},xi={class:"task-details"},Di={class:"task-title"},Mi={class:"task-preview"},Ni={class:"task-time"},Ui={class:"task-actions"},Fi=["title","onClick"],Li={key:1,class:"tab-content config-tab"},Bi={key:0,class:"config-container"},Oi={class:"template-info-header"},qi={class:"template-info"},ji={class:"template-id"},Vi=["title"],Hi=ue({__name:"Sidebar",emits:["planExecutionRequested"],setup(o,{expose:e,emit:s}){const{t:n}=Pe(),a=cs(),l=U(80),i=U(!1),h=U(0),g=U(0),u=U(null),d=U({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),b=U(null),C=U({enabled:!0,success:!0}),M=de(()=>C.value.enabled),_=async()=>{try{const T=await De.getCoordinatorToolConfig();C.value=T}catch(T){console.error("加载CoordinatorTool配置失败:",T),C.value={enabled:!0,success:!1,message:T instanceof Error?T.message:"Unknown error"}}},y=s,v=async()=>{try{const T=await G.saveTemplate();T!=null&&T.duplicate?a.success(n("sidebar.saveCompleted",{message:T.message,versionCount:T.versionCount})):T!=null&&T.saved?(a.success(n("sidebar.saveSuccess",{message:T.message,versionCount:T.versionCount})),$()):T!=null&&T.message&&a.success(n("sidebar.saveStatus",{message:T.message}))}catch(T){console.error("Failed to save plan modifications:",T),a.error(T.message||n("sidebar.saveFailed"))}},$=async()=>{await new Promise(T=>setTimeout(T,500)),u.value&&u.value.loadParameterRequirements(),b.value&&b.value.loadParameterRequirements()},E=async()=>{var T;try{await G.generatePlan(),a.success(n("sidebar.generateSuccess",{templateId:((T=G.selectedTemplate)==null?void 0:T.id)??n("sidebar.unknown")}))}catch(V){console.error("Failed to generate plan:",V),a.error(n("sidebar.generateFailed")+": "+V.message)}},w=async()=>{try{await G.updatePlan(),a.success(n("sidebar.updateSuccess"))}catch(T){console.error("Failed to update plan:",T),a.error(n("sidebar.updateFailed")+": "+T.message)}},R=()=>{try{G&&typeof G.rollbackVersion=="function"?G.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(T){console.error("Error during rollback operation:",T),a.error(n("sidebar.rollbackFailed")||"Rollback failed")}},m=()=>{try{G&&typeof G.restoreVersion=="function"?G.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(T){console.error("Error during restore operation:",T),a.error(n("sidebar.restoreFailed")||"Restore failed")}},j=async T=>{console.log("[Sidebar] handleExecutePlan called with replacementParams:",T);try{const V=G.preparePlanExecution();if(!V){console.log("[Sidebar] No plan data available, returning");return}T&&Object.keys(T).length>0&&(V.replacementParams=T,console.log("[Sidebar] Added replacement parameters to plan data:",T)),console.log("[Sidebar] Triggering plan execution request:",V),console.log("[Sidebar] Emitting planExecutionRequested event"),y("planExecutionRequested",{title:V.title,planData:V.planData,params:V.params,replacementParams:T}),console.log("[Sidebar] Event emitted")}catch(V){console.error("Error executing plan:",V),a.error(n("sidebar.executeFailed")+": "+V.message)}finally{G.finishPlanExecution()}},x=U(!1),J=()=>{if(console.log("[Sidebar] 发布MCP服务按钮被点击"),console.log("[Sidebar] currentPlanTemplateId:",G.currentPlanTemplateId),!G.currentPlanTemplateId){console.log("[Sidebar] 没有选择计划模板，显示警告"),a.error(n("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] 打开发布MCP服务模态框"),x.value=!0},k=T=>{T===null?(console.log("MCP服务删除成功"),a.success(n("mcpService.deleteSuccess")),d.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP服务发布成功:",T),a.success(n("mcpService.publishSuccess")),d.value={...T,toolName:T.toolName||"",serviceGroup:T.serviceGroup||""})},N=()=>{G.clearExecutionParams()},z=T=>{G.executionParams=T},F=T=>{G.generatorPrompt=T},A=T=>{G.planType=T},B=async T=>{if(!T){d.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const V=await De.getCoordinatorToolsByTemplate(T);V?d.value={...V,toolName:V.toolName||"",serviceGroup:V.serviceGroup||""}:d.value={toolName:"",toolDescription:"",planTemplateId:T,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(V){console.error("Failed to load tool information:",V),d.value={toolName:"",toolDescription:"",planTemplateId:T,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},D=T=>{if(isNaN(T.getTime()))return console.warn("Invalid date received:",T),n("time.unknown");const L=new Date().getTime()-T.getTime(),q=Math.floor(L/6e4),K=Math.floor(L/36e5),ve=Math.floor(L/864e5);return q<1?n("time.now"):q<60?n("time.minuteAgo",{count:q}):K<24?n("time.hourAgo",{count:K}):ve<30?n("time.dayAgo",{count:ve}):T.toLocaleDateString("zh-CN")},Q=(T,V)=>!T||T.length<=V?T:T.substring(0,V)+"...",Z=T=>{i.value=!0,h.value=T.clientX,g.value=l.value,document.addEventListener("mousemove",ce),document.addEventListener("mouseup",fe),document.body.style.cursor="col-resize",document.body.style.userSelect="none",T.preventDefault()},ce=T=>{if(!i.value)return;const V=window.innerWidth,q=(T.clientX-h.value)/V*100;let K=g.value+q;K=Math.max(15,Math.min(100,K)),l.value=K},fe=()=>{i.value=!1,document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",fe),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},W=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return ie(()=>G.currentPlanTemplateId,T=>{B(T)},{immediate:!0}),we(()=>{G.loadPlanTemplateList(),_(),G.loadAvailableTools();const T=localStorage.getItem("sidebarWidth");T&&(l.value=parseFloat(T))}),Te(()=>{document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",fe)}),e({loadPlanTemplateList:G.loadPlanTemplateList,toggleSidebar:G.toggleSidebar,currentPlanTemplateId:G.currentPlanTemplateId}),(T,V)=>{var L,q;return p(),f(oe,null,[t("div",{class:ne(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(G).isCollapsed}]),style:ze({width:l.value+"%"})},[t("div",yi,[t("div",_i,[t("div",$i,c(T.$t("sidebar.title")),1)]),t("div",wi,[t("button",{class:ne(["tab-button",{active:r(G).currentTab==="list"}]),onClick:V[0]||(V[0]=K=>r(G).switchToTab("list"))},[S(r(P),{icon:"carbon:list",width:"16"}),se(" "+c(T.$t("sidebar.templateList")),1)],2),t("button",{class:ne(["tab-button",{active:r(G).currentTab==="config"}]),onClick:V[1]||(V[1]=K=>r(G).switchToTab("config")),disabled:!r(G).selectedTemplate},[S(r(P),{icon:"carbon:settings",width:"16"}),se(" "+c(T.$t("sidebar.configuration")),1)],10,Si)]),r(G).currentTab==="list"?(p(),f("div",ki,[t("div",Ti,[t("button",{class:"new-task-btn",onClick:V[2]||(V[2]=K=>r(G).createNewTemplate(r(G).planType))},[S(r(P),{icon:"carbon:add",width:"16"}),se(" "+c(T.$t("sidebar.newPlan"))+" ",1),V[8]||(V[8]=t("span",{class:"shortcut"},"⌘ K",-1))])]),t("div",Pi,[r(G).isLoading?(p(),f("div",Ei,[S(r(P),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),t("span",null,c(T.$t("sidebar.loading")),1)])):r(G).errorMessage?(p(),f("div",Ci,[S(r(P),{icon:"carbon:warning",width:"20"}),t("span",null,c(r(G).errorMessage),1),t("button",{onClick:V[3]||(V[3]=(...K)=>r(G).loadPlanTemplateList&&r(G).loadPlanTemplateList(...K)),class:"retry-btn"},c(T.$t("sidebar.retry")),1)])):r(G).planTemplateList.length===0?(p(),f("div",Ii,[S(r(P),{icon:"carbon:document",width:"32"}),t("span",null,c(T.$t("sidebar.noTemplates")),1)])):(p(!0),f(oe,{key:3},re(r(G).sortedTemplates,K=>(p(),f("div",{key:K.id,class:ne(["sidebar-content-list-item",{"sidebar-content-list-item-active":K.id===r(G).currentPlanTemplateId}]),onClick:ve=>r(G).selectTemplate(K)},[t("div",Ai,[S(r(P),{icon:"carbon:document",width:"20"})]),t("div",xi,[t("div",Di,c(K.title||T.$t("sidebar.unnamedPlan")),1),t("div",Mi,c(Q(K.description||T.$t("sidebar.noDescription"),40)),1)]),t("div",Ni,c(D(r(G).parseDateTime(K.updateTime||K.createTime))),1),t("div",Ui,[t("button",{class:"delete-task-btn",title:T.$t("sidebar.deleteTemplate"),onClick:he(ve=>r(G).deleteTemplate(K),["stop"])},[S(r(P),{icon:"carbon:close",width:"16"})],8,Fi)])],10,Ri))),128))])])):r(G).currentTab==="config"?(p(),f("div",Li,[r(G).selectedTemplate?(p(),f("div",Bi,[t("div",Oi,[t("div",qi,[t("h3",null,c(r(G).selectedTemplate.title||T.$t("sidebar.unnamedPlan")),1),t("span",ji,"ID: "+c(r(G).selectedTemplate.id),1)]),t("button",{class:"back-to-list-btn",onClick:V[4]||(V[4]=K=>r(G).switchToTab("list"))},[S(r(P),{icon:"carbon:arrow-left",width:"16"})])]),S(bi,{"generator-prompt":r(G).generatorPrompt,"json-content":r(G).jsonContent,"is-generating":r(G).isGenerating,"plan-type":r(G).planType,onGeneratePlan:E,onUpdatePlan:w,onUpdateGeneratorPrompt:F,onUpdatePlanType:A},null,8,["generator-prompt","json-content","is-generating","plan-type"]),r(G).planType==="dynamic_agent"?(p(),ae(Pr,{key:0,"json-content":r(G).jsonContent,"can-rollback":r(G).canRollback,"can-restore":r(G).canRestore,"is-generating":r(G).isGenerating,"is-executing":r(G).isExecuting,"current-plan-template-id":r(G).currentPlanTemplateId||"",onRollback:R,onRestore:m,onSave:v,"onUpdate:jsonContent":V[5]||(V[5]=K=>r(G).jsonContent=K)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),ae(Go,{key:1,"json-content":r(G).jsonContent,"can-rollback":r(G).canRollback,"can-restore":r(G).canRestore,"is-generating":r(G).isGenerating,"is-executing":r(G).isExecuting,"current-plan-template-id":r(G).currentPlanTemplateId||"",onRollback:R,onRestore:m,onSave:v,"onUpdate:jsonContent":V[6]||(V[6]=K=>r(G).jsonContent=K)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),S(oi,{ref_key:"executionControllerRef",ref:u,"current-plan-template-id":r(G).currentPlanTemplateId||"","is-executing":r(G).isExecuting,"is-generating":r(G).isGenerating,"show-publish-button":M.value,"tool-info":d.value,onExecutePlan:j,onPublishMcpService:J,onClearParams:N,onUpdateExecutionParams:z},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):O("",!0)])):O("",!0)]),t("div",{class:"sidebar-resizer",onMousedown:Z,onDblclick:W,title:T.$t("sidebar.resizeHint")},V[9]||(V[9]=[t("div",{class:"resizer-line"},null,-1)]),40,Vi)],6),S(Zn,{ref_key:"publishMcpModalRef",ref:b,modelValue:x.value,"onUpdate:modelValue":V[7]||(V[7]=K=>x.value=K),"plan-template-id":r(G).currentPlanTemplateId||"","plan-title":((L=r(G).selectedTemplate)==null?void 0:L.title)||"","plan-description":((q=r(G).selectedTemplate)==null?void 0:q.description)||"",onPublished:k},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),Gi=pe(Hi,[["__scopeId","data-v-a2158c71"]]);class pt{static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const s=await fetch(`${this.BASE_URL}/single?memoryId=${e}`);return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to get memory :",s),s}}static async update(e,s){try{const n=await fetch(`${this.BASE_URL}/update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memoryId:e,memoryName:s})});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to update memory:",n),n}}static async delete(e){try{const s=await fetch(`${this.BASE_URL}/delete?memoryId=${e}`);await this.handleResponse(s)}catch(s){throw console.error("Failed to update memory:",s),s}}}ge(pt,"BASE_URL","/api/memories");class zi{constructor(){ge(this,"isCollapsed",!1);ge(this,"selectMemoryId","");ge(this,"loadMessages",()=>{});ge(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Ue=st(new zi),Wi={key:0,class:"app-container"},Ji={class:"app-content"},Ki={class:"header"},Xi={class:"relative"},Yi={class:"title-edit-group"},Qi={id:"main-title",class:"main-title"},Zi={key:0,id:"title-edit-container",class:"title-edit-container"},ec={class:"search-bar"},tc={class:"search-container"},sc=["placeholder"],nc={class:"message-list",id:"message-list"},oc={class:"message-header"},ac={class:"message-content"},lc={class:"sender-info"},rc=["onClick"],ic={class:"sender-name"},cc=["onClick"],dc={class:"action-buttons"},uc=["onClick"],pc={class:"action-buttons"},hc=["onClick"],mc={class:"message-preview"},fc={class:"preview-line"},vc={key:0,class:"preview-line",style:{opacity:"0.8"}},gc={class:"message-meta"},bc={class:"message-id"},yc={class:"meta-right"},_c={key:0,class:"unread-count"},$c={class:"message-time"},wc=["id"],Sc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},kc={class:"bubble-avatar"},Tc={class:"bubble-content"},Pc={class:"bubble-text"},Ec={key:0,class:"empty-state"},Cc={class:"modal-content"},Ic={class:"modal-header"},Rc={class:"modal-title"},Ac=["placeholder"],xc={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},Dc={class:"modal-footer"},Mc={class:"modal-content"},Nc={class:"modal-header"},Uc={class:"modal-title"},Fc={class:"state-text",id:"delete-message"},Lc={class:"modal-footer"},Bc=ue({__name:"Memory",emits:["memory-selected"],setup(o,{emit:e}){const s=U(!1),n=U(""),a=U([]),l=U([]),i=U(!1),h=U(null),g=U(""),u=U(!1),d=U(null),b=new Map,C=e,M=k=>{k.key==="Escape"&&(u.value?x():i.value&&w())};we(()=>{Ue.setLoadMessages(_),document.addEventListener("keydown",M)}),Te(()=>{document.removeEventListener("keydown",M)});const _=async()=>{try{const k=await pt.getMemories();a.value?a.value=k.map(N=>({...N,expanded:b.has(N.memoryId)?b.get(N.memoryId):!1})):a.value=k.map(N=>({...N,expanded:!1})),l.value=[...a.value],$()}catch(k){console.error("error:",k),a.value=[],l.value=[]}},y=k=>{Ue.selectMemory(k),C("memory-selected")},v=k=>{const N=typeof k=="string"?parseInt(k,10):k;return isNaN(N)||N<=0?"unknow time":new Date(N.toString().length===13?N:N*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},$=()=>{const k=n.value.toLowerCase().trim();if(!k){l.value=[...a.value];return}l.value=a.value.filter(N=>{const z=N.memoryName.toLowerCase().includes(k),F=N.memoryId.toLowerCase().includes(k),A=N.messages.some(B=>B.text.toLowerCase().includes(k));return z||F||A})},E=(k,N)=>{h.value=k,g.value=N,i.value=!0},w=()=>{i.value=!1,h.value=null},R=async()=>{if(!h.value)return;const k=g.value.trim()||"unknow name",N=a.value.findIndex(z=>z.memoryId===h.value);if(N!==-1){const z=a.value[N];try{const F=await pt.update(z.memoryId,k);F.messages||(F.messages=[]),a.value[N]={...F,expanded:z.expanded},$(),i.value=!1}catch(F){console.error("error:",F)}}},m=k=>{const N=a.value.find(z=>z.memoryId===k);if(N){N.expanded=!N.expanded,b.set(k,N.expanded);const z=l.value.findIndex(F=>F.memoryId===k);z!==-1&&(l.value[z]={...N})}},j=k=>{d.value=k,u.value=!0},x=()=>{u.value=!1,d.value=null},J=async()=>{if(d.value)try{await pt.delete(d.value),a.value=a.value.filter(k=>k.memoryId!==d.value),$(),a.value.length===0&&Ue.clearMemoryId(),u.value=!1,d.value=null}catch(k){console.error("error:",k)}};return(k,N)=>(p(),ae(Qe,{to:"body"},[S(qe,{name:"modal"},{default:Me(()=>[r(Ue).isCollapsed?(p(),f("div",Wi,[t("div",Ji,[t("div",Ki,[t("div",Xi,[t("div",Yi,[t("h1",Qi,[t("span",null,c(k.$t("memory.title")),1)])]),s.value?(p(),f("div",Zi)):O("",!0)]),t("button",{class:"close-btn",onClick:N[0]||(N[0]=z=>r(Ue).toggleSidebar())},[S(r(P),{icon:"carbon:close"})])]),t("div",ec,[t("div",tc,[S(r(P),{class:"search-container-icon",icon:"carbon:search"}),te(t("input",{type:"text",placeholder:k.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":N[1]||(N[1]=z=>n.value=z),onInput:$},null,40,sc),[[le,n.value]])])]),t("div",nc,[t("div",null,[(p(!0),f(oe,null,re(l.value,z=>(p(),f("div",{class:ne(["message-item",{expanded:z.expanded}]),key:z.memoryId},[t("div",oc,[t("div",ac,[t("div",lc,[t("div",{class:"sender-div",onClick:he(F=>y(z.memoryId),["stop"])},[t("h3",ic,c(z.memoryName),1)],8,rc),t("div",{class:"toggle-container",onClick:he(F=>E(z.memoryId,z.memoryName),["stop"])},[S(r(P),{icon:"carbon:edit",class:"edit-btn"})],8,cc),t("div",dc,[t("button",{class:"delete-btn",onClick:he(F=>m(z.memoryId),["stop"])},[S(r(P),{id:"toggle-"+z.memoryId,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,uc)]),t("div",pc,[t("button",{class:"delete-btn",onClick:he(F=>j(z.memoryId),["stop"])},[S(r(P),{icon:"carbon:delete"})],8,hc)])]),t("div",mc,[t("p",fc,c(z.messages.length>0?z.messages[0].text:"none message"),1),z.messages.length>1?(p(),f("p",vc,c(z.messages[1].text),1)):O("",!0)]),t("div",gc,[t("span",bc,"ID: "+c(z.memoryId),1),t("div",yc,[z.messages.length>0?(p(),f("span",_c,c(z.messages.length)+" "+c(k.$t("memory.size")),1)):O("",!0),t("span",$c,c(v(z.createTime)),1)])])])]),z.expanded?(p(),f("div",{key:0,id:"content-"+z.memoryId,class:"expanded-content"},[t("div",Sc,[(p(!0),f(oe,null,re(z.messages,(F,A)=>(p(),f("div",{class:"message-bubble",key:A},[t("div",kc,c(F.messageType),1),t("div",Tc,[t("p",Pc,c(F.text),1)])]))),128))])],8,wc)):O("",!0)],2))),128))]),l.value.length===0&&n.value?(p(),f("div",Ec,N[3]||(N[3]=[t("p",{class:"state-text"},"none message",-1)]))):O("",!0)]),i.value?(p(),f("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:he(w,["self"])},[t("div",Cc,[t("div",Ic,[t("h3",Rc,c(k.$t("memory.changeName")),1),te(t("input",{type:"text","onUpdate:modelValue":N[2]||(N[2]=z=>g.value=z),class:"edit-input",placeholder:k.$t("memory.newNamePlaceholder")},null,8,Ac),[[le,g.value]]),t("span",xc,c(g.value.length),1)]),t("div",Dc,[t("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:w},c(k.$t("memory.cancel")),1),t("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:R},c(k.$t("memory.save")),1)])])])):O("",!0),u.value?(p(),f("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:he(x,["self"])},[t("div",Mc,[t("div",Nc,[t("h3",Uc,c(k.$t("memory.deleteHint")),1),t("p",Fc,c(k.$t("memory.deleteHintPrefix"))+" "+c(d.value)+" "+c(k.$t("memory.deleteHintSuffix")),1)]),t("div",Lc,[t("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:x},c(k.$t("memory.cancel")),1),t("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:J},c(k.$t("memory.delete")),1)])])])):O("",!0)])])):O("",!0)]),_:1})]))}}),Oc=pe(Bc,[["__scopeId","data-v-e212f55a"]]),qc="/api/executor";async function Us(o){try{const e=await fetch(`${qc}/agent-execution/${o}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,e),null}}async function jc(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),Us(o)}class Le{static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const s=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(s)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(s){throw console.error("Failed to get file tree:",s),s}}static async getFileContent(e,s){try{const n=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(s)}`),l=await(await this.handleResponse(n)).json();if(!l.success)throw new Error(l.message||"Failed to get file content");return l.data}catch(n){throw console.error("Failed to get file content:",n),n}}static async downloadFile(e,s,n){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(s)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),h=document.createElement("a");h.href=i,h.download=n||s.split("/").pop()||"download",document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(i),document.body.removeChild(h)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,s){const n=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(n.some(i=>e.startsWith(i)))return!0;const l=s.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const s=e.name.toLowerCase();return s.endsWith(".js")?"vscode-icons:file-type-js":s.endsWith(".ts")?"vscode-icons:file-type-typescript":s.endsWith(".vue")?"vscode-icons:file-type-vue":s.endsWith(".java")?"vscode-icons:file-type-java":s.endsWith(".py")?"vscode-icons:file-type-python":s.endsWith(".json")?"vscode-icons:file-type-json":s.endsWith(".xml")?"vscode-icons:file-type-xml":s.endsWith(".html")?"vscode-icons:file-type-html":s.endsWith(".css")?"vscode-icons:file-type-css":s.endsWith(".md")?"vscode-icons:file-type-markdown":s.endsWith(".yml")||s.endsWith(".yaml")?"vscode-icons:file-type-yaml":s.endsWith(".pdf")?"vscode-icons:file-type-pdf2":s.endsWith(".doc")||s.endsWith(".docx")?"vscode-icons:file-type-word":s.endsWith(".xls")||s.endsWith(".xlsx")?"vscode-icons:file-type-excel":s.endsWith(".ppt")||s.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":s.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":s.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}ge(Le,"BASE_URL","/api/file-browser");const Vc={class:"file-tree-node"},Hc={class:"node-icon"},Gc={class:"node-name"},zc={key:1,class:"file-size"},Wc={key:2,class:"node-actions"},Jc={key:0,class:"children"},Kc=ue({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:e}){const s=o,n=e,a=U(s.level===0),l=U(!1),i=U(!1),h=U({}),g=()=>{s.node.type==="directory"&&(a.value=!a.value)},u=()=>{s.node.type==="directory"?g():d()},d=()=>{s.node.type==="file"&&n("file-selected",s.node),M()},b=()=>{n("download-file",s.node),M()},C=$=>{$.preventDefault(),i.value=!0,h.value={position:"fixed",top:`${$.clientY}px`,left:`${$.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",M)},0)},M=()=>{i.value=!1,document.removeEventListener("click",M)},_=async()=>{try{await navigator.clipboard.writeText(s.node.path)}catch($){console.error("Failed to copy path:",$)}M()},y=()=>s.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Le.getFileIcon(s.node),v=$=>{if($===0)return"0 B";const E=1024,w=["B","KB","MB","GB"],R=Math.floor(Math.log($)/Math.log(E));return parseFloat(($/Math.pow(E,R)).toFixed(1))+" "+w[R]};return Te(()=>{document.removeEventListener("click",M)}),($,E)=>{const w=as("FileTreeNode",!0);return p(),f("div",Vc,[t("div",{class:ne(["node-content",{"is-directory":$.node.type==="directory","is-file":$.node.type==="file","is-expanded":a.value}]),style:ze({paddingLeft:`${$.level*16+12}px`}),onClick:u,onContextmenu:he(C,["prevent"])},[$.node.type==="directory"?(p(),f("div",{key:0,class:"expand-icon",onClick:he(g,["stop"])},[S(r(P),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):O("",!0),t("div",Hc,[S(r(P),{icon:y()},null,8,["icon"])]),t("span",Gc,c($.node.name),1),$.node.type==="file"?(p(),f("span",zc,c(v($.node.size)),1)):O("",!0),l.value?(p(),f("div",Wc,[$.node.type==="file"?(p(),f("button",{key:0,onClick:E[0]||(E[0]=he(R=>$.$emit("download-file",$.node),["stop"])),class:"action-btn download-btn",title:"Download"},[S(r(P),{icon:"carbon:download"})])):O("",!0)])):O("",!0)],38),$.node.type==="directory"&&a.value&&$.node.children?(p(),f("div",Jc,[(p(!0),f(oe,null,re($.node.children,R=>(p(),ae(w,{key:R.path,node:R,level:$.level+1,onFileSelected:E[1]||(E[1]=m=>$.$emit("file-selected",m)),onDownloadFile:E[2]||(E[2]=m=>$.$emit("download-file",m))},null,8,["node","level"]))),128))])):O("",!0),i.value?(p(),f("div",{key:1,class:"context-menu",style:ze(h.value),onClick:E[3]||(E[3]=he(()=>{},["stop"]))},[t("div",{class:"context-menu-item",onClick:d},[S(r(P),{icon:"carbon:view"}),E[4]||(E[4]=t("span",null,"Open",-1))]),$.node.type==="file"?(p(),f("div",{key:0,class:"context-menu-item",onClick:b},[S(r(P),{icon:"carbon:download"}),E[5]||(E[5]=t("span",null,"Download",-1))])):O("",!0),E[7]||(E[7]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:_},[S(r(P),{icon:"carbon:copy"}),E[6]||(E[6]=t("span",null,"Copy Path",-1))])],4)):O("",!0)])}}}),Xc=pe(Kc,[["__scopeId","data-v-e4a376d5"]]),Yc={class:"file-browser"},Qc={class:"file-browser-header"},Zc={class:"header-actions"},ed=["disabled","title"],td={class:"file-browser-content"},sd={class:"file-tree-panel"},nd={key:0,class:"loading-state"},od={key:1,class:"error-state"},ad={key:0,class:"waiting-for-files"},ld={class:"message-content"},rd={class:"tips"},id=["disabled"],cd={key:1,class:"actual-error"},dd={key:2,class:"empty-state"},ud={key:3,class:"file-tree"},pd={key:0,class:"file-content-panel"},hd={class:"file-content-header"},md={class:"file-info"},fd={class:"file-name"},vd={class:"file-size"},gd={class:"file-actions"},bd=["title"],yd=["title"],_d={class:"file-content-body"},$d={key:0,class:"loading-content"},wd={key:1,class:"content-error"},Sd={key:2,class:"file-content"},kd={key:0,class:"text-content"},Td={key:1,class:"binary-content"},Pd=ue({__name:"index",props:{planId:{}},setup(o){const e=o,{t:s}=Pe(),n=U(!1),a=U(null),l=U(null),i=U(null),h=U(null),g=U(!1),u=U(null),d=U(null),b=de(()=>!h.value||!i.value?!1:Le.isTextFile(h.value.mimeType,i.value.name)),C=de(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),M=()=>{d.value&&(clearTimeout(d.value),d.value=null)},_=()=>{M(),d.value=window.setTimeout(()=>{C.value&&y()},5e3)},y=async()=>{if(e.planId){n.value=!0,a.value=null,M();try{l.value=await Le.getFileTree(e.planId)}catch(m){a.value=m instanceof Error?m.message:s("fileBrowser.loadError"),console.error("Failed to load file tree:",m);const j=m instanceof Error?m.message:"";(j.includes("Plan directory not found")||j.includes("not found"))&&_()}finally{n.value=!1}}},v=async m=>{if(m.type!=="directory"){i.value=m,h.value=null,g.value=!0,u.value=null;try{h.value=await Le.getFileContent(e.planId,m.path)}catch(j){u.value=j instanceof Error?j.message:s("fileBrowser.contentLoadError"),console.error("Failed to load file content:",j)}finally{g.value=!1}}},$=async m=>{try{await Le.downloadFile(e.planId,m.path,m.name)}catch(j){console.error("Failed to download file:",j)}},E=()=>{i.value=null,h.value=null,u.value=null},w=m=>Le.getFileIcon(m),R=m=>{if(m===0)return"0 B";const j=1024,x=["B","KB","MB","GB"],J=Math.floor(Math.log(m)/Math.log(j));return parseFloat((m/Math.pow(j,J)).toFixed(1))+" "+x[J]};return ie(()=>e.planId,m=>{m&&(i.value=null,h.value=null,y())},{immediate:!0}),we(()=>{e.planId&&y()}),Te(()=>{M()}),(m,j)=>(p(),f("div",Yc,[t("div",Qc,[t("h3",null,c(m.$t("fileBrowser.title")),1),t("div",Zc,[t("button",{class:"refresh-btn",onClick:y,disabled:n.value,title:m.$t("fileBrowser.refresh")},[S(r(P),{icon:"carbon:refresh",class:ne({rotating:n.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,ed)])]),t("div",td,[t("div",sd,[n.value?(p(),f("div",nd,[S(r(P),{icon:"carbon:loading",class:"rotating"}),t("span",null,c(m.$t("fileBrowser.loading")),1)])):a.value?(p(),f("div",od,[C.value?(p(),f("div",ad,[S(r(P),{icon:"carbon:time",class:"rotating"}),t("div",ld,[t("h3",null,c(m.$t("fileBrowser.waitingForGeneration")),1),t("p",null,c(m.$t("fileBrowser.planExecuting")),1),t("div",rd,[S(r(P),{icon:"carbon:information"}),t("span",null,c(m.$t("fileBrowser.filesTip")),1)])]),t("button",{onClick:y,class:"retry-btn",disabled:n.value},[S(r(P),{icon:"carbon:refresh",class:ne({rotating:n.value})},null,8,["class"]),se(" "+c(n.value?m.$t("fileBrowser.checking"):m.$t("fileBrowser.checkNow")),1)],8,id)])):(p(),f("div",cd,[S(r(P),{icon:"carbon:warning"}),t("span",null,c(a.value),1),t("button",{onClick:y,class:"retry-btn"},c(m.$t("fileBrowser.retry")),1)]))])):l.value?(p(),f("div",ud,[S(Xc,{node:l.value,level:0,onFileSelected:v,onDownloadFile:$},null,8,["node"])])):(p(),f("div",dd,[S(r(P),{icon:"carbon:folder-off"}),t("span",null,c(m.$t("fileBrowser.noFiles")),1)]))]),i.value?(p(),f("div",pd,[t("div",hd,[t("div",md,[S(r(P),{icon:w(i.value)},null,8,["icon"]),t("span",fd,c(i.value.name),1),t("span",vd,"("+c(R(i.value.size))+")",1)]),t("div",gd,[t("button",{onClick:j[0]||(j[0]=x=>$(i.value)),class:"download-btn",title:m.$t("fileBrowser.download")},[S(r(P),{icon:"carbon:download"})],8,bd),t("button",{onClick:E,class:"close-btn",title:m.$t("common.close")},[S(r(P),{icon:"carbon:close"})],8,yd)])]),t("div",_d,[g.value?(p(),f("div",$d,[S(r(P),{icon:"carbon:loading",class:"rotating"}),t("span",null,c(m.$t("fileBrowser.loadingContent")),1)])):u.value?(p(),f("div",wd,[S(r(P),{icon:"carbon:warning"}),t("span",null,c(u.value),1)])):h.value?(p(),f("div",Sd,[b.value?(p(),f("div",kd,[t("pre",null,[t("code",null,c(h.value.content),1)])])):(p(),f("div",Td,[S(r(P),{icon:"carbon:document-unknown"}),t("p",null,c(m.$t("fileBrowser.binaryFile")),1),t("button",{onClick:j[1]||(j[1]=x=>$(i.value)),class:"download-btn-large"},[S(r(P),{icon:"carbon:download"}),se(" "+c(m.$t("fileBrowser.downloadToView")),1)])]))])):O("",!0)])])):O("",!0)])]))}}),Ed=pe(Pd,[["__scopeId","data-v-e7c74fe4"]]),Cd={class:"right-panel"},Id={class:"preview-header"},Rd={class:"preview-tabs"},Ad={class:"preview-content"},xd={key:0,class:"step-details"},Dd={key:0,class:"step-info"},Md={key:0,class:"agent-info"},Nd={class:"info-item"},Ud={class:"label"},Fd={class:"value"},Ld={class:"info-item"},Bd={class:"label"},Od={class:"value"},qd={class:"info-item"},jd={class:"label"},Vd={class:"execution-status"},Hd={class:"status-item"},Gd={class:"status-text"},zd={key:0},Wd={key:0,class:"think-act-steps"},Jd={class:"steps-container"},Kd={class:"step-header"},Xd={class:"step-number"},Yd={class:"think-section"},Qd={class:"think-content"},Zd={class:"input"},eu={class:"label"},tu={class:"output"},su={class:"label"},nu={key:0,class:"action-section"},ou={class:"action-content"},au={class:"tool-info"},lu={class:"label"},ru={class:"value"},iu={class:"input"},cu={class:"label"},du={class:"output"},uu={class:"label"},pu={key:0,class:"sub-plan-section"},hu={class:"sub-plan-content"},mu={class:"sub-plan-header"},fu={class:"sub-plan-info"},vu={class:"label"},gu={class:"value"},bu={key:0,class:"sub-plan-info"},yu={class:"label"},_u={class:"value"},$u={class:"sub-plan-status"},wu={class:"status-text"},Su={key:0,class:"no-steps-message"},ku={key:1,class:"no-execution-message"},Tu={class:"step-basic-info"},Pu={class:"info-item"},Eu={class:"label"},Cu={class:"value"},Iu={key:0,class:"info-item"},Ru={class:"label"},Au={class:"value"},xu={class:"info-item"},Du={class:"label"},Mu={class:"no-execution-hint"},Nu={key:2,class:"execution-indicator"},Uu={class:"execution-text"},Fu={key:1,class:"no-selection"},Lu=["title"],Bu={key:1,class:"file-browser-container"},Ou={key:1,class:"no-plan-message"},qu={class:"message-content"},ju={class:"tips"},Vu=ue({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:e}){const s=o,{t:n}=Pe(),a=U(),l=U(),i=U("details"),h=U(localStorage.getItem("jmanus-last-plan-id")),g=U(localStorage.getItem("jmanus-has-executed-plan")==="true"),u=U(!1),d=U(!0),b=U(!0),C=de(()=>l.value?l.value.completed?n("rightPanel.status.completed"):l.value.current?n("rightPanel.status.executing"):n("rightPanel.status.waiting"):""),M=de(()=>s.currentRootPlanId?s.currentRootPlanId:h.value),_=de(()=>!M.value&&!g.value),y=async k=>{var N,z,F;if(console.log("[RightPanel] Step selected:",{stepId:k}),!k){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const A=await Us(k);if(!A){console.warn("[RightPanel] Agent execution detail not found for stepId:",k),l.value=null;return}const B={stepId:k,title:A.agentName||`Step ${k}`,description:A.agentDescription||"",agentExecution:A,completed:A.status==="FINISHED",current:A.status==="RUNNING"};l.value=B,console.log("[RightPanel] Step details updated:",B),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(N=l.value.agentExecution)==null?void 0:N.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(F=(z=l.value.agentExecution)==null?void 0:z.thinkActSteps)==null?void 0:F.length),await ke(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{E()},100),R()}catch(A){console.error("[RightPanel] Error fetching step details:",A),l.value=null}},v=async()=>{var k;if(!((k=l.value)!=null&&k.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const N=await jc(l.value.stepId);N&&l.value&&(l.value.agentExecution=N,l.value.completed=N.status==="FINISHED",l.value.current=N.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),R())}catch(N){console.error("[RightPanel] Error refreshing step:",N)}};ie(()=>s.selectedStepId,async k=>{k?await y(k):l.value=null},{immediate:!0});const $=k=>{a.value=k??void 0},E=()=>{if(!a.value)return;const{scrollTop:k,scrollHeight:N,clientHeight:z}=a.value,F=N-k-z<50,A=N>z;d.value=F,u.value=A&&!F,F?b.value=!0:N-k-z>100&&(b.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:k,scrollHeight:N,clientHeight:z,isAtBottom:F,hasScrollableContent:A,showButton:u.value,shouldAutoScroll:b.value})},w=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),ke(()=>{b.value=!0,E()}))},R=()=>{!b.value||!a.value||ke(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},m=k=>{if(k===null||typeof k>"u"||k==="")return"N/A";try{const N=typeof k=="object"?k:JSON.parse(k);return JSON.stringify(N,null,2)}catch{return String(k)}},j=()=>{l.value=null,b.value=!0,a.value&&a.value.removeEventListener("scroll",E)},x=()=>{const k=()=>{const N=a.value;return N?($(N),N.addEventListener("scroll",E),b.value=!0,E(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ke(()=>{k()||setTimeout(()=>{k()},100)})};return ie(()=>s.currentRootPlanId,(k,N)=>{k&&k!==N?(h.value=k,g.value=!0,localStorage.setItem("jmanus-last-plan-id",k),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",k)):!k&&N&&console.log("[RightPanel] Plan execution finished, keeping last plan:",h.value)},{immediate:!0}),we(()=>{console.log("[RightPanel] Component mounted"),ke(()=>{x()})}),Te(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),j()}),e({handleStepSelected:y,refreshCurrentStep:v,updateDisplayedPlanProgress:k=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",k),k&&(h.value=k,g.value=!0,localStorage.setItem("jmanus-last-plan-id",k),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",k))}}),(k,N)=>{var z,F;return p(),f("div",Cd,[t("div",Id,[t("div",Rd,[t("div",{class:ne(["tab-item",{active:i.value==="details"}]),onClick:N[0]||(N[0]=A=>i.value="details")},[S(r(P),{icon:"carbon:events"}),t("span",null,c(r(n)("rightPanel.stepExecutionDetails")),1)],2),t("div",{class:ne(["tab-item",{active:i.value==="files"}]),onClick:N[1]||(N[1]=A=>i.value="files")},[S(r(P),{icon:"carbon:folder"}),t("span",null,c(r(n)("fileBrowser.title")),1)],2)])]),t("div",Ad,[i.value==="details"?(p(),f("div",xd,[l.value?(p(),f("div",Dd,[t("h3",null,c(l.value.title||l.value.description||r(n)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),f("div",Md,[t("div",Nd,[t("span",Ud,c(r(n)("rightPanel.executingAgent"))+":",1),t("span",Fd,c(l.value.agentExecution.agentName),1)]),t("div",Ld,[t("span",Bd,c(r(n)("rightPanel.callingModel"))+":",1),t("span",Od,c(l.value.agentExecution.modelName),1)]),t("div",qd,[t("span",jd,c(r(n)("rightPanel.executionResult"))+":",1),t("span",{class:ne(["value",{success:l.value.agentExecution.status==="FINISHED"}])},c(l.value.agentExecution.status||r(n)("rightPanel.executing")),3)])])):O("",!0),t("div",Vd,[t("div",Hd,[l.value.completed?(p(),ae(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),ae(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),ae(r(P),{key:2,icon:"carbon:time",class:"status-icon pending"})),t("span",Gd,c(C.value),1)])])])):O("",!0),t("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:E},[l.value?(p(),f("div",zd,[(z=l.value.agentExecution)!=null&&z.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),f("div",Wd,[t("h4",null,c(r(n)("rightPanel.thinkAndActionSteps")),1),t("div",Jd,[(p(!0),f(oe,null,re(l.value.agentExecution.thinkActSteps,(A,B)=>(p(),f("div",{key:B,class:"think-act-step"},[t("div",Kd,[t("span",Xd,"#"+c(B+1),1),t("span",{class:ne(["step-status",A.status])},c(A.status||r(n)("rightPanel.executing")),3)]),t("div",Yd,[t("h5",null,[S(r(P),{icon:"carbon:thinking"}),se(" "+c(r(n)("rightPanel.thinking")),1)]),t("div",Qd,[t("div",Zd,[t("span",eu,c(r(n)("rightPanel.input"))+":",1),t("pre",null,c(m(A.thinkInput)),1)]),t("div",tu,[t("span",su,c(r(n)("rightPanel.output"))+":",1),t("pre",null,c(m(A.thinkOutput)),1)])])]),A.actionNeeded?(p(),f("div",nu,[t("h5",null,[S(r(P),{icon:"carbon:play"}),se(" "+c(r(n)("rightPanel.action")),1)]),t("div",ou,[(p(!0),f(oe,null,re(A.actToolInfoList,(D,Q)=>(p(),f("div",{key:Q},[t("div",au,[t("span",lu,c(r(n)("rightPanel.tool"))+":",1),t("span",ru,c(D.name||""),1)]),t("div",iu,[t("span",cu,c(r(n)("rightPanel.toolParameters"))+":",1),t("pre",null,c(m(D.parameters)),1)]),t("div",du,[t("span",uu,c(r(n)("rightPanel.executionResult"))+":",1),t("pre",null,c(m(D.result)),1)])]))),128))]),A.subPlanExecutionRecord?(p(),f("div",pu,[t("h5",null,[S(r(P),{icon:"carbon:tree-view"}),se(" "+c(r(n)("rightPanel.subPlan")),1)]),t("div",hu,[t("div",mu,[t("div",fu,[t("span",vu,c(k.$t("rightPanel.subPlanId"))+":",1),t("span",gu,c(A.subPlanExecutionRecord.currentPlanId),1)]),A.subPlanExecutionRecord.title?(p(),f("div",bu,[t("span",yu,c(k.$t("rightPanel.title"))+":",1),t("span",_u,c(A.subPlanExecutionRecord.title),1)])):O("",!0),t("div",$u,[A.subPlanExecutionRecord.completed?(p(),ae(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),ae(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),t("span",wu,c(A.subPlanExecutionRecord.completed?k.$t("rightPanel.status.completed"):k.$t("rightPanel.status.executing")),1)])])])])):O("",!0)])):O("",!0)]))),128))]),l.value.agentExecution&&!((F=l.value.agentExecution.thinkActSteps)!=null&&F.length)?(p(),f("div",Su,[t("p",null,c(r(n)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?O("",!0):(p(),f("div",ku,[S(r(P),{icon:"carbon:information",class:"info-icon"}),t("h4",null,c(r(n)("rightPanel.stepInfo")),1),t("div",Tu,[t("div",Pu,[t("span",Eu,c(r(n)("rightPanel.stepName"))+":",1),t("span",Cu,c(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),f("div",Iu,[t("span",Ru,c(k.$t("rightPanel.description"))+":",1),t("span",Au,c(l.value.description),1)])):O("",!0),t("div",xu,[t("span",Du,c(k.$t("rightPanel.status.label"))+":",1),t("span",{class:ne(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},c(l.value.completed?k.$t("rightPanel.status.completed"):l.value.current?k.$t("rightPanel.status.executing"):k.$t("rightPanel.status.pending")),3)])]),t("p",Mu,c(r(n)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),f("div",Nu,[N[2]||(N[2]=t("div",{class:"execution-waves"},[t("div",{class:"wave wave-1"}),t("div",{class:"wave wave-2"}),t("div",{class:"wave wave-3"})],-1)),t("p",Uu,[S(r(P),{icon:"carbon:in-progress",class:"rotating-icon"}),se(" "+c(r(n)("rightPanel.stepExecuting")),1)])])):O("",!0)])):(p(),f("div",Fu,[S(r(P),{icon:"carbon:events",class:"empty-icon"}),t("h3",null,c(r(n)("rightPanel.noStepSelected")),1),t("p",null,c(r(n)("rightPanel.selectStepHint")),1)]))])):O("",!0),S(qe,{name:"scroll-button"},{default:Me(()=>[u.value?(p(),f("button",{key:0,onClick:w,class:"scroll-to-bottom-btn",title:r(n)("rightPanel.scrollToBottom")},[S(r(P),{icon:"carbon:chevron-down"})],8,Lu)):O("",!0)]),_:1})],544)])):O("",!0),i.value==="files"?(p(),f("div",Bu,[M.value?(p(),ae(Ed,{key:0,"plan-id":M.value},null,8,["plan-id"])):_.value?(p(),f("div",Ou,[S(r(P),{icon:"carbon:folder-off"}),t("div",qu,[t("h3",null,c(r(n)("fileBrowser.noFilesYet")),1),t("p",null,c(r(n)("fileBrowser.noPlanExecuting")),1),t("div",ju,[S(r(P),{icon:"carbon:information"}),t("span",null,c(r(n)("fileBrowser.startTaskTip")),1)])])])):O("",!0)])):O("",!0)])])}}}),Hu=pe(Vu,[["__scopeId","data-v-ea214380"]]);function Bt(){return{formatResponseText:g=>g?g.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:g=>{const d=new Date().getTime()-g.getTime();return d<6e4?"刚刚":d<36e5?`${Math.floor(d/6e4)}分钟前`:d<864e5?`${Math.floor(d/36e5)}小时前`:g.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:g=>de(()=>({user:g.type==="user",assistant:g.type==="assistant",streaming:g.isStreaming,"has-error":!!g.error,"has-thinking":!!g.thinking,"has-execution":!!g.planExecution})),formatFileSize:g=>{if(g===0)return"0 B";const u=1024,d=["B","KB","MB","GB"],b=Math.floor(Math.log(g)/Math.log(u));return parseFloat((g/Math.pow(u,b)).toFixed(2))+" "+d[b]},truncateText:(g,u=100)=>!g||g.length<=u?g:g.substring(0,u)+"...",stripHtml:g=>g.replace(/<[^>]*>/g,""),hasDisplayableContent:g=>!!(g.content||g.thinking||g.planExecution||g.error),getMessageStatus:g=>g.error?"发送失败":g.isStreaming?"正在输入...":g.type==="assistant"&&!g.content&&!g.thinking?"等待响应":""}}const Gu=["data-message-id"],zu={class:"user-content"},Wu={class:"message-text"},Ju={key:0,class:"attachments"},Ku={class:"attachment-name"},Xu={class:"attachment-size"},Yu={class:"message-timestamp"},Qu={key:0,class:"message-status error"},Zu={class:"status-text"},ep=ue({__name:"UserMessage",props:{message:{}},setup(o){const{formatTimestamp:e,formatFileSize:s}=Bt();return(n,a)=>{var l;return p(),f("div",{class:"user-message","data-message-id":n.message.id},[t("div",zu,[t("div",Wu,c(n.message.content),1),(l=n.message.attachments)!=null&&l.length?(p(),f("div",Ju,[(p(!0),f(oe,null,re(n.message.attachments,(i,h)=>(p(),f("div",{key:h,class:"attachment-item"},[S(r(P),{icon:"carbon:document",class:"attachment-icon"}),t("span",Ku,c(i.name),1),t("span",Xu,c(r(s)(i.size)),1)]))),128))])):O("",!0),t("div",Yu,c(r(e)(n.message.timestamp)),1)]),n.message.error?(p(),f("div",Qu,[S(r(P),{icon:"carbon:warning",class:"status-icon"}),t("span",Zu,c(n.message.error),1)])):O("",!0)],8,Gu)}}}),tp=pe(ep,[["__scopeId","data-v-94372507"]]),sp={class:"sub-plan-info"},np={class:"sub-plan-details"},op={class:"sub-plan-title"},ap={key:0,class:"nesting-level"},lp={class:"sub-plan-id"},rp={class:"sub-plan-meta"},ip={key:0,class:"trigger-tool"},cp={class:"trigger-text"},dp={key:0,class:"sub-plan-progress"},up={class:"progress-info"},pp={class:"progress-text"},hp={class:"progress-bar"},mp={key:1,class:"sub-plan-agents-steps"},fp={class:"agents-steps-header"},vp={class:"agents-label"},gp={class:"agents-steps-list"},bp=["onClick"],yp={class:"agent-step-header"},_p={class:"agent-name"},$p={class:"sub-agent-execution-info"},wp={key:0,class:"agent-result"},Sp={class:"result-header"},kp={class:"result-label"},Tp={class:"result-content"},Pp={key:1,class:"agent-error"},Ep={class:"error-header"},Cp={class:"error-label"},Ip={class:"error-content"},Rp={key:2,class:"think-act-preview"},Ap={class:"think-act-header"},xp={class:"think-act-label"},Dp={class:"think-act-steps-preview"},Mp=["onClick"],Np={class:"step-number"},Up={class:"step-description"},Fp={key:0,class:"more-steps"},Lp={class:"more-steps-text"},Bp={key:3,class:"nested-sub-plans"},Op={class:"nested-sub-plans-header"},qp={class:"nested-label"},jp={class:"nested-sub-plans-list"},Vp={key:4,class:"direct-sub-plans"},Hp={class:"direct-sub-plans-header"},Gp={class:"direct-label"},zp={class:"direct-sub-plans-list"},Wp=ue({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:e}){const s=o,n=e,{t:a}=Pe(),l=()=>`nesting-level-${s.nestingLevel}`,i=()=>{var x,J;return s.subPlan.completed?"completed":((x=s.subPlan.agentExecutionSequence)==null?void 0:x.some(k=>k.status==="RUNNING"))?"running":((J=s.subPlan.agentExecutionSequence)==null?void 0:J.some(k=>k.status==="FINISHED"))?"in-progress":"pending"},h=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},g=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{var j;if(!((j=s.subPlan.agentExecutionSequence)!=null&&j.length))return 0;if(s.subPlan.completed)return 100;const m=d();return Math.min(100,m/s.subPlan.agentExecutionSequence.length*100)},d=()=>{var m;return(m=s.subPlan.agentExecutionSequence)!=null&&m.length?s.subPlan.agentExecutionSequence.filter(j=>j.status==="FINISHED").length:0},b=m=>{switch(m){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},C=m=>{switch(m){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},M=m=>{switch(m){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},_=m=>{var j;return((j=m.thinkActSteps)==null?void 0:j.some(x=>x.subPlanExecutionRecord))??!1},y=m=>{var j;return((j=m.thinkActSteps)==null?void 0:j.filter(x=>x.subPlanExecutionRecord))??[]},v=()=>{n("sub-plan-selected",-1,s.subPlanIndex,s.subPlan)},$=(m,j)=>{const x=j.stepId||`subplan-${s.subPlanIndex}-agent-${m}`;n("step-selected",x)},E=(m,j,x)=>{const J=x.stepId||`subplan-${s.subPlanIndex}-agent-${m}`;n("step-selected",J)},w=(m,j,x)=>{n("sub-plan-selected",m,j,x)},R=m=>{n("step-selected",m)};return(m,j)=>{var J,k;const x=as("RecursiveSubPlan",!0);return p(),f("div",{class:ne(["recursive-sub-plan",l()])},[t("div",{class:"sub-plan-header",onClick:v},[t("div",sp,[S(r(P),{icon:g(),class:"sub-plan-status-icon"},null,8,["icon"]),t("div",np,[t("div",op,[se(c(m.subPlan.title||m.$t("chat.subPlan"))+" #"+c(m.subPlanIndex+1)+" ",1),(m.nestingLevel??0)>0?(p(),f("span",ap,"(L"+c((m.nestingLevel??0)+1)+")",1)):O("",!0)]),t("div",lp,c(m.subPlan.currentPlanId),1)])]),t("div",rp,[t("div",{class:ne(["sub-plan-status-badge",i()])},c(h()),3),m.subPlan.parentActToolCall?(p(),f("div",ip,[S(r(P),{icon:"carbon:function",class:"trigger-icon"}),t("span",cp,c(m.subPlan.parentActToolCall.name),1)])):O("",!0)])]),(J=m.subPlan.agentExecutionSequence)!=null&&J.length?(p(),f("div",dp,[t("div",up,[t("span",pp,c(m.$t("chat.progress"))+": "+c(d())+" / "+c(m.subPlan.agentExecutionSequence.length),1),t("div",hp,[t("div",{class:"progress-fill",style:ze({width:u()+"%"})},null,4)])])])):O("",!0),(k=m.subPlan.agentExecutionSequence)!=null&&k.length?(p(),f("div",mp,[t("div",fp,[t("span",vp,c(m.$t("chat.agentExecutions"))+":",1)]),t("div",gp,[(p(!0),f(oe,null,re(m.subPlan.agentExecutionSequence,(N,z)=>{var F,A;return p(),f("div",{key:N.id||z,class:ne(["agent-step-item",b(N.status)]),onClick:B=>$(z,N)},[t("div",yp,[S(r(P),{icon:C(N.status),class:"agent-icon"},null,8,["icon"]),t("span",_p,c(N.agentName||m.$t("chat.unknownAgent")),1),t("div",{class:ne(["agent-status-badge",b(N.status)])},c(M(N.status)),3)]),t("div",$p,[N.result?(p(),f("div",wp,[t("div",Sp,[S(r(P),{icon:"carbon:checkmark",class:"result-icon"}),t("span",kp,c(m.$t("chat.agentResult"))+":",1)]),t("pre",Tp,c(N.result),1)])):O("",!0),N.errorMessage?(p(),f("div",Pp,[t("div",Ep,[S(r(P),{icon:"carbon:warning",class:"error-icon"}),t("span",Cp,c(m.$t("chat.errorMessage"))+":",1)]),t("pre",Ip,c(N.errorMessage),1)])):O("",!0),(F=N.thinkActSteps)!=null&&F.length?(p(),f("div",Rp,[t("div",Ap,[S(r(P),{icon:"carbon:thinking",class:"think-act-icon"}),t("span",xp,c(m.$t("chat.thinkActSteps"))+" ("+c(N.thinkActSteps.length)+")",1)]),t("div",Dp,[(p(!0),f(oe,null,re(N.thinkActSteps.slice(0,m.maxVisibleSteps??2),(B,D)=>(p(),f("div",{key:B.id||D,class:"think-act-step-preview",onClick:he(Q=>E(z,D,N),["stop"])},[t("span",Np,"#"+c(D+1),1),t("span",Up,c(B.actionDescription||m.$t("chat.thinking")),1),S(r(P),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Mp))),128)),N.thinkActSteps.length>(m.maxVisibleSteps??2)?(p(),f("div",Fp,[t("span",Lp,c(m.$t("chat.andMoreSteps",{count:N.thinkActSteps.length-(m.maxVisibleSteps??2)})),1)])):O("",!0)])])):O("",!0),_(N)?(p(),f("div",Bp,[t("div",Op,[S(r(P),{icon:"carbon:tree-view-alt",class:"nested-icon"}),t("span",qp,c(m.$t("chat.nestedSubPlans")),1)]),t("div",jp,[(p(!0),f(oe,null,re(y(N),(B,D)=>(p(),ae(x,{key:B.id||D,"sub-plan":B.subPlanExecutionRecord,"sub-plan-index":D,"nesting-level":(m.nestingLevel??0)+1,"max-nesting-depth":m.maxNestingDepth??3,"max-visible-steps":m.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):O("",!0),(A=N.subPlanExecutionRecords)!=null&&A.length?(p(),f("div",Vp,[t("div",Hp,[S(r(P),{icon:"carbon:tree-view",class:"direct-icon"}),t("span",Gp,c(m.$t("chat.directSubPlans")),1)]),t("div",zp,[(p(!0),f(oe,null,re(N.subPlanExecutionRecords,(B,D)=>(p(),ae(x,{key:B.currentPlanId||D,"sub-plan":B,"sub-plan-index":D,"nesting-level":(m.nestingLevel??0)+1,"max-nesting-depth":m.maxNestingDepth??3,"max-visible-steps":m.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):O("",!0)])],10,bp)}),128))])])):O("",!0)],2)}}}),Jp=pe(Wp,[["__scopeId","data-v-5ef3cbb7"]]),Kp={class:"execution-details"},Xp={key:0,class:"plan-overview"},Yp={class:"plan-header"},Qp={class:"plan-title"},Zp={key:0,class:"parent-tool-call"},eh={class:"parent-tool-header"},th={class:"tool-label"},sh={class:"tool-name"},nh={key:0,class:"tool-parameters"},oh={class:"param-label"},ah={class:"param-content"},lh={key:1,class:"agent-execution-container"},rh={class:"section-title"},ih=["onClick"],ch={class:"agent-info"},dh={class:"agent-details"},uh={class:"agent-name"},ph={class:"request-content"},hh={class:"agent-controls"},mh={class:"agent-execution-info"},fh={key:0,class:"agent-result"},vh={class:"result-header"},gh={class:"result-label"},bh={class:"result-content"},yh={key:1,class:"agent-error"},_h={class:"error-header"},$h={class:"error-label"},wh={class:"error-content"},Sh={key:0,class:"sub-plans-container"},kh={class:"sub-plans-header"},Th={class:"sub-plans-title"},Ph={class:"sub-plans-list"},Eh=ue({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const s=o,n=e,{t:a}=Pe(),l=de(()=>{var y;return((y=s.planExecution)==null?void 0:y.agentExecutionSequence)??[]}),i=y=>{y.stepId?n("step-selected",y.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",y)},h=()=>s.planExecution?s.planExecution.completed?"completed":l.value.some($=>$.status==="RUNNING")?"running":l.value.some($=>$.status==="FINISHED")?"in-progress":"pending":"unknown",g=()=>{switch(h()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},u=y=>{switch(y){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},d=y=>{switch(y){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},b=y=>{switch(y){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},C=(y,v,$)=>{n("sub-plan-selected",y,v,$)},M=y=>{n("step-selected",y)},_=y=>{if(!y)return"";try{const v=JSON.parse(y);return JSON.stringify(v,null,2)}catch{return y}};return(y,v)=>{var $,E,w;return p(),f("div",Kp,[y.planExecution?(p(),f("div",Xp,[t("div",Yp,[t("h3",Qp,c(y.planExecution.title||y.$t("chat.planExecution")),1),t("div",{class:ne(["plan-status-badge",h()])},c(g()),3)]),y.planExecution.parentActToolCall?(p(),f("div",Zp,[t("div",eh,[S(r(P),{icon:"carbon:flow",class:"tool-icon"}),t("span",th,c(y.$t("chat.triggeredByTool"))+":",1),t("span",sh,c(y.planExecution.parentActToolCall.name),1)]),y.planExecution.parentActToolCall.parameters?(p(),f("div",nh,[t("span",oh,c(y.$t("common.parameters"))+":",1),t("pre",ah,c(_(y.planExecution.parentActToolCall.parameters)),1)])):O("",!0)])):O("",!0)])):O("",!0),(((E=($=y.planExecution)==null?void 0:$.agentExecutionSequence)==null?void 0:E.length)??0)>0?(p(),f("div",lh,[t("h4",rh,c(y.$t("chat.agentExecutionSequence")),1),(p(!0),f(oe,null,re((w=y.planExecution)==null?void 0:w.agentExecutionSequence,(R,m)=>{var j;return p(),f("div",{key:R.id||m,class:ne(["agent-execution-item",u(R.status)])},[t("div",{class:"agent-header",onClick:x=>i(R)},[t("div",ch,[S(r(P),{icon:b(R.status),class:"agent-status-icon"},null,8,["icon"]),t("div",dh,[t("div",uh,c(R.agentName||y.$t("chat.unknownAgent")),1),t("pre",ph,c(R.agentRequest),1)])]),t("div",hh,[t("div",{class:ne(["agent-status-badge",u(R.status)])},c(d(R.status)),3),S(r(P),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,ih),t("div",mh,[R.result?(p(),f("div",fh,[t("div",vh,[S(r(P),{icon:"carbon:checkmark",class:"result-icon"}),t("span",gh,c(y.$t("chat.agentResult"))+":",1)]),t("pre",bh,c(R.result),1)])):O("",!0),R.errorMessage?(p(),f("div",yh,[t("div",_h,[S(r(P),{icon:"carbon:warning",class:"error-icon"}),t("span",$h,c(y.$t("chat.errorMessage"))+":",1)]),t("pre",wh,c(R.errorMessage),1)])):O("",!0)]),(j=R.subPlanExecutionRecords)!=null&&j.length?(p(),f("div",Sh,[t("div",kh,[S(r(P),{icon:"carbon:tree-view",class:"sub-plans-icon"}),t("span",Th,c(y.$t("chat.subPlanExecutions"))+" ("+c(R.subPlanExecutionRecords.length)+") ",1)]),t("div",Ph,[(p(!0),f(oe,null,re(R.subPlanExecutionRecords,(x,J)=>(p(),ae(Jp,{key:x.currentPlanId||J,"sub-plan":x,"sub-plan-index":J,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:C,onStepSelected:M},null,8,["sub-plan","sub-plan-index"]))),128))])])):O("",!0)],2)}),128))])):O("",!0)])}}}),Fs=pe(Eh,[["__scopeId","data-v-2d936ebb"]]),Ch={key:0,class:"thinking-section"},Ih={class:"thinking-header"},Rh={class:"thinking-avatar"},Ah={class:"thinking-label"},xh={class:"thinking-content"},Dh={key:0,class:"thinking"},Mh={key:2,class:"default-processing"},Nh={class:"processing-indicator"},Uh=ue({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const s=o,n=e,a=de(()=>{var u,d,b,C;return s.thinking||(((d=(u=s.thinkingDetails)==null?void 0:u.agentExecutionSequence)==null?void 0:d.length)??0)>0||(((C=(b=s.planExecution)==null?void 0:b.agentExecutionSequence)==null?void 0:C.length)??0)>0}),l=(u,d)=>{n("agent-selected",u,d)},i=(u,d,b)=>{n("sub-plan-selected",u,d,b)},h=u=>{n("user-input-submitted",u)},g=u=>{n("step-selected",u)};return(u,d)=>a.value?(p(),f("div",Ch,[t("div",Ih,[t("div",Rh,[S(r(P),{icon:"carbon:thinking",class:"thinking-icon"})]),t("div",Ah,c(u.$t("chat.thinkingLabel")),1)]),t("div",xh,[u.thinking?(p(),f("div",Dh,[S(r(P),{icon:"carbon:thinking",class:"thinking-icon"}),t("span",null,c(u.thinking),1)])):O("",!0),u.thinkingDetails||u.planExecution?(p(),ae(Fs,{key:1,"plan-execution":u.thinkingDetails||u.planExecution,"step-actions":u.stepActions||[],"generic-input":u.genericInput||"",onAgentSelected:l,onSubPlanSelected:i,onUserInputSubmitted:h,onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):!u.hasContent&&u.thinking?(p(),f("div",Mh,[t("div",Nh,[d[0]||(d[0]=t("div",{class:"thinking-dots"},[t("span"),t("span"),t("span")],-1)),t("span",null,c(u.thinking||u.$t("chat.thinkingProcessing")),1)])])):O("",!0)])])):O("",!0)}}),Fh=pe(Uh,[["__scopeId","data-v-c341487f"]]);class Ot{static async getDetails(e){try{const s=await fetch(`${this.BASE_URL}/details/${e}`);if(s.status===404)return null;if(!s.ok){const l=await s.text();throw new Error(`Failed to get detailed information: ${s.status} - ${l}`)}const n=await s.text(),a=JSON.parse(n);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(s){return console.error("[CommonApiService] Failed to get plan details:",s),null}}static async submitFormInput(e,s){const n=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok){let l;try{l=await n.json()}catch{l={message:`Failed to submit form input: ${n.status}`}}throw new Error(l.message||`Failed to submit form input: ${n.status}`)}const a=n.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await n.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ge(Ot,"BASE_URL","/api/executor");const Lh={class:"user-input-form-container"},Bh={class:"user-input-header"},Oh={class:"user-input-title"},qh={class:"user-input-message"},jh={key:0,class:"form-description"},Vh={key:0,class:"form-grid"},Hh=["for"],Gh=["id","name","placeholder","required","onUpdate:modelValue"],zh=["id","name","placeholder","required","onUpdate:modelValue"],Wh=["id","name","placeholder","required","onUpdate:modelValue"],Jh=["id","name","placeholder","required","onUpdate:modelValue"],Kh=["id","name","placeholder","required","onUpdate:modelValue"],Xh=["id","name","required","onUpdate:modelValue"],Yh={value:""},Qh=["value"],Zh={key:6,class:"checkbox-group"},em=["id","name","value","onUpdate:modelValue"],tm={class:"checkbox-label"},sm={key:7,class:"radio-group"},nm=["id","name","value","onUpdate:modelValue"],om={class:"radio-label"},am=["id","name","placeholder","required","onUpdate:modelValue"],lm={key:1,class:"form-group"},rm={for:"form-input-genericInput"},im={type:"submit",class:"submit-user-input-btn"},cm=ue({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:e}){const s=o,n=e;Pe();const a=st({}),l=U(s.genericInput||""),i=U(!1),h=U(null),g=()=>{var M;const C=(M=s.userInputWaitState)==null?void 0:M.formInputs;C&&C.length>0&&(!i.value||Object.keys(a).length!==C.length)&&(C.forEach((y,v)=>{(!(v in a)||y.type==="checkbox"&&!Array.isArray(a[v])||y.type!=="checkbox"&&a[v]==="")&&(y.type==="checkbox"?a[v]=[]:a[v]="")}),i.value=!0)};we(()=>{g()}),ie(()=>{var C;return(C=s.userInputWaitState)==null?void 0:C.formInputs},()=>{h.value&&clearTimeout(h.value),h.value=setTimeout(()=>{i.value=!1,g()},100)},{deep:!0});const u=async()=>{var C;try{const M={},_=(C=s.userInputWaitState)==null?void 0:C.formInputs;_&&_.length>0?Object.entries(a).forEach(([y,v])=>{const $=parseInt(y,10),E=_[$];if(E){const w=E.label||`input_${y}`;Array.isArray(v)?M[w]=v.join(", "):M[w]=v}}):M.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",M,"for planId:",s.planId),s.planId?(await Ot.submitFormInput(s.planId,M),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),n("user-input-submitted",M)}catch(M){console.error("[UserInputForm] User input submission failed:",M)}},d=C=>C?Array.isArray(C)?C:typeof C=="string"?C.split(",").map(M=>M.trim()).filter(M=>M.length>0):[]:[],b=C=>typeof C=="boolean"?C:typeof C=="string"?C==="true":!1;return Te(()=>{h.value&&clearTimeout(h.value)}),(C,M)=>{var _,y,v,$,E;return p(),f("div",Lh,[t("div",Bh,[S(r(P),{icon:"carbon:user",class:"user-icon"}),t("h4",Oh,c(C.$t("chat.userInputRequired")),1)]),t("p",qh,c(((_=C.userInputWaitState)==null?void 0:_.title)??C.$t("chat.userInput.message")),1),(y=C.userInputWaitState)!=null&&y.formDescription?(p(),f("p",jh,c((v=C.userInputWaitState)==null?void 0:v.formDescription),1)):O("",!0),t("form",{onSubmit:he(u,["prevent"]),class:"user-input-form"},[($=C.userInputWaitState)!=null&&$.formInputs&&C.userInputWaitState.formInputs.length>0?(p(),f("div",Vh,[(p(!0),f(oe,null,re((E=C.userInputWaitState)==null?void 0:E.formInputs,(w,R)=>(p(),f("div",{key:R,class:"form-group"},[t("label",{for:`form-input-${w.label.replace(/\W+/g,"_")}`},c(w.label)+c(b(w.required)?" *":"")+": ",9,Hh),!w.type||w.type==="text"?te((p(),f("input",{key:0,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":m=>a[R]=m,class:"form-input"},null,8,Gh)),[[le,a[R]]]):w.type==="email"?te((p(),f("input",{key:1,type:"email",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":m=>a[R]=m,class:"form-input"},null,8,zh)),[[le,a[R]]]):w.type==="number"?te((p(),f("input",{key:2,type:"number",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":m=>a[R]=m,class:"form-input"},null,8,Wh)),[[le,a[R]]]):w.type==="password"?te((p(),f("input",{key:3,type:"password",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":m=>a[R]=m,class:"form-input"},null,8,Jh)),[[le,a[R]]]):w.type==="textarea"?te((p(),f("textarea",{key:4,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":m=>a[R]=m,class:"form-input form-textarea",rows:"4"},null,8,Kh)),[[le,a[R]]]):w.type==="select"&&w.options?te((p(),f("select",{key:5,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,required:b(w.required),"onUpdate:modelValue":m=>a[R]=m,class:"form-input form-select"},[t("option",Yh,c(C.$t("selectCommon.pleaseSelect")),1),(p(!0),f(oe,null,re(d(w.options),m=>(p(),f("option",{key:m,value:m},c(m),9,Qh))),128))],8,Xh)),[[nt,a[R]]]):w.type==="checkbox"&&w.options?(p(),f("div",Zh,[(p(!0),f(oe,null,re(d(w.options),m=>(p(),f("label",{key:m,class:"checkbox-item"},[te(t("input",{type:"checkbox",id:`form-input-${w.label.replace(/\W+/g,"_")}-${m.replace(/\W+/g,"_")}`,name:w.label,value:m,"onUpdate:modelValue":j=>a[R]=j,class:"form-checkbox"},null,8,em),[[it,a[R]]]),t("span",tm,c(m),1)]))),128))])):w.type==="radio"&&w.options?(p(),f("div",sm,[(p(!0),f(oe,null,re(d(w.options),m=>(p(),f("label",{key:m,class:"radio-item"},[te(t("input",{type:"radio",id:`form-input-${w.label.replace(/\W+/g,"_")}-${m.replace(/\W+/g,"_")}`,name:w.label,value:m,"onUpdate:modelValue":j=>a[R]=j,class:"form-radio"},null,8,nm),[[Os,a[R]]]),t("span",om,c(m),1)]))),128))])):te((p(),f("input",{key:8,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":m=>a[R]=m,class:"form-input"},null,8,am)),[[le,a[R]]])]))),128))])):(p(),f("div",lm,[t("label",rm,c(C.$t("common.input"))+":",1),te(t("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":M[0]||(M[0]=w=>l.value=w),class:"form-input"},null,512),[[le,l.value]])])),t("button",im,c(C.$t("chat.userInput.submit")),1)],32)])}}}),dm=pe(cm,[["__scopeId","data-v-043b591c"]]),um={class:"response-section"},pm={class:"response-header"},hm={class:"response-avatar"},mm={class:"response-name"},fm={key:0,class:"response-timestamp"},vm={class:"response-content"},gm={key:1,class:"final-response"},bm=["innerHTML"],ym={class:"response-actions"},_m=["title"],$m=["title"],wm={key:2,class:"response-placeholder"},Sm={class:"typing-indicator"},km={class:"typing-text"},Tm={key:3,class:"response-error"},Pm={class:"error-text"},Em={key:4,class:"response-empty"},Cm={class:"empty-text"},Im=ue({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:e}){const s=o,n=e,{formatResponseText:a,formatTimestamp:l}=Bt(),i=async()=>{if(s.content)try{const d=s.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(d),n("copy")}catch(d){console.error("Failed to copy to clipboard:",d)}},h=()=>{n("regenerate")},g=()=>{n("retry")},u=d=>{console.log("[ResponseSection] User input submitted:",d),n("user-input-submitted",d)};return(d,b)=>{var C;return p(),f("div",um,[t("div",pm,[t("div",hm,[S(r(P),{icon:"carbon:bot",class:"bot-icon"})]),t("div",mm,c(d.$t("chat.botName")),1),d.timestamp?(p(),f("div",fm,c(r(l)(d.timestamp)),1)):O("",!0)]),t("div",vm,[(C=d.userInputWaitState)!=null&&C.waiting?(p(),ae(dm,ls({key:0,"user-input-wait-state":d.userInputWaitState},d.planId?{"plan-id":d.planId}:{},{"generic-input":d.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):O("",!0),d.content?(p(),f("div",gm,[t("div",{class:"response-text",innerHTML:r(a)(d.content)},null,8,bm),t("div",ym,[t("button",{class:"action-btn copy-btn",onClick:i,title:d.$t("chat.copyResponse")},[S(r(P),{icon:"carbon:copy"})],8,_m),t("button",{class:"action-btn regenerate-btn",onClick:h,title:d.$t("chat.regenerateResponse")},[S(r(P),{icon:"carbon:renew"})],8,$m)])])):d.isStreaming?(p(),f("div",wm,[t("div",Sm,[b[0]||(b[0]=t("div",{class:"typing-dots"},[t("span"),t("span"),t("span")],-1)),t("span",km,c(d.$t("chat.thinkingResponse")),1)])])):d.error?(p(),f("div",Tm,[S(r(P),{icon:"carbon:warning",class:"error-icon"}),t("span",Pm,c(d.error),1),t("button",{class:"retry-btn",onClick:g},c(d.$t("chat.retry")),1)])):(p(),f("div",Em,[t("span",Cm,c(d.$t("chat.waitingForResponse")),1)]))])])}}}),Rm=pe(Im,[["__scopeId","data-v-6581a34f"]]),Am={class:"assistant-message"},xm=ue({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const s=o,n=e,a=()=>{n("copy",s.message.id)},l=()=>{n("regenerate",s.message.id)},i=()=>{n("retry",s.message.id)},h=(u,d)=>{console.log("[AssistantMessage] User input submitted:",d,"for message:",u.id)},g=u=>{console.log("[AssistantMessage] Step selected:",u),n("step-selected",u)};return(u,d)=>{var b,C,M,_;return p(),f("div",Am,[u.message.thinkingDetails?(p(),ae(Fh,{key:0,"thinking-details":u.message.thinkingDetails,onStepSelected:g},null,8,["thinking-details"])):O("",!0),u.message.planExecution?(p(),ae(Fs,{key:1,"plan-execution":u.message.planExecution,"step-actions":u.message.stepActions||[],"generic-input":u.message.genericInput||"",onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):O("",!0),u.message.content||u.message.error||u.isStreaming||(C=(b=u.message.planExecution)==null?void 0:b.userInputWaitState)!=null&&C.waiting?(p(),ae(Rm,ls({key:2,content:u.message.content||"","is-streaming":u.isStreaming||!1},{...u.message.error?{error:u.message.error}:{},...(M=u.message.planExecution)!=null&&M.userInputWaitState?{userInputWaitState:u.message.planExecution.userInputWaitState}:{},...(_=u.message.planExecution)!=null&&_.currentPlanId?{planId:u.message.planExecution.currentPlanId}:{}},{timestamp:u.message.timestamp,"generic-input":u.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:i,onUserInputSubmitted:d[0]||(d[0]=y=>h(u.message,y))}),null,16,["content","is-streaming","timestamp","generic-input"])):O("",!0)])}}}),Dm=pe(xm,[["__scopeId","data-v-3810c279"]]),Mm=ue({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const s=o,n=e,{getMessageClasses:a}=Bt(),l=de(()=>a(s.message)),i=d=>{n("copy",d)},h=d=>{n("regenerate",d)},g=d=>{n("retry",d)},u=d=>{n("step-selected",d)};return(d,b)=>(p(),f("div",{class:ne(["chat-message",l.value])},[d.message.type==="user"?(p(),ae(tp,{key:0,message:d.message},null,8,["message"])):d.message.type==="assistant"?(p(),ae(Dm,{key:1,message:d.message,"is-streaming":d.isStreaming||!1,onCopy:i,onRegenerate:h,onRetry:g,onStepSelected:u},null,8,["message","is-streaming"])):O("",!0)],2))}}),Nm=pe(Mm,[["__scopeId","data-v-218b3735"]]);function Dt(o){const e={...o};return"agentExecutionSequence"in o&&Array.isArray(o.agentExecutionSequence)&&(e.agentExecutionSequence=o.agentExecutionSequence.map(s=>Um(s))),e}function Um(o){const e={...o};return"subPlanExecutionRecords"in o&&Array.isArray(o.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=o.subPlanExecutionRecords.map(s=>Dt(s))),e}function Fm(o){const e={...o};return"thinkingDetails"in o&&o.thinkingDetails&&(e.thinkingDetails=Dt(o.thinkingDetails)),"planExecution"in o&&o.planExecution&&(e.planExecution=Dt(o.planExecution)),"attachments"in o&&Array.isArray(o.attachments)&&(e.attachments=[...o.attachments]),e}function Lm(){const o=U([]),e=U(!1),s=U(null),n=U(null),a=de(()=>o.value.length>0?o.value[o.value.length-1]:null),l=de(()=>s.value!==null),i=de(()=>o.value.length>0),h=(R,m,j)=>{const x={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:R,content:m,timestamp:new Date,isStreaming:!1,...j};return o.value.push(x),x},g=(R,m)=>{const j=o.value.findIndex(x=>x.id===R);j!==-1&&(o.value[j]={...o.value[j],...m})},u=R=>{const m=o.value.findIndex(j=>j.id===R);m!==-1&&o.value.splice(m,1)},d=()=>{o.value=[],s.value=null,n.value=null},b=R=>{s.value=R,g(R,{isStreaming:!0})},C=R=>{R&&g(R,{isStreaming:!1}),s.value===R&&(s.value=null)},M=R=>{n.value=R},_=(R,m,j="content")=>{const x=o.value.find(J=>J.id===R);x&&typeof x[j]=="string"&&g(R,{[j]:x[j]+m})},y=(R,m)=>{g(R,{thinkingDetails:m})},v=(R,m)=>{g(R,{thinking:m})},$=(R,m)=>{g(R,{planExecution:m})},E=R=>o.value.find(m=>m.id===R),w=R=>o.value.findIndex(m=>m.id===R);return{messages:Ze(o),isLoading:e,streamingMessageId:Ze(s),activeMessageId:Ze(n),lastMessage:a,isStreaming:l,hasMessages:i,addMessage:h,updateMessage:g,removeMessage:u,clearMessages:d,startStreaming:b,stopStreaming:C,setActiveMessage:M,appendToMessage:_,updateMessageThinking:v,updateMessageThinkingDetails:y,updateMessagePlanExecution:$,findMessage:E,getMessageIndex:w}}function Bm(o){const e=U(!1),s=U(!0),n=150,a=async(v=!0)=>{o.value&&(await ke(),o.value.scrollTo({top:o.value.scrollHeight,behavior:v?"smooth":"auto"}))},l=()=>{if(!o.value)return!1;const{scrollTop:v,scrollHeight:$,clientHeight:E}=o.value;return $-v-E<n},i=()=>{if(!o.value)return;const v=l();e.value=!v&&o.value.scrollHeight>o.value.clientHeight,v&&(s.value=!0)},h=()=>{i(),l()||(s.value=!1)},g=async()=>{s.value&&await a()},u=async()=>{s.value=!0,await a()},d=(v,$=!0)=>{if(!o.value)return;const E=o.value.querySelector(`[data-message-id="${v}"]`);E&&E.scrollIntoView({behavior:$?"smooth":"auto",block:"center"})},b=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:v,scrollHeight:$,clientHeight:E}=o.value,w=v===0,R=v+E>=$-5,m=$>E?v/($-E)*100:100;return{scrollTop:v,scrollHeight:$,clientHeight:E,isAtTop:w,isAtBottom:R,scrollPercentage:m}},C=()=>{o.value&&o.value.addEventListener("scroll",h,{passive:!0})},M=()=>{o.value&&o.value.removeEventListener("scroll",h)},_=()=>{C(),i()},y=()=>{M()};return we(()=>{ke(()=>{_()})}),Te(()=>{y()}),{showScrollToBottom:Ze(e),isAutoScrollEnabled:Ze(s),scrollToBottom:a,autoScrollToBottom:g,forceScrollToBottom:u,scrollToMessage:d,isNearBottom:l,checkScrollPosition:i,getScrollInfo:b,addScrollListener:C,removeScrollListener:M,initializeScrollBehavior:_,cleanupScrollBehavior:y}}class qt{static async sendMessage(e){return Ws.withLlmCheck(async()=>{const s=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error(`API request failed: ${s.status}`);return await s.json()})}}ge(qt,"BASE_URL","/api/executor");const Om=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:qt},Symbol.toStringTag,{value:"Module"})),Be=class Be{constructor(){ge(this,"POLL_INTERVAL",5e3);ge(this,"state",st({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));ge(this,"callbacks",{});ge(this,"planExecutionCache",new Map);ge(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,s){this.uiStateCache.set(e,s),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,s){this.planExecutionCache.set(e,s),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const s=this.planExecutionCache.delete(e);return s&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),s}clearAllCachedRecords(){const e=this.planExecutionCache.size,s=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${s}`)}static getInstance(){return Be.instance||(Be.instance=new Be),Be.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(s){console.error("[PlanExecutionManager] Failed to send user message:",s);const n=this.state.activePlanId??"error";this.setCachedUIState(n,{enabled:!0}),this.emitChatInputUpdateState(n),this.state.activePlanId=null}}handlePlanExecutionRequested(e,s){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:s}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(s??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,s){const n=this.getCachedPlanRecord(e);return n!=null&&n.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(n.currentPlanId,s),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const s=this.state.activePlanId??"ui-state";return this.setCachedUIState(s,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(s),!0}async sendUserMessageAndSetPlanId(e){try{const s=await qt.sendMessage({input:e});if(s!=null&&s.planId)return this.state.activePlanId=s.planId,s;if(s!=null&&s.planTemplateId)return this.state.activePlanId=s.planTemplateId,{...s,planId:s.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",s),new Error("Failed to get valid planId from API response")}catch(s){throw console.error("[PlanExecutionManager] API call failed:",s),s}}initiatePlanExecutionSequence(e,s){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${s}`);const n=s;this.emitDialogRoundStart(n),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await et.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}},5e3)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await et.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}},5e3)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const s=await Ot.getDetails(e);return s!=null&&s.rootPlanId&&(this.planExecutionCache.set(s.rootPlanId,s),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${s.rootPlanId}`)),s}catch(s){return console.error("[PlanExecutionManager] Failed to get plan details:",s),{currentPlanId:e,status:"failed",message:s instanceof Error?s.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};ge(Be,"instance",null);let Mt=Be;const Ne=Mt.getInstance(),qm={class:"chat-container"},jm={key:0,class:"loading-message"},Vm={class:"loading-content"},Hm=["title"],Gm=ue({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(o,{expose:e,emit:s}){const n=s,{t:a}=Pe(),{messages:l,isLoading:i,streamingMessageId:h,addMessage:g,updateMessage:u,startStreaming:d,stopStreaming:b,findMessage:C}=Lm(),M=U(null),{scrollToBottom:_,autoScrollToBottom:y,showScrollToBottom:v}=Bm(M),$=U(),E=B=>h.value===B,w=de(()=>l.value.map(Fm)),R=()=>{},m=B=>{const D=B.target;if(D.classList.contains("md-copy-btn")){const Q=D.getAttribute("data-raw");if(Q){const Z=decodeURIComponent(Q);navigator.clipboard.writeText(Z).then(()=>{D.textContent=a("chat.copied"),setTimeout(()=>{D.textContent=a("chat.copy")},1e3)})}}},j=async B=>{const D=C(B);if(D)try{const Q=D.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(Q)}catch(Q){console.error("Failed to copy message:",Q)}},x=B=>{const D=C(B);D&&D.type==="assistant"&&(u(B,{content:""}),d(B))},J=B=>{C(B)&&(u(B,{content:""}),d(B))},k=B=>{console.log("[ChatContainer] Step selected:",B),n("step-selected",B)},N=B=>{console.log("[ChatContainer] Plan update received:",B);const D=Ne.getCachedPlanRecord(B);if(!D){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",B);return}console.log("[ChatContainer] Retrieved plan details from cache:",D);const Q=l.value.findIndex(Z=>{var ce;return((ce=Z.planExecution)==null?void 0:ce.currentPlanId)===D.currentPlanId&&Z.type==="assistant"});if(Q!==-1){const Z=l.value[Q],ce={planExecution:JSON.parse(JSON.stringify(D))};if(!D.agentExecutionSequence||D.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),D.completed){ce.thinking="";const fe=D.summary??D.result??D.message??"Execution completed";ce.content=fe,console.log("[ChatContainer] Set simple response content:",fe)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");u(Z.id,ce)}},z=B=>{if(console.log("[ChatContainer] Plan completed:",B),B.rootPlanId){const D=l.value.findIndex(Q=>{var Z;return((Z=Q.planExecution)==null?void 0:Z.currentPlanId)===B.rootPlanId});if(D!==-1){const Q=l.value[D],Z=B.summary??B.result??"Execution completed";u(Q.id,{thinking:"",content:Z}),console.log("[ChatContainer] Updated completed message:",Z)}}},F=B=>{console.log("[ChatContainer] Dialog round start:",B)},A=B=>{console.log("[ChatContainer] Plan error:",B),g("assistant",`Error: ${B}`),console.error("[ChatContainer] Plan execution error:",B)};return we(()=>{ie(l,()=>{ke(()=>{y()})},{deep:!0}),Ne.setEventCallbacks({onPlanUpdate:N,onPlanCompleted:z,onDialogRoundStart:F,onPlanError:A})}),Te(()=>{$.value&&clearInterval($.value)}),e({scrollToBottom:_,handlePlanUpdate:N,handlePlanCompleted:z,handleDialogRoundStart:F,handlePlanError:A,addMessage:g,updateMessage:u,startStreaming:d,stopStreaming:b}),(B,D)=>(p(),f("div",qm,[t("div",{class:"messages",ref_key:"messagesRef",ref:M,onScroll:R,onClick:m},[(p(!0),f(oe,null,re(w.value,Q=>(p(),ae(Nm,{key:Q.id,message:Q,"is-streaming":E(Q.id),onCopy:j,onRegenerate:x,onRetry:J,onStepSelected:k},null,8,["message","is-streaming"]))),128)),r(i)?(p(),f("div",jm,[t("div",Vm,[S(r(P),{icon:"carbon:circle-dash",class:"loading-icon"}),t("span",null,c(B.$t("chat.processing")),1)])])):O("",!0)],544),S(qe,{name:"scroll-button"},{default:Me(()=>[r(v)?(p(),f("button",{key:0,class:"scroll-to-bottom",onClick:D[0]||(D[0]=()=>r(_)()),title:B.$t("chat.scrollToBottom")},[S(r(P),{icon:"carbon:chevron-down"})],8,Hm)):O("",!0)]),_:1})]))}}),zm=pe(Gm,[["__scopeId","data-v-e7a5d6c9"]]),wt=U([]),ss=o=>{wt.value=[...o]},Pt=()=>{wt.value=[]},Wm=()=>wt.value,Jm=()=>wt.value.length>0;class Km{static async deleteFile(e,s){try{console.log("[FileUploadApiService] Deleting file:",s,"from plan:",e);const n=await fetch(`/api/file-upload/files/${e}/${encodeURIComponent(s)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=await n.json();return console.log("[FileUploadApiService] File deleted successfully:",a),a}catch(n){throw console.error("[FileUploadApiService] Error deleting file:",n),n}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for plan:",e);const s=await fetch(`/api/file-upload/files/${e}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();return console.log("[FileUploadApiService] Got uploaded files:",n.totalCount),n}catch(s){throw console.error("[FileUploadApiService] Error getting uploaded files:",s),s}}}const Xm={class:"input-area"},Ym={class:"input-container"},Qm=["title"],Zm=["placeholder","disabled"],ef=["title"],tf=["disabled","title"],sf={key:0,class:"uploaded-files"},nf={class:"files-header"},of={class:"files-list"},af={class:"file-name"},lf={class:"file-size"},rf=["onClick","title"],cf={key:1,class:"upload-progress"},df=ue({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked","files-uploaded"],setup(o,{expose:e,emit:s}){const{t:n}=Pe(),a=o,l=s,i=U(),h=U(),g=U(""),u=de(()=>a.placeholder||n("input.placeholder")),d=U(u.value),b=U([]),C=U(!1),M=U(null),_=()=>{M.value=null,b.value=[],Pt()};Te(()=>{_()}),ie(()=>b.value.length,(A,B)=>{});const y=de(()=>!!a.disabled),v=()=>{ke(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},$=A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),E())},E=()=>{if(!g.value.trim()||y.value)return;let A=g.value.trim();if(b.value.length>0){const D=b.value.map(Q=>`${Q.name} (${Q.relativePath})`).join(", ");A+=`

[Uploaded files: ${D}]`}const B={input:A,memoryId:Ue.selectMemoryId,uploadedFiles:b.value,sessionPlanId:M.value};l("send",B),k(),b.value=[],Pt()},w=()=>{l("plan-mode-clicked")},R=()=>{h.value&&h.value.click()},m=async A=>{const B=A.target,D=B.files;if(!D||D.length===0)return;const Q=Array.from(D);console.log("[FileUpload] Selected files for upload:",Q.map(Z=>Z.name)),await j(Q),B&&(B.value="")},j=async A=>{if(A.length!==0){C.value=!0;try{const B=new FormData;A.forEach(ce=>{B.append("files",ce)});let D="/api/file-upload/upload";M.value?(D=`/api/file-upload/upload/${M.value}`,console.log("[FileUpload] Using existing sessionPlanId:",M.value)):console.log("[FileUpload] Creating new temporary planId");const Q=await fetch(D,{method:"POST",body:B});if(!Q.ok)throw new Error(`Upload failed: ${Q.statusText}`);const Z=await Q.json();if(Z.uploadedFiles){!M.value&&Z.planId?(M.value=Z.planId,console.log("[FileUpload] Set sessionPlanId:",M.value)):M.value&&console.log("[FileUpload] SessionPlanId already exists:",M.value);const ce=Z.uploadedFiles.map(fe=>({name:fe.originalName,size:fe.size,type:fe.extension,planId:Z.planId,relativePath:fe.relativePath}));b.value=[...b.value,...ce],l("files-uploaded",ce),ss(b.value),console.log("[Input] Updated global uploadedFiles state:",b.value),b.value.length>0&&(d.value=n("input.filesAttached",{count:b.value.length}))}console.log("Files uploaded successfully:",Z)}catch(B){console.error("File upload error:",B)}finally{C.value=!1}}},x=async A=>{try{console.log("🗑️ Removing file:",A.name,"from plan:",A.planId),A.planId&&(await Km.deleteFile(A.planId,A.name),console.log("✅ File deleted from server successfully")),b.value=b.value.filter(B=>B.name!==A.name),b.value.length===0?(d.value=u.value,Pt()):(d.value=n("input.filesAttached",{count:b.value.length}),ss(b.value)),console.log("🎉 File removal completed, remaining files:",b.value.length)}catch(B){console.error("❌ Error removing file:",B),alert(n("input.fileDeleteError")||"Failed to delete file")}},J=A=>{if(A===0)return"0 Bytes";const B=1024,D=["Bytes","KB","MB","GB"],Q=Math.floor(Math.log(A)/Math.log(B));return parseFloat((A/Math.pow(B,Q)).toFixed(2))+" "+D[Q]},k=()=>{g.value="",v(),l("clear")},N=(A,B)=>{B&&(d.value=A?B:n("input.waiting")),l("update-state",A,B)},z=A=>{g.value=A,v()},F=()=>g.value.trim();return ie(()=>a.initialValue,A=>{A&&A.trim()&&(g.value=A,v())},{immediate:!0}),e({clearInput:k,updateState:N,setInputValue:z,getQuery:F,resetSession:_,focus:()=>{var A;return(A=i.value)==null?void 0:A.focus()}}),we(()=>{}),Te(()=>{}),(A,B)=>(p(),f("div",Xm,[t("div",Ym,[t("button",{class:"attach-btn",title:A.$t("input.attachFile"),onClick:R},[S(r(P),{icon:"carbon:attachment"})],8,Qm),t("input",{ref_key:"fileInputRef",ref:h,type:"file",multiple:"",style:{display:"none"},onChange:m,accept:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini"},null,544),te(t("textarea",{"onUpdate:modelValue":B[0]||(B[0]=D=>g.value=D),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:d.value,disabled:y.value,onKeydown:$,onInput:v},null,40,Zm),[[le,g.value]]),t("button",{class:"plan-mode-btn",title:A.$t("input.planMode"),onClick:w},[S(r(P),{icon:"carbon:document"}),se(" "+c(A.$t("input.planMode")),1)],8,ef),t("button",{class:"send-button",disabled:!g.value.trim()||y.value,onClick:E,title:A.$t("input.send")},[S(r(P),{icon:"carbon:send-alt"}),se(" "+c(A.$t("input.send")),1)],8,tf)]),b.value.length>0?(p(),f("div",sf,[t("div",nf,[S(r(P),{icon:"carbon:document"}),t("span",null,c(r(n)("input.attachedFiles"))+" ("+c(b.value.length)+")",1)]),t("div",of,[(p(!0),f(oe,null,re(b.value,D=>(p(),f("div",{key:D.name,class:"file-item"},[S(r(P),{icon:"carbon:document",class:"file-icon"}),t("span",af,c(D.name),1),t("span",lf,"("+c(J(D.size))+")",1),t("button",{onClick:Q=>x(D),class:"remove-btn",title:r(n)("input.removeFile")},[S(r(P),{icon:"carbon:close"})],8,rf)]))),128))])])):O("",!0),C.value?(p(),f("div",cf,[S(r(P),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),t("span",null,c(r(n)("input.uploading")),1)])):O("",!0)]))}}),uf=pe(df,[["__scopeId","data-v-6783ceee"]]);class He{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const s=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to get cron task by id:",s),s}}static async createCronTask(e){try{const s=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to create cron task:",s),s}}static async updateCronTask(e,s){try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to update cron task:",n),n}}static async updateTaskStatus(e,s){try{const n=await fetch(`${this.BASE_URL}/${e}/status?status=${s}`,{method:"PUT"});await this.handleResponse(n)}catch(n){throw console.error("Failed to update task status:",n),n}}static async deleteCronTask(e){try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(s)}catch(s){throw console.error("Failed to delete cron task:",s),s}}static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ge(He,"BASE_URL","/api/cron-tasks");const Ge={validateCronExpression(o){const e=o.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(o){return new Date(o).toLocaleString()},async saveTask(o){try{let e;return o.id?e=await He.updateCronTask(Number(o.id),o):e=await He.createCronTask(o),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(o){try{await He.deleteCronTask(String(o))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(o){if(!o.id)throw new Error("Task ID is required");const e=o.status===0?1:0;return await He.updateCronTask(Number(o.id),{...o,status:e})},prepareTaskExecution(o){return o.planTemplateId?{useTemplate:!0,planData:{title:o.cronName||"Scheduled Task Execution",planData:{id:o.planTemplateId,planTemplateId:o.planTemplateId,planId:o.planTemplateId},params:o.executionParams||void 0}}:{useTemplate:!1,taskContent:o.planDesc||o.cronName||""}}},pf={class:"modal-header"},hf={class:"header-actions"},mf={class:"status-switch"},ff={class:"status-label"},vf={class:"toggle-switch"},gf=["checked"],bf={class:"modal-content"},yf={class:"form-group"},_f={class:"form-label"},$f=["placeholder"],wf={class:"form-group"},Sf={class:"form-label"},kf=["placeholder"],Tf={class:"form-help"},Pf={class:"form-group"},Ef={class:"form-label"},Cf=["placeholder"],If={class:"form-group"},Rf={class:"form-label"},Af={class:"template-toggle"},xf={key:0,class:"template-selector"},Df={value:""},Mf=["value"],Nf={class:"form-help"},Uf={key:0,class:"form-group"},Ff={class:"time-info"},Lf={class:"time-label"},Bf={class:"time-value"},Of={key:1,class:"form-group"},qf={class:"time-info"},jf={class:"time-label"},Vf={class:"time-value"},Hf={class:"modal-footer"},Gf=["disabled"],zf=ue({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(o,{emit:e}){const s=o,n=e,a=U(!1),l=U([]),i=U({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),h=async()=>{try{const _=await et.getAllPlanTemplates();_&&_.templates&&(l.value=_.templates.map(y=>({id:y.id,name:y.title||"Unnamed Template"})))}catch(_){console.error("Failed to get template list:",_)}},g=_=>{_.key==="Escape"&&s.modelValue&&n("update:modelValue",!1)};we(()=>{h(),document.addEventListener("keydown",g)}),Te(()=>{document.removeEventListener("keydown",g)});const u=_=>{_.target===_.currentTarget&&n("update:modelValue",!1)},d=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},b=()=>i.value.cronName.trim()?i.value.cronTime.trim()?Ge.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),C=_=>Ge.formatTime(_),M=async()=>{var _;if(b()){a.value=!0;try{const y={...i.value,...((_=s.task)==null?void 0:_.id)!==void 0&&{id:s.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};n("save",y)}finally{a.value=!1}}};return ie(()=>s.task,_=>{if(_){const y=_.templateId||_.planTemplateId||"";i.value={cronName:_.cronName||"",cronTime:_.cronTime||"",planDesc:_.planDesc||"",status:_.status??1,linkTemplate:!!y,templateId:y,planTemplateId:y}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),ie(()=>s.modelValue,_=>{_||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(_,y)=>(p(),ae(Qe,{to:"body"},[S(qe,{name:"modal"},{default:Me(()=>{var v,$,E;return[_.modelValue?(p(),f("div",{key:0,class:"modal-overlay",onClick:u},[t("div",{class:"modal-container",onClick:y[8]||(y[8]=he(()=>{},["stop"]))},[t("div",pf,[t("h3",null,c(_.$t("cronTask.taskDetail")),1),t("div",hf,[t("div",mf,[t("span",ff,c(_.$t("cronTask.taskStatus")),1),t("label",vf,[t("input",{type:"checkbox",checked:i.value.status===0,onChange:y[0]||(y[0]=w=>i.value.status=i.value.status===0?1:0)},null,40,gf),y[9]||(y[9]=t("span",{class:"toggle-slider"},null,-1))])]),t("button",{class:"close-btn",onClick:y[1]||(y[1]=w=>_.$emit("update:modelValue",!1))},[S(r(P),{icon:"carbon:close"})])])]),t("div",bf,[t("form",{onSubmit:he(M,["prevent"]),class:"task-form"},[t("div",yf,[t("label",_f,c(_.$t("cronTask.taskName")),1),te(t("input",{"onUpdate:modelValue":y[2]||(y[2]=w=>i.value.cronName=w),type:"text",class:"form-input",placeholder:_.$t("cronTask.taskNamePlaceholder"),required:""},null,8,$f),[[le,i.value.cronName]])]),t("div",wf,[t("label",Sf,c(_.$t("cronTask.cronExpression")),1),te(t("input",{"onUpdate:modelValue":y[3]||(y[3]=w=>i.value.cronTime=w),type:"text",class:"form-input",placeholder:_.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,kf),[[le,i.value.cronTime]]),t("div",Tf,c(_.$t("cronTask.cronExpressionHelp")),1)]),t("div",Pf,[t("label",Ef,c(_.$t("cronTask.taskDescription")),1),te(t("textarea",{"onUpdate:modelValue":y[4]||(y[4]=w=>i.value.planDesc=w),class:"form-textarea",placeholder:_.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,Cf),[[le,i.value.planDesc]])]),t("div",If,[t("label",Rf,c(_.$t("cronTask.planTemplate")),1),t("div",Af,[t("button",{type:"button",class:ne(["template-btn",i.value.linkTemplate?"active":""]),onClick:y[5]||(y[5]=w=>i.value.linkTemplate=!0)},[S(r(P),{icon:"carbon:checkmark"}),se(" "+c(_.$t("cronTask.linkTemplate")),1)],2),t("button",{type:"button",class:ne(["template-btn",i.value.linkTemplate?"":"active"]),onClick:d},[S(r(P),{icon:"carbon:close"}),se(" "+c(_.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(p(),f("div",xf,[te(t("select",{"onUpdate:modelValue":y[6]||(y[6]=w=>i.value.templateId=w),class:"form-select"},[t("option",Df,c(_.$t("cronTask.selectTemplate")),1),(p(!0),f(oe,null,re(l.value,w=>(p(),f("option",{key:w.id,value:w.id},c(w.name),9,Mf))),128))],512),[[nt,i.value.templateId]]),t("div",Nf,c(_.$t("cronTask.templateHelpText")),1)])):O("",!0)]),(v=_.task)!=null&&v.createTime?(p(),f("div",Uf,[t("div",Ff,[t("span",Lf,c(_.$t("cronTask.createTime"))+":",1),t("span",Bf,c(C(_.task.createTime)),1)])])):O("",!0),($=_.task)!=null&&$.updateTime?(p(),f("div",Of,[t("div",qf,[t("span",jf,c(_.$t("cronTask.updateTime"))+":",1),t("span",Vf,c(C(_.task.updateTime)),1)])])):O("",!0)],32)]),t("div",Hf,[t("button",{type:"button",class:"cancel-btn",onClick:y[7]||(y[7]=w=>_.$emit("update:modelValue",!1))},c(_.$t("common.cancel")),1),t("button",{type:"button",class:"save-btn",onClick:M,disabled:a.value},[a.value?(p(),ae(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):O("",!0),se(" "+c((E=s.task)!=null&&E.id?_.$t("common.save"):_.$t("common.create")),1)],8,Gf)])])])):O("",!0)]}),_:1})]))}}),Wf=pe(zf,[["__scopeId","data-v-45bbcf14"]]),Jf={class:"modal-header"},Kf={class:"header-actions"},Xf={class:"modal-content"},Yf={key:0,class:"loading-container"},Qf={key:1,class:"empty-container"},Zf={key:2,class:"task-list"},ev=["onClick"],tv={class:"task-main"},sv={class:"task-info"},nv={class:"task-header"},ov={class:"task-name"},av={class:"task-description"},lv={class:"task-time"},rv=["onClick"],iv=["onClick","disabled","title"],cv=["onClick","title"],dv={class:"dropdown-menu"},uv=["onClick"],pv=["onClick","disabled"],hv=["onClick","disabled"],mv={class:"confirm-header"},fv={class:"confirm-content"},vv={class:"confirm-actions"},gv=["disabled"],bv={class:"confirm-header"},yv={class:"confirm-content"},_v={class:"create-options"},$v={class:"option-content"},wv={class:"option-title"},Sv={class:"option-desc"},kv={class:"option-content"},Tv={class:"option-title"},Pv={class:"option-desc"},Ev={class:"confirm-actions"},Cv=ue({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(o,{emit:e}){const s=rs(),n=is(),a=cs(),{t:l}=Pe(),i=o,h=e,g=U([]),u=U(!1),d=U(null),b=U(null),C=U(null),M=U(null),_=U(!1),y=U(null),v=U(!1),$=U(null),E=U(!1),w=W=>{W.target===W.currentTarget&&h("update:modelValue",!1)},R=async()=>{u.value=!0;try{g.value=await He.getAllCronTasks()}catch(W){console.error("Failed to load cron tasks:",W),a.error(`Failed to load tasks: ${W instanceof Error?W.message:String(W)}`)}finally{u.value=!1}},m=async W=>{d.value=W;try{const T=g.value.find(q=>q.id===W);if(!T){console.error("Task not found:",W);return}h("update:modelValue",!1);const V=Date.now().toString();await s.push({name:"direct",params:{id:V}}),await new Promise(q=>setTimeout(q,100));const L=Ge.prepareTaskExecution(T);L.useTemplate&&L.planData?n.emitPlanExecutionRequested(L.planData):L.taskContent&&n.setTask(L.taskContent)}catch(T){console.error("Failed to execute task:",T),a.error(`Execution failed: ${T instanceof Error?T.message:String(T)}`)}finally{d.value=null}},j=W=>{y.value={...W},_.value=!0,M.value=null},x=async W=>{try{await Ge.saveTask(W),await R(),_.value=!1,a.success("Task saved successfully")}catch(T){console.error("Failed to save task:",T),a.error(`Save failed: ${T instanceof Error?T.message:String(T)}`)}},J=W=>{$.value=W,v.value=!0},k=async()=>{var W;if((W=$.value)!=null&&W.id){b.value=$.value.id;try{await Ge.deleteTask($.value.id),await R(),v.value=!1,$.value=null,a.success("Task deleted successfully")}catch(T){console.error("Failed to delete task:",T),a.error(`Delete failed: ${T instanceof Error?T.message:String(T)}`)}finally{b.value=null}}},N=()=>{v.value=!1,$.value=null},z=W=>{M.value=M.value===W?null:W},F=async W=>{if(W.id){C.value=W.id;try{await Ge.toggleTaskStatus(W),await R(),M.value=null,a.success(`Task ${W.status===0?"disabled":"enabled"} successfully`)}catch(T){console.error("Failed to toggle task status:",T),a.error(`Status toggle failed: ${T instanceof Error?T.message:String(T)}`)}finally{C.value=null}}},A=async W=>{try{await navigator.clipboard.writeText(W),a.success("Cron expression copied successfully")}catch(T){a.error(`Copy failed: ${T instanceof Error?T.message:String(T)}`)}},B=()=>{E.value=!0},D=()=>{E.value=!1;try{h("update:modelValue",!1);const W=l("cronTask.template");n.setTaskToInput(W);const T=Date.now().toString();s.push({name:"direct",params:{id:T}})}catch(W){console.error("Error in createWithJmanus:",W),a.error(`Creation failed: ${W instanceof Error?W.message:String(W)}`)}},Q=()=>{E.value=!1,y.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},_.value=!0},Z=()=>{E.value=!1},ce=W=>{const T=W.target;!T.closest(".action-dropdown")&&!T.closest(".dropdown-menu")&&(M.value=null)},fe=W=>{W.key==="Escape"&&(v.value?N():E.value?Z():i.modelValue&&h("update:modelValue",!1))};return we(()=>{document.addEventListener("click",ce,!0),document.addEventListener("keydown",fe)}),Te(()=>{document.removeEventListener("click",ce,!0),document.removeEventListener("keydown",fe)}),ie(()=>i.modelValue,W=>{W&&R()}),(W,T)=>(p(),f(oe,null,[(p(),ae(Qe,{to:"body"},[S(qe,{name:"modal"},{default:Me(()=>[o.modelValue?(p(),f("div",{key:0,class:"modal-overlay",onClick:w},[t("div",{class:"modal-container",onClick:T[3]||(T[3]=he(()=>{},["stop"]))},[t("div",Jf,[t("h3",null,c(W.$t("cronTask.title")),1),t("div",Kf,[t("button",{class:"add-task-btn",onClick:[B,T[0]||(T[0]=he(()=>{},["stop"]))]},[S(r(P),{icon:"carbon:add"}),se(" "+c(W.$t("cronTask.addTask")),1)]),t("button",{class:"close-btn",onClick:T[1]||(T[1]=V=>W.$emit("update:modelValue",!1))},[S(r(P),{icon:"carbon:close"})])])]),t("div",Xf,[u.value?(p(),f("div",Yf,[S(r(P),{icon:"carbon:loading",class:"loading-icon"}),t("span",null,c(W.$t("common.loading")),1)])):g.value.length===0?(p(),f("div",Qf,[S(r(P),{icon:"carbon:time",class:"empty-icon"}),t("span",null,c(W.$t("cronTask.noTasks")),1)])):(p(),f("div",Zf,[(p(!0),f(oe,null,re(g.value,V=>(p(),f("div",{key:V.id||"",class:"task-item",onClick:L=>j(V)},[t("div",tv,[t("div",sv,[t("div",nv,[t("div",ov,c(V.cronName),1),t("div",{class:ne(["task-status-badge",V.status===0?"active":"inactive"])},[S(r(P),{icon:V.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),t("span",null,c(V.status===0?W.$t("cronTask.active"):W.$t("cronTask.inactive")),1)],2)]),t("div",av,c(V.planDesc),1),t("div",lv,[S(r(P),{icon:"carbon:time"}),t("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:he(L=>A(V.cronTime),["stop"])},c(V.cronTime),9,rv)])])]),t("div",{class:"task-actions",onClick:T[2]||(T[2]=he(()=>{},["stop"]))},[t("button",{class:"action-btn execute-btn",onClick:L=>m(V.id),disabled:d.value===V.id,title:W.$t("cronTask.executeOnce")},[S(r(P),{icon:d.value===V.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),se(" "+c(W.$t("cronTask.executeOnce")),1)],8,iv),t("div",{class:ne(["action-dropdown",{active:M.value===V.id}])},[t("button",{class:"action-btn dropdown-btn",onClick:L=>z(V.id),title:W.$t("cronTask.operations")},[S(r(P),{icon:"carbon:overflow-menu-horizontal"}),se(" "+c(W.$t("cronTask.operations")),1)],8,cv),te(t("div",dv,[t("button",{class:"dropdown-item edit-btn",onClick:L=>j(V)},[S(r(P),{icon:"carbon:edit"}),se(" "+c(W.$t("cronTask.edit")),1)],8,uv),t("button",{class:"dropdown-item toggle-btn",onClick:L=>F(V),disabled:C.value===V.id},[S(r(P),{icon:C.value===V.id?"carbon:loading":V.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),se(" "+c(V.status===0?W.$t("cronTask.disable"):W.$t("cronTask.enable")),1)],8,pv),t("button",{class:"dropdown-item delete-btn",onClick:L=>J(V),disabled:b.value===V.id},[S(r(P),{icon:b.value===V.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),se(" "+c(W.$t("cronTask.delete")),1)],8,hv)],512),[[os,M.value===V.id]])],2)])],8,ev))),128))]))])])])):O("",!0)]),_:1})])),S(Wf,{modelValue:_.value,"onUpdate:modelValue":T[4]||(T[4]=V=>_.value=V),task:y.value,onSave:x},null,8,["modelValue","task"]),(p(),ae(Qe,{to:"body"},[S(qe,{name:"modal"},{default:Me(()=>{var V,L,q,K;return[v.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:N},[t("div",{class:"confirm-modal",onClick:T[5]||(T[5]=he(()=>{},["stop"]))},[t("div",mv,[S(r(P),{icon:"carbon:warning",class:"warning-icon"}),t("h3",null,c(W.$t("cronTask.deleteConfirm")),1)]),t("div",fv,[t("p",null,c(W.$t("cronTask.deleteConfirmMessage",{taskName:((V=$.value)==null?void 0:V.cronName)||((L=$.value)==null?void 0:L.planDesc)||""})),1)]),t("div",vv,[t("button",{class:"confirm-btn cancel-btn",onClick:N},c(W.$t("common.cancel")),1),t("button",{class:"confirm-btn delete-btn",onClick:k,disabled:b.value===((q=$.value)==null?void 0:q.id)},[S(r(P),{icon:b.value===((K=$.value)==null?void 0:K.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),se(" "+c(W.$t("cronTask.delete")),1)],8,gv)])])])):O("",!0)]}),_:1})])),(p(),ae(Qe,{to:"body"},[S(qe,{name:"modal"},{default:Me(()=>[E.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Z},[t("div",{class:"confirm-modal create-options-modal",onClick:T[6]||(T[6]=he(()=>{},["stop"]))},[t("div",bv,[S(r(P),{icon:"carbon:time",class:"create-icon"}),t("h3",null,c(W.$t("cronTask.createTask")),1)]),t("div",yv,[t("p",null,c(W.$t("cronTask.selectCreateMethod")),1),t("div",_v,[t("button",{class:"create-option-btn jmanus-btn",onClick:D},[S(r(P),{icon:"carbon:ai-status"}),t("div",$v,[t("span",wv,c(W.$t("cronTask.createWithJmanus")),1),t("span",Sv,c(W.$t("cronTask.createWithJmanusDesc")),1)])]),t("button",{class:"create-option-btn manual-btn",onClick:Q},[S(r(P),{icon:"carbon:edit"}),t("div",kv,[t("span",Tv,c(W.$t("cronTask.createManually")),1),t("span",Pv,c(W.$t("cronTask.createManuallyDesc")),1)])])])]),t("div",Ev,[t("button",{class:"confirm-btn cancel-btn",onClick:Z},c(W.$t("common.cancel")),1)])])])):O("",!0)]),_:1})]))],64))}}),Iv=pe(Cv,[["__scopeId","data-v-a90a3961"]]),Rv={class:"direct-page"},Av={class:"direct-chat"},xv={class:"chat-header"},Dv={class:"header-actions"},Mv=["title"],Nv=["title"],Uv=["title"],Fv=["title"],Lv={class:"chat-content"},Bv=["title"],Ov={class:"message-content"},qv=ue({__name:"index",setup(o){const e=qs(),s=rs(),n=is(),{t:a}=Pe(),{message:l}=zs(),i=U(""),h=U(""),g=U(),u=U(),d=U(),b=U(),C=U(!1),M=U(!1),_=U(null),y=U(!1),v=U(50),$=U(!1),E=U(0),w=U(0),R=de(()=>{if(G.isCollapsed)return v.value;let L=26;b.value&&b.value.sidebarWidth!==void 0&&(L=b.value.sidebarWidth);const q=100-L;return Math.max(20,Math.min(q,v.value))});we(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",n.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",n.hasUnprocessedTask()),Ne.setEventCallbacks({onPlanUpdate:q=>{console.log("[Direct] Plan update event received for rootPlanId:",q),k(q)&&(console.log("[Direct] Processing plan update for current rootPlanId:",q),u.value&&typeof u.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",q),u.value.handlePlanUpdate(q)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),g.value&&typeof g.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",q),g.value.updateDisplayedPlanProgress(q)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:q=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",q),!!k(q)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",q),u.value&&typeof u.value.handlePlanCompleted=="function"){const K=Ne.getCachedPlanRecord(q);console.log("[Direct] Calling chatRef.handlePlanCompleted with details:",K),u.value.handlePlanCompleted(K??{planId:q})}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");_.value=null,console.log("[Direct] Cleared currentRootPlanId after plan completion")}},onDialogRoundStart:q=>{console.log("[Direct] Dialog round start event received for rootPlanId:",q),_.value=q,console.log("[Direct] Set currentRootPlanId to:",q),u.value&&typeof u.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",q),u.value.handleDialogRoundStart(q)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),F()},onChatInputUpdateState:q=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",q),!k(q,!0))return;const K=Ne.getCachedUIState(q);K&&B(K.enabled,K.placeholder)},onPlanError:q=>{u.value.handlePlanError(q)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),G.loadPlanTemplateList(),n.hasUnprocessedTask()&&n.currentTask){const q=n.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",q),n.markTaskAsProcessed(),ke(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",q),await N({input:q})}catch(K){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",K),i.value=q}})}else{const q=n.getAndClearTaskToInput();q?(h.value=q,console.log("[Direct] Setting inputOnlyContent for input only:",h.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const L=localStorage.getItem("directPanelWidth");L&&(v.value=parseFloat(L)),console.log("[Direct] Final prompt value:",i.value),h.value&&ke(()=>{d.value&&typeof d.value.setInputValue=="function"&&(d.value.setInputValue(h.value),console.log("[Direct] Set input value:",h.value),h.value="")}),window.addEventListener("plan-execution-requested",q=>{console.log("[DirectView] Received plan-execution-requested event:",q.detail),W(q.detail)})}),ie(()=>n.currentTask,L=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",L),L&&!L.processed){const q=L.prompt;n.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",q),ke(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",q),await N({input:q})}catch(K){console.warn("[Direct] handleChatSendMessage failed for new task:",K)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),ie(()=>i.value,(L,q)=>{console.log("[Direct] prompt value changed from:",q,"to:",L)},{immediate:!1}),ie(()=>n.taskToInput,L=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",L),L!=null&&L.trim()&&(console.log("[Direct] Setting input value from taskToInput:",L),ke(()=>{d.value&&typeof d.value.setInputValue=="function"&&(d.value.setInputValue(L.trim()),console.log("[Direct] Input value set from taskToInput watch:",L.trim()),n.getAndClearTaskToInput())}))},{immediate:!1}),Te(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),_.value=null,Ne.cleanup(),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",x),window.removeEventListener("plan-execution-requested",L=>{W(L.detail)})});const m=L=>{$.value=!0,E.value=L.clientX,w.value=v.value,document.addEventListener("mousemove",j),document.addEventListener("mouseup",x),document.body.style.cursor="col-resize",document.body.style.userSelect="none",L.preventDefault()},j=L=>{if(!$.value)return;const q=window.innerWidth,ve=(L.clientX-E.value)/q*100;let H=w.value+ve;H=Math.max(20,Math.min(80,H)),v.value=H},x=()=>{$.value=!1,document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",x),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",v.value.toString())},J=()=>{v.value=50,localStorage.setItem("directPanelWidth","50")},k=(L,q=!1)=>!_.value||L===_.value||q&&(L==="ui-state"||L==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",L,"current:",_.value),!1),N=async L=>{var K,ve,H,Y,X,ye,xe,Ke,Xe;let q=null;try{console.log("[DirectView] Processing send-message event:",L);const Re=(K=u.value)==null?void 0:K.addMessage("user",L.input);L.attachments&&Re&&((ve=u.value)==null||ve.updateMessage(Re.id,{attachments:L.attachments})),q=(H=u.value)==null?void 0:H.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),q&&((Y=u.value)==null||Y.startStreaming(q.id));const{DirectApiService:lt}=await js(async()=>{const{DirectApiService:rt}=await Promise.resolve().then(()=>Om);return{DirectApiService:rt}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessage");const Ee=await lt.sendMessage(L);console.log("[DirectView] API response received:",Ee),Ee.planId&&q?((X=u.value)==null||X.updateMessage(q.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ee.planId,rootPlanId:Ee.planId,status:"running"}}),_.value=Ee.planId,console.log("[DirectView] Set currentRootPlanId to:",Ee.planId),Ne.handlePlanExecutionRequested(Ee.planId,L.input),console.log("[DirectView] Started polling for plan execution updates")):q&&((ye=u.value)==null||ye.updateMessage(q.id,{content:Ee.message||Ee.result||"No response received from backend"}),(xe=u.value)==null||xe.stopStreaming(q.id))}catch(Re){console.error("[DirectView] Send message failed:",Re),(Ke=u.value)==null||Ke.addMessage("assistant",`Error: ${(Re==null?void 0:Re.message)||"Failed to send message"}`),q&&((Xe=u.value)==null||Xe.stopStreaming(q.id))}},z=async L=>{console.log("[DirectView] Send message from input:",JSON.stringify(L)),await N(L)},F=()=>{console.log("[DirectView] Input cleared"),d.value&&typeof d.value.clear=="function"&&d.value.clear()},A=()=>{console.log("[DirectView] Input focused")},B=(L,q)=>{console.log("[DirectView] Input state updated:",L,q),M.value=!L},D=L=>{console.log("[DirectView] Step selected:",L),g.value&&typeof g.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",L),g.value.handleStepSelected(L)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},Q=(L,q,K,ve)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:L,subPlanId:q,stepIndex:K,subStepIndex:ve}),g.value&&typeof g.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:L,subPlanId:q,stepIndex:K,subStepIndex:ve}),g.value.handleSubPlanStepSelected(L,q,K,ve)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},Z=()=>{console.log("[DirectView] Plan mode button clicked"),G.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",G.isCollapsed)},ce=()=>{s.push("/home")},fe=()=>{s.push("/configs")},W=async L=>{var ve,H,Y,X,ye,xe,Ke,Xe,Re,lt,Ee,rt;if(console.log("[DirectView] Plan execution requested:",L),C.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}C.value=!0;let q=!1,K=null;try{console.log("[DirectView] Adding messages for plan execution:",L.title),(ve=u.value)==null||ve.addMessage("user",L.title),q=!0,K=(H=u.value)==null?void 0:H.addMessage("assistant","",{thinking:a("chat.planningExecution")}),K&&((Y=u.value)==null||Y.startStreaming(K.id),console.log("[DirectView] Added assistant message for plan execution:",K.id))}catch(Se){console.warn("[DirectView] Failed to add messages:",Se)}try{const Se=((X=L.planData)==null?void 0:X.planTemplateId)||((ye=L.planData)==null?void 0:ye.id)||((xe=L.planData)==null?void 0:xe.planId);if(!Se)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",Se,"params:",L.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Fe=Jm()?Wm():void 0;console.log("[Direct] Executing with uploaded files:",(Fe==null?void 0:Fe.length)??0),console.log("[Direct] Executing with replacement params:",L.replacementParams);let Ce;if((Ke=L.params)!=null&&Ke.trim()?(console.log("[Direct] Calling executePlan with rawParam:",L.params.trim()),Ce=await et.executePlan(Se,L.params.trim(),Fe,L.replacementParams)):(console.log("[Direct] Calling executePlan without rawParam"),Ce=await et.executePlan(Se,void 0,Fe,L.replacementParams)),console.log("[Direct] Plan execution API response:",Ce),Ce.planId&&K)console.log("[Direct] Got planId from response:",Ce.planId,"starting plan execution"),(Xe=u.value)==null||Xe.updateMessage(K.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ce.planId,rootPlanId:Ce.planId,status:"running"}}),_.value=Ce.planId,console.log("[Direct] Set currentRootPlanId to:",Ce.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Ne.handlePlanExecutionRequested(Ce.planId,L.title);else throw console.error("[Direct] No planId in response:",Ce),new Error(a("direct.executionFailedNoPlanId"))}catch(Se){console.error("[Direct] Plan execution failed:",Se),console.error("[Direct] Error details:",{message:Se.message,stack:Se.stack}),_.value=null;try{console.log("[Direct] Adding error messages to chat"),q||(Re=u.value)==null||Re.addMessage("user",L.title),K?((lt=u.value)==null||lt.updateMessage(K.id,{content:`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`,thinking:void 0}),(Ee=u.value)==null||Ee.stopStreaming(K.id)):(rt=u.value)==null||rt.addMessage("assistant",`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`)}catch(Fe){console.error("[Direct] Failed to add error messages:",Fe),alert(`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),C.value=!1}},T=()=>{u.value.showMemory()},V=()=>{Ue.clearMemoryId(),u.value.newChat()};return(L,q)=>(p(),f("div",Rv,[t("div",Av,[S(Gi,{ref_key:"sidebarRef",ref:b,onPlanExecutionRequested:W},null,512),t("div",{class:"left-panel",style:ze({width:R.value+"%"})},[t("div",xv,[t("button",{class:"back-button",onClick:ce},[S(r(P),{icon:"carbon:arrow-left"})]),t("h2",null,c(L.$t("conversation")),1),t("div",Dv,[S(Js),t("button",{class:"config-button",onClick:V,title:L.$t("memory.newChat")},[S(r(P),{icon:"carbon:add",width:"20"})],8,Mv),t("button",{class:"config-button",onClick:fe,title:L.$t("direct.configuration")},[S(r(P),{icon:"carbon:settings-adjust",width:"20"})],8,Nv),t("button",{class:"cron-task-btn",onClick:q[0]||(q[0]=K=>y.value=!0),title:L.$t("cronTask.title")},[S(r(P),{icon:"carbon:alarm",width:"20"})],8,Uv),t("button",{class:"cron-task-btn",onClick:q[1]||(q[1]=K=>r(Ue).toggleSidebar()),title:L.$t("memory.selectMemory")},[S(r(P),{icon:"carbon:calendar",width:"20"})],8,Fv)])]),t("div",Lv,[S(zm,{ref_key:"chatRef",ref:u,mode:"direct","initial-prompt":i.value||"",onStepSelected:D,onSubPlanStepSelected:Q},null,8,["initial-prompt"])]),(p(),ae(uf,{key:L.$i18n.locale,ref_key:"inputRef",ref:d,disabled:M.value,placeholder:M.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":i.value,onSend:z,onClear:F,onFocus:A,onUpdateState:B,onPlanModeClicked:Z},null,8,["disabled","placeholder","initial-value"]))],4),t("div",{class:"panel-resizer",onMousedown:m,onDblclick:J,title:L.$t("direct.panelResizeHint")},q[3]||(q[3]=[t("div",{class:"resizer-line"},null,-1)]),40,Bv),S(Hu,{ref_key:"rightPanelRef",ref:g,style:ze({width:100-v.value+"%"}),"current-root-plan-id":_.value},null,8,["style","current-root-plan-id"])]),S(Iv,{modelValue:y.value,"onUpdate:modelValue":q[2]||(q[2]=K=>y.value=K)},null,8,["modelValue"]),S(Oc,{onMemorySelected:T}),r(l).show?(p(),f("div",{key:0,class:ne(["message-toast",r(l).type])},[t("div",Ov,[t("span",null,c(r(l).text),1)])],2)):O("",!0)]))}}),hg=pe(qv,[["__scopeId","data-v-0d21d333"]]);export{hg as default};

var De=Object.defineProperty;var Le=(B,o,a)=>o in B?De(B,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):B[o]=a;var me=(B,o,a)=>Le(B,typeof o!="symbol"?o+"":o,a);import{d as le,c as r,o as i,e,t,f as ye,r as M,m as ne,g as ae,h as Ce,i as y,b as E,s as w,w as I,v as j,F as z,j as H,q as W,E as Ae,a as ee,z as X,T as _e,G as Ee,u as s,H as Pe,x as he,A as Te,I as Fe,k as Re,B as Ve,J as Be,C as Ie,l as qe}from"./index-PjGzWOoB.js";import{_ as ie,I as x}from"./_plugin-vue_export-helper-BloPnmjZ.js";import{L as Oe}from"./index-Ldf9OtvN.js";const Ge={class:"switch"},je=["checked"],Ke={class:"switch-label"},Je=le({__name:"index",props:{enabled:{type:Boolean},label:{}},emits:["update:switchValue"],setup(B,{emit:o}){const a=o,g=m=>{const p=m.target.checked;a("update:switchValue",p)};return(m,p)=>(i(),r("label",Ge,[e("input",{type:"checkbox",checked:m.enabled,onChange:g},null,40,je),p[0]||(p[0]=e("span",{class:"slider"},null,-1)),e("span",Ke,t(m.label),1)]))}}),ze=ie(Je,[["__scopeId","data-v-d484b4a3"]]);class be{static async getConfigsByGroup(o){try{const a=await fetch(`${this.BASE_URL}/group/${o}`);if(!a.ok)throw new Error(`Failed to get ${o} group configuration: ${a.status}`);return await a.json()}catch(a){throw console.error(`Failed to get ${o} group configuration:`,a),a}}static async batchUpdateConfigs(o){if(o.length===0)return{success:!0,message:"No configuration needs to be updated"};try{const a=await fetch(`${this.BASE_URL}/batch-update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Batch update configuration failed: ${a.status}`);return{success:!0,message:"Configuration saved successfully"}}catch(a){return console.error("Batch update configuration failed:",a),{success:!1,message:a instanceof Error?a.message:"Update failed, please try again"}}}static async getConfigById(o){try{const a=await fetch(`${this.BASE_URL}/${o}`);if(!a.ok)throw new Error(`Failed to get configuration item: ${a.status}`);return await a.json()}catch(a){throw console.error(`Failed to get configuration item[${o}]:`,a),a}}static async updateConfig(o){try{const a=await fetch(`${this.BASE_URL}/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Failed to update configuration item: ${a.status}`);return{success:!0,message:"Configuration updated successfully"}}catch(a){return console.error("Failed to update configuration item:",a),{success:!1,message:a instanceof Error?a.message:"Update failed, please try again"}}}}me(be,"BASE_URL","/api/config");const He={class:"config-panel"},Ye={class:"config-header"},Xe={class:"header-left"},We={class:"config-stats"},Qe={class:"stat-item"},Ze={class:"stat-label"},eo={class:"stat-value"},oo={key:0,class:"stat-item"},to={class:"stat-label"},so={class:"stat-value modified"},no={class:"header-right"},ao={class:"import-export-actions"},lo=["title"],io=["title"],co={class:"search-box"},ro=["placeholder"],uo={key:0,class:"loading-container"},po={key:1,class:"config-groups"},fo={class:"group-header"},go={class:"group-info"},mo={class:"group-icon"},vo={class:"group-actions"},ho=["onClick","disabled","title"],yo={class:"sub-groups"},_o=["onClick"],bo={class:"sub-group-info"},Co={class:"sub-group-title"},$o={class:"item-count"},wo={class:"config-items"},ko={key:0,class:"config-item-content vertical-layout"},So={class:"config-item-info"},To={class:"config-item-header"},Vo={class:"config-label"},Ao={class:"type-badge boolean"},xo={key:0,class:"modified-badge"},Po=["title"],Uo={class:"config-control"},Eo=["value","onChange"],Mo=["value"],No={key:1,class:"config-item-content vertical-layout"},Do={class:"config-item-info"},Lo={class:"config-item-header"},Fo={class:"config-label"},Ro={class:"type-badge select"},Bo={key:0,class:"modified-badge"},Io=["title"],qo={class:"config-control"},Oo=["value","onChange"],Go=["value"],jo={key:2,class:"config-item-content vertical-layout"},Ko={class:"config-item-info"},Jo={class:"config-item-header"},zo={class:"config-label"},Ho={class:"type-badge textarea"},Yo={key:0,class:"modified-badge"},Xo=["title"],Wo={class:"config-control"},Qo=["value","onInput"],Zo={key:3,class:"config-item-content vertical-layout"},et={class:"config-item-info"},ot={class:"config-item-header"},tt={class:"config-label"},st={class:"type-badge number"},nt={key:0,class:"modified-badge"},at=["title"],lt={key:0,class:"config-meta"},it={class:"range-info"},ct={class:"config-control"},rt=["value","onInput","min","max"],dt={key:4,class:"config-item-content vertical-layout"},ut={class:"config-item-info"},pt={class:"config-item-header"},ft={class:"config-label"},gt={class:"type-badge string"},mt={key:0,class:"modified-badge"},vt=["title"],ht={class:"config-control"},yt=["value","onInput"],_t={key:2,class:"empty-state"},bt=le({__name:"basicConfig",setup(B){const{t:o}=ye(),a=M(!0),g=M(!1),m=M([]),p=M(new Map),u=M(new Set),v=ne({show:!1,text:"",type:"success"}),V=M(""),P={headless:"config.basicConfig.browserSettings.headless",requestTimeout:"config.basicConfig.browserSettings.requestTimeout",debugDetail:"config.basicConfig.general.debugDetail",baseDir:"config.basicConfig.general.baseDir",openBrowser:"config.basicConfig.interactionSettings.openBrowser",maxSteps:"config.basicConfig.agentSettings.maxSteps",userInputTimeout:"config.basicConfig.agentSettings.userInputTimeout",maxMemory:"config.basicConfig.agentSettings.maxMemory",parallelToolCalls:"config.basicConfig.agentSettings.parallelToolCalls",forceOverrideFromYaml:"config.basicConfig.agents.forceOverrideFromYaml",enabled:"config.basicConfig.infiniteContext.enabled",parallelThreads:"config.basicConfig.infiniteContext.parallelThreads",taskContextSize:"config.basicConfig.infiniteContext.taskContextSize",allowExternalAccess:"config.basicConfig.fileSystem.allowExternalAccess"},_={manus:"config.basicConfig.groupDisplayNames.manus"},T={manus:"🤖",browser:"🌐",interaction:"🖥️",system:"⚙️",performance:"⚡"},L={agent:"config.subGroupDisplayNames.agent",browser:"config.subGroupDisplayNames.browser",interaction:"config.subGroupDisplayNames.interaction",agents:"config.subGroupDisplayNames.agents",infiniteContext:"config.subGroupDisplayNames.infiniteContext",general:"config.subGroupDisplayNames.general",filesystem:"config.subGroupDisplayNames.filesystem"},Q=ae(()=>m.value.some(d=>d.subGroups.some($=>$.items.some(k=>p.value.get(k.id)!==k.configValue)))),oe=d=>d==="true",q=d=>parseFloat(d)||0,b=d=>({maxSteps:1,browserTimeout:1,maxThreads:1,timeoutSeconds:5,maxMemory:1})[d]||1,O=d=>({maxSteps:100,browserTimeout:600,maxThreads:32,timeoutSeconds:300,maxMemory:1e3})[d]||1e4,Z=d=>typeof d=="string"?d:d.value,K=d=>typeof d=="string"?d:d.label,re=(d,$)=>{if(typeof $=="boolean")return $.toString();if(typeof $=="string"){if(d.options&&d.options.length>0){const k=d.options.find(S=>(typeof S=="string"?S:S.label)===$||(typeof S=="string"?S:S.value)===$);if(k)return typeof k=="string"?k:k.value}return $}return String($)},U=(d,$,k=!1)=>{let S;d.inputType==="BOOLEAN"||d.inputType==="CHECKBOX"?S=re(d,$):S=String($),d.configValue!==S&&(d.configValue=S,d._modified=!0,(k||d.inputType==="BOOLEAN"||d.inputType==="CHECKBOX"||d.inputType==="SELECT")&&n())};let l=null;const n=()=>{l&&clearTimeout(l),l=window.setTimeout(()=>{D()},500)},c=(d,$="success")=>{v.text=d,v.type=$,v.show=!0,setTimeout(()=>{v.show=!1},3e3)},F=async()=>{try{a.value=!0;const $=["manus"].map(async S=>{try{const f=await be.getConfigsByGroup(S);if(console.log("加载配置组:",S,f),f.length===0)return null;const N=f.map(Y=>({...Y,displayName:P[Y.configKey]||Y.configKey,min:b(Y.configKey),max:O(Y.configKey)}));N.forEach(Y=>{p.value.set(Y.id,Y.configValue)});const R=new Map;N.forEach(Y=>{const ce=Y.configSubGroup??"general";R.has(ce)||R.set(ce,[]),R.get(ce).push(Y)});const te=Array.from(R.entries()).map(([Y,ce])=>({name:Y,displayName:L[Y]||Y,items:ce}));return{name:S,displayName:_[S]||S,subGroups:te}}catch(f){return console.warn(`加载配置组 ${S} 失败，跳过:`,f),null}}),k=await Promise.all($);m.value=k.filter(S=>S!==null),console.log("配置加载完成:",m.value)}catch(d){console.error("加载配置失败:",d),c(o("config.basicConfig.loadConfigFailed"),"error")}finally{a.value=!1}},D=async()=>{if(!(g.value||!Q.value))try{g.value=!0;const d=[];if(m.value.forEach(k=>{k.subGroups.forEach(S=>{const f=S.items.filter(N=>N._modified);d.push(...f)})}),d.length===0){c("没有需要保存的修改");return}const $=await be.batchUpdateConfigs(d);$.success?(d.forEach(k=>{p.value.set(k.id,k.configValue),k._modified=!1}),c("配置保存成功")):c($.message||"保存失败","error")}catch(d){console.error("保存配置失败:",d),c(o("config.basicConfig.saveFailed"),"error")}finally{g.value=!1}},J=async d=>{if(confirm(`确定要重置 "${_[d]||d}" 组的所有配置吗？`))try{g.value=!0;const k=m.value.find(N=>N.name===d);if(!k)return;const S=[];if(k.subGroups.forEach(N=>{N.items.forEach(R=>{const te=se(R.configKey);te!==R.configValue&&S.push({...R,configValue:te})})}),S.length===0){c("该组配置已是默认值");return}const f=await be.batchUpdateConfigs(S);f.success?(await F(),c(`成功重置 ${S.length} 项配置`)):c(f.message||"重置失败","error")}catch(k){console.error("重置组配置失败:",k),c(o("config.basicConfig.resetFailed"),"error")}finally{g.value=!1}},se=d=>({systemName:"JTaskPilot",language:"zh-CN",maxThreads:"8",timeoutSeconds:"60",autoOpenBrowser:"false",headlessBrowser:"true",maxMemory:"1000"})[d]||"",$e=(d,$)=>{const k=`${d}-${$}`;u.value.has(k)?u.value.delete(k):u.value.add(k)},ge=(d,$)=>u.value.has(`${d}-${$}`),A=ae(()=>{const d=m.value.reduce((k,S)=>k+S.subGroups.reduce((f,N)=>f+N.items.length,0),0),$=m.value.reduce((k,S)=>k+S.subGroups.reduce((f,N)=>f+N.items.filter(R=>p.value.get(R.id)!==R.configValue).length,0),0);return{total:d,modified:$}}),h=ae(()=>{if(!V.value.trim())return m.value;const d=V.value.toLowerCase();return m.value.map($=>({...$,subGroups:$.subGroups.map(k=>({...k,items:k.items.filter(S=>S.displayName.toLowerCase().includes(d)||S.configKey.toLowerCase().includes(d)||S.description&&S.description.toLowerCase().includes(d))})).filter(k=>k.items.length>0)})).filter($=>$.subGroups.length>0)}),G=()=>{try{const d={timestamp:new Date().toISOString(),version:"1.0",configs:m.value.reduce((f,N)=>(N.subGroups.forEach(R=>{R.items.forEach(te=>{f[te.configKey]=te.configValue})}),f),{})},$=JSON.stringify(d,null,2),k=new Blob([$],{type:"application/json"}),S=document.createElement("a");S.href=URL.createObjectURL(k),S.download=`config-export-${new Date().toISOString().split("T")[0]}.json`,S.click(),c("配置导出成功")}catch(d){console.error("导出配置失败:",d),c("导出失败","error")}},C=d=>{var f;const $=d.target,k=(f=$.files)==null?void 0:f[0];if(!k)return;const S=new FileReader;S.onload=async N=>{var R;try{const te=JSON.parse((R=N.target)==null?void 0:R.result);if(!te.configs)throw new Error("无效的配置文件格式");if(!confirm("确定要导入配置吗？这将覆盖当前配置。"))return;g.value=!0;const ce=[];if(m.value.forEach(Me=>{Me.subGroups.forEach(Ne=>{Ne.items.forEach(Se=>{Object.prototype.hasOwnProperty.call(te.configs,Se.configKey)&&ce.push({...Se,configValue:te.configs[Se.configKey]})})})}),ce.length===0){c("没有找到可导入的配置项");return}const xe=await be.batchUpdateConfigs(ce);xe.success?(await F(),c(`成功导入 ${ce.length} 项配置`)):c(xe.message||"导入失败","error")}catch(te){console.error("导入配置失败:",te),c(o("config.basicConfig.importFailed"),"error")}finally{g.value=!1,$.value=""}},S.readAsText(k)};return Ce(()=>{F()}),(d,$)=>(i(),r("div",He,[e("div",Ye,[e("div",Xe,[e("h2",null,t(d.$t("config.basicConfig.title")),1),e("div",We,[e("span",Qe,[e("span",Ze,t(d.$t("config.basicConfig.totalConfigs"))+":",1),e("span",eo,t(A.value.total),1)]),A.value.modified>0?(i(),r("span",oo,[e("span",to,t(d.$t("config.basicConfig.modified"))+":",1),e("span",so,t(A.value.modified),1)])):E("",!0)])]),e("div",no,[e("div",ao,[e("button",{onClick:G,class:"action-btn",title:d.$t("config.basicConfig.exportConfigs")}," 📤 ",8,lo),e("label",{class:"action-btn",title:d.$t("config.basicConfig.importConfigs")},[$[1]||($[1]=w(" 📥 ")),e("input",{type:"file",accept:".json",onChange:C,style:{display:"none"}},null,32)],8,io)]),e("div",co,[I(e("input",{"onUpdate:modelValue":$[0]||($[0]=k=>V.value=k),type:"text",placeholder:d.$t("config.search"),class:"search-input"},null,8,ro),[[j,V.value]]),$[2]||($[2]=e("span",{class:"search-icon"},"🔍",-1))])])]),a.value?(i(),r("div",uo,[$[3]||($[3]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,t(d.$t("config.loading")),1)])):h.value.length>0?(i(),r("div",po,[(i(!0),r(z,null,H(h.value,k=>(i(),r("div",{key:k.name,class:"config-group"},[e("div",fo,[e("div",go,[e("span",mo,t(T[k.name]||"⚙️"),1)]),e("div",vo,[e("button",{onClick:S=>J(k.name),class:"reset-btn",disabled:g.value,title:d.$t("config.resetGroupConfirm")},t(d.$t("config.reset")),9,ho)]),$[4]||($[4]=e("div",{class:"group-divider"},null,-1))]),e("div",yo,[(i(!0),r(z,null,H(k.subGroups,S=>(i(),r("div",{key:S.name,class:"sub-group"},[e("div",{class:"sub-group-header",onClick:f=>$e(k.name,S.name)},[e("div",bo,[$[5]||($[5]=e("span",{class:"sub-group-icon"},"📁",-1)),e("h4",Co,t(d.$t(S.displayName)),1),e("span",$o,"("+t(S.items.length)+")",1)]),e("span",{class:W(["collapse-icon",{collapsed:ge(k.name,S.name)}])}," ▼ ",2)],8,_o),I(e("div",wo,[(i(!0),r(z,null,H(S.items,f=>(i(),r("div",{key:f.id,class:W(["config-item",{modified:p.value.get(f.id)!==f.configValue}])},[f.inputType==="BOOLEAN"||f.inputType==="CHECKBOX"?(i(),r("div",ko,[e("div",So,[e("div",To,[e("label",Vo,[w(t(d.$t(f.displayName)||f.description)+" ",1),e("span",Ao,t(f.inputType==="CHECKBOX"?d.$t("config.types.checkbox"):d.$t("config.types.boolean")),1),p.value.get(f.id)!==f.configValue?(i(),r("span",xo,t(d.$t("config.modified")),1)):E("",!0)]),e("span",{class:"config-key",title:f.configKey},t(f.configKey),9,Po)])]),e("div",Uo,[f.options&&f.options.length>0?(i(),r("select",{key:0,class:"config-input select-input",value:f.configValue,onChange:N=>{var R;return U(f,((R=N.target)==null?void 0:R.value)||"")}},[(i(!0),r(z,null,H(f.options,N=>(i(),r("option",{key:Z(N),value:Z(N)},t(K(N)),9,Mo))),128))],40,Eo)):(i(),ee(ze,{key:1,enabled:oe(f.configValue),label:"","onUpdate:switchValue":N=>U(f,N)},null,8,["enabled","onUpdate:switchValue"]))])])):f.inputType==="SELECT"?(i(),r("div",No,[e("div",Do,[e("div",Lo,[e("label",Fo,[w(t(d.$t(f.displayName)||f.description)+" ",1),e("span",Ro,t(d.$t("config.types.select")),1),p.value.get(f.id)!==f.configValue?(i(),r("span",Bo,t(d.$t("config.modified")),1)):E("",!0)]),e("span",{class:"config-key",title:f.configKey},t(f.configKey),9,Io)])]),e("div",qo,[e("select",{class:"config-input select-input",value:f.configValue,onChange:N=>{var R;return U(f,((R=N.target)==null?void 0:R.value)||"")}},[(i(!0),r(z,null,H(f.options||[],N=>(i(),r("option",{key:Z(N),value:Z(N)},t(K(N)),9,Go))),128))],40,Oo)])])):f.inputType==="TEXTAREA"?(i(),r("div",jo,[e("div",Ko,[e("div",Jo,[e("label",zo,[w(t(d.$t(f.displayName)||f.description)+" ",1),e("span",Ho,t(d.$t("config.types.textarea")),1),p.value.get(f.id)!==f.configValue?(i(),r("span",Yo,t(d.$t("config.modified")),1)):E("",!0)]),e("span",{class:"config-key",title:f.configKey},t(f.configKey),9,Xo)])]),e("div",Wo,[e("textarea",{class:"config-input textarea-input",value:f.configValue,onInput:N=>{var R;return U(f,((R=N.target)==null?void 0:R.value)||"")},onBlur:n,rows:"3"},null,40,Qo)])])):f.inputType==="NUMBER"?(i(),r("div",Zo,[e("div",et,[e("div",ot,[e("label",tt,[w(t(d.$t(f.displayName)||f.description)+" ",1),e("span",st,t(d.$t("config.types.number")),1),p.value.get(f.id)!==f.configValue?(i(),r("span",nt,t(d.$t("config.modified")),1)):E("",!0)]),e("span",{class:"config-key",title:f.configKey},t(f.configKey),9,at),f.min||f.max?(i(),r("div",lt,[e("span",it,t(d.$t("config.range"))+": "+t(f.min||0)+" - "+t(f.max||"∞"),1)])):E("",!0)])]),e("div",ct,[e("input",{type:"number",class:"config-input number-input",value:q(f.configValue),onInput:N=>{var R;return U(f,((R=N.target)==null?void 0:R.value)||"")},onBlur:n,min:f.min||1,max:f.max||1e4},null,40,rt)])])):(i(),r("div",dt,[e("div",ut,[e("div",pt,[e("label",ft,[w(t(d.$t(f.displayName)||f.description)+" ",1),e("span",gt,t(f.inputType==="TEXT"?d.$t("config.types.text"):d.$t("config.types.string")),1),p.value.get(f.id)!==f.configValue?(i(),r("span",mt,t(d.$t("config.modified")),1)):E("",!0)]),e("span",{class:"config-key",title:f.configKey},t(f.configKey),9,vt)])]),e("div",ht,[e("input",{type:"text",class:"config-input text-input",value:f.configValue,onInput:N=>{var R;return U(f,((R=N.target)==null?void 0:R.value)||"")},onBlur:n},null,40,yt)])]))],2))),128))],512),[[Ae,!ge(k.name,S.name)]])]))),128))])]))),128))])):(i(),r("div",_t,[e("p",null,t(d.$t("config.notFound")),1)])),y(_e,{name:"message-fade"},{default:X(()=>[v.show?(i(),r("div",{key:0,class:W(["message-toast",v.type])},t(v.text),3)):E("",!0)]),_:1})]))}}),Ct=ie(bt,[["__scopeId","data-v-8f028e7e"]]),$t={class:"modal-header"},wt={class:"modal-content"},kt={class:"modal-footer"},St=le({__name:"index",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""}},emits:["update:modelValue","confirm"],setup(B){const o=a=>{a.target===a.currentTarget&&(a.stopPropagation(),a.preventDefault())};return(a,g)=>(i(),ee(Ee,{to:"body"},[y(_e,{name:"modal"},{default:X(()=>[B.modelValue?(i(),r("div",{key:0,class:"modal-overlay",onClick:o},[e("div",{class:"modal-container",onClick:g[3]||(g[3]=he(()=>{},["stop"]))},[e("div",$t,[e("h3",null,t(B.title),1),e("button",{class:"close-btn",onClick:g[0]||(g[0]=m=>a.$emit("update:modelValue",!1))},[y(s(x),{icon:"carbon:close"})])]),e("div",wt,[Pe(a.$slots,"default",{},void 0,!0)]),e("div",kt,[Pe(a.$slots,"footer",{},()=>[e("button",{class:"cancel-btn",onClick:g[1]||(g[1]=m=>a.$emit("update:modelValue",!1))},t(a.$t("common.cancel")),1),e("button",{class:"confirm-btn",onClick:g[2]||(g[2]=m=>a.$emit("confirm"))},t(a.$t("common.confirm")),1)],!0)])])])):E("",!0)]),_:3})]))}}),fe=ie(St,[["__scopeId","data-v-baaf1c89"]]),Tt={class:"tool-selection-content"},Vt={class:"tool-controls"},At={class:"search-container"},xt={class:"sort-container"},Pt={class:"tool-summary"},Ut={class:"summary-text"},Et={key:0,class:"tool-groups"},Mt=["onClick"],Nt={class:"group-title-area"},Dt={class:"group-name"},Lt={class:"group-count"},Ft={class:"group-enable-all"},Rt=["checked","onChange","data-group"],Bt={class:"tool-info"},It={class:"tool-selection-name"},qt={key:0,class:"tool-selection-desc"},Ot={class:"tool-actions"},Gt=["checked","onChange"],jt={key:1,class:"empty-state"},Kt=le({__name:"index",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(B,{emit:o}){const a=B,g=o,m=ae({get:()=>a.modelValue,set:l=>g("update:modelValue",l)}),p=M(""),u=M("group"),v=M(new Set),V=M([]),P=(l,n)=>{const c=document.querySelector(`input[data-group="${l}"]`);c&&(c.indeterminate=O(n))};Te(()=>a.selectedToolIds,l=>{V.value=[...l]},{immediate:!0});const _=ae(()=>{let l=a.tools.filter(n=>n.key);if(p.value){const n=p.value.toLowerCase();l=l.filter(c=>{var F;return c.name.toLowerCase().includes(n)||c.description.toLowerCase().includes(n)||(((F=c.serviceGroup)==null?void 0:F.toLowerCase().includes(n))??!1)})}switch(u.value){case"name":l=[...l].sort((n,c)=>n.name.localeCompare(c.name));break;case"enabled":l=[...l].sort((n,c)=>{const F=V.value.includes(n.key),D=V.value.includes(c.key);return F&&!D?-1:!F&&D?1:n.name.localeCompare(c.name)});break;case"group":default:l=[...l].sort((n,c)=>{const F=n.serviceGroup??"未分组",D=c.serviceGroup??"未分组";return F!==D?F.localeCompare(D):n.name.localeCompare(c.name)});break}return l}),T=ae(()=>{const l=new Map;return _.value.forEach(n=>{const c=n.serviceGroup??"未分组";l.has(c)||l.set(c,[]),l.get(c).push(n)}),new Map([...l.entries()].sort())}),L=ae(()=>_.value.length);Te([V,T],()=>{Re(()=>{for(const[l,n]of T.value)P(l,n)})},{flush:"post",deep:!1});const Q=l=>V.value.includes(l),oe=(l,n)=>{n.stopPropagation();const F=n.target.checked;if(!l){console.error("toolKey is undefined, cannot proceed");return}F?V.value.includes(l)||(V.value=[...V.value,l]):V.value=V.value.filter(D=>D!==l)},q=l=>l.filter(n=>V.value.includes(n.key)),b=l=>l.length>0&&l.every(n=>V.value.includes(n.key)),O=l=>{const n=q(l).length;return n>0&&n<l.length},Z=(l,n)=>{n.stopPropagation();const F=n.target.checked,D=l.map(J=>J.key);if(F){const J=[...V.value];D.forEach(se=>{J.includes(se)||J.push(se)}),V.value=J}else V.value=V.value.filter(J=>!D.includes(J))},K=l=>{v.value.has(l)?v.value.delete(l):v.value.add(l)},re=()=>{g("confirm",[...V.value]),g("update:modelValue",!1)},U=()=>{V.value=[...a.selectedToolIds],g("update:modelValue",!1)};return Te(m,l=>{if(l){v.value.clear();const n=Array.from(T.value.keys());n.length>1&&n.slice(1).forEach(c=>{v.value.add(c)})}}),(l,n)=>(i(),ee(fe,{modelValue:m.value,"onUpdate:modelValue":[n[4]||(n[4]=c=>m.value=c),U],title:"选择工具",onConfirm:re},{default:X(()=>[e("div",Tt,[e("div",Vt,[e("div",At,[I(e("input",{"onUpdate:modelValue":n[0]||(n[0]=c=>p.value=c),type:"text",class:"search-input",placeholder:"搜索工具..."},null,512),[[j,p.value]])]),e("div",xt,[I(e("select",{"onUpdate:modelValue":n[1]||(n[1]=c=>u.value=c),class:"sort-select"},n[5]||(n[5]=[e("option",{value:"group"},"按服务组排序",-1),e("option",{value:"name"},"按名称排序",-1),e("option",{value:"enabled"},"按启用状态排序",-1)]),512),[[Fe,u.value]])])]),e("div",Pt,[e("span",Ut," 共 "+t(T.value.size)+" 个服务组，"+t(L.value)+" 个工具 (已选择 "+t(V.value.length)+" 个) ",1)]),T.value.size>0?(i(),r("div",Et,[(i(!0),r(z,null,H(T.value,([c,F])=>(i(),r("div",{key:c,class:"tool-group"},[e("div",{class:W(["tool-group-header",{collapsed:v.value.has(c)}]),onClick:D=>K(c)},[e("div",Nt,[y(s(x),{icon:v.value.has(c)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),y(s(x),{icon:"carbon:folder",class:"group-icon"}),e("span",Dt,t(c),1),e("span",Lt," ("+t(q(F).length)+"/"+t(F.length)+") ",1)]),e("div",{class:"group-actions",onClick:n[2]||(n[2]=he(()=>{},["stop"]))},[e("label",Ft,[e("input",{type:"checkbox",class:"group-enable-checkbox",checked:b(F),onChange:D=>Z(F,D),"data-group":c},null,40,Rt),n[6]||(n[6]=e("span",{class:"enable-label"},"启用全部",-1))])])],10,Mt),e("div",{class:W(["tool-group-content",{collapsed:v.value.has(c)}])},[(i(!0),r(z,null,H(F.filter(D=>D&&D.key),D=>(i(),r("div",{key:D.key,class:"tool-selection-item"},[e("div",Bt,[e("div",It,t(D.name),1),D.description?(i(),r("div",qt,t(D.description),1)):E("",!0)]),e("div",Ot,[e("label",{class:"tool-enable-switch",onClick:n[3]||(n[3]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",class:"tool-enable-checkbox",checked:Q(D.key),onChange:J=>oe(D.key,J)},null,40,Gt),n[7]||(n[7]=e("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(i(),r("div",jt,[y(s(x),{icon:"carbon:tools",class:"empty-icon"}),n[8]||(n[8]=e("p",null,"没有找到工具",-1))]))])]),_:1},8,["modelValue"]))}}),Jt=ie(Kt,[["__scopeId","data-v-79f6a572"]]);class pe{static async handleResponse(o){if(!o.ok)try{const a=await o.json();throw new Error(a.message||`API request failed: ${o.status}`)}catch{throw new Error(`API request failed: ${o.status} ${o.statusText}`)}return o}static async getAllAgents(){try{const o=await fetch(this.BASE_URL);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get Agent list:",o),o}}static async getAgentById(o){try{const a=await fetch(`${this.BASE_URL}/${o}`);return await(await this.handleResponse(a)).json()}catch(a){throw console.error(`Failed to get Agent[${o}] details:`,a),a}}static async createAgent(o){try{const a=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await(await this.handleResponse(a)).json()}catch(a){throw console.error("Failed to create Agent:",a),a}}static async updateAgent(o,a){try{const g=await fetch(`${this.BASE_URL}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await(await this.handleResponse(g)).json()}catch(g){throw console.error(`Failed to update Agent[${o}]:`,g),g}}static async deleteAgent(o){try{const a=await fetch(`${this.BASE_URL}/${o}`,{method:"DELETE"});if(a.status===400)throw new Error("Cannot delete default Agent");await this.handleResponse(a)}catch(a){throw console.error(`Failed to delete Agent[${o}]:`,a),a}}static async getAvailableTools(){try{const o=await fetch(`${this.BASE_URL}/tools`);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get available tools list:",o),o}}}me(pe,"BASE_URL","/api/agents");class de{static async handleResponse(o){if(!o.ok)try{const a=await o.json();throw new Error(a.message||`API request failed: ${o.status}`)}catch{throw new Error(`API request failed: ${o.status} ${o.statusText}`)}return o}static async getAllModels(){try{const o=await fetch(this.BASE_URL);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get Model list:",o),o}}static async getAllTypes(){try{const o=await fetch(`${this.BASE_URL}/types`);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get Model list:",o),o}}static async getModelById(o){try{const a=await fetch(`${this.BASE_URL}/${o}`);return await(await this.handleResponse(a)).json()}catch(a){throw console.error(`Failed to get Model[${o}] details:`,a),a}}static async createModel(o){try{const a=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await(await this.handleResponse(a)).json()}catch(a){throw console.error("Failed to create Model:",a),a}}static async updateModel(o,a){try{const g=await fetch(`${this.BASE_URL}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await(await this.handleResponse(g)).json()}catch(g){throw console.error(`Failed to update Model[${o}]:`,g),g}}static async deleteModel(o){try{const a=await fetch(`${this.BASE_URL}/${o}`,{method:"DELETE"});if(a.status===400)throw new Error("Cannot delete default Model");await this.handleResponse(a)}catch(a){throw console.error(`Failed to delete Model[${o}]:`,a),a}}}me(de,"BASE_URL","/api/models");const zt={class:"config-panel"},Ht={class:"panel-header"},Yt={class:"panel-actions"},Xt=["disabled"],Wt={class:"agent-layout"},Qt={class:"agent-list"},Zt={class:"list-header"},es={class:"agent-count"},os={key:0,class:"agents-container"},ts=["onClick"],ss={class:"agent-card-header"},ns={class:"agent-name"},as={class:"agent-desc"},ls={key:0,class:"agent-model"},is={class:"model-tag"},cs={class:"model-tag"},rs={key:1,class:"agent-tools"},ds={key:0,class:"tool-more"},us={key:1,class:"loading-state"},ps={key:2,class:"empty-state"},fs={key:0,class:"agent-detail"},gs={class:"detail-header"},ms={class:"detail-actions"},vs={class:"form-item"},hs=["placeholder"],ys={class:"form-item"},_s=["placeholder"],bs={class:"form-item"},Cs=["value","placeholder"],$s={class:"model-section"},ws={class:"form-item"},ks={class:"model-chooser"},Ss=["title"],Ts={key:0,class:"current-model"},Vs={class:"model-type"},As={class:"model-name"},xs={key:1,class:"current-model"},Ps={class:"current-model"},Us={class:"dropdown-header"},Es={class:"model-options"},Ms=["onClick"],Ns={class:"model-type"},Ds={class:"model-name"},Ls={class:"tools-section"},Fs={class:"assigned-tools"},Rs={class:"section-header"},Bs={class:"tools-grid"},Is={class:"tool-info"},qs={class:"tool-name"},Os={class:"tool-desc"},Gs={key:0,class:"no-tools"},js={key:1,class:"no-selection"},Ks={class:"modal-form"},Js={class:"form-item"},zs=["placeholder"],Hs={class:"form-item"},Ys=["placeholder"],Xs={class:"form-item"},Ws=["value","placeholder"],Qs={class:"delete-confirm"},Zs={class:"warning-text"},en=le({__name:"agentConfig",setup(B){const{t:o}=ye(),a=M(!1),g=M(""),m=M(""),p=ne([]),u=M(null),v=ne([]),V=M(!1),P=M(!1),_=M(!1),T=M(!1),L=M(null),Q=ne([]),oe=()=>{T.value=!T.value},q=A=>{L.value=A,T.value=!1},b=ne({name:"",description:"",nextStepPrompt:""}),O=A=>{const h=v.find(G=>G.key===A);return h?h.name:A},Z=A=>{const h=v.find(G=>G.key===A);return h?h.description:""},K=(A,h)=>{h==="success"?(m.value=A,setTimeout(()=>{m.value=""},3e3)):(g.value=A,setTimeout(()=>{g.value=""},5e3))},re=async()=>{a.value=!0;try{const[A,h,G]=await Promise.all([pe.getAllAgents(),pe.getAvailableTools(),de.getAllModels()]),C=A.map(d=>({...d,availableTools:d.availableTools,...G}));p.splice(0,p.length,...C),v.splice(0,v.length,...h),Q.splice(0,Q.length,...G),C.length>0&&await U(C[0])}catch(A){console.error("加载数据失败:",A),K(o("config.agentConfig.loadDataFailed")+": "+A.message,"error");const h=[{key:"search-web",name:"网络搜索",description:"在互联网上搜索信息",enabled:!0,serviceGroup:"搜索服务"},{key:"search-local",name:"本地搜索",description:"在本地文件中搜索内容",enabled:!0,serviceGroup:"搜索服务"},{key:"file-read",name:"读取文件",description:"读取本地或远程文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-write",name:"写入文件",description:"创建或修改文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-delete",name:"删除文件",description:"删除指定的文件",enabled:!1,serviceGroup:"文件服务"},{key:"calculator",name:"计算器",description:"执行数学计算",enabled:!0,serviceGroup:"计算服务"},{key:"code-execute",name:"代码执行",description:"执行Python或JavaScript代码",enabled:!0,serviceGroup:"计算服务"},{key:"weather",name:"天气查询",description:"获取指定地区的天气信息",enabled:!0,serviceGroup:"信息服务"},{key:"currency",name:"汇率查询",description:"查询货币汇率信息",enabled:!0,serviceGroup:"信息服务"},{key:"email",name:"发送邮件",description:"发送电子邮件",enabled:!1,serviceGroup:"通信服务"},{key:"sms",name:"发送短信",description:"发送短信消息",enabled:!1,serviceGroup:"通信服务"}],G=[{id:"demo-1",name:"通用助手",description:"一个能够处理各种任务的智能助手",nextStepPrompt:"You are a helpful assistant that can answer questions and help with various tasks. What would you like me to help you with next?",availableTools:["search-web","calculator","weather"]},{id:"demo-2",name:"数据分析师",description:"专门用于数据分析和可视化的Agent",nextStepPrompt:"You are a data analyst assistant specialized in analyzing data and creating visualizations. Please provide the data you would like me to analyze.",availableTools:["file-read","file-write","calculator","code-execute"]}];v.splice(0,v.length,...h),p.splice(0,p.length,...G),G.length>0&&(u.value=G[0])}finally{a.value=!1}},U=async A=>{try{const h=await pe.getAgentById(A.id);u.value={...h,availableTools:h.availableTools},L.value=h.model??null}catch(h){console.error("加载Agent详情失败:",h),K(o("config.agentConfig.loadDetailsFailed")+": "+h.message,"error"),u.value={...A,availableTools:A.availableTools}}},l=()=>{b.name="",b.description="",b.nextStepPrompt="",V.value=!0},n=async()=>{var A;if(!b.name.trim()||!b.description.trim()){K(o("config.agentConfig.requiredFields"),"error");return}try{const h={name:b.name.trim(),description:b.description.trim(),nextStepPrompt:((A=b.nextStepPrompt)==null?void 0:A.trim())??"",availableTools:[]},G=await pe.createAgent(h);p.push(G),u.value=G,V.value=!1,K(o("config.agentConfig.createSuccess"),"success")}catch(h){K(o("config.agentConfig.createFailed")+": "+h.message,"error")}},c=()=>{_.value=!0},F=A=>{u.value&&(u.value.availableTools=[...A])},D=async()=>{if(u.value){if(!u.value.name.trim()||!u.value.description.trim()){K(o("config.agentConfig.requiredFields"),"error");return}try{u.value.model=L.value;const A=await pe.updateAgent(u.value.id,u.value),h=p.findIndex(G=>G.id===A.id);h!==-1&&(p[h]=A),u.value=A,u.value.model=L.value,K(o("config.agentConfig.saveSuccess"),"success")}catch(A){K(o("config.agentConfig.saveFailed")+": "+A.message,"error")}}},J=()=>{P.value=!0},se=async()=>{if(u.value)try{await pe.deleteAgent(u.value.id);const A=p.findIndex(h=>h.id===u.value.id);A!==-1&&p.splice(A,1),u.value=p.length>0?p[0]:null,P.value=!1,K(o("config.agentConfig.deleteSuccess"),"success")}catch(A){K(o("config.agentConfig.deleteFailed")+": "+A.message,"error")}},$e=()=>{const A=document.createElement("input");A.type="file",A.accept=".json",A.onchange=h=>{var C;const G=(C=h.target.files)==null?void 0:C[0];if(G){const d=new FileReader;d.onload=async $=>{var k;try{const S=JSON.parse((k=$.target)==null?void 0:k.result);if(!S.name||!S.description)throw new Error(o("config.agentConfig.invalidFormat"));const{id:f,...N}=S,R=await pe.createAgent(N);p.push(R),u.value=R,K(o("config.agentConfig.importSuccess"),"success")}catch(S){K(o("config.agentConfig.importFailed")+": "+S.message,"error")}},d.readAsText(G)}},A.click()},ge=()=>{if(u.value)try{const A=JSON.stringify(u.value,null,2),h=new Blob([A],{type:"application/json"}),G=URL.createObjectURL(h),C=document.createElement("a");C.href=G,C.download=`agent-${u.value.name}-${new Date().toISOString().split("T")[0]}.json`,C.click(),URL.revokeObjectURL(G),K(o("config.agentConfig.exportSuccess"),"success")}catch(A){K(o("config.agentConfig.exportFailed")+": "+A.message,"error")}};return Ce(()=>{re()}),(A,h)=>{var G;return i(),r("div",zt,[e("div",Ht,[e("h2",null,t(s(o)("config.agentConfig.title")),1),e("div",Yt,[e("button",{class:"action-btn",onClick:$e},[y(s(x),{icon:"carbon:upload"}),w(" "+t(s(o)("config.agentConfig.import")),1)]),e("button",{class:"action-btn",onClick:ge,disabled:!u.value},[y(s(x),{icon:"carbon:download"}),w(" "+t(s(o)("config.agentConfig.export")),1)],8,Xt)])]),e("div",Wt,[e("div",Qt,[e("div",Zt,[e("h3",null,t(s(o)("config.agentConfig.configuredAgents")),1),e("span",es,"("+t(p.length)+t(s(o)("config.agentConfig.agentCount"))+")",1)]),a.value?E("",!0):(i(),r("div",os,[(i(!0),r(z,null,H(p,C=>{var d,$;return i(),r("div",{key:C.id,class:W(["agent-card",{active:((d=u.value)==null?void 0:d.id)===C.id}]),onClick:k=>U(C)},[e("div",ss,[e("span",ns,t(C.name),1),y(s(x),{icon:"carbon:chevron-right"})]),e("p",as,t(C.description),1),C.model?(i(),r("div",ls,[e("span",is,t(C.model.type),1),e("span",cs,t(C.model.modelName),1)])):E("",!0),(($=C.availableTools)==null?void 0:$.length)>0?(i(),r("div",rs,[(i(!0),r(z,null,H(C.availableTools.slice(0,3),k=>(i(),r("span",{key:k,class:"tool-tag"},t(O(k)),1))),128)),C.availableTools.length>3?(i(),r("span",ds," +"+t(C.availableTools.length-3),1)):E("",!0)])):E("",!0)],10,ts)}),128))])),a.value?(i(),r("div",us,[y(s(x),{icon:"carbon:loading",class:"loading-icon"}),w(" "+t(s(o)("common.loading")),1)])):E("",!0),!a.value&&p.length===0?(i(),r("div",ps,[y(s(x),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,t(s(o)("config.agentConfig.noAgent")),1)])):E("",!0),e("button",{class:"add-btn",onClick:l},[y(s(x),{icon:"carbon:add"}),w(" "+t(s(o)("config.agentConfig.createNew")),1)])]),u.value?(i(),r("div",fs,[e("div",gs,[e("h3",null,t(u.value.name),1),e("div",ms,[e("button",{class:"action-btn primary",onClick:D},[y(s(x),{icon:"carbon:save"}),w(" "+t(s(o)("common.save")),1)]),e("button",{class:"action-btn danger",onClick:J},[y(s(x),{icon:"carbon:trash-can"}),w(" "+t(s(o)("common.delete")),1)])])]),e("div",vs,[e("label",null,[w(t(s(o)("config.agentConfig.agentName"))+" ",1),h[15]||(h[15]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":h[0]||(h[0]=C=>u.value.name=C),placeholder:s(o)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,hs),[[j,u.value.name]])]),e("div",ys,[e("label",null,[w(t(s(o)("config.agentConfig.description"))+" ",1),h[16]||(h[16]=e("span",{class:"required"},"*",-1))]),I(e("textarea",{"onUpdate:modelValue":h[1]||(h[1]=C=>u.value.description=C),rows:"3",placeholder:s(o)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,_s),[[j,u.value.description]])]),e("div",bs,[e("label",null,t(s(o)("config.agentConfig.nextStepPrompt")),1),e("textarea",{value:u.value.nextStepPrompt||"",onInput:h[2]||(h[2]=C=>u.value.nextStepPrompt=C.target.value),rows:"8",placeholder:s(o)("config.agentConfig.nextStepPromptPlaceholder")},null,40,Cs)]),e("div",$s,[e("h4",null,t(s(o)("config.agentConfig.modelConfiguration")),1),e("div",ws,[e("div",ks,[e("button",{class:"model-btn",onClick:oe,title:A.$t("model.switch")},[y(s(x),{icon:"carbon:build-run",width:"18"}),L.value?(i(),r("span",Ts,[e("span",Vs,t(L.value.type),1),h[17]||(h[17]=e("span",{class:"spacer"},null,-1)),e("span",As,t(L.value.modelName),1)])):(i(),r("span",xs,[e("span",Ps,t(s(o)("config.agentConfig.modelConfigurationLabel")),1)])),y(s(x),{icon:T.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])],8,Ss),T.value?(i(),r("div",{key:0,class:"model-dropdown",onClick:h[4]||(h[4]=he(()=>{},["stop"]))},[e("div",Us,[e("span",null,t(s(o)("config.agentConfig.modelConfigurationLabel")),1),e("button",{class:"close-btn",onClick:h[3]||(h[3]=C=>T.value=!1)},[y(s(x),{icon:"carbon:close",width:"16"})])]),e("div",Es,[(i(!0),r(z,null,H(Q,C=>{var d,$;return i(),r("button",{key:C.id,class:W(["model-option",{active:((d=L.value)==null?void 0:d.id)===C.id}]),onClick:k=>q(C)},[e("span",Ns,t(C.type),1),e("span",Ds,t(C.modelName),1),(($=L.value)==null?void 0:$.id)===C.id?(i(),ee(s(x),{key:0,icon:"carbon:checkmark",width:"16",class:"check-icon"})):E("",!0)],10,Ms)}),128))])])):E("",!0),T.value?(i(),r("div",{key:1,class:"backdrop",onClick:h[5]||(h[5]=C=>T.value=!1)})):E("",!0)])])]),e("div",Ls,[e("h4",null,t(s(o)("config.agentConfig.toolConfiguration")),1),e("div",Fs,[e("div",Rs,[e("span",null,t(s(o)("config.agentConfig.assignedTools"))+" ("+t((u.value.availableTools||[]).length)+")",1),v.length>0?(i(),r("button",{key:0,class:"action-btn small",onClick:c},[y(s(x),{icon:"carbon:add"}),w(" "+t(s(o)("config.agentConfig.addRemoveTools")),1)])):E("",!0)]),e("div",Bs,[(i(!0),r(z,null,H(u.value.availableTools||[],C=>(i(),r("div",{key:C,class:"tool-item assigned"},[e("div",Is,[e("span",qs,t(O(C)),1),e("span",Os,t(Z(C)),1)])]))),128)),u.value.availableTools.length===0?(i(),r("div",Gs,[y(s(x),{icon:"carbon:tool-box"}),e("span",null,t(s(o)("config.agentConfig.noAssignedTools")),1)])):E("",!0)])])])])):(i(),r("div",js,[y(s(x),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,t(s(o)("config.agentConfig.selectAgentHint")),1)]))]),y(fe,{modelValue:V.value,"onUpdate:modelValue":h[9]||(h[9]=C=>V.value=C),title:s(o)("config.agentConfig.newAgent"),onConfirm:n},{default:X(()=>[e("div",Ks,[e("div",Js,[e("label",null,[w(t(s(o)("config.agentConfig.agentName"))+" ",1),h[18]||(h[18]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":h[6]||(h[6]=C=>b.name=C),placeholder:s(o)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,zs),[[j,b.name]])]),e("div",Hs,[e("label",null,[w(t(s(o)("config.agentConfig.description"))+" ",1),h[19]||(h[19]=e("span",{class:"required"},"*",-1))]),I(e("textarea",{"onUpdate:modelValue":h[7]||(h[7]=C=>b.description=C),rows:"3",placeholder:s(o)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,Ys),[[j,b.description]])]),e("div",Xs,[e("label",null,t(s(o)("config.agentConfig.nextStepPrompt")),1),e("textarea",{value:b.nextStepPrompt||"",onInput:h[8]||(h[8]=C=>b.nextStepPrompt=C.target.value),rows:"8",placeholder:s(o)("config.agentConfig.nextStepPromptPlaceholder")},null,40,Ws)])])]),_:1},8,["modelValue","title"]),y(Jt,{modelValue:_.value,"onUpdate:modelValue":h[10]||(h[10]=C=>_.value=C),tools:v,"selected-tool-ids":((G=u.value)==null?void 0:G.availableTools)||[],onConfirm:F},null,8,["modelValue","tools","selected-tool-ids"]),y(fe,{modelValue:P.value,"onUpdate:modelValue":h[12]||(h[12]=C=>P.value=C),title:s(o)("config.agentConfig.deleteConfirm")},{footer:X(()=>[e("button",{class:"cancel-btn",onClick:h[11]||(h[11]=C=>P.value=!1)},t(s(o)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:se},t(s(o)("common.delete")),1)]),default:X(()=>{var C;return[e("div",Qs,[y(s(x),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[w(t(s(o)("config.agentConfig.deleteConfirmText"))+" ",1),e("strong",null,t((C=u.value)==null?void 0:C.name),1),w(" "+t(s(o)("common.confirm"))+"？",1)]),e("p",Zs,t(s(o)("config.agentConfig.deleteWarning")),1)])]}),_:1},8,["modelValue","title"]),g.value?(i(),r("div",{key:0,class:"error-toast",onClick:h[13]||(h[13]=C=>g.value="")},[y(s(x),{icon:"carbon:error"}),w(" "+t(g.value),1)])):E("",!0),m.value?(i(),r("div",{key:1,class:"success-toast",onClick:h[14]||(h[14]=C=>m.value="")},[y(s(x),{icon:"carbon:checkmark"}),w(" "+t(m.value),1)])):E("",!0)])}}}),on=ie(en,[["__scopeId","data-v-82fd42c0"]]),tn={class:"custom-select"},sn=["title"],nn={key:0,class:"current-option"},an={class:"option-name"},ln={key:1,class:"current-option"},cn={class:"dropdown-header"},rn={class:"select-options"},dn=["onClick"],un={class:"option-name"},pn=le({__name:"index",props:{modelValue:{},options:{},placeholder:{},dropdownTitle:{},icon:{}},emits:["update:modelValue"],setup(B,{emit:o}){const a=B,g=o,m=M(!1),p=ae(()=>a.options.find(P=>P.id===a.modelValue)),u=P=>P.id===a.modelValue,v=()=>{m.value=!m.value},V=P=>{g("update:modelValue",P.id),m.value=!1};return(P,_)=>(i(),r("div",tn,[e("button",{class:"select-btn",onClick:v,title:P.placeholder},[y(s(x),{icon:a.icon||"carbon:select-01",width:"18"},null,8,["icon"]),p.value?(i(),r("span",nn,[e("span",an,t(p.value.name),1)])):(i(),r("span",ln,t(P.placeholder),1)),y(s(x),{icon:m.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])],8,sn),y(_e,{name:"slideDown"},{default:X(()=>[I(e("div",{class:"select-dropdown",onClick:_[1]||(_[1]=he(()=>{},["stop"]))},[e("div",cn,[e("span",null,t(P.dropdownTitle),1),e("button",{class:"close-btn",onClick:_[0]||(_[0]=T=>m.value=!1)},[y(s(x),{icon:"carbon:close",width:"16"})])]),e("div",rn,[(i(!0),r(z,null,H(P.options,T=>(i(),r("button",{key:T.id,class:W(["select-option",{active:u(T)}]),onClick:L=>V(T)},[e("span",un,t(T.name),1),u(T)?(i(),ee(s(x),{key:0,icon:"carbon:checkmark",width:"16",class:"check-icon"})):E("",!0)],10,dn))),128))])],512),[[Ae,m.value]])]),_:1}),m.value?(i(),r("div",{key:0,class:"backdrop",onClick:_[2]||(_[2]=T=>m.value=!1)})):E("",!0)]))}}),Ue=ie(pn,[["__scopeId","data-v-1185e370"]]),fn={class:"config-panel"},gn={class:"panel-header"},mn={class:"panel-actions"},vn=["disabled"],hn={class:"model-layout"},yn={class:"model-list"},_n={class:"list-header"},bn={class:"model-count"},Cn={key:0,class:"models-container"},$n=["onClick"],wn={class:"model-card-header"},kn={class:"model-name"},Sn={class:"model-desc"},Tn={key:0,class:"model-type"},Vn={class:"model-tag"},An={key:1,class:"loading-state"},xn={key:2,class:"empty-state"},Pn={key:0,class:"model-detail"},Un={class:"detail-header"},En={class:"detail-actions"},Mn={class:"form-item"},Nn={class:"form-item"},Dn=["placeholder"],Ln={class:"form-item"},Fn=["placeholder"],Rn={class:"form-item"},Bn=["placeholder"],In={class:"form-item"},qn=["placeholder"],On={key:1,class:"no-selection"},Gn={class:"modal-form"},jn={class:"form-item"},Kn={class:"form-item"},Jn=["placeholder"],zn={class:"form-item"},Hn=["placeholder"],Yn={class:"form-item"},Xn=["placeholder"],Wn={class:"form-item"},Qn=["placeholder"],Zn={class:"delete-confirm"},ea={class:"warning-text"},oa=le({__name:"modelConfig",setup(B){const{t:o}=ye(),a=M(!1),g=M(""),m=M(""),p=ne([]),u=ne([]),v=M(null),V=M(!1),P=M(!1),_=ne({baseUrl:"",apiKey:"",modelName:"",modelDescription:"",type:""}),T=(U,l)=>{l==="success"?(m.value=U,setTimeout(()=>{m.value=""},3e3)):(g.value=U,setTimeout(()=>{g.value=""},5e3))},L=async()=>{a.value=!0;try{const[U,l]=await Promise.all([de.getAllModels(),de.getAllTypes()]),n=U.map(c=>({...c}));p.splice(0,p.length,...n),u.splice(0,u.length,...l),n.length>0&&await Q(n[0])}catch(U){console.error("加载数据失败:",U),T(o("config.modelConfig.loadDataFailed")+": "+U.message,"error")}finally{a.value=!1}},Q=async U=>{try{const l=await de.getModelById(U.id);v.value={...l}}catch(l){console.error("加载Model详情失败:",l),T(o("config.modelConfig.loadDetailsFailed")+": "+l.message,"error"),v.value={...U}}},oe=()=>{_.baseUrl="",_.apiKey="",_.modelName="",_.modelDescription="",_.type="",V.value=!0},q=async()=>{if(!_.modelName.trim()||!_.modelDescription.trim()){T(o("config.modelConfig.requiredFields"),"error");return}try{const U={baseUrl:_.baseUrl.trim(),apiKey:_.apiKey.trim(),modelName:_.modelName.trim(),modelDescription:_.modelDescription.trim(),type:_.type.trim()},l=await de.createModel(U);p.push(l),v.value=l,V.value=!1,T(o("config.modelConfig.createSuccess"),"success")}catch(U){T(o("config.modelConfig.createFailed")+": "+U.message,"error")}},b=async()=>{if(v.value){if(!v.value.modelName.trim()||!v.value.modelDescription.trim()){T(o("config.modelConfig.requiredFields"),"error");return}try{const U=await de.updateModel(v.value.id,v.value),l=p.findIndex(n=>n.id===U.id);l!==-1&&(p[l]=U),v.value=U,T(o("config.modelConfig.saveSuccess"),"success")}catch(U){T(o("config.modelConfig.saveFailed")+": "+U.message,"error")}}},O=()=>{P.value=!0},Z=async()=>{if(v.value)try{await de.deleteModel(v.value.id);const U=p.findIndex(l=>l.id===v.value.id);U!==-1&&p.splice(U,1),v.value=p.length>0?p[0]:null,P.value=!1,T(o("config.modelConfig.deleteSuccess"),"success")}catch(U){T(o("config.modelConfig.deleteFailed")+": "+U.message,"error")}},K=()=>{const U=document.createElement("input");U.type="file",U.accept=".json",U.onchange=l=>{var c;const n=(c=l.target.files)==null?void 0:c[0];if(n){const F=new FileReader;F.onload=async D=>{var J;try{const se=JSON.parse((J=D.target)==null?void 0:J.result);if(!se.modelName||!se.modelDescription)throw new Error(o("config.modelConfig.invalidFormat"));const{id:$e,...ge}=se,A=await de.createModel(ge);p.push(A),v.value=A,T(o("config.modelConfig.importSuccess"),"success")}catch(se){T(o("config.modelConfig.importFailed")+": "+se.message,"error")}},F.readAsText(n)}},U.click()},re=()=>{if(v.value)try{const U=JSON.stringify(v.value,null,2),l=new Blob([U],{type:"application/json"}),n=URL.createObjectURL(l),c=document.createElement("a");c.href=n,c.download=`model-${v.value.modelName}-${new Date().toISOString().split("T")[0]}.json`,c.click(),URL.revokeObjectURL(n),T(o("config.modelConfig.exportSuccess"),"success")}catch(U){T(o("config.modelConfig.exportFailed")+": "+U.message,"error")}};return Ce(()=>{L()}),(U,l)=>(i(),r("div",fn,[e("div",gn,[e("h2",null,t(s(o)("config.modelConfig.title")),1),e("div",mn,[e("button",{class:"action-btn",onClick:K},[y(s(x),{icon:"carbon:upload"}),w(" "+t(s(o)("config.modelConfig.import")),1)]),e("button",{class:"action-btn",onClick:re,disabled:!v.value},[y(s(x),{icon:"carbon:download"}),w(" "+t(s(o)("config.modelConfig.export")),1)],8,vn)])]),e("div",hn,[e("div",yn,[e("div",_n,[e("h3",null,t(s(o)("config.modelConfig.configuredModels")),1),e("span",bn,"("+t(p.length)+")",1)]),a.value?E("",!0):(i(),r("div",Cn,[(i(!0),r(z,null,H(p,n=>{var c;return i(),r("div",{key:n.id,class:W(["model-card",{active:((c=v.value)==null?void 0:c.id)===n.id}]),onClick:F=>Q(n)},[e("div",wn,[e("span",kn,t(n.modelName),1),y(s(x),{icon:"carbon:chevron-right"})]),e("p",Sn,t(n.modelDescription),1),n.type?(i(),r("div",Tn,[e("span",Vn,t(n.type),1)])):E("",!0)],10,$n)}),128))])),a.value?(i(),r("div",An,[y(s(x),{icon:"carbon:loading",class:"loading-icon"}),w(" "+t(s(o)("common.loading")),1)])):E("",!0),!a.value&&p.length===0?(i(),r("div",xn,[y(s(x),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,t(s(o)("config.modelConfig.noModel")),1)])):E("",!0),e("button",{class:"add-btn",onClick:oe},[y(s(x),{icon:"carbon:add"}),w(" "+t(s(o)("config.modelConfig.createNew")),1)])]),v.value?(i(),r("div",Pn,[e("div",Un,[e("h3",null,t(v.value.modelName),1),e("div",En,[e("button",{class:"action-btn primary",onClick:b},[y(s(x),{icon:"carbon:save"}),w(" "+t(s(o)("common.save")),1)]),e("button",{class:"action-btn danger",onClick:O},[y(s(x),{icon:"carbon:trash-can"}),w(" "+t(s(o)("common.delete")),1)])])]),e("div",Mn,[e("label",null,[w(t(s(o)("config.modelConfig.type"))+" ",1),l[15]||(l[15]=e("span",{class:"required"},"*",-1))]),y(Ue,{modelValue:v.value.type,"onUpdate:modelValue":l[0]||(l[0]=n=>v.value.type=n),options:u.map(n=>({id:n,name:n})),placeholder:s(o)("config.modelConfig.typePlaceholder"),"dropdown-title":s(o)("config.modelConfig.typePlaceholder"),icon:"carbon:types"},null,8,["modelValue","options","placeholder","dropdown-title"])]),e("div",Nn,[e("label",null,[w(t(s(o)("config.modelConfig.baseUrl"))+" ",1),l[16]||(l[16]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=n=>v.value.baseUrl=n),placeholder:s(o)("config.modelConfig.baseUrlPlaceholder"),required:""},null,8,Dn),[[j,v.value.baseUrl]])]),e("div",Ln,[e("label",null,[w(t(s(o)("config.modelConfig.apiKey"))+" ",1),l[17]||(l[17]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=n=>v.value.apiKey=n),placeholder:s(o)("config.modelConfig.apiKeyPlaceholder"),required:""},null,8,Fn),[[j,v.value.apiKey]])]),e("div",Rn,[e("label",null,[w(t(s(o)("config.modelConfig.modelName"))+" ",1),l[18]||(l[18]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=n=>v.value.modelName=n),placeholder:s(o)("config.modelConfig.modelNamePlaceholder"),required:""},null,8,Bn),[[j,v.value.modelName]])]),e("div",In,[e("label",null,[w(t(s(o)("config.modelConfig.description"))+" ",1),l[19]||(l[19]=e("span",{class:"required"},"*",-1))]),I(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=n=>v.value.modelDescription=n),rows:"3",placeholder:s(o)("config.modelConfig.descriptionPlaceholder"),required:""},null,8,qn),[[j,v.value.modelDescription]])])])):(i(),r("div",On,[y(s(x),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,t(s(o)("config.modelConfig.selectModelHint")),1)]))]),y(fe,{modelValue:V.value,"onUpdate:modelValue":l[10]||(l[10]=n=>V.value=n),title:s(o)("config.modelConfig.newModel"),onConfirm:q},{default:X(()=>[e("div",Gn,[e("div",jn,[e("label",null,[w(t(s(o)("config.modelConfig.type"))+" ",1),l[20]||(l[20]=e("span",{class:"required"},"*",-1))]),y(Ue,{modelValue:_.type,"onUpdate:modelValue":l[5]||(l[5]=n=>_.type=n),options:u.map(n=>({id:n,name:n})),placeholder:s(o)("config.modelConfig.typePlaceholder"),"dropdown-title":s(o)("config.modelConfig.typePlaceholder"),icon:"carbon:types"},null,8,["modelValue","options","placeholder","dropdown-title"])]),e("div",Kn,[e("label",null,[w(t(s(o)("config.modelConfig.baseUrl"))+" ",1),l[21]||(l[21]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=n=>_.baseUrl=n),placeholder:s(o)("config.modelConfig.baseUrlPlaceholder"),required:""},null,8,Jn),[[j,_.baseUrl]])]),e("div",zn,[e("label",null,[w(t(s(o)("config.modelConfig.apiKey"))+" ",1),l[22]||(l[22]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":l[7]||(l[7]=n=>_.apiKey=n),placeholder:s(o)("config.modelConfig.apiKeyPlaceholder"),required:""},null,8,Hn),[[j,_.apiKey]])]),e("div",Yn,[e("label",null,[w(t(s(o)("config.modelConfig.modelName"))+" ",1),l[23]||(l[23]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":l[8]||(l[8]=n=>_.modelName=n),placeholder:s(o)("config.modelConfig.modelNamePlaceholder"),required:""},null,8,Xn),[[j,_.modelName]])]),e("div",Wn,[e("label",null,[w(t(s(o)("config.modelConfig.description"))+" ",1),l[24]||(l[24]=e("span",{class:"required"},"*",-1))]),I(e("textarea",{"onUpdate:modelValue":l[9]||(l[9]=n=>_.modelDescription=n),rows:"3",placeholder:s(o)("config.modelConfig.descriptionPlaceholder"),required:""},null,8,Qn),[[j,_.modelDescription]])])])]),_:1},8,["modelValue","title"]),y(fe,{modelValue:P.value,"onUpdate:modelValue":l[12]||(l[12]=n=>P.value=n),title:"Delete confirmation"},{footer:X(()=>[e("button",{class:"cancel-btn",onClick:l[11]||(l[11]=n=>P.value=!1)},t(s(o)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:Z},t(s(o)("common.delete")),1)]),default:X(()=>{var n;return[e("div",Zn,[y(s(x),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[w(t(s(o)("config.modelConfig.deleteConfirmText"))+" ",1),e("strong",null,t((n=v.value)==null?void 0:n.modelName),1),w(" "+t(s(o)("common.confirm"))+"？",1)]),e("p",ea,t(s(o)("config.modelConfig.deleteWarning")),1)])]}),_:1},8,["modelValue"]),g.value?(i(),r("div",{key:0,class:"error-toast",onClick:l[13]||(l[13]=n=>g.value="")},[y(s(x),{icon:"carbon:error"}),w(" "+t(g.value),1)])):E("",!0),m.value?(i(),r("div",{key:1,class:"success-toast",onClick:l[14]||(l[14]=n=>m.value="")},[y(s(x),{icon:"carbon:checkmark"}),w(" "+t(m.value),1)])):E("",!0)]))}}),ta=ie(oa,[["__scopeId","data-v-615182f6"]]);class ke{static async getAllMcpServers(){const o=await fetch(`${this.BASE_URL}/list`);if(!o.ok)throw new Error(`Failed to get MCP server list: ${o.status}`);return await o.json()}static async addMcpServer(o){try{const a=await fetch(`${this.BASE_URL}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Failed to add MCP server: ${a.status}`);return{success:!0,message:"Successfully added MCP server"}}catch(a){return console.error("Failed to add MCP server:",a),{success:!1,message:a instanceof Error?a.message:"Failed to add, please retry"}}}static async removeMcpServer(o){try{const a=await fetch(`${this.BASE_URL}/remove?id=${o}`);if(!a.ok)throw new Error(`Failed to delete MCP server: ${a.status}`);return{success:!0,message:"Successfully deleted MCP server"}}catch(a){return console.error(`Failed to delete MCP server[${o}]:`,a),{success:!1,message:a instanceof Error?a.message:"Failed to delete, please retry"}}}}me(ke,"BASE_URL","/api/mcp");const sa={class:"mcp-config-panel"},na={class:"mcp-header"},aa={class:"header-left"},la={class:"mcp-stats"},ia={class:"stat-item"},ca={class:"stat-label"},ra={class:"stat-value"},da={class:"header-right"},ua={class:"search-box"},pa=["placeholder"],fa={key:0,class:"loading-container"},ga={key:1,class:"mcp-layout"},ma={class:"mcp-table-container"},va={class:"section-title"},ha={key:0,class:"empty-state"},ya={class:"empty-state-text"},_a={key:1,class:"mcp-table-wrapper"},ba={class:"mcp-table"},Ca={class:"mcp-id"},$a={class:"mcp-server-name"},wa={class:"server-name-content"},ka={class:"mcp-connection-type"},Sa={class:"mcp-config"},Ta=["title"],Va={class:"mcp-actions"},Aa=["onClick","disabled"],xa={class:"add-mcp-container"},Pa={class:"add-mcp-header"},Ua={class:"add-mcp-title"},Ea={class:"mcp-form"},Ma={class:"mcp-form-group"},Na={class:"form-label"},Da={class:"connection-type-options"},La={class:"connection-type-option"},Fa={for:"mcp-connection-type-studio",class:"radio-label"},Ra={class:"connection-type-desc"},Ba={class:"connection-type-option"},Ia={for:"mcp-connection-type-sse",class:"radio-label"},qa={class:"connection-type-desc"},Oa={class:"connection-type-option"},Ga={for:"mcp-connection-type-streaming",class:"radio-label"},ja={class:"connection-type-desc"},Ka={class:"mcp-form-group"},Ja={class:"form-label"},za=["placeholder"],Ha={class:"mcp-form-actions"},Ya=["disabled"],Xa=["disabled"],Wa={class:"mcp-form-instructions"},Qa={class:"indented-list"},Za=le({__name:"mcpConfig",setup(B){const{t:o}=ye(),a=M(!1),g=M([]),m=M(""),p=ne({connectionType:"STUDIO",configJson:""}),u=ne({show:!1,text:"",type:"success"}),v=ae(()=>p.configJson.trim().length>0),V=ae(()=>{if(!m.value.trim())return g.value;const q=m.value.toLowerCase();return g.value.filter(b=>b.mcpServerName.toLowerCase().includes(q)||b.connectionType.toLowerCase().includes(q)||b.connectionConfig.toLowerCase().includes(q))}),P=q=>q?q.length>50?q.substring(0,50)+"...":q:"",_=(q,b="success")=>{u.text=q,u.type=b,u.show=!0,setTimeout(()=>{u.show=!1},3e3)},T=async()=>{try{a.value=!0,g.value=await ke.getAllMcpServers()}catch(q){console.error("加载MCP服务器列表失败:",q),_(o("config.basicConfig.loadConfigFailed"),"error")}finally{a.value=!1}},L=async()=>{if(!v.value){_(o("config.mcpConfig.configRequired"),"error");return}try{JSON.parse(p.configJson)}catch{_(o("config.mcpConfig.invalidJson"),"error");return}try{a.value=!0;const q={connectionType:p.connectionType,configJson:p.configJson},b=await ke.addMcpServer(q);b.success?(_(o("config.mcpConfig.addSuccess")),oe(),await T()):_(b.message||o("config.mcpConfig.addFailed"),"error")}catch(q){console.error("添加MCP服务器失败:",q),_(o("config.mcpConfig.addFailed"),"error")}finally{a.value=!1}},Q=async q=>{if(confirm(o("config.mcpConfig.deleteConfirm")))try{a.value=!0;const b=await ke.removeMcpServer(q);b.success?(_(o("config.mcpConfig.deleteSuccess")),await T()):_(b.message||o("config.mcpConfig.deleteFailed"),"error")}catch(b){console.error("删除MCP服务器失败:",b),_(o("config.mcpConfig.deleteFailed"),"error")}finally{a.value=!1}},oe=()=>{p.connectionType="STUDIO",p.configJson=""};return Ce(()=>{T()}),(q,b)=>(i(),r("div",sa,[e("div",na,[e("div",aa,[e("h2",null,t(s(o)("config.mcpConfig.title")),1),e("div",la,[e("span",ia,[e("span",ca,t(s(o)("config.mcpConfig.mcpServers"))+":",1),e("span",ra,t(g.value.length),1)])])]),e("div",da,[e("div",ua,[I(e("input",{"onUpdate:modelValue":b[0]||(b[0]=O=>m.value=O),type:"text",placeholder:s(o)("config.mcpSearch"),class:"search-input"},null,8,pa),[[j,m.value]]),b[5]||(b[5]=e("span",{class:"search-icon"},"🔍",-1))])])]),a.value?(i(),r("div",fa,[b[6]||(b[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,t(s(o)("config.loading")),1)])):(i(),r("div",ga,[e("div",ma,[e("h3",va,t(s(o)("config.mcpConfig.serverList")),1),V.value.length===0?(i(),r("div",ha,[b[7]||(b[7]=e("div",{class:"empty-state-icon"},"📂",-1)),e("div",ya,t(m.value?s(o)("config.notFound"):s(o)("config.mcpConfig.noServers")),1)])):(i(),r("div",_a,[e("table",ba,[e("thead",null,[e("tr",null,[b[8]||(b[8]=e("th",null,"ID",-1)),e("th",null,t(s(o)("agent.name")),1),e("th",null,t(s(o)("config.mcpConfig.connectionType")),1),e("th",null,t(s(o)("config.mcpConfig.configJsonLabel")),1),e("th",null,t(s(o)("common.actions")),1)])]),e("tbody",null,[(i(!0),r(z,null,H(V.value,O=>(i(),r("tr",{key:O.id,class:"mcp-row"},[e("td",Ca,t(O.id),1),e("td",$a,[e("div",wa,[b[9]||(b[9]=e("span",{class:"server-icon"},"🔌",-1)),w(" "+t(O.mcpServerName),1)])]),e("td",ka,[e("span",{class:W(["connection-type-badge",O.connectionType.toLowerCase()])},t(O.connectionType),3)]),e("td",Sa,[e("div",{class:"config-preview",title:O.connectionConfig},t(P(O.connectionConfig)),9,Ta)]),e("td",Va,[e("button",{onClick:Z=>Q(O.id),class:"action-btn delete-btn",disabled:a.value},t(s(o)("common.delete")),9,Aa)])]))),128))])])]))]),e("div",xa,[e("div",Pa,[e("h3",Ua,t(s(o)("config.mcpConfig.addMcpServer")),1)]),e("div",Ea,[e("div",Ma,[e("label",Na,t(s(o)("config.mcpConfig.connectionType"))+"：",1),e("div",Da,[e("div",La,[I(e("input",{type:"radio",id:"mcp-connection-type-studio","onUpdate:modelValue":b[1]||(b[1]=O=>p.connectionType=O),value:"STUDIO"},null,512),[[Ve,p.connectionType]]),e("label",Fa,[b[10]||(b[10]=e("span",{class:"radio-title"},"STUDIO",-1)),e("span",Ra,t(s(o)("config.mcpConfig.instructionStep1LocalDesc")),1)])]),e("div",Ba,[I(e("input",{type:"radio",id:"mcp-connection-type-sse","onUpdate:modelValue":b[2]||(b[2]=O=>p.connectionType=O),value:"SSE"},null,512),[[Ve,p.connectionType]]),e("label",Ia,[b[11]||(b[11]=e("span",{class:"radio-title"},"SSE",-1)),e("span",qa,t(s(o)("config.mcpConfig.instructionStep1RemoteDesc")),1)])]),e("div",Oa,[I(e("input",{type:"radio",id:"mcp-connection-type-streaming","onUpdate:modelValue":b[3]||(b[3]=O=>p.connectionType=O),value:"STREAMING"},null,512),[[Ve,p.connectionType]]),e("label",Ga,[b[12]||(b[12]=e("span",{class:"radio-title"},"Streamable HTTP",-1)),e("span",ja,t(s(o)("config.mcpConfig.instructionStep1RemoteDesc")),1)])])])]),e("div",Ka,[e("label",Ja,t(s(o)("config.mcpConfig.configJsonLabel")),1),I(e("textarea",{"onUpdate:modelValue":b[4]||(b[4]=O=>p.configJson=O),placeholder:s(o)("config.mcpConfig.configJsonPlaceholder"),class:"config-textarea",rows:"6"},null,8,za),[[j,p.configJson]])]),e("div",Ha,[e("button",{onClick:L,class:"action-btn add-btn",disabled:a.value},t(s(o)("common.add")),9,Ya),e("button",{onClick:oe,class:"action-btn reset-btn",disabled:a.value},t(s(o)("common.reset")),9,Xa)])]),e("div",Wa,[e("h4",null,t(s(o)("config.mcpConfig.instructions")),1),e("ol",null,[e("li",null,[w(t(s(o)("config.mcpConfig.instructionStep1"))+" ",1),e("ul",Qa,[e("li",null,[e("strong",null,t(s(o)("config.mcpConfig.instructionStep1Local")),1),w("："+t(s(o)("config.mcpConfig.instructionStep1LocalDesc")),1)]),e("li",null,[e("strong",null,t(s(o)("config.mcpConfig.instructionStep1Remote")),1),w("："+t(s(o)("config.mcpConfig.instructionStep1RemoteDesc")),1)])])]),e("li",null,t(s(o)("config.mcpConfig.instructionStep2")),1),e("li",null,t(s(o)("config.mcpConfig.instructionStep3")),1),e("li",null,t(s(o)("config.mcpConfig.instructionStep4")),1)])])])])),y(_e,{name:"message-fade"},{default:X(()=>[u.show?(i(),r("div",{key:0,class:W(["message-toast",u.type])},t(u.text),3)):E("",!0)]),_:1})]))}}),el=ie(Za,[["__scopeId","data-v-355da8bb"]]);class ve{static async handleResponse(o){if(!o.ok)try{const a=await o.json();throw new Error(a.message||`API request failed: ${o.status}`)}catch{throw new Error(`API request failed: ${o.status} ${o.statusText}`)}return o}static async getAllPrompts(){try{const o=await fetch(this.BASE_URL);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get Prompt list:",o),o}}static async getPromptById(o){try{const a=await fetch(`${this.BASE_URL}/${o}`);return await(await this.handleResponse(a)).json()}catch(a){throw console.error(`Failed to get Pr'o'm'p't[${o}] details:`,a),a}}static async createPrompt(o){try{const a=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await(await this.handleResponse(a)).json()}catch(a){throw console.error("Failed to create Prompt:",a),a}}static async updatePrompt(o,a){try{const g=await fetch(`${this.BASE_URL}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await(await this.handleResponse(g)).json()}catch(g){throw console.error(`Failed to update Prompt[${o}]:`,g),g}}static async deletePrompt(o){try{const a=await fetch(`${this.BASE_URL}/${o}`,{method:"DELETE"});if(a.status===400)throw new Error("Cannot delete default Prompt");await this.handleResponse(a)}catch(a){throw console.error(`Failed to delete Prompt[${o}]:`,a),a}}}me(ve,"BASE_URL","/api/prompt");const ol=le({__name:"Toast",setup(B,{expose:o}){const a=M(!1),g=M(""),m=M("success"),p=M("carbon:checkmark"),u=M(3e3),v=(P,_="success",T=3e3)=>{g.value=P,m.value=_,p.value=_==="success"?"carbon:checkmark":"carbon:error",u.value=T,a.value=!0,setTimeout(()=>{a.value=!1},u.value)},V=()=>{a.value=!1};return o({show:v}),(P,_)=>(i(),ee(Ee,{to:"body"},[y(_e,{name:"slide"},{default:X(()=>[a.value?(i(),r("div",{key:0,class:W(["toast",`toast--${m.value}`]),onClick:V},[y(s(x),{icon:p.value,class:"toast-icon"},null,8,["icon"]),e("span",null,t(g.value),1)],2)):E("",!0)]),_:1})]))}}),tl=ie(ol,[["__scopeId","data-v-581895ae"]]);let ue=null;const sl=()=>{if(!ue){const B=Be(tl),o=document.createElement("div");document.body.appendChild(o),ue=B.mount(o)}return{success:(B,o)=>{ue==null||ue.show(B,"success",o)},error:(B,o)=>{ue==null||ue.show(B,"error",o)}}},nl={class:"custom-select"},al=["title"],ll={key:0,class:"current-option"},il={class:"option-name"},cl={key:1,class:"current-option"},rl={class:"select-options"},dl=["onClick"],ul={class:"option-name"},pl=le({__name:"select",props:{modelValue:{},options:{},placeholder:{}},emits:["update:modelValue"],setup(B,{emit:o}){const a=B,g=o,m=M(!1),p=ae(()=>a.options.find(P=>P.id===a.modelValue)),u=P=>P.id===a.modelValue,v=()=>{m.value=!m.value},V=P=>{g("update:modelValue",P.id),m.value=!1};return(P,_)=>(i(),r("div",nl,[e("button",{class:"select-btn",onClick:v,title:P.placeholder},[p.value?(i(),r("span",ll,[e("span",il,t(p.value.name),1)])):(i(),r("span",cl,t(P.placeholder),1)),y(s(x),{icon:m.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])],8,al),y(_e,{name:"slideDown"},{default:X(()=>[I(e("div",{class:"select-dropdown",onClick:_[0]||(_[0]=he(()=>{},["stop"]))},[e("div",rl,[(i(!0),r(z,null,H(P.options,T=>(i(),r("button",{key:T.id,class:W(["select-option",{active:u(T)}]),onClick:L=>V(T)},[e("span",ul,t(T.name),1),u(T)?(i(),ee(s(x),{key:0,icon:"carbon:checkmark",width:"16",class:"check-icon"})):E("",!0)],10,dl))),128))])],512),[[Ae,m.value]])]),_:1}),m.value?(i(),r("div",{key:0,class:"backdrop",onClick:_[1]||(_[1]=T=>m.value=!1)})):E("",!0)]))}}),we=ie(pl,[["__scopeId","data-v-4c6d676f"]]),fl={class:"config-panel"},gl={class:"panel-header"},ml={class:"prompt-layout"},vl={class:"prompt-list"},hl={class:"list-header"},yl={class:"prompt-count"},_l={key:0,class:"prompts-container"},bl=["onClick"],Cl={class:"prompt-card-header"},$l={class:"prompt-name"},wl={key:0,class:"prompt-desc"},kl={class:"tags"},Sl={class:"tag"},Tl={key:1,class:"loading-state"},Vl={key:2,class:"empty-state"},Al={key:0,class:"prompt-detail"},xl={class:"detail-header"},Pl={class:"detail-actions"},Ul={class:"form-item"},El=["placeholder"],Ml={class:"form-item"},Nl={class:"form-item"},Dl={class:"form-item"},Ll=["placeholder"],Fl={class:"form-item"},Rl=["placeholder"],Bl={key:1,class:"no-selection"},Il={class:"modal-form"},ql={class:"form-item"},Ol=["placeholder"],Gl={class:"form-item"},jl={class:"form-item"},Kl={class:"form-item"},Jl=["placeholder"],zl={class:"form-item"},Hl=["placeholder"],Yl={class:"delete-confirm"},Xl={class:"warning-text"},Wl=le({__name:"dynamicPromptConfig",setup(B){const{t:o}=ye(),{success:a,error:g}=sl(),m=M(!1),p=ne([]),u=M(null),v=M(!1),V=M(!1),P=[{id:"USER",name:"USER"},{id:"ASSISTANT",name:"ASSISTANT"},{id:"SYSTEM",name:"SYSTEM"},{id:"TOOL",name:"TOOL"}],_=[{id:"LLM",name:"LLM"},{id:"PLANNING",name:"PLANNING"},{id:"AGENT",name:"AGENT"}],T={promptName:"",messageType:"",type:"",promptDescription:""},L=ne({...T}),Q=async()=>{m.value=!0;try{const l=await ve.getAllPrompts();l.length>0&&await oe(l[0]),p.splice(0,p.length,...l)}catch(l){console.error("加载数据失败:",l),g(o("config.promptConfig.loadDataFailed")+": "+l.message)}finally{m.value=!1}},oe=async l=>{try{const n=await ve.getPromptById(l.id);u.value={...n}}catch(n){console.error("加载Prompt详情失败:",n),g(o("config.promptConfig.loadDetailsFailed")+": "+n.message),u.value={...l}}},q=async()=>{if(Z(L))try{const l={...L,builtIn:!1},n=await ve.createPrompt(l);p.push(n),u.value=n,v.value=!1,a(o("config.promptConfig.createSuccess"))}catch(l){g(o("config.promptConfig.createFailed")+": "+l.message)}},b=async()=>{if(u.value&&Z(u.value))try{const l=await ve.updatePrompt(u.value.id,u.value),n=p.findIndex(c=>c.id===l.id);n!==-1&&(p[n]=l),u.value={...l},a(o("config.promptConfig.saveSuccess"))}catch(l){g(o("config.promptConfig.saveFailed")+": "+l.message)}},O=async()=>{if(u.value)try{await ve.deletePrompt(u.value.id);const l=p.findIndex(n=>n.id===u.value.id);l!==-1&&p.splice(l,1),u.value=p.length>0?p[0]:null,V.value=!1,a(o("config.promptConfig.deleteSuccess"))}catch(l){g(o("config.promptConfig.deleteFailed")+": "+l.message)}};function Z(l){const n=["promptName","messageType","type","promptContent"];for(const F of n){const D=l[F];if(D==null||typeof D=="string"&&D.trim()==="")return g(`${F} is required and cannot be empty`),!1}return!!K(p,l)}function K(l,n){const c=l.find(F=>F.promptName===n.promptName);return c&&n.id&&c.id!==n.id?(g(`Name "${n.promptName}" already exists. Please use a different name.`),!1):c&&!n.id?(g(`Name "${n.promptName}" already exists. Please use a different name.`),!1):!0}const re=()=>{L.promptName="",L.promptDescription="",L.promptContent="",Object.assign(L,T),v.value=!0},U=()=>{V.value=!0};return Ce(()=>{Q()}),(l,n)=>(i(),r("div",fl,[e("div",gl,[e("h2",null,t(s(o)("config.promptConfig.title")),1)]),e("div",ml,[e("div",vl,[e("div",hl,[e("h3",null,t(s(o)("config.promptConfig.configuredprompts")),1),e("span",yl,"("+t(p.length)+t(s(o)("config.promptConfig.promptCount"))+")",1)]),m.value?E("",!0):(i(),r("div",_l,[(i(!0),r(z,null,H(p,c=>{var F,D;return i(),r("div",{key:c.id,class:W(["prompt-card",{active:((F=u.value)==null?void 0:F.id)===c.id}]),onClick:J=>oe(c)},[e("div",Cl,[e("span",$l,t(c.promptName),1),y(s(x),{icon:"carbon:chevron-right"})]),(D=c.promptDescription)!=null&&D.trim()?(i(),r("p",wl,t(c.promptDescription),1)):E("",!0),e("div",kl,[e("span",Sl,t(c.builtIn?s(o)("config.promptConfig.builtIn"):s(o)("config.promptConfig.custom")),1)])],10,bl)}),128))])),m.value?(i(),r("div",Tl,[y(s(x),{icon:"carbon:loading",class:"loading-icon"}),w(" "+t(s(o)("common.loading")),1)])):E("",!0),!m.value&&p.length===0?(i(),r("div",Vl,[y(s(x),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,t(s(o)("config.promptConfig.noPrompts")),1)])):E("",!0),e("button",{class:"add-btn",onClick:re},[y(s(x),{icon:"carbon:add"}),w(" "+t(s(o)("config.promptConfig.createNew")),1)])]),u.value?(i(),r("div",Al,[e("div",xl,[e("h3",null,t(u.value.promptName),1),e("div",Pl,[e("button",{class:"action-btn primary",onClick:b},[y(s(x),{icon:"carbon:save"}),w(" "+t(s(o)("common.save")),1)]),u.value.builtIn?E("",!0):(i(),r("button",{key:0,class:"action-btn danger",onClick:U},[y(s(x),{icon:"carbon:trash-can"}),w(" "+t(s(o)("common.delete")),1)]))])]),e("div",Ul,[e("label",null,[w(t(s(o)("config.promptConfig.promptName"))+" ",1),n[15]||(n[15]=e("span",{class:"required"},"*",-1))]),I(e("input",{disabled:!0,type:"text","onUpdate:modelValue":n[0]||(n[0]=c=>u.value.promptName=c),placeholder:s(o)("config.promptConfig.placeholder"),required:""},null,8,El),[[j,u.value.promptName]])]),e("div",Ml,[e("label",null,[w(t(s(o)("config.promptConfig.messageType"))+" ",1),n[16]||(n[16]=e("span",{class:"required"},"*",-1))]),u.value.builtIn?I((i(),r("input",{key:1,type:"text","onUpdate:modelValue":n[2]||(n[2]=c=>u.value.messageType=c),disabled:!0},null,512)),[[j,u.value.messageType]]):(i(),ee(we,{key:0,modelValue:u.value.messageType,"onUpdate:modelValue":n[1]||(n[1]=c=>u.value.messageType=c),options:P,disabled:u.value.builtIn,placeholder:s(o)("config.promptConfig.placeholder")},null,8,["modelValue","disabled","placeholder"]))]),e("div",Nl,[e("label",null,[w(t(s(o)("config.promptConfig.type"))+" ",1),n[17]||(n[17]=e("span",{class:"required"},"*",-1))]),u.value.builtIn?I((i(),r("input",{key:1,type:"text","onUpdate:modelValue":n[4]||(n[4]=c=>u.value.type=c),disabled:!0,required:""},null,512)),[[j,u.value.type]]):(i(),ee(we,{key:0,modelValue:u.value.type,"onUpdate:modelValue":n[3]||(n[3]=c=>u.value.type=c),options:_,disabled:u.value.builtIn,placeholder:s(o)("config.promptConfig.placeholder")},null,8,["modelValue","disabled","placeholder"]))]),e("div",Dl,[e("label",null,t(s(o)("config.promptConfig.description")),1),I(e("textarea",{"onUpdate:modelValue":n[5]||(n[5]=c=>u.value.promptDescription=c),rows:"2",placeholder:s(o)("config.promptConfig.descriptionPlaceholder"),required:""},null,8,Ll),[[j,u.value.promptDescription]])]),e("div",Fl,[e("label",null,[w(t(s(o)("config.promptConfig.promptContent"))+" ",1),n[18]||(n[18]=e("span",{class:"required"},"*",-1))]),I(e("textarea",{"onUpdate:modelValue":n[6]||(n[6]=c=>u.value.promptContent=c),rows:"8",placeholder:s(o)("config.promptConfig.promptContentPlaceholder"),required:""},null,8,Rl),[[j,u.value.promptContent]])])])):(i(),r("div",Bl,[y(s(x),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,t(s(o)("config.promptConfig.selectPromptHint")),1)]))]),y(fe,{modelValue:v.value,"onUpdate:modelValue":n[12]||(n[12]=c=>v.value=c),title:s(o)("config.promptConfig.newPrompt"),onConfirm:q},{default:X(()=>[e("div",Il,[e("div",ql,[e("label",null,[w(t(s(o)("config.promptConfig.promptName"))+" ",1),n[19]||(n[19]=e("span",{class:"required"},"*",-1))]),I(e("input",{type:"text","onUpdate:modelValue":n[7]||(n[7]=c=>L.promptName=c),placeholder:s(o)("config.promptConfig.placeholder"),required:""},null,8,Ol),[[j,L.promptName]])]),e("div",Gl,[e("label",null,[w(t(s(o)("config.promptConfig.messageType"))+" ",1),n[20]||(n[20]=e("span",{class:"required"},"*",-1))]),y(we,{modelValue:L.messageType,"onUpdate:modelValue":n[8]||(n[8]=c=>L.messageType=c),options:P,placeholder:s(o)("config.promptConfig.placeholder")},null,8,["modelValue","placeholder"])]),e("div",jl,[e("label",null,[w(t(s(o)("config.promptConfig.type"))+" ",1),n[21]||(n[21]=e("span",{class:"required"},"*",-1))]),y(we,{modelValue:L.type,"onUpdate:modelValue":n[9]||(n[9]=c=>L.type=c),options:_,placeholder:s(o)("config.promptConfig.placeholder")},null,8,["modelValue","placeholder"])]),e("div",Kl,[e("label",null,t(s(o)("config.promptConfig.description")),1),I(e("textarea",{"onUpdate:modelValue":n[10]||(n[10]=c=>L.promptDescription=c),rows:"3",placeholder:s(o)("config.promptConfig.descriptionPlaceholder")},null,8,Jl),[[j,L.promptDescription]])]),e("div",zl,[e("label",null,[w(t(s(o)("config.promptConfig.promptContent"))+" ",1),n[22]||(n[22]=e("span",{class:"required"},"*",-1))]),I(e("textarea",{"onUpdate:modelValue":n[11]||(n[11]=c=>L.promptContent=c),rows:"8",placeholder:s(o)("config.promptConfig.promptContentPlaceholder"),required:""},null,8,Hl),[[j,L.promptContent]])])])]),_:1},8,["modelValue","title"]),y(fe,{modelValue:V.value,"onUpdate:modelValue":n[14]||(n[14]=c=>V.value=c),title:s(o)("config.promptConfig.deleteConfirm")},{footer:X(()=>[e("button",{class:"cancel-btn",onClick:n[13]||(n[13]=c=>V.value=!1)},t(s(o)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:O},t(s(o)("common.delete")),1)]),default:X(()=>{var c;return[e("div",Yl,[y(s(x),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[w(t(s(o)("config.promptConfig.deleteConfirmText"))+" ",1),e("strong",null,t((c=u.value)==null?void 0:c.promptName),1),w(" "+t(s(o)("common.confirm"))+"？ ",1)]),e("p",Xl,t(s(o)("config.promptConfig.deleteWarning")),1)])]}),_:1},8,["modelValue","title"])]))}}),Ql=ie(Wl,[["__scopeId","data-v-8426fa4c"]]),Zl={class:"config-container"},ei={class:"config-header"},oi={class:"header-actions"},ti={class:"config-content"},si={class:"config-nav"},ni=["onClick"],ai={class:"config-details"},li=le({__name:"index",setup(B){const{t:o}=ye(),a=Ie(),g=qe(),m=M(a.params.category||"basic"),p=ae(()=>[{key:"basic",label:o("config.categories.basic"),icon:"carbon:settings"},{key:"agent",label:o("config.categories.agent"),icon:"carbon:bot"},{key:"model",label:o("config.categories.model"),icon:"carbon:build-image"},{key:"mcp",label:o("config.categories.mcp"),icon:"carbon:tool-box"},{key:"prompt",label:o("config.categories.prompt"),icon:"carbon:repo-artifact"}]),u=v=>{m.value=v,g.push({name:a.name,params:{...a.params,category:v},query:a.query})};return(v,V)=>(i(),r("div",Zl,[e("div",ei,[e("div",oi,[e("button",{class:"action-btn",onClick:V[0]||(V[0]=P=>v.$router.push("/"))},[y(s(x),{icon:"carbon:arrow-left"}),w(" "+t(v.$t("backHome")),1)]),y(Oe)])]),e("div",ti,[e("nav",si,[(i(!0),r(z,null,H(p.value,(P,_)=>(i(),r("div",{key:_,class:W(["nav-item",{active:m.value===P.key}]),onClick:T=>u(P.key)},[y(s(x),{icon:P.icon,width:"20"},null,8,["icon"]),e("span",null,t(P.label),1)],10,ni))),128))]),e("div",ai,[m.value==="basic"?(i(),ee(Ct,{key:0})):E("",!0),m.value==="agent"?(i(),ee(on,{key:1})):E("",!0),m.value==="model"?(i(),ee(ta,{key:2})):E("",!0),m.value==="mcp"?(i(),ee(el,{key:3})):E("",!0),m.value==="prompt"?(i(),ee(Ql,{key:4})):E("",!0)])])]))}}),ui=ie(li,[["__scopeId","data-v-ea3bfe45"]]);export{ui as default};

var Be=Object.defineProperty;var Oe=(F,o,n)=>o in F?Be(F,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):F[o]=n;var me=(F,o,n)=>Oe(F,typeof o!="symbol"?o+"":o,n);import{d as ie,c as u,o as c,e,t as s,f as ge,r as O,s as ne,g as te,h as ve,i as C,b as I,p as w,w as j,v as J,F as Q,j as Z,m as se,B as Ee,a as le,y as z,T as ke,G as we,A as je,u as t,q as Ce,z as be,H as Ge,l as Je,D as Ke,I as Pe,n as He,J as Ve,K as ze,k as Fe,C as Re,L as Ye}from"./index-Bv0VVP6v.js";import{_ as ae,I as N}from"./_plugin-vue_export-helper-D0FSf4sr.js";import{u as Le}from"./useToast-DjH8Aq3n.js";import{L as We}from"./index-Y53_iuBh.js";const Xe={class:"switch"},Qe=["checked"],Ze={class:"switch-label"},eo=ie({__name:"index",props:{enabled:{type:Boolean},label:{}},emits:["update:switchValue"],setup(F,{emit:o}){const n=o,m=b=>{const _=b.target.checked;n("update:switchValue",_)};return(b,_)=>(c(),u("label",Xe,[e("input",{type:"checkbox",checked:b.enabled,onChange:m},null,40,Qe),_[0]||(_[0]=e("span",{class:"slider"},null,-1)),e("span",Ze,s(b.label),1)]))}}),oo=ae(eo,[["__scopeId","data-v-d484b4a3"]]);class $e{static async getConfigsByGroup(o){try{const n=await fetch(`${this.BASE_URL}/group/${o}`);if(!n.ok)throw new Error(`Failed to get ${o} group configuration: ${n.status}`);return await n.json()}catch(n){throw console.error(`Failed to get ${o} group configuration:`,n),n}}static async batchUpdateConfigs(o){if(o.length===0)return{success:!0,message:"No configuration needs to be updated"};try{const n=await fetch(`${this.BASE_URL}/batch-update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!n.ok)throw new Error(`Batch update configuration failed: ${n.status}`);return{success:!0,message:"Configuration saved successfully"}}catch(n){return console.error("Batch update configuration failed:",n),{success:!1,message:n instanceof Error?n.message:"Update failed, please try again"}}}static async getConfigById(o){try{const n=await fetch(`${this.BASE_URL}/${o}`);if(!n.ok)throw new Error(`Failed to get configuration item: ${n.status}`);return await n.json()}catch(n){throw console.error(`Failed to get configuration item[${o}]:`,n),n}}static async updateConfig(o){try{const n=await fetch(`${this.BASE_URL}/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!n.ok)throw new Error(`Failed to update configuration item: ${n.status}`);return{success:!0,message:"Configuration updated successfully"}}catch(n){return console.error("Failed to update configuration item:",n),{success:!1,message:n instanceof Error?n.message:"Update failed, please try again"}}}}me($e,"BASE_URL","/api/config");const to={class:"config-panel"},so={class:"config-header"},no={class:"header-left"},ao={class:"config-stats"},lo={class:"stat-item"},io={class:"stat-label"},co={class:"stat-value"},ro={key:0,class:"stat-item"},uo={class:"stat-label"},po={class:"stat-value modified"},fo={class:"header-right"},go={class:"import-export-actions"},mo=["title"],ho=["title"],vo={class:"search-box"},yo=["placeholder"],_o={key:0,class:"loading-container"},bo={key:1,class:"config-groups"},Co={class:"group-header"},$o={class:"group-info"},wo={class:"group-icon"},ko={class:"group-actions"},So=["onClick","disabled","title"],To={class:"sub-groups"},No=["onClick"],Uo={class:"sub-group-info"},xo={class:"sub-group-title"},Vo={class:"item-count"},Ao={class:"config-items"},Eo={key:0,class:"config-item-content vertical-layout"},Po={class:"config-item-info"},Do={class:"config-item-header"},Mo={class:"config-label"},Fo={class:"type-badge boolean"},Ro={key:0,class:"modified-badge"},Lo=["title"],Io={class:"config-control"},qo=["value","onChange"],Bo=["value"],Oo={key:1,class:"config-item-content vertical-layout"},jo={class:"config-item-info"},Go={class:"config-item-header"},Jo={class:"config-label"},Ko={class:"type-badge select"},Ho={key:0,class:"modified-badge"},zo=["title"],Yo={class:"config-control"},Wo=["value","onChange"],Xo=["value"],Qo={key:2,class:"config-item-content vertical-layout"},Zo={class:"config-item-info"},et={class:"config-item-header"},ot={class:"config-label"},tt={class:"type-badge textarea"},st={key:0,class:"modified-badge"},nt=["title"],at={class:"config-control"},lt=["value","onInput"],it={key:3,class:"config-item-content vertical-layout"},ct={class:"config-item-info"},rt={class:"config-item-header"},dt={class:"config-label"},ut={class:"type-badge number"},pt={key:0,class:"modified-badge"},ft=["title"],gt={key:0,class:"config-meta"},mt={class:"range-info"},ht={class:"config-control"},vt=["value","onInput","min","max"],yt={key:4,class:"config-item-content vertical-layout"},_t={class:"config-item-info"},bt={class:"config-item-header"},Ct={class:"config-label"},$t={class:"type-badge string"},wt={key:0,class:"modified-badge"},kt=["title"],St={class:"config-control"},Tt=["value","onInput"],Nt={key:2,class:"empty-state"},Ut=ie({__name:"basicConfig",setup(F){const{t:o}=ge(),n=O(!0),m=O(!1),b=O([]),_=O(new Map),V=O(new Set),p=ne({show:!1,text:"",type:"success"}),a=O(""),k={headless:"config.basicConfig.browserSettings.headless",requestTimeout:"config.basicConfig.browserSettings.requestTimeout",debugDetail:"config.basicConfig.general.debugDetail",baseDir:"config.basicConfig.general.baseDir",openBrowser:"config.basicConfig.interactionSettings.openBrowser",maxSteps:"config.basicConfig.agentSettings.maxSteps",userInputTimeout:"config.basicConfig.agentSettings.userInputTimeout",maxMemory:"config.basicConfig.agentSettings.maxMemory",parallelToolCalls:"config.basicConfig.agentSettings.parallelToolCalls",forceOverrideFromYaml:"config.basicConfig.agents.forceOverrideFromYaml",enabled:"config.basicConfig.infiniteContext.enabled",parallelThreads:"config.basicConfig.infiniteContext.parallelThreads",taskContextSize:"config.basicConfig.infiniteContext.taskContextSize",allowExternalAccess:"config.basicConfig.fileSystem.allowExternalAccess"},A={manus:"config.basicConfig.groupDisplayNames.manus"},E={manus:"🤖",browser:"🌐",interaction:"🖥️",system:"⚙️",performance:"⚡"},P={agent:"config.subGroupDisplayNames.agent",browser:"config.subGroupDisplayNames.browser",interaction:"config.subGroupDisplayNames.interaction",agents:"config.subGroupDisplayNames.agents",infiniteContext:"config.subGroupDisplayNames.infiniteContext",general:"config.subGroupDisplayNames.general",filesystem:"config.subGroupDisplayNames.filesystem"},D=te(()=>b.value.some(d=>d.subGroups.some(f=>f.items.some(S=>_.value.get(S.id)!==S.configValue)))),R=d=>d==="true",L=d=>parseFloat(d)||0,x=d=>({maxSteps:1,browserTimeout:1,maxThreads:1,timeoutSeconds:5,maxMemory:1})[d]||1,q=d=>({maxSteps:100,browserTimeout:600,maxThreads:32,timeoutSeconds:300,maxMemory:1e3})[d]||1e4,G=d=>typeof d=="string"?d:d.value,ee=d=>typeof d=="string"?d:d.label,ce=(d,f)=>{if(typeof f=="boolean")return f.toString();if(typeof f=="string"){if(d.options&&d.options.length>0){const S=d.options.find(U=>(typeof U=="string"?U:U.label)===f||(typeof U=="string"?U:U.value)===f);if(S)return typeof S=="string"?S:S.value}return f}return String(f)},H=(d,f,S=!1)=>{let U;d.inputType==="BOOLEAN"||d.inputType==="CHECKBOX"?U=ce(d,f):U=String(f),d.configValue!==U&&(d.configValue=U,d._modified=!0,(S||d.inputType==="BOOLEAN"||d.inputType==="CHECKBOX"||d.inputType==="SELECT")&&g())};let T=null;const g=()=>{T&&clearTimeout(T),T=window.setTimeout(()=>{i()},500)},l=(d,f="success")=>{p.text=d,p.type=f,p.show=!0,setTimeout(()=>{p.show=!1},3e3)},r=async()=>{try{n.value=!0;const f=["manus"].map(async U=>{try{const y=await $e.getConfigsByGroup(U);if(y.length===0)return null;const B=y.map(X=>({...X,displayName:k[X.configKey]||X.configKey,min:x(X.configKey),max:q(X.configKey)}));B.forEach(X=>{_.value.set(X.id,X.configValue)});const K=new Map;B.forEach(X=>{const de=X.configSubGroup??"general";K.has(de)||K.set(de,[]),K.get(de).push(X)});const oe=Array.from(K.entries()).map(([X,de])=>({name:X,displayName:P[X]||X,items:de}));return{name:U,displayName:A[U]||U,subGroups:oe}}catch(y){return console.warn(`加载配置组 ${U} 失败，跳过:`,y),null}}),S=await Promise.all(f);b.value=S.filter(U=>U!==null),console.log(o("config.basicConfig.loadConfigSuccess"),b.value)}catch(d){console.error(o("config.basicConfig.loadConfigFailed"),d),l(o("config.basicConfig.loadConfigFailed"),"error")}finally{n.value=!1}},i=async()=>{if(!(m.value||!D.value))try{m.value=!0;const d=[];if(b.value.forEach(S=>{S.subGroups.forEach(U=>{const y=U.items.filter(B=>B._modified);d.push(...y)})}),d.length===0){l(o("config.basicConfig.noModified"));return}const f=await $e.batchUpdateConfigs(d);f.success?(d.forEach(S=>{_.value.set(S.id,S.configValue),S._modified=!1}),l(o("config.basicConfig.saveSuccess"))):l(f.message||o("config.basicConfig.saveFailed"),"error")}catch(d){console.error(o("config.basicConfig.saveFailed"),d),l(o("config.basicConfig.saveFailed"),"error")}finally{m.value=!1}},h=async d=>{if(confirm(o("config.basicConfig.resetGroupConfirm",A[d]||d)))try{m.value=!0;const S=b.value.find(B=>B.name===d);if(!S)return;const U=[];if(S.subGroups.forEach(B=>{B.items.forEach(K=>{const oe=v(K.configKey);oe!==K.configValue&&U.push({...K,configValue:oe})})}),U.length===0){l(o("config.basicConfig.isDefault"));return}const y=await $e.batchUpdateConfigs(U);y.success?(await r(),l(o("config.basicConfig.resetSuccess",U.length))):l(y.message||o("config.basicConfig.resetFailed"),"error")}catch(S){console.error(o("config.basicConfig.resetFailed"),S),l(o("config.basicConfig.resetFailed"),"error")}finally{m.value=!1}},v=d=>({systemName:"JTaskPilot",language:"zh-CN",maxThreads:"8",timeoutSeconds:"60",autoOpenBrowser:"false",headlessBrowser:"true",maxMemory:"1000"})[d]||"",Y=(d,f)=>{const S=`${d}-${f}`;V.value.has(S)?V.value.delete(S):V.value.add(S)},W=(d,f)=>V.value.has(`${d}-${f}`),re=te(()=>{const d=b.value.reduce((S,U)=>S+U.subGroups.reduce((y,B)=>y+B.items.length,0),0),f=b.value.reduce((S,U)=>S+U.subGroups.reduce((y,B)=>y+B.items.filter(K=>_.value.get(K.id)!==K.configValue).length,0),0);return{total:d,modified:f}}),ye=te(()=>{if(!a.value.trim())return b.value;const d=a.value.toLowerCase();return b.value.map(f=>({...f,subGroups:f.subGroups.map(S=>({...S,items:S.items.filter(U=>U.displayName.toLowerCase().includes(d)||U.configKey.toLowerCase().includes(d)||U.description&&U.description.toLowerCase().includes(d))})).filter(S=>S.items.length>0)})).filter(f=>f.subGroups.length>0)}),M=()=>{try{const d={timestamp:new Date().toISOString(),version:"1.0",configs:b.value.reduce((y,B)=>(B.subGroups.forEach(K=>{K.items.forEach(oe=>{y[oe.configKey]=oe.configValue})}),y),{})},f=JSON.stringify(d,null,2),S=new Blob([f],{type:"application/json"}),U=document.createElement("a");U.href=URL.createObjectURL(S),U.download=`config-export-${new Date().toISOString().split("T")[0]}.json`,U.click(),l(o("config.basicConfig.exportSuccess"))}catch(d){console.error(o("config.basicConfig.exportFailed"),d),l(o("config.basicConfig.exportFailed"),"error")}},$=d=>{var y;const f=d.target,S=(y=f.files)==null?void 0:y[0];if(!S)return;const U=new FileReader;U.onload=async B=>{var K;try{const oe=JSON.parse((K=B.target)==null?void 0:K.result);if(!oe.configs)throw new Error(o("config.basicConfig.invalidFormat"));if(!confirm(o("config.importConfirm")))return;m.value=!0;const de=[];if(b.value.forEach(Ie=>{Ie.subGroups.forEach(qe=>{qe.items.forEach(xe=>{Object.prototype.hasOwnProperty.call(oe.configs,xe.configKey)&&de.push({...xe,configValue:oe.configs[xe.configKey]})})})}),de.length===0){l(o("config.basicConfig.notFound"));return}const De=await $e.batchUpdateConfigs(de);De.success?(await r(),l(o("config.basicConfig.importSuccess"))):l(De.message||o("config.basicConfig.importFailed"),"error")}catch(oe){console.error(o("config.basicConfig.importFailed"),oe),l(o("config.basicConfig.importFailed"),"error")}finally{m.value=!1,f.value=""}},U.readAsText(S)};return ve(()=>{r()}),(d,f)=>(c(),u("div",to,[e("div",so,[e("div",no,[e("h2",null,s(d.$t("config.basicConfig.title")),1),e("div",ao,[e("span",lo,[e("span",io,s(d.$t("config.basicConfig.totalConfigs"))+":",1),e("span",co,s(re.value.total),1)]),re.value.modified>0?(c(),u("span",ro,[e("span",uo,s(d.$t("config.basicConfig.modified"))+":",1),e("span",po,s(re.value.modified),1)])):I("",!0)])]),e("div",fo,[e("div",go,[e("button",{onClick:M,class:"action-btn",title:d.$t("config.basicConfig.exportConfigs")}," 📤 ",8,mo),e("label",{class:"action-btn",title:d.$t("config.basicConfig.importConfigs")},[f[1]||(f[1]=w(" 📥 ")),e("input",{type:"file",accept:".json",onChange:$,style:{display:"none"}},null,32)],8,ho)]),e("div",vo,[j(e("input",{"onUpdate:modelValue":f[0]||(f[0]=S=>a.value=S),type:"text",placeholder:d.$t("config.search"),class:"search-input"},null,8,yo),[[J,a.value]]),f[2]||(f[2]=e("span",{class:"search-icon"},"🔍",-1))])])]),n.value?(c(),u("div",_o,[f[3]||(f[3]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,s(d.$t("config.loading")),1)])):ye.value.length>0?(c(),u("div",bo,[(c(!0),u(Q,null,Z(ye.value,S=>(c(),u("div",{key:S.name,class:"config-group"},[e("div",Co,[e("div",$o,[e("span",wo,s(E[S.name]||"⚙️"),1)]),e("div",ko,[e("button",{onClick:U=>h(S.name),class:"reset-btn",disabled:m.value,title:d.$t("config.resetGroupConfirm")},s(d.$t("config.reset")),9,So)]),f[4]||(f[4]=e("div",{class:"group-divider"},null,-1))]),e("div",To,[(c(!0),u(Q,null,Z(S.subGroups,U=>(c(),u("div",{key:U.name,class:"sub-group"},[e("div",{class:"sub-group-header",onClick:y=>Y(S.name,U.name)},[e("div",Uo,[f[5]||(f[5]=e("span",{class:"sub-group-icon"},"📁",-1)),e("h4",xo,s(d.$t(U.displayName)),1),e("span",Vo,"("+s(U.items.length)+")",1)]),e("span",{class:se(["collapse-icon",{collapsed:W(S.name,U.name)}])}," ▼ ",2)],8,No),j(e("div",Ao,[(c(!0),u(Q,null,Z(U.items,y=>(c(),u("div",{key:y.id,class:se(["config-item",{modified:_.value.get(y.id)!==y.configValue}])},[y.inputType==="BOOLEAN"||y.inputType==="CHECKBOX"?(c(),u("div",Eo,[e("div",Po,[e("div",Do,[e("label",Mo,[w(s(d.$t(y.displayName)||y.description)+" ",1),e("span",Fo,s(y.inputType==="CHECKBOX"?d.$t("config.types.checkbox"):d.$t("config.types.boolean")),1),_.value.get(y.id)!==y.configValue?(c(),u("span",Ro,s(d.$t("config.modified")),1)):I("",!0)]),e("span",{class:"config-key",title:y.configKey},s(y.configKey),9,Lo)])]),e("div",Io,[y.options&&y.options.length>0?(c(),u("select",{key:0,class:"config-input select-input",value:y.configValue,onChange:B=>{var K;return H(y,((K=B.target)==null?void 0:K.value)||"")}},[(c(!0),u(Q,null,Z(y.options,B=>(c(),u("option",{key:G(B),value:G(B)},s(ee(B)),9,Bo))),128))],40,qo)):(c(),le(oo,{key:1,enabled:R(y.configValue),label:"","onUpdate:switchValue":B=>H(y,B)},null,8,["enabled","onUpdate:switchValue"]))])])):y.inputType==="SELECT"?(c(),u("div",Oo,[e("div",jo,[e("div",Go,[e("label",Jo,[w(s(d.$t(y.displayName)||y.description)+" ",1),e("span",Ko,s(d.$t("config.types.select")),1),_.value.get(y.id)!==y.configValue?(c(),u("span",Ho,s(d.$t("config.modified")),1)):I("",!0)]),e("span",{class:"config-key",title:y.configKey},s(y.configKey),9,zo)])]),e("div",Yo,[e("select",{class:"config-input select-input",value:y.configValue,onChange:B=>{var K;return H(y,((K=B.target)==null?void 0:K.value)||"")}},[(c(!0),u(Q,null,Z(y.options||[],B=>(c(),u("option",{key:G(B),value:G(B)},s(ee(B)),9,Xo))),128))],40,Wo)])])):y.inputType==="TEXTAREA"?(c(),u("div",Qo,[e("div",Zo,[e("div",et,[e("label",ot,[w(s(d.$t(y.displayName)||y.description)+" ",1),e("span",tt,s(d.$t("config.types.textarea")),1),_.value.get(y.id)!==y.configValue?(c(),u("span",st,s(d.$t("config.modified")),1)):I("",!0)]),e("span",{class:"config-key",title:y.configKey},s(y.configKey),9,nt)])]),e("div",at,[e("textarea",{class:"config-input textarea-input",value:y.configValue,onInput:B=>{var K;return H(y,((K=B.target)==null?void 0:K.value)||"")},onBlur:g,rows:"3"},null,40,lt)])])):y.inputType==="NUMBER"?(c(),u("div",it,[e("div",ct,[e("div",rt,[e("label",dt,[w(s(d.$t(y.displayName)||y.description)+" ",1),e("span",ut,s(d.$t("config.types.number")),1),_.value.get(y.id)!==y.configValue?(c(),u("span",pt,s(d.$t("config.modified")),1)):I("",!0)]),e("span",{class:"config-key",title:y.configKey},s(y.configKey),9,ft),y.min||y.max?(c(),u("div",gt,[e("span",mt,s(d.$t("config.range"))+": "+s(y.min||0)+" - "+s(y.max||"∞"),1)])):I("",!0)])]),e("div",ht,[e("input",{type:"number",class:"config-input number-input",value:L(y.configValue),onInput:B=>{var K;return H(y,((K=B.target)==null?void 0:K.value)||"")},onBlur:g,min:y.min||1,max:y.max||1e4},null,40,vt)])])):(c(),u("div",yt,[e("div",_t,[e("div",bt,[e("label",Ct,[w(s(d.$t(y.displayName)||y.description)+" ",1),e("span",$t,s(y.inputType==="TEXT"?d.$t("config.types.text"):d.$t("config.types.string")),1),_.value.get(y.id)!==y.configValue?(c(),u("span",wt,s(d.$t("config.modified")),1)):I("",!0)]),e("span",{class:"config-key",title:y.configKey},s(y.configKey),9,kt)])]),e("div",St,[e("input",{type:"text",class:"config-input text-input",value:y.configValue,onInput:B=>{var K;return H(y,((K=B.target)==null?void 0:K.value)||"")},onBlur:g},null,40,Tt)])]))],2))),128))],512),[[Ee,!W(S.name,U.name)]])]))),128))])]))),128))])):(c(),u("div",Nt,[e("p",null,s(d.$t("config.notFound")),1)])),C(ke,{name:"message-fade"},{default:z(()=>[p.show?(c(),u("div",{key:0,class:se(["message-toast",p.type])},s(p.text),3)):I("",!0)]),_:1})]))}}),Me=ae(Ut,[["__scopeId","data-v-bb27f059"]]),xt={},Vt={class:"config-config"},At={class:"panel-header"},Et={class:"panel-actions"};function Pt(F,o){return c(),u("div",Vt,[e("div",At,[we(F.$slots,"title",{},void 0),e("div",Et,[we(F.$slots,"actions",{},void 0)])]),we(F.$slots,"default",{},void 0)])}const Ne=ae(xt,[["render",Pt],["__scopeId","data-v-c91688e7"]]),Dt={class:"modal-header"},Mt={class:"modal-content"},Ft={class:"modal-footer"},Rt=ie({__name:"index",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""}},emits:["update:modelValue","confirm"],setup(F){const o=n=>{n.target===n.currentTarget&&(n.stopPropagation(),n.preventDefault())};return(n,m)=>(c(),le(je,{to:"body"},[C(ke,{name:"modal"},{default:z(()=>[F.modelValue?(c(),u("div",{key:0,class:"modal-overlay",onClick:o},[e("div",{class:"modal-container",onClick:m[3]||(m[3]=Ce(()=>{},["stop"]))},[e("div",Dt,[e("h3",null,s(F.title),1),e("button",{class:"close-btn",onClick:m[0]||(m[0]=b=>n.$emit("update:modelValue",!1))},[C(t(N),{icon:"carbon:close"})])]),e("div",Mt,[we(n.$slots,"default",{},void 0,!0)]),e("div",Ft,[we(n.$slots,"footer",{},()=>[e("button",{class:"cancel-btn",onClick:m[1]||(m[1]=b=>n.$emit("update:modelValue",!1))},s(n.$t("common.cancel")),1),e("button",{class:"confirm-btn",onClick:m[2]||(m[2]=b=>n.$emit("confirm"))},s(n.$t("common.confirm")),1)],!0)])])])):I("",!0)]),_:3})]))}}),pe=ae(Rt,[["__scopeId","data-v-baaf1c89"]]),Lt={class:"tool-selection-content"},It={class:"tool-controls"},qt={class:"search-container"},Bt={class:"sort-container"},Ot={class:"tool-summary"},jt={class:"summary-text"},Gt={key:0,class:"tool-groups"},Jt=["onClick"],Kt={class:"group-title-area"},Ht={class:"group-name"},zt={class:"group-count"},Yt={class:"group-enable-all"},Wt=["checked","onChange","data-group"],Xt={class:"tool-info"},Qt={class:"tool-selection-name"},Zt={key:0,class:"tool-selection-desc"},es={class:"tool-actions"},os=["checked","onChange"],ts={key:1,class:"empty-state"},ss=ie({__name:"index",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(F,{emit:o}){const n=F,m=o,b=te({get:()=>n.modelValue,set:T=>m("update:modelValue",T)}),_=O(""),V=O("group"),p=O(new Set),a=O([]),k=(T,g)=>{const l=document.querySelector(`input[data-group="${T}"]`);l&&(l.indeterminate=q(g))};be(()=>n.selectedToolIds,T=>{a.value=[...T]},{immediate:!0});const A=te(()=>{let T=n.tools.filter(g=>g.key);if(_.value){const g=_.value.toLowerCase();T=T.filter(l=>{var r;return l.name.toLowerCase().includes(g)||l.description.toLowerCase().includes(g)||(((r=l.serviceGroup)==null?void 0:r.toLowerCase().includes(g))??!1)})}switch(V.value){case"name":T=[...T].sort((g,l)=>g.name.localeCompare(l.name));break;case"enabled":T=[...T].sort((g,l)=>{const r=a.value.includes(g.key),i=a.value.includes(l.key);return r&&!i?-1:!r&&i?1:g.name.localeCompare(l.name)});break;case"group":default:T=[...T].sort((g,l)=>{const r=g.serviceGroup??"未分组",i=l.serviceGroup??"未分组";return r!==i?r.localeCompare(i):g.name.localeCompare(l.name)});break}return T}),E=te(()=>{const T=new Map;return A.value.forEach(g=>{const l=g.serviceGroup??"未分组";T.has(l)||T.set(l,[]),T.get(l).push(g)}),new Map([...T.entries()].sort())}),P=te(()=>A.value.length);be([a,E],()=>{Je(()=>{for(const[T,g]of E.value)k(T,g)})},{flush:"post",deep:!1});const D=T=>a.value.includes(T),R=(T,g)=>{g.stopPropagation();const r=g.target.checked;if(!T){console.error("toolKey is undefined, cannot proceed");return}r?a.value.includes(T)||(a.value=[...a.value,T]):a.value=a.value.filter(i=>i!==T)},L=T=>T.filter(g=>a.value.includes(g.key)),x=T=>T.length>0&&T.every(g=>a.value.includes(g.key)),q=T=>{const g=L(T).length;return g>0&&g<T.length},G=(T,g)=>{g.stopPropagation();const r=g.target.checked,i=T.map(h=>h.key);if(r){const h=[...a.value];i.forEach(v=>{h.includes(v)||h.push(v)}),a.value=h}else a.value=a.value.filter(h=>!i.includes(h))},ee=T=>{p.value.has(T)?p.value.delete(T):p.value.add(T)},ce=()=>{m("confirm",[...a.value]),m("update:modelValue",!1)},H=()=>{a.value=[...n.selectedToolIds],m("update:modelValue",!1)};return be(b,T=>{if(T){p.value.clear();const g=Array.from(E.value.keys());g.length>1&&g.slice(1).forEach(l=>{p.value.add(l)})}}),(T,g)=>(c(),le(pe,{modelValue:b.value,"onUpdate:modelValue":[g[4]||(g[4]=l=>b.value=l),H],title:"选择工具",onConfirm:ce},{default:z(()=>[e("div",Lt,[e("div",It,[e("div",qt,[j(e("input",{"onUpdate:modelValue":g[0]||(g[0]=l=>_.value=l),type:"text",class:"search-input",placeholder:"搜索工具..."},null,512),[[J,_.value]])]),e("div",Bt,[j(e("select",{"onUpdate:modelValue":g[1]||(g[1]=l=>V.value=l),class:"sort-select"},g[5]||(g[5]=[e("option",{value:"group"},"按服务组排序",-1),e("option",{value:"name"},"按名称排序",-1),e("option",{value:"enabled"},"按启用状态排序",-1)]),512),[[Ge,V.value]])])]),e("div",Ot,[e("span",jt," 共 "+s(E.value.size)+" 个服务组，"+s(P.value)+" 个工具 (已选择 "+s(a.value.length)+" 个) ",1)]),E.value.size>0?(c(),u("div",Gt,[(c(!0),u(Q,null,Z(E.value,([l,r])=>(c(),u("div",{key:l,class:"tool-group"},[e("div",{class:se(["tool-group-header",{collapsed:p.value.has(l)}]),onClick:i=>ee(l)},[e("div",Kt,[C(t(N),{icon:p.value.has(l)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),C(t(N),{icon:"carbon:folder",class:"group-icon"}),e("span",Ht,s(l),1),e("span",zt," ("+s(L(r).length)+"/"+s(r.length)+") ",1)]),e("div",{class:"group-actions",onClick:g[2]||(g[2]=Ce(()=>{},["stop"]))},[e("label",Yt,[e("input",{type:"checkbox",class:"group-enable-checkbox",checked:x(r),onChange:i=>G(r,i),"data-group":l},null,40,Wt),g[6]||(g[6]=e("span",{class:"enable-label"},"启用全部",-1))])])],10,Jt),e("div",{class:se(["tool-group-content",{collapsed:p.value.has(l)}])},[(c(!0),u(Q,null,Z(r.filter(i=>i&&i.key),i=>(c(),u("div",{key:i.key,class:"tool-selection-item"},[e("div",Xt,[e("div",Qt,s(i.name),1),i.description?(c(),u("div",Zt,s(i.description),1)):I("",!0)]),e("div",es,[e("label",{class:"tool-enable-switch",onClick:g[3]||(g[3]=Ce(()=>{},["stop"]))},[e("input",{type:"checkbox",class:"tool-enable-checkbox",checked:D(i.key),onChange:h=>R(i.key,h)},null,40,os),g[7]||(g[7]=e("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(c(),u("div",ts,[C(t(N),{icon:"carbon:tools",class:"empty-icon"}),g[8]||(g[8]=e("p",null,"没有找到工具",-1))]))])]),_:1},8,["modelValue"]))}}),ns=ae(ss,[["__scopeId","data-v-79f6a572"]]);class fe{static async handleResponse(o){if(!o.ok)try{const n=await o.json();throw new Error(n.message||`API request failed: ${o.status}`)}catch{throw new Error(`API request failed: ${o.status} ${o.statusText}`)}return o}static async getAllAgents(o){try{if(o){const n=await fetch(`${this.BASE_URL}/namespace/${o}`);return await(await this.handleResponse(n)).json()}else{const n=await fetch(`${this.BASE_URL}`);return await(await this.handleResponse(n)).json()}}catch(n){throw console.error("Failed to get Agent list:",n),n}}static async getAgentById(o){try{const n=await fetch(`${this.BASE_URL}/${o}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error(`Failed to get Agent[${o}] details:`,n),n}}static async createAgent(o){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create Agent:",n),n}}static async updateAgent(o,n){try{const m=await fetch(`${this.BASE_URL}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await(await this.handleResponse(m)).json()}catch(m){throw console.error(`Failed to update Agent[${o}]:`,m),m}}static async deleteAgent(o){try{const n=await fetch(`${this.BASE_URL}/${o}`,{method:"DELETE"});if(n.status===400)throw new Error("Cannot delete default Agent");await this.handleResponse(n)}catch(n){throw console.error(`Failed to delete Agent[${o}]:`,n),n}}static async getAvailableTools(){try{const o=await fetch(`${this.BASE_URL}/tools`);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get available tools list:",o),o}}}me(fe,"BASE_URL","/api/agents");class ue{static async handleResponse(o){if(!o.ok)try{const n=await o.json();throw new Error(n.message||`API request failed: ${o.status}`)}catch{throw new Error(`API request failed: ${o.status} ${o.statusText}`)}return o}static async getAllModels(){try{const o=await fetch(this.BASE_URL);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get Model list:",o),o}}static async getAllTypes(){try{const o=await fetch(`${this.BASE_URL}/types`);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get Model list:",o),o}}static async getModelById(o){try{const n=await fetch(`${this.BASE_URL}/${o}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error(`Failed to get Model[${o}] details:`,n),n}}static async createModel(o){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create Model:",n),n}}static async updateModel(o,n){try{const m=await fetch(`${this.BASE_URL}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(m.status===499)throw new Error("Request rejected, please modify the model configuration in the configuration file");return await(await this.handleResponse(m)).json()}catch(m){throw console.error(`Failed to update Model[${o}]:`,m),m}}static async deleteModel(o){try{const n=await fetch(`${this.BASE_URL}/${o}`,{method:"DELETE"});if(n.status===400)throw new Error("Cannot delete default Model");if(n.status===499)throw new Error("Request rejected, please modify the model configuration in the configuration file");await this.handleResponse(n)}catch(n){throw console.error(`Failed to delete Model[${o}]:`,n),n}}}me(ue,"BASE_URL","/api/models");const Ue=Ke("namespace",()=>{const F=O("default");function o(b){F.value=b}const n=O([]);function m(b){n.value=b}return{namespace:F,namespaces:n,setCurrentNs:o,setNamespaces:m}}),as=["disabled"],ls={class:"agent-layout"},is={class:"agent-list"},cs={class:"list-header"},rs={class:"agent-count"},ds={key:0,class:"agents-container"},us=["onClick"],ps={class:"agent-card-header"},fs={class:"agent-name"},gs={class:"agent-desc"},ms={key:0,class:"agent-model"},hs={class:"model-tag"},vs={class:"model-tag"},ys={key:1,class:"agent-tools"},_s={key:0,class:"tool-more"},bs={key:1,class:"loading-state"},Cs={key:2,class:"empty-state"},$s={key:0,class:"agent-detail"},ws={class:"detail-header"},ks={class:"detail-actions"},Ss={class:"form-item"},Ts=["placeholder"],Ns={class:"form-item"},Us=["placeholder"],xs={class:"form-item"},Vs=["value","placeholder"],As={class:"model-section"},Es={class:"form-item"},Ps={class:"model-chooser"},Ds=["title"],Ms={key:0,class:"current-model"},Fs={class:"model-type"},Rs={class:"model-name"},Ls={key:1,class:"current-model"},Is={class:"current-model"},qs={class:"dropdown-header"},Bs={class:"model-options"},Os=["onClick"],js={class:"model-type"},Gs={class:"model-name"},Js={class:"tools-section"},Ks={class:"assigned-tools"},Hs={class:"section-header"},zs={class:"tools-grid"},Ys={class:"tool-info"},Ws={class:"tool-name"},Xs={class:"tool-desc"},Qs={key:0,class:"no-tools"},Zs={key:1,class:"no-selection"},en={class:"modal-form"},on={class:"form-item"},tn=["placeholder"],sn={class:"form-item"},nn=["placeholder"],an={class:"form-item"},ln=["value","placeholder"],cn={class:"delete-confirm"},rn={class:"warning-text"},dn=ie({__name:"agentConfig",setup(F){const{t:o}=ge(),n=Ue(),{namespace:m}=Pe(n),b=O(!1),_=O(""),V=O(""),p=ne([]),a=O(null),k=ne([]),A=O(!1),E=O(!1),P=O(!1),D=O(!1),R=O(null),L=ne([]),x=()=>{D.value=!D.value},q=M=>{R.value=M,D.value=!1},G=ne({name:"",description:"",nextStepPrompt:""}),ee=M=>{const $=k.find(d=>d.key===M);return $?$.name:M},ce=M=>{const $=k.find(d=>d.key===M);return $?$.description:""},H=(M,$)=>{$==="success"?(V.value=M,setTimeout(()=>{V.value=""},3e3)):(_.value=M,setTimeout(()=>{_.value=""},5e3))},T=async()=>{b.value=!0;try{const[M,$,d]=await Promise.all([fe.getAllAgents(m.value),fe.getAvailableTools(),ue.getAllModels()]),f=M.map(S=>({...S,availableTools:S.availableTools,...d}));p.splice(0,p.length,...f),k.splice(0,k.length,...$),L.splice(0,L.length,...d),f.length>0&&await g(f[0])}catch(M){console.error("加载数据失败:",M),H(o("config.agentConfig.loadDataFailed")+": "+M.message,"error");const $=[{key:"search-web",name:"网络搜索",description:"在互联网上搜索信息",enabled:!0,serviceGroup:"搜索服务"},{key:"search-local",name:"本地搜索",description:"在本地文件中搜索内容",enabled:!0,serviceGroup:"搜索服务"},{key:"file-read",name:"读取文件",description:"读取本地或远程文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-write",name:"写入文件",description:"创建或修改文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-delete",name:"删除文件",description:"删除指定的文件",enabled:!1,serviceGroup:"文件服务"},{key:"calculator",name:"计算器",description:"执行数学计算",enabled:!0,serviceGroup:"计算服务"},{key:"code-execute",name:"代码执行",description:"执行Python或JavaScript代码",enabled:!0,serviceGroup:"计算服务"},{key:"weather",name:"天气查询",description:"获取指定地区的天气信息",enabled:!0,serviceGroup:"信息服务"},{key:"currency",name:"汇率查询",description:"查询货币汇率信息",enabled:!0,serviceGroup:"信息服务"},{key:"email",name:"发送邮件",description:"发送电子邮件",enabled:!1,serviceGroup:"通信服务"},{key:"sms",name:"发送短信",description:"发送短信消息",enabled:!1,serviceGroup:"通信服务"}],d=[{id:"demo-1",name:"通用助手",description:"一个能够处理各种任务的智能助手",nextStepPrompt:"You are a helpful assistant that can answer questions and help with various tasks. What would you like me to help you with next?",availableTools:["search-web","calculator","weather"]},{id:"demo-2",name:"数据分析师",description:"专门用于数据分析和可视化的Agent",nextStepPrompt:"You are a data analyst assistant specialized in analyzing data and creating visualizations. Please provide the data you would like me to analyze.",availableTools:["file-read","file-write","calculator","code-execute"]}];k.splice(0,k.length,...$),p.splice(0,p.length,...d),d.length>0&&(a.value=d[0])}finally{b.value=!1}},g=async M=>{try{const $=await fe.getAgentById(M.id);a.value={...$,availableTools:$.availableTools},R.value=$.model??null}catch($){console.error("加载Agent详情失败:",$),H(o("config.agentConfig.loadDetailsFailed")+": "+$.message,"error"),a.value={...M,availableTools:M.availableTools}}},l=()=>{G.name="",G.description="",G.nextStepPrompt="",A.value=!0},r=async()=>{var M;if(!G.name.trim()||!G.description.trim()){H(o("config.agentConfig.requiredFields"),"error");return}try{const $={name:G.name.trim(),description:G.description.trim(),nextStepPrompt:((M=G.nextStepPrompt)==null?void 0:M.trim())??"",availableTools:[],namespace:m.value},d=await fe.createAgent($);p.push(d),a.value=d,A.value=!1,H(o("config.agentConfig.createSuccess"),"success")}catch($){H(o("config.agentConfig.createFailed")+": "+$.message,"error")}},i=()=>{P.value=!0},h=M=>{a.value&&(a.value.availableTools=[...M])},v=async()=>{if(a.value){if(!a.value.name.trim()||!a.value.description.trim()){H(o("config.agentConfig.requiredFields"),"error");return}try{a.value.model=R.value;const M=await fe.updateAgent(a.value.id,a.value),$=p.findIndex(d=>d.id===M.id);$!==-1&&(p[$]=M),a.value=M,a.value.model=R.value,H(o("config.agentConfig.saveSuccess"),"success")}catch(M){H(o("config.agentConfig.saveFailed")+": "+M.message,"error")}}},Y=()=>{E.value=!0},W=async()=>{if(a.value)try{await fe.deleteAgent(a.value.id);const M=p.findIndex($=>$.id===a.value.id);M!==-1&&p.splice(M,1),a.value=p.length>0?p[0]:null,E.value=!1,H(o("config.agentConfig.deleteSuccess"),"success")}catch(M){H(o("config.agentConfig.deleteFailed")+": "+M.message,"error")}},re=()=>{const M=document.createElement("input");M.type="file",M.accept=".json",M.onchange=$=>{var f;const d=(f=$.target.files)==null?void 0:f[0];if(d){const S=new FileReader;S.onload=async U=>{var y;try{const B=JSON.parse((y=U.target)==null?void 0:y.result);if(!B.name||!B.description)throw new Error(o("config.agentConfig.invalidFormat"));const{id:K,...oe}=B,X=await fe.createAgent(oe);p.push(X),a.value=X,H(o("config.agentConfig.importSuccess"),"success")}catch(B){H(o("config.agentConfig.importFailed")+": "+B.message,"error")}},S.readAsText(d)}},M.click()},ye=()=>{if(a.value)try{const M=JSON.stringify(a.value,null,2),$=new Blob([M],{type:"application/json"}),d=URL.createObjectURL($),f=document.createElement("a");f.href=d,f.download=`agent-${a.value.name}-${new Date().toISOString().split("T")[0]}.json`,f.click(),URL.revokeObjectURL(d),H(o("config.agentConfig.exportSuccess"),"success")}catch(M){H(o("config.agentConfig.exportFailed")+": "+M.message,"error")}};return ve(()=>{T()}),be(()=>m.value,(M,$)=>{M!==$&&(p.splice(0),a.value=null,T())}),(M,$)=>(c(),le(Ne,null,{title:z(()=>[e("h2",null,s(t(o)("config.agentConfig.title")),1)]),actions:z(()=>[e("button",{class:"action-btn",onClick:re},[C(t(N),{icon:"carbon:upload"}),w(" "+s(t(o)("config.agentConfig.import")),1)]),e("button",{class:"action-btn",onClick:ye,disabled:!a.value},[C(t(N),{icon:"carbon:download"}),w(" "+s(t(o)("config.agentConfig.export")),1)],8,as)]),default:z(()=>{var d;return[e("div",ls,[e("div",is,[e("div",cs,[e("h3",null,s(t(o)("config.agentConfig.configuredAgents")),1),e("span",rs,"("+s(p.length)+s(t(o)("config.agentConfig.agentCount"))+")",1)]),b.value?I("",!0):(c(),u("div",ds,[(c(!0),u(Q,null,Z(p,f=>{var S,U;return c(),u("div",{key:f.id,class:se(["agent-card",{active:((S=a.value)==null?void 0:S.id)===f.id}]),onClick:y=>g(f)},[e("div",ps,[e("span",fs,s(f.name),1),C(t(N),{icon:"carbon:chevron-right"})]),e("p",gs,s(f.description),1),f.model?(c(),u("div",ms,[e("span",hs,s(f.model.type),1),e("span",vs,s(f.model.modelName),1)])):I("",!0),((U=f.availableTools)==null?void 0:U.length)>0?(c(),u("div",ys,[(c(!0),u(Q,null,Z(f.availableTools.slice(0,3),y=>(c(),u("span",{key:y,class:"tool-tag"},s(ee(y)),1))),128)),f.availableTools.length>3?(c(),u("span",_s," +"+s(f.availableTools.length-3),1)):I("",!0)])):I("",!0)],10,us)}),128))])),b.value?(c(),u("div",bs,[C(t(N),{icon:"carbon:loading",class:"loading-icon"}),w(" "+s(t(o)("common.loading")),1)])):I("",!0),!b.value&&p.length===0?(c(),u("div",Cs,[C(t(N),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,s(t(o)("config.agentConfig.noAgent")),1)])):I("",!0),e("button",{class:"add-btn",onClick:l},[C(t(N),{icon:"carbon:add"}),w(" "+s(t(o)("config.agentConfig.createNew")),1)])]),a.value?(c(),u("div",$s,[e("div",ws,[e("h3",null,s(a.value.name),1),e("div",ks,[e("button",{class:"action-btn primary",onClick:v},[C(t(N),{icon:"carbon:save"}),w(" "+s(t(o)("common.save")),1)]),e("button",{class:"action-btn danger",onClick:Y},[C(t(N),{icon:"carbon:trash-can"}),w(" "+s(t(o)("common.delete")),1)])])]),e("div",Ss,[e("label",null,[w(s(t(o)("config.agentConfig.agentName"))+" ",1),$[15]||($[15]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":$[0]||($[0]=f=>a.value.name=f),placeholder:t(o)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,Ts),[[J,a.value.name]])]),e("div",Ns,[e("label",null,[w(s(t(o)("config.agentConfig.description"))+" ",1),$[16]||($[16]=e("span",{class:"required"},"*",-1))]),j(e("textarea",{"onUpdate:modelValue":$[1]||($[1]=f=>a.value.description=f),rows:"3",placeholder:t(o)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,Us),[[J,a.value.description]])]),e("div",xs,[e("label",null,s(t(o)("config.agentConfig.nextStepPrompt")),1),e("textarea",{value:a.value.nextStepPrompt||"",onInput:$[2]||($[2]=f=>a.value.nextStepPrompt=f.target.value),rows:"8",placeholder:t(o)("config.agentConfig.nextStepPromptPlaceholder")},null,40,Vs)]),e("div",As,[e("h4",null,s(t(o)("config.agentConfig.modelConfiguration")),1),e("div",Es,[e("div",Ps,[e("button",{class:"model-btn",onClick:x,title:M.$t("model.switch")},[C(t(N),{icon:"carbon:build-run",width:"18"}),R.value?(c(),u("span",Ms,[e("span",Fs,s(R.value.type),1),$[17]||($[17]=e("span",{class:"spacer"},null,-1)),e("span",Rs,s(R.value.modelName),1)])):(c(),u("span",Ls,[e("span",Is,s(t(o)("config.agentConfig.modelConfigurationLabel")),1)])),C(t(N),{icon:D.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])],8,Ds),D.value?(c(),u("div",{key:0,class:"model-dropdown",onClick:$[4]||($[4]=Ce(()=>{},["stop"]))},[e("div",qs,[e("span",null,s(t(o)("config.agentConfig.modelConfigurationLabel")),1),e("button",{class:"close-btn",onClick:$[3]||($[3]=f=>D.value=!1)},[C(t(N),{icon:"carbon:close",width:"16"})])]),e("div",Bs,[(c(!0),u(Q,null,Z(L,f=>{var S,U;return c(),u("button",{key:f.id,class:se(["model-option",{active:((S=R.value)==null?void 0:S.id)===f.id}]),onClick:y=>q(f)},[e("span",js,s(f.type),1),e("span",Gs,s(f.modelName),1),((U=R.value)==null?void 0:U.id)===f.id?(c(),le(t(N),{key:0,icon:"carbon:checkmark",width:"16",class:"check-icon"})):I("",!0)],10,Os)}),128))])])):I("",!0),D.value?(c(),u("div",{key:1,class:"backdrop",onClick:$[5]||($[5]=f=>D.value=!1)})):I("",!0)])])]),e("div",Js,[e("h4",null,s(t(o)("config.agentConfig.toolConfiguration")),1),e("div",Ks,[e("div",Hs,[e("span",null,s(t(o)("config.agentConfig.assignedTools"))+" ("+s((a.value.availableTools||[]).length)+")",1),k.length>0?(c(),u("button",{key:0,class:"action-btn small",onClick:i},[C(t(N),{icon:"carbon:add"}),w(" "+s(t(o)("config.agentConfig.addRemoveTools")),1)])):I("",!0)]),e("div",zs,[(c(!0),u(Q,null,Z(a.value.availableTools||[],f=>(c(),u("div",{key:f,class:"tool-item assigned"},[e("div",Ys,[e("span",Ws,s(ee(f)),1),e("span",Xs,s(ce(f)),1)])]))),128)),a.value.availableTools.length===0?(c(),u("div",Qs,[C(t(N),{icon:"carbon:tool-box"}),e("span",null,s(t(o)("config.agentConfig.noAssignedTools")),1)])):I("",!0)])])])])):(c(),u("div",Zs,[C(t(N),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,s(t(o)("config.agentConfig.selectAgentHint")),1)]))]),C(pe,{modelValue:A.value,"onUpdate:modelValue":$[9]||($[9]=f=>A.value=f),title:t(o)("config.agentConfig.newAgent"),onConfirm:r},{default:z(()=>[e("div",en,[e("div",on,[e("label",null,[w(s(t(o)("config.agentConfig.agentName"))+" ",1),$[18]||($[18]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":$[6]||($[6]=f=>G.name=f),placeholder:t(o)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,tn),[[J,G.name]])]),e("div",sn,[e("label",null,[w(s(t(o)("config.agentConfig.description"))+" ",1),$[19]||($[19]=e("span",{class:"required"},"*",-1))]),j(e("textarea",{"onUpdate:modelValue":$[7]||($[7]=f=>G.description=f),rows:"3",placeholder:t(o)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,nn),[[J,G.description]])]),e("div",an,[e("label",null,s(t(o)("config.agentConfig.nextStepPrompt")),1),e("textarea",{value:G.nextStepPrompt||"",onInput:$[8]||($[8]=f=>G.nextStepPrompt=f.target.value),rows:"8",placeholder:t(o)("config.agentConfig.nextStepPromptPlaceholder")},null,40,ln)])])]),_:1},8,["modelValue","title"]),C(ns,{modelValue:P.value,"onUpdate:modelValue":$[10]||($[10]=f=>P.value=f),tools:k,"selected-tool-ids":((d=a.value)==null?void 0:d.availableTools)||[],onConfirm:h},null,8,["modelValue","tools","selected-tool-ids"]),C(pe,{modelValue:E.value,"onUpdate:modelValue":$[12]||($[12]=f=>E.value=f),title:t(o)("config.agentConfig.deleteConfirm")},{footer:z(()=>[e("button",{class:"cancel-btn",onClick:$[11]||($[11]=f=>E.value=!1)},s(t(o)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:W},s(t(o)("common.delete")),1)]),default:z(()=>{var f;return[e("div",cn,[C(t(N),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[w(s(t(o)("config.agentConfig.deleteConfirmText"))+" ",1),e("strong",null,s((f=a.value)==null?void 0:f.name),1),w(" "+s(t(o)("common.confirm"))+"？ ",1)]),e("p",rn,s(t(o)("config.agentConfig.deleteWarning")),1)])]}),_:1},8,["modelValue","title"]),_.value?(c(),u("div",{key:0,class:"error-toast",onClick:$[13]||($[13]=f=>_.value="")},[C(t(N),{icon:"carbon:error"}),w(" "+s(_.value),1)])):I("",!0),V.value?(c(),u("div",{key:1,class:"success-toast",onClick:$[14]||($[14]=f=>V.value="")},[C(t(N),{icon:"carbon:checkmark"}),w(" "+s(V.value),1)])):I("",!0)]}),_:1}))}}),un=ae(dn,[["__scopeId","data-v-c5a48db6"]]),pn={class:"custom-select"},fn=["title"],gn={key:0,class:"current-option"},mn={class:"option-name"},hn={key:1,class:"current-option"},vn={class:"dropdown-header"},yn={class:"select-options"},_n=["onClick"],bn={class:"option-name"},Cn=ie({__name:"index",props:{modelValue:{},options:{},placeholder:{},dropdownTitle:{},icon:{},direction:{},dropStyles:{},onChange:{type:Function}},emits:["update:modelValue"],setup(F,{emit:o}){const n=F,m=o,b=O(!1),_=te(()=>n.options.find(k=>k.id===n.modelValue)),V=k=>k.id===n.modelValue,p=()=>{b.value=!b.value},a=k=>{n.onChange?n.onChange(k.id,k):m("update:modelValue",k.id),b.value=!1};return(k,A)=>(c(),u("div",pn,[e("button",{class:"select-btn",onClick:p,title:k.placeholder},[C(t(N),{icon:n.icon||"carbon:select-01",width:"18"},null,8,["icon"]),_.value?(c(),u("span",gn,[e("span",mn,s(_.value.name),1)])):(c(),u("span",hn,s(k.placeholder),1)),C(t(N),{icon:b.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])],8,fn),C(ke,{name:"slideDown"},{default:z(()=>[j(e("div",{class:"select-dropdown",style:He({...k.dropStyles,...n.direction==="right"?{right:0}:{left:0}}),onClick:A[1]||(A[1]=Ce(()=>{},["stop"]))},[e("div",vn,[e("span",null,s(k.dropdownTitle),1),e("button",{class:"close-btn",onClick:A[0]||(A[0]=E=>b.value=!1)},[C(t(N),{icon:"carbon:close",width:"16"})])]),e("div",yn,[(c(!0),u(Q,null,Z(k.options,E=>(c(),u("button",{key:E.id,class:se(["select-option",{active:V(E)}]),onClick:P=>a(E)},[e("span",bn,s(E.name),1),V(E)?(c(),le(t(N),{key:0,icon:"carbon:checkmark",width:"16",class:"check-icon"})):I("",!0)],10,_n))),128))])],4),[[Ee,b.value]])]),_:1}),b.value?(c(),u("div",{key:0,class:"backdrop",onClick:A[2]||(A[2]=E=>b.value=!1)})):I("",!0)]))}}),Ae=ae(Cn,[["__scopeId","data-v-b753c57e"]]),$n=["disabled"],wn={class:"model-layout"},kn={class:"model-list"},Sn={class:"list-header"},Tn={class:"model-count"},Nn={key:0,class:"models-container"},Un=["onClick"],xn={class:"model-card-header"},Vn={class:"model-name"},An={class:"model-desc"},En={key:0,class:"model-type"},Pn={class:"model-tag"},Dn={key:1,class:"loading-state"},Mn={key:2,class:"empty-state"},Fn={key:0,class:"model-detail"},Rn={class:"detail-header"},Ln={class:"detail-actions"},In={class:"form-item"},qn={class:"form-item"},Bn=["placeholder"],On={class:"form-item"},jn=["placeholder"],Gn={class:"form-item"},Jn=["placeholder"],Kn={class:"form-item"},Hn=["placeholder"],zn={class:"form-item"},Yn=["placeholder"],Wn={key:1,class:"no-selection"},Xn={class:"modal-form"},Qn={class:"form-item"},Zn={class:"form-item"},ea=["placeholder"],oa={class:"form-item"},ta=["placeholder"],sa={class:"form-item"},na=["placeholder"],aa={class:"form-item"},la=["placeholder"],ia={class:"form-item"},ca=["placeholder"],ra={class:"delete-confirm"},da={class:"warning-text"},ua=ie({__name:"modelConfig",setup(F){const{t:o}=ge(),n=O(!1),m=O(""),b=O(""),_=ne([]),V=ne([]),p=O(null),a=O(!1),k=O(!1),A=te({get(){var g;return(g=p.value)!=null&&g.headers?JSON.stringify(p.value.headers,null,2):""},set(g){p.value&&(p.value.headers=g.trim()?JSON.parse(g):null)}}),E=te({get(){return P.headers?JSON.stringify(P.headers,null,2):""},set(g){P.headers=g.trim()?JSON.parse(g):null}}),P=ne({baseUrl:"",headers:null,apiKey:"",modelName:"",modelDescription:"",type:""}),D=(g,l)=>{l==="success"?(b.value=g,setTimeout(()=>{b.value=""},3e3)):(m.value=g,setTimeout(()=>{m.value=""},5e3))},R=async()=>{n.value=!0;try{const[g,l]=await Promise.all([ue.getAllModels(),ue.getAllTypes()]),r=g.map(i=>({...i}));_.splice(0,_.length,...r),V.splice(0,V.length,...l),r.length>0&&await L(r[0])}catch(g){console.error("加载数据失败:",g),D(o("config.modelConfig.loadDataFailed")+": "+g.message,"error")}finally{n.value=!1}},L=async g=>{try{const l=await ue.getModelById(g.id);p.value={...l}}catch(l){console.error("加载Model详情失败:",l),D(o("config.modelConfig.loadDetailsFailed")+": "+l.message,"error"),p.value={...g}}},x=()=>{P.baseUrl="",P.headers=null,P.apiKey="",P.modelName="",P.modelDescription="",P.type="",a.value=!0},q=async()=>{if(!P.modelName.trim()||!P.modelDescription.trim()){D(o("config.modelConfig.requiredFields"),"error");return}try{const g={baseUrl:P.baseUrl.trim(),headers:P.headers,apiKey:P.apiKey.trim(),modelName:P.modelName.trim(),modelDescription:P.modelDescription.trim(),type:P.type.trim()},l=await ue.createModel(g);_.push(l),p.value=l,a.value=!1,D(o("config.modelConfig.createSuccess"),"success")}catch(g){D(o("config.modelConfig.createFailed")+": "+g.message,"error")}},G=async()=>{if(p.value){if(!p.value.modelName.trim()||!p.value.modelDescription.trim()){D(o("config.modelConfig.requiredFields"),"error");return}try{const g=await ue.updateModel(p.value.id,p.value),l=_.findIndex(r=>r.id===g.id);l!==-1&&(_[l]=g),p.value=g,D(o("config.modelConfig.saveSuccess"),"success")}catch(g){D(o("config.modelConfig.saveFailed")+": "+g.message,"error")}}},ee=()=>{k.value=!0},ce=async()=>{if(p.value)try{await ue.deleteModel(p.value.id);const g=_.findIndex(l=>l.id===p.value.id);g!==-1&&_.splice(g,1),p.value=_.length>0?_[0]:null,k.value=!1,D(o("config.modelConfig.deleteSuccess"),"success")}catch(g){D(o("config.modelConfig.deleteFailed")+": "+g.message,"error")}},H=()=>{const g=document.createElement("input");g.type="file",g.accept=".json",g.onchange=l=>{var i;const r=(i=l.target.files)==null?void 0:i[0];if(r){const h=new FileReader;h.onload=async v=>{var Y;try{const W=JSON.parse((Y=v.target)==null?void 0:Y.result);if(!W.modelName||!W.modelDescription)throw new Error(o("config.modelConfig.invalidFormat"));const{id:re,...ye}=W,M=await ue.createModel(ye);_.push(M),p.value=M,D(o("config.modelConfig.importSuccess"),"success")}catch(W){D(o("config.modelConfig.importFailed")+": "+W.message,"error")}},h.readAsText(r)}},g.click()},T=()=>{if(p.value)try{const g=JSON.stringify(p.value,null,2),l=new Blob([g],{type:"application/json"}),r=URL.createObjectURL(l),i=document.createElement("a");i.href=r,i.download=`model-${p.value.modelName}-${new Date().toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(r),D(o("config.modelConfig.exportSuccess"),"success")}catch(g){D(o("config.modelConfig.exportFailed")+": "+g.message,"error")}};return ve(()=>{R()}),(g,l)=>(c(),le(Ne,null,{title:z(()=>[e("h2",null,s(t(o)("config.modelConfig.title")),1)]),actions:z(()=>[e("button",{class:"action-btn",onClick:H},[C(t(N),{icon:"carbon:upload"}),w(" "+s(t(o)("config.modelConfig.import")),1)]),e("button",{class:"action-btn",onClick:T,disabled:!p.value},[C(t(N),{icon:"carbon:download"}),w(" "+s(t(o)("config.modelConfig.export")),1)],8,$n)]),default:z(()=>[e("div",wn,[e("div",kn,[e("div",Sn,[e("h3",null,s(t(o)("config.modelConfig.configuredModels")),1),e("span",Tn,"("+s(_.length)+")",1)]),n.value?I("",!0):(c(),u("div",Nn,[(c(!0),u(Q,null,Z(_,r=>{var i;return c(),u("div",{key:r.id,class:se(["model-card",{active:((i=p.value)==null?void 0:i.id)===r.id}]),onClick:h=>L(r)},[e("div",xn,[e("span",Vn,s(r.modelName),1),C(t(N),{icon:"carbon:chevron-right"})]),e("p",An,s(r.modelDescription),1),r.type?(c(),u("div",En,[e("span",Pn,s(r.type),1)])):I("",!0)],10,Un)}),128))])),n.value?(c(),u("div",Dn,[C(t(N),{icon:"carbon:loading",class:"loading-icon"}),w(" "+s(t(o)("common.loading")),1)])):I("",!0),!n.value&&_.length===0?(c(),u("div",Mn,[C(t(N),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,s(t(o)("config.modelConfig.noModel")),1)])):I("",!0),e("button",{class:"add-btn",onClick:x},[C(t(N),{icon:"carbon:add"}),w(" "+s(t(o)("config.modelConfig.createNew")),1)])]),p.value?(c(),u("div",Fn,[e("div",Rn,[e("h3",null,s(p.value.modelName),1),e("div",Ln,[e("button",{class:"action-btn primary",onClick:G},[C(t(N),{icon:"carbon:save"}),w(" "+s(t(o)("common.save")),1)]),e("button",{class:"action-btn danger",onClick:ee},[C(t(N),{icon:"carbon:trash-can"}),w(" "+s(t(o)("common.delete")),1)])])]),e("div",In,[e("label",null,[w(s(t(o)("config.modelConfig.type"))+" ",1),l[17]||(l[17]=e("span",{class:"required"},"*",-1))]),C(Ae,{modelValue:p.value.type,"onUpdate:modelValue":l[0]||(l[0]=r=>p.value.type=r),options:V.map(r=>({id:r,name:r})),placeholder:t(o)("config.modelConfig.typePlaceholder"),"dropdown-title":t(o)("config.modelConfig.typePlaceholder"),icon:"carbon:types"},null,8,["modelValue","options","placeholder","dropdown-title"])]),e("div",qn,[e("label",null,[w(s(t(o)("config.modelConfig.baseUrl"))+" ",1),l[18]||(l[18]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=r=>p.value.baseUrl=r),placeholder:t(o)("config.modelConfig.baseUrlPlaceholder"),required:""},null,8,Bn),[[J,p.value.baseUrl]])]),e("div",On,[e("label",null,s(t(o)("config.modelConfig.headers")),1),j(e("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=r=>A.value=r),placeholder:t(o)("config.modelConfig.headersPlaceholder")},null,8,jn),[[J,A.value]])]),e("div",Gn,[e("label",null,[w(s(t(o)("config.modelConfig.apiKey"))+" ",1),l[19]||(l[19]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=r=>p.value.apiKey=r),placeholder:t(o)("config.modelConfig.apiKeyPlaceholder"),required:""},null,8,Jn),[[J,p.value.apiKey]])]),e("div",Kn,[e("label",null,[w(s(t(o)("config.modelConfig.modelName"))+" ",1),l[20]||(l[20]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":l[4]||(l[4]=r=>p.value.modelName=r),placeholder:t(o)("config.modelConfig.modelNamePlaceholder"),required:""},null,8,Hn),[[J,p.value.modelName]])]),e("div",zn,[e("label",null,[w(s(t(o)("config.modelConfig.description"))+" ",1),l[21]||(l[21]=e("span",{class:"required"},"*",-1))]),j(e("textarea",{"onUpdate:modelValue":l[5]||(l[5]=r=>p.value.modelDescription=r),rows:"3",placeholder:t(o)("config.modelConfig.descriptionPlaceholder"),required:""},null,8,Yn),[[J,p.value.modelDescription]])])])):(c(),u("div",Wn,[C(t(N),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,s(t(o)("config.modelConfig.selectModelHint")),1)]))]),C(pe,{modelValue:a.value,"onUpdate:modelValue":l[12]||(l[12]=r=>a.value=r),title:t(o)("config.modelConfig.newModel"),onConfirm:q},{default:z(()=>[e("div",Xn,[e("div",Qn,[e("label",null,[w(s(t(o)("config.modelConfig.type"))+" ",1),l[22]||(l[22]=e("span",{class:"required"},"*",-1))]),C(Ae,{modelValue:P.type,"onUpdate:modelValue":l[6]||(l[6]=r=>P.type=r),options:V.map(r=>({id:r,name:r})),placeholder:t(o)("config.modelConfig.typePlaceholder"),"dropdown-title":t(o)("config.modelConfig.typePlaceholder"),icon:"carbon:types"},null,8,["modelValue","options","placeholder","dropdown-title"])]),e("div",Zn,[e("label",null,[w(s(t(o)("config.modelConfig.baseUrl"))+" ",1),l[23]||(l[23]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":l[7]||(l[7]=r=>P.baseUrl=r),placeholder:t(o)("config.modelConfig.baseUrlPlaceholder"),required:""},null,8,ea),[[J,P.baseUrl]])]),e("div",oa,[e("label",null,s(t(o)("config.modelConfig.headers")),1),j(e("input",{type:"text","onUpdate:modelValue":l[8]||(l[8]=r=>E.value=r),placeholder:t(o)("config.modelConfig.headersPlaceholder")},null,8,ta),[[J,E.value]])]),e("div",sa,[e("label",null,[w(s(t(o)("config.modelConfig.apiKey"))+" ",1),l[24]||(l[24]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":l[9]||(l[9]=r=>P.apiKey=r),placeholder:t(o)("config.modelConfig.apiKeyPlaceholder"),required:""},null,8,na),[[J,P.apiKey]])]),e("div",aa,[e("label",null,[w(s(t(o)("config.modelConfig.modelName"))+" ",1),l[25]||(l[25]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":l[10]||(l[10]=r=>P.modelName=r),placeholder:t(o)("config.modelConfig.modelNamePlaceholder"),required:""},null,8,la),[[J,P.modelName]])]),e("div",ia,[e("label",null,[w(s(t(o)("config.modelConfig.description"))+" ",1),l[26]||(l[26]=e("span",{class:"required"},"*",-1))]),j(e("textarea",{"onUpdate:modelValue":l[11]||(l[11]=r=>P.modelDescription=r),rows:"3",placeholder:t(o)("config.modelConfig.descriptionPlaceholder"),required:""},null,8,ca),[[J,P.modelDescription]])])])]),_:1},8,["modelValue","title"]),C(pe,{modelValue:k.value,"onUpdate:modelValue":l[14]||(l[14]=r=>k.value=r),title:"Delete confirmation"},{footer:z(()=>[e("button",{class:"cancel-btn",onClick:l[13]||(l[13]=r=>k.value=!1)},s(t(o)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:ce},s(t(o)("common.delete")),1)]),default:z(()=>{var r;return[e("div",ra,[C(t(N),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[w(s(t(o)("config.modelConfig.deleteConfirmText"))+" ",1),e("strong",null,s((r=p.value)==null?void 0:r.modelName),1),w(" "+s(t(o)("common.confirm"))+"？ ",1)]),e("p",da,s(t(o)("config.modelConfig.deleteWarning")),1)])]}),_:1},8,["modelValue"]),m.value?(c(),u("div",{key:0,class:"error-toast",onClick:l[15]||(l[15]=r=>m.value="")},[C(t(N),{icon:"carbon:error"}),w(" "+s(m.value),1)])):I("",!0),b.value?(c(),u("div",{key:1,class:"success-toast",onClick:l[16]||(l[16]=r=>b.value="")},[C(t(N),{icon:"carbon:checkmark"}),w(" "+s(b.value),1)])):I("",!0)]),_:1}))}}),pa=ae(ua,[["__scopeId","data-v-dfd8f8e2"]]);class Te{static async getAllMcpServers(){const o=await fetch(`${this.BASE_URL}/list`);if(!o.ok)throw new Error(`Failed to get MCP server list: ${o.status}`);return await o.json()}static async addMcpServer(o){try{const n=await fetch(`${this.BASE_URL}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!n.ok)throw new Error(`Failed to add MCP server: ${n.status}`);return{success:!0,message:"Successfully added MCP server"}}catch(n){return console.error("Failed to add MCP server:",n),{success:!1,message:n instanceof Error?n.message:"Failed to add, please retry"}}}static async removeMcpServer(o){try{const n=await fetch(`${this.BASE_URL}/remove?id=${o}`);if(!n.ok)throw new Error(`Failed to delete MCP server: ${n.status}`);return{success:!0,message:"Successfully deleted MCP server"}}catch(n){return console.error(`Failed to delete MCP server[${o}]:`,n),{success:!1,message:n instanceof Error?n.message:"Failed to delete, please retry"}}}}me(Te,"BASE_URL","/api/mcp");const fa={class:"mcp-config-panel"},ga={class:"mcp-header"},ma={class:"header-left"},ha={class:"mcp-stats"},va={class:"stat-item"},ya={class:"stat-label"},_a={class:"stat-value"},ba={class:"header-right"},Ca={class:"search-box"},$a=["placeholder"],wa={key:0,class:"loading-container"},ka={key:1,class:"mcp-layout"},Sa={class:"mcp-table-container"},Ta={class:"section-title"},Na={key:0,class:"empty-state"},Ua={class:"empty-state-text"},xa={key:1,class:"mcp-table-wrapper"},Va={class:"mcp-table"},Aa={class:"mcp-id"},Ea={class:"mcp-server-name"},Pa={class:"server-name-content"},Da={class:"mcp-connection-type"},Ma={class:"mcp-config"},Fa=["title"],Ra={class:"mcp-actions"},La=["onClick","disabled"],Ia={class:"add-mcp-container"},qa={class:"add-mcp-header"},Ba={class:"add-mcp-title"},Oa={class:"mcp-form"},ja={class:"mcp-form-group"},Ga={class:"form-label"},Ja={class:"connection-type-options"},Ka={class:"connection-type-option"},Ha={for:"mcp-connection-type-studio",class:"radio-label"},za={class:"connection-type-desc"},Ya={class:"connection-type-option"},Wa={for:"mcp-connection-type-sse",class:"radio-label"},Xa={class:"connection-type-desc"},Qa={class:"connection-type-option"},Za={for:"mcp-connection-type-streaming",class:"radio-label"},el={class:"connection-type-desc"},ol={class:"mcp-form-group"},tl={class:"form-label"},sl=["placeholder"],nl={class:"mcp-form-actions"},al=["disabled"],ll=["disabled"],il={class:"mcp-form-instructions"},cl={class:"indented-list"},rl=ie({__name:"mcpConfig",setup(F){const{t:o}=ge(),n=O(!1),m=O([]),b=O(""),_=ne({connectionType:"STUDIO",configJson:""}),V=ne({show:!1,text:"",type:"success"}),p=te(()=>_.configJson.trim().length>0),a=te(()=>{if(!b.value.trim())return m.value;const L=b.value.toLowerCase();return m.value.filter(x=>x.mcpServerName.toLowerCase().includes(L)||x.connectionType.toLowerCase().includes(L)||x.connectionConfig.toLowerCase().includes(L))}),k=L=>L?L.length>50?L.substring(0,50)+"...":L:"",A=(L,x="success")=>{V.text=L,V.type=x,V.show=!0,setTimeout(()=>{V.show=!1},3e3)},E=async()=>{try{n.value=!0,m.value=await Te.getAllMcpServers()}catch(L){console.error("加载MCP服务器列表失败:",L),A(o("config.basicConfig.loadConfigFailed"),"error")}finally{n.value=!1}},P=async()=>{if(!p.value){A(o("config.mcpConfig.configRequired"),"error");return}try{JSON.parse(_.configJson)}catch{A(o("config.mcpConfig.invalidJson"),"error");return}try{n.value=!0;const L={connectionType:_.connectionType,configJson:_.configJson},x=await Te.addMcpServer(L);x.success?(A(o("config.mcpConfig.addSuccess")),R(),await E()):A(x.message||o("config.mcpConfig.addFailed"),"error")}catch(L){console.error("添加MCP服务器失败:",L),A(o("config.mcpConfig.addFailed"),"error")}finally{n.value=!1}},D=async L=>{if(confirm(o("config.mcpConfig.deleteConfirm")))try{n.value=!0;const x=await Te.removeMcpServer(L);x.success?(A(o("config.mcpConfig.deleteSuccess")),await E()):A(x.message||o("config.mcpConfig.deleteFailed"),"error")}catch(x){console.error("删除MCP服务器失败:",x),A(o("config.mcpConfig.deleteFailed"),"error")}finally{n.value=!1}},R=()=>{_.connectionType="STUDIO",_.configJson=""};return ve(()=>{E()}),(L,x)=>(c(),u("div",fa,[e("div",ga,[e("div",ma,[e("h2",null,s(t(o)("config.mcpConfig.title")),1),e("div",ha,[e("span",va,[e("span",ya,s(t(o)("config.mcpConfig.mcpServers"))+":",1),e("span",_a,s(m.value.length),1)])])]),e("div",ba,[e("div",Ca,[j(e("input",{"onUpdate:modelValue":x[0]||(x[0]=q=>b.value=q),type:"text",placeholder:t(o)("config.mcpSearch"),class:"search-input"},null,8,$a),[[J,b.value]]),x[5]||(x[5]=e("span",{class:"search-icon"},"🔍",-1))])])]),n.value?(c(),u("div",wa,[x[6]||(x[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,s(t(o)("config.loading")),1)])):(c(),u("div",ka,[e("div",Sa,[e("h3",Ta,s(t(o)("config.mcpConfig.serverList")),1),a.value.length===0?(c(),u("div",Na,[x[7]||(x[7]=e("div",{class:"empty-state-icon"},"📂",-1)),e("div",Ua,s(b.value?t(o)("config.notFound"):t(o)("config.mcpConfig.noServers")),1)])):(c(),u("div",xa,[e("table",Va,[e("thead",null,[e("tr",null,[x[8]||(x[8]=e("th",null,"ID",-1)),e("th",null,s(t(o)("agent.name")),1),e("th",null,s(t(o)("config.mcpConfig.connectionType")),1),e("th",null,s(t(o)("config.mcpConfig.configJsonLabel")),1),e("th",null,s(t(o)("common.actions")),1)])]),e("tbody",null,[(c(!0),u(Q,null,Z(a.value,q=>(c(),u("tr",{key:q.id,class:"mcp-row"},[e("td",Aa,s(q.id),1),e("td",Ea,[e("div",Pa,[x[9]||(x[9]=e("span",{class:"server-icon"},"🔌",-1)),w(" "+s(q.mcpServerName),1)])]),e("td",Da,[e("span",{class:se(["connection-type-badge",q.connectionType.toLowerCase()])},s(q.connectionType),3)]),e("td",Ma,[e("div",{class:"config-preview",title:q.connectionConfig},s(k(q.connectionConfig)),9,Fa)]),e("td",Ra,[e("button",{onClick:G=>D(q.id),class:"action-btn delete-btn",disabled:n.value},s(t(o)("common.delete")),9,La)])]))),128))])])]))]),e("div",Ia,[e("div",qa,[e("h3",Ba,s(t(o)("config.mcpConfig.addMcpServer")),1)]),e("div",Oa,[e("div",ja,[e("label",Ga,s(t(o)("config.mcpConfig.connectionType"))+"：",1),e("div",Ja,[e("div",Ka,[j(e("input",{type:"radio",id:"mcp-connection-type-studio","onUpdate:modelValue":x[1]||(x[1]=q=>_.connectionType=q),value:"STUDIO"},null,512),[[Ve,_.connectionType]]),e("label",Ha,[x[10]||(x[10]=e("span",{class:"radio-title"},"STUDIO",-1)),e("span",za,s(t(o)("config.mcpConfig.instructionStep1LocalDesc")),1)])]),e("div",Ya,[j(e("input",{type:"radio",id:"mcp-connection-type-sse","onUpdate:modelValue":x[2]||(x[2]=q=>_.connectionType=q),value:"SSE"},null,512),[[Ve,_.connectionType]]),e("label",Wa,[x[11]||(x[11]=e("span",{class:"radio-title"},"SSE",-1)),e("span",Xa,s(t(o)("config.mcpConfig.instructionStep1RemoteDesc")),1)])]),e("div",Qa,[j(e("input",{type:"radio",id:"mcp-connection-type-streaming","onUpdate:modelValue":x[3]||(x[3]=q=>_.connectionType=q),value:"STREAMING"},null,512),[[Ve,_.connectionType]]),e("label",Za,[x[12]||(x[12]=e("span",{class:"radio-title"},"Streamable HTTP",-1)),e("span",el,s(t(o)("config.mcpConfig.instructionStep1RemoteDesc")),1)])])])]),e("div",ol,[e("label",tl,s(t(o)("config.mcpConfig.configJsonLabel")),1),j(e("textarea",{"onUpdate:modelValue":x[4]||(x[4]=q=>_.configJson=q),placeholder:t(o)("config.mcpConfig.configJsonPlaceholder"),class:"config-textarea",rows:"6"},null,8,sl),[[J,_.configJson]])]),e("div",nl,[e("button",{onClick:P,class:"action-btn add-btn",disabled:n.value},s(t(o)("common.add")),9,al),e("button",{onClick:R,class:"action-btn reset-btn",disabled:n.value},s(t(o)("common.reset")),9,ll)])]),e("div",il,[e("h4",null,s(t(o)("config.mcpConfig.instructions")),1),e("ol",null,[e("li",null,[w(s(t(o)("config.mcpConfig.instructionStep1"))+" ",1),e("ul",cl,[e("li",null,[e("strong",null,s(t(o)("config.mcpConfig.instructionStep1Local")),1),w("："+s(t(o)("config.mcpConfig.instructionStep1LocalDesc")),1)]),e("li",null,[e("strong",null,s(t(o)("config.mcpConfig.instructionStep1Remote")),1),w("："+s(t(o)("config.mcpConfig.instructionStep1RemoteDesc")),1)])])]),e("li",null,s(t(o)("config.mcpConfig.instructionStep2")),1),e("li",null,s(t(o)("config.mcpConfig.instructionStep3")),1),e("li",null,s(t(o)("config.mcpConfig.instructionStep4")),1)])])])])),C(ke,{name:"message-fade"},{default:z(()=>[V.show?(c(),u("div",{key:0,class:se(["message-toast",V.type])},s(V.text),3)):I("",!0)]),_:1})]))}}),dl=ae(rl,[["__scopeId","data-v-355da8bb"]]);class he{static async handleResponse(o){if(!o.ok)try{const n=await o.json();throw new Error(n.message||`API request failed: ${o.status}`)}catch{throw new Error(`API request failed: ${o.status} ${o.statusText}`)}return o}static async getAllPrompts(o){try{const n=await fetch(`${this.BASE_URL}/namespace/${o}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to get Prompt list:",n),n}}static async getPromptById(o){try{const n=await fetch(`${this.BASE_URL}/${o}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error(`Failed to get Pr'o'm'p't[${o}] details:`,n),n}}static async createPrompt(o){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create Prompt:",n),n}}static async updatePrompt(o,n){try{const m=await fetch(`${this.BASE_URL}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await(await this.handleResponse(m)).json()}catch(m){throw console.error(`Failed to update Prompt[${o}]:`,m),m}}static async deletePrompt(o){try{const n=await fetch(`${this.BASE_URL}/${o}`,{method:"DELETE"});if(n.status===400)throw new Error("Cannot delete default Prompt");await this.handleResponse(n)}catch(n){throw console.error(`Failed to delete Prompt[${o}]:`,n),n}}}me(he,"BASE_URL","/api/prompt");const ul={class:"custom-select"},pl=["title"],fl={key:0,class:"current-option"},gl={class:"option-name"},ml={key:1,class:"current-option"},hl={class:"select-options"},vl=["onClick"],yl={class:"option-name"},_l=ie({__name:"select",props:{modelValue:{},options:{},placeholder:{}},emits:["update:modelValue"],setup(F,{emit:o}){const n=F,m=o,b=O(!1),_=te(()=>n.options.find(k=>k.id===n.modelValue)),V=k=>k.id===n.modelValue,p=()=>{b.value=!b.value},a=k=>{m("update:modelValue",k.id),b.value=!1};return(k,A)=>(c(),u("div",ul,[e("button",{class:"select-btn",onClick:p,title:k.placeholder},[_.value?(c(),u("span",fl,[e("span",gl,s(_.value.name),1)])):(c(),u("span",ml,s(k.placeholder),1)),C(t(N),{icon:b.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])],8,pl),C(ke,{name:"slideDown"},{default:z(()=>[j(e("div",{class:"select-dropdown",onClick:A[0]||(A[0]=Ce(()=>{},["stop"]))},[e("div",hl,[(c(!0),u(Q,null,Z(k.options,E=>(c(),u("button",{key:E.id,class:se(["select-option",{active:V(E)}]),onClick:P=>a(E)},[e("span",yl,s(E.name),1),V(E)?(c(),le(t(N),{key:0,icon:"carbon:checkmark",width:"16",class:"check-icon"})):I("",!0)],10,vl))),128))])],512),[[Ee,b.value]])]),_:1}),b.value?(c(),u("div",{key:0,class:"backdrop",onClick:A[1]||(A[1]=E=>b.value=!1)})):I("",!0)]))}}),Se=ae(_l,[["__scopeId","data-v-4c6d676f"]]);function bl(F){return!(F==null||typeof F=="string"&&F.trim()===""||Array.isArray(F)&&F.length===0||typeof F=="object"&&Object.keys(F).length===0)}function Cl(F,o,n="application/json"){const m=JSON.stringify(F,null,2),b=new Blob([m],{type:n}),_=URL.createObjectURL(b),V=document.createElement("a");V.href=_,V.download=o,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(_)}function $l(F="json"){return new Promise((o,n)=>{const m=document.createElement("input");m.type="file",m.accept=`.${F}`,m.onchange=b=>{var V;const _=(V=b.target.files)==null?void 0:V[0];if(_){const p=new FileReader;p.onload=a=>{var k;try{const A=(k=a.target)==null?void 0:k.result;if(F==="json"){const E=JSON.parse(A);o(E)}else o(A)}catch(A){n(new Error(`Failed to parse file: ${A instanceof Error?A.message:"Unknown error"}`))}},p.onerror=()=>{n(new Error("Failed to read file"))},p.readAsText(_)}},m.click()})}const wl={class:"prompt-layout"},kl={class:"prompt-list"},Sl={class:"list-header"},Tl={class:"prompt-count"},Nl={key:0,class:"prompts-container"},Ul=["onClick"],xl={class:"prompt-card-header"},Vl={class:"prompt-name"},Al={key:0,class:"prompt-desc"},El={class:"tags"},Pl={class:"tag"},Dl={key:1,class:"loading-state"},Ml={key:2,class:"empty-state"},Fl={key:0,class:"prompt-detail"},Rl={class:"detail-header"},Ll={class:"detail-actions"},Il={class:"form-item"},ql=["placeholder"],Bl={class:"form-item"},Ol={class:"form-item"},jl={class:"form-item"},Gl=["placeholder"],Jl={class:"form-item"},Kl=["placeholder"],Hl={key:1,class:"no-selection"},zl={class:"modal-form"},Yl={class:"form-item"},Wl=["placeholder"],Xl={class:"form-item"},Ql={class:"form-item"},Zl={class:"form-item"},ei=["placeholder"],oi={class:"form-item"},ti=["placeholder"],si={class:"delete-confirm"},ni={class:"warning-text"},ai=ie({__name:"dynamicPromptConfig",setup(F){const{t:o}=ge(),{success:n,error:m}=Le(),b=Ue(),{namespace:_}=Pe(b),V=O(!1),p=ne([]),a=O(null),k=O(!1),A=O(!1),E=[{id:"USER",name:"USER"},{id:"ASSISTANT",name:"ASSISTANT"},{id:"SYSTEM",name:"SYSTEM"},{id:"TOOL",name:"TOOL"}],P=[{id:"LLM",name:"LLM"},{id:"PLANNING",name:"PLANNING"},{id:"AGENT",name:"AGENT"}],D={promptName:"",messageType:"",type:"",promptDescription:""},R=ne({...D}),L=async()=>{V.value=!0;try{const i=await he.getAllPrompts(_.value);i.length>0&&await G(i[0]),p.splice(0,p.length,...i)}catch(i){console.error("加载数据失败:",i),m(o("config.promptConfig.loadDataFailed")+": "+i.message)}finally{V.value=!1}},x=async()=>{if(a.value&&T(a.value))try{const i=await he.updatePrompt(a.value.id,a.value),h=p.findIndex(v=>v.id===i.id);h!==-1&&(p[h]=i),a.value={...i},n(o("config.promptConfig.saveSuccess"))}catch(i){m(o("config.promptConfig.saveFailed")+": "+i.message)}},q=async()=>{if(a.value)try{await he.deletePrompt(a.value.id);const i=p.findIndex(h=>h.id===a.value.id);i!==-1&&p.splice(i,1),a.value=p.length>0?p[0]:null,A.value=!1,n(o("config.promptConfig.deleteSuccess"))}catch(i){m(o("config.promptConfig.deleteFailed")+": "+i.message)}},G=async i=>{try{const h=await he.getPromptById(i.id);a.value={...h}}catch(h){console.error("加载Prompt详情失败:",h),m(o("config.promptConfig.loadDetailsFailed")+": "+h.message),a.value={...i}}},ee=async()=>{if(T(R))try{const i={...R,namespace:_.value,builtIn:!1},h=await he.createPrompt(i);p.push(h),a.value=h,k.value=!1,n(o("config.promptConfig.createSuccess"))}catch(i){m(o("config.promptConfig.createFailed")+": "+i.message)}},ce=async()=>{try{const i=await $l("json"),{id:h,...v}=i,Y=await he.createPrompt({...v,namespace:_.value,builtIn:!1});p.push(Y),a.value=Y,k.value=!1,n(o("config.promptConfig.importSuccess"))}catch(i){m(o("config.promptConfig.importFailed")+": "+i.message)}},H=()=>{try{const i=a.value;Cl(i,`prompt-${i.promptName}-${new Date().toISOString().split("T")[0]}.json`),n(o("config.agentConfig.exportSuccess"))}catch(i){m(o("config.agentConfig.exportFailed")+": "+i.message)}};function T(i){const h=["promptName","messageType","type","promptContent"];for(const Y of h){const W=i[Y];if(W==null||typeof W=="string"&&W.trim()==="")return m(`${Y} is required and cannot be empty`),!1}return!!g(p,i)}function g(i,h){const v=i.find(Y=>Y.promptName===h.promptName);return v&&h.id&&v.id!==h.id?(m(`Name "${h.promptName}" already exists. Please use a different name.`),!1):v&&!h.id?(m(`Name "${h.promptName}" already exists. Please use a different name.`),!1):!0}const l=()=>{R.promptName="",R.promptDescription="",R.promptContent="",Object.assign(R,D),k.value=!0},r=()=>{A.value=!0};return ve(()=>{L()}),be(()=>_.value,(i,h)=>{i!==h&&(p.splice(0),a.value=null,L())}),(i,h)=>(c(),le(Ne,null,{title:z(()=>[e("h2",null,s(t(o)("config.promptConfig.title")),1)]),actions:z(()=>[e("button",{class:"action-btn",onClick:ce},[C(t(N),{icon:"carbon:upload"}),w(" "+s(t(o)("config.agentConfig.import")),1)])]),default:z(()=>[e("div",wl,[e("div",kl,[e("div",Sl,[e("h3",null,s(t(o)("config.promptConfig.configuredprompts")),1),e("span",Tl,"("+s(p.length)+s(t(o)("config.promptConfig.promptCount"))+")",1)]),V.value?I("",!0):(c(),u("div",Nl,[(c(!0),u(Q,null,Z(p,v=>{var Y,W;return c(),u("div",{key:v.id,class:se(["prompt-card",{active:((Y=a.value)==null?void 0:Y.id)===v.id}]),onClick:re=>G(v)},[e("div",xl,[e("span",Vl,s(v.promptName),1),C(t(N),{icon:"carbon:chevron-right"})]),(W=v.promptDescription)!=null&&W.trim()?(c(),u("p",Al,s(v.promptDescription),1)):I("",!0),e("div",El,[e("span",Pl,s(v.builtIn?t(o)("config.promptConfig.builtIn"):t(o)("config.promptConfig.custom")),1)])],10,Ul)}),128))])),V.value?(c(),u("div",Dl,[C(t(N),{icon:"carbon:loading",class:"loading-icon"}),w(" "+s(t(o)("common.loading")),1)])):I("",!0),!V.value&&p.length===0?(c(),u("div",Ml,[C(t(N),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,s(t(o)("config.promptConfig.noPrompts")),1)])):I("",!0),e("button",{class:"add-btn",onClick:l},[C(t(N),{icon:"carbon:add"}),w(" "+s(t(o)("config.promptConfig.createNew")),1)])]),a.value?(c(),u("div",Fl,[e("div",Rl,[e("h3",null,s(a.value.promptName),1),e("div",Ll,[e("button",{class:"action-btn",onClick:H},[C(t(N),{icon:"carbon:download"}),w(" "+s(t(o)("config.agentConfig.export")),1)]),e("button",{class:"action-btn primary",onClick:x},[C(t(N),{icon:"carbon:save"}),w(" "+s(t(o)("common.save")),1)]),a.value.builtIn?I("",!0):(c(),u("button",{key:0,class:"action-btn danger",onClick:r},[C(t(N),{icon:"carbon:trash-can"}),w(" "+s(t(o)("common.delete")),1)]))])]),e("div",Il,[e("label",null,[w(s(t(o)("config.promptConfig.promptName"))+" ",1),h[15]||(h[15]=e("span",{class:"required"},"*",-1))]),j(e("input",{disabled:!0,type:"text","onUpdate:modelValue":h[0]||(h[0]=v=>a.value.promptName=v),placeholder:t(o)("config.promptConfig.placeholder"),required:""},null,8,ql),[[J,a.value.promptName]])]),e("div",Bl,[e("label",null,[w(s(t(o)("config.promptConfig.messageType"))+" ",1),h[16]||(h[16]=e("span",{class:"required"},"*",-1))]),a.value.builtIn?j((c(),u("input",{key:1,type:"text","onUpdate:modelValue":h[2]||(h[2]=v=>a.value.messageType=v),disabled:!0},null,512)),[[J,a.value.messageType]]):(c(),le(Se,{key:0,modelValue:a.value.messageType,"onUpdate:modelValue":h[1]||(h[1]=v=>a.value.messageType=v),options:E,disabled:a.value.builtIn,placeholder:t(o)("config.promptConfig.placeholder")},null,8,["modelValue","disabled","placeholder"]))]),e("div",Ol,[e("label",null,[w(s(t(o)("config.promptConfig.type"))+" ",1),h[17]||(h[17]=e("span",{class:"required"},"*",-1))]),a.value.builtIn?j((c(),u("input",{key:1,type:"text","onUpdate:modelValue":h[4]||(h[4]=v=>a.value.type=v),disabled:!0,required:""},null,512)),[[J,a.value.type]]):(c(),le(Se,{key:0,modelValue:a.value.type,"onUpdate:modelValue":h[3]||(h[3]=v=>a.value.type=v),options:P,disabled:a.value.builtIn,placeholder:t(o)("config.promptConfig.placeholder")},null,8,["modelValue","disabled","placeholder"]))]),e("div",jl,[e("label",null,s(t(o)("config.promptConfig.description")),1),j(e("textarea",{"onUpdate:modelValue":h[5]||(h[5]=v=>a.value.promptDescription=v),rows:"2",placeholder:t(o)("config.promptConfig.descriptionPlaceholder"),required:""},null,8,Gl),[[J,a.value.promptDescription]])]),e("div",Jl,[e("label",null,[w(s(t(o)("config.promptConfig.promptContent"))+" ",1),h[18]||(h[18]=e("span",{class:"required"},"*",-1))]),j(e("textarea",{"onUpdate:modelValue":h[6]||(h[6]=v=>a.value.promptContent=v),rows:"8",placeholder:t(o)("config.promptConfig.promptContentPlaceholder"),required:""},null,8,Kl),[[J,a.value.promptContent]])])])):(c(),u("div",Hl,[C(t(N),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,s(t(o)("config.promptConfig.selectPromptHint")),1)]))]),C(pe,{modelValue:k.value,"onUpdate:modelValue":h[12]||(h[12]=v=>k.value=v),title:t(o)("config.promptConfig.newPrompt"),onConfirm:ee},{default:z(()=>[e("div",zl,[e("div",Yl,[e("label",null,[w(s(t(o)("config.promptConfig.promptName"))+" ",1),h[19]||(h[19]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":h[7]||(h[7]=v=>R.promptName=v),placeholder:t(o)("config.promptConfig.placeholder"),required:""},null,8,Wl),[[J,R.promptName]])]),e("div",Xl,[e("label",null,[w(s(t(o)("config.promptConfig.messageType"))+" ",1),h[20]||(h[20]=e("span",{class:"required"},"*",-1))]),C(Se,{modelValue:R.messageType,"onUpdate:modelValue":h[8]||(h[8]=v=>R.messageType=v),options:E,placeholder:t(o)("config.promptConfig.placeholder")},null,8,["modelValue","placeholder"])]),e("div",Ql,[e("label",null,[w(s(t(o)("config.promptConfig.type"))+" ",1),h[21]||(h[21]=e("span",{class:"required"},"*",-1))]),C(Se,{modelValue:R.type,"onUpdate:modelValue":h[9]||(h[9]=v=>R.type=v),options:P,placeholder:t(o)("config.promptConfig.placeholder")},null,8,["modelValue","placeholder"])]),e("div",Zl,[e("label",null,s(t(o)("config.promptConfig.description")),1),j(e("textarea",{"onUpdate:modelValue":h[10]||(h[10]=v=>R.promptDescription=v),rows:"3",placeholder:t(o)("config.promptConfig.descriptionPlaceholder")},null,8,ei),[[J,R.promptDescription]])]),e("div",oi,[e("label",null,[w(s(t(o)("config.promptConfig.promptContent"))+" ",1),h[22]||(h[22]=e("span",{class:"required"},"*",-1))]),j(e("textarea",{"onUpdate:modelValue":h[11]||(h[11]=v=>R.promptContent=v),rows:"8",placeholder:t(o)("config.promptConfig.promptContentPlaceholder"),required:""},null,8,ti),[[J,R.promptContent]])])])]),_:1},8,["modelValue","title"]),C(pe,{modelValue:A.value,"onUpdate:modelValue":h[14]||(h[14]=v=>A.value=v),title:t(o)("config.promptConfig.deleteConfirm")},{footer:z(()=>[e("button",{class:"cancel-btn",onClick:h[13]||(h[13]=v=>A.value=!1)},s(t(o)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:q},s(t(o)("common.delete")),1)]),default:z(()=>{var v;return[e("div",si,[C(t(N),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[w(s(t(o)("config.promptConfig.deleteConfirmText"))+" ",1),e("strong",null,s((v=a.value)==null?void 0:v.promptName),1),w(" "+s(t(o)("common.confirm"))+"？ ",1)]),e("p",ni,s(t(o)("config.promptConfig.deleteWarning")),1)])]}),_:1},8,["modelValue","title"])]),_:1}))}}),li=ae(ai,[["__scopeId","data-v-22c6c6b7"]]);class _e{static async handleResponse(o){if(!o.ok)try{const n=await o.json();throw new Error(n.message||`API request failed: ${o.status}`)}catch{throw new Error(`API request failed: ${o.status} ${o.statusText}`)}return o}static async getAllNamespaces(){try{const o=await fetch(`${this.BASE_URL}`);return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to get Namespace list:",o),o}}static async getNamespaceById(o){try{const n=await fetch(`${this.BASE_URL}/${o}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error(`Failed to get Namespace[${o}] details:`,n),n}}static async createNamespace(o){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create Namespace:",n),n}}static async updateNamespace(o,n){try{const m=await fetch(`${this.BASE_URL}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await(await this.handleResponse(m)).json()}catch(m){throw console.error(`Failed to update Namespace[${o}]:`,m),m}}static async deleteNamespace(o){try{const n=await fetch(`${this.BASE_URL}/${o}`,{method:"DELETE"});if(n.status===400)throw new Error("Cannot delete default Namespace");await this.handleResponse(n)}catch(n){throw console.error(`Failed to delete Namespace[${o}]:`,n),n}}}me(_e,"BASE_URL","/api/namespaces");const ii={class:"namespace-layout"},ci={class:"namespace-list"},ri={class:"list-header"},di={key:0,class:"namespaces-container"},ui=["onClick"],pi={class:"namespace-card-header"},fi={class:"namespace-name"},gi={key:0,class:"namespace-desc"},mi={key:1,class:"loading-state"},hi={key:0,class:"namespace-detail"},vi={class:"detail-header"},yi={class:"detail-actions"},_i={class:"form-item"},bi=["placeholder"],Ci={class:"form-item"},$i=["placeholder"],wi={class:"form-item"},ki=["placeholder"],Si={class:"form-item"},Ti=["placeholder"],Ni={key:1,class:"no-selection"},Ui={class:"modal-form"},xi={class:"form-item"},Vi=["placeholder"],Ai={class:"form-item"},Ei=["placeholder"],Pi={class:"form-item"},Di=["placeholder"],Mi={class:"form-item"},Fi=["placeholder"],Ri={class:"delete-confirm"},Li={class:"warning-text"},Ii=ie({__name:"namespaceConfig",setup(F){const{t:o}=ge(),{success:n,error:m}=Le(),b=Ue(),{setNamespaces:_}=b,V=O(!1),p=ne([]),a=O(null),k=O(null),A=O(!1),E=O(!1),P={name:""},D=ne({...P}),R=async()=>{V.value=!0;try{const r=await _e.getAllNamespaces();r.length>0&&await L(r[0]),p.splice(0,p.length,...r)}catch(r){console.error("加载数据失败:",r),m(o("config.namespaceConfig.loadDataFailed")+": "+r.message)}finally{V.value=!1}},L=async r=>{a.value={...r},k.value={...r}},x=async()=>{if(ce(D)&&T(D.host))try{const r={description:"",...D},i=await _e.createNamespace(r);p.push({...i}),a.value=i,k.value={...i},A.value=!1,ee(),n(o("config.namespaceConfig.saveSuccess"))}catch(r){m(o("config.namespaceConfig.createFailed")+": "+r.message)}},q=async()=>{if(a.value&&ce(a.value)&&T(a.value.host))try{const r=await _e.updateNamespace(a.value.id,a.value),i=p.findIndex(h=>h.id===r.id);i!==-1&&(p[i]=r),a.value={...r},k.value={...r},ee(),n(o("config.namespaceConfig.saveSuccess"))}catch(r){m(o("config.namespaceConfig.saveFailed")+": "+r.message)}},G=async()=>{if(a.value)try{await _e.deleteNamespace(a.value.id);const r=p.findIndex(i=>i.id===a.value.id);r!==-1&&p.splice(r,1),a.value=p.length>0?p[0]:null,E.value=!1,ee(),n(o("config.namespaceConfig.deleteSuccess"))}catch(r){m(o("config.namespaceConfig.deleteFailed")+": "+r.message)}},ee=async()=>{_(p.map(r=>({id:r.code,name:r.name,host:r.host})))};function ce(r){const i=["name","code"];for(const h of i){const v=r[h];if(v==null||typeof v=="string"&&v.trim()==="")return m(`${h} is required and cannot be empty`),!1}return!!H(p,r,["name","code"])}function H(r,i,h=["name","code"]){for(const v of h){let Y;if(v in i)Y=i[v];else continue;if(!(Y!=null&&Y.trim()))continue;const W=r.find(re=>re[v]===Y);if(!(W&&"id"in i&&W.id===i.id)&&W)return m(`${v} "${Y}" already exists. Please use a different value.`),!1}return!0}const T=r=>{if(!r)return!0;const h=/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(r);return h||m("Please enter a valid URL format"),h},g=()=>{D.name="",Object.assign(D,P),A.value=!0},l=()=>{E.value=!0};return ve(()=>{R()}),(r,i)=>(c(),le(Ne,null,{title:z(()=>[e("h2",null,s(t(o)("config.namespaceConfig.title")),1)]),default:z(()=>{var h;return[e("div",ii,[e("div",ci,[e("div",ri,[e("h3",null,s(t(o)("config.namespaceConfig.configured")),1)]),V.value?I("",!0):(c(),u("div",di,[(c(!0),u(Q,null,Z(p,v=>{var Y,W;return c(),u("div",{key:v.id,class:se(["namespace-card",{active:((Y=a.value)==null?void 0:Y.id)===v.id}]),onClick:re=>L(v)},[e("div",pi,[e("span",fi,s(v.name),1),C(t(N),{icon:"carbon:chevron-right"})]),(W=v.description)!=null&&W.trim()?(c(),u("p",gi,s(v.description),1)):I("",!0)],10,ui)}),128))])),V.value?(c(),u("div",mi,[C(t(N),{icon:"carbon:loading",class:"loading-icon"}),w(" "+s(t(o)("common.loading")),1)])):I("",!0),e("button",{class:"add-btn",onClick:g},[C(t(N),{icon:"carbon:add"}),w(" "+s(t(o)("config.namespaceConfig.createNew")),1)])]),a.value?(c(),u("div",hi,[e("div",vi,[e("h3",null,s(((h=k.value)==null?void 0:h.name)??""),1),e("div",yi,[e("button",{class:"action-btn primary",onClick:q},[C(t(N),{icon:"carbon:save"}),w(" "+s(t(o)("common.save")),1)]),a.value.code!=="default"?(c(),u("button",{key:0,class:"action-btn danger",onClick:l},[C(t(N),{icon:"carbon:trash-can"}),w(" "+s(t(o)("common.delete")),1)])):I("",!0)])]),e("div",_i,[e("label",null,[w(s(t(o)("config.namespaceConfig.name"))+" ",1),i[11]||(i[11]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=v=>a.value.name=v),placeholder:t(o)("config.namespaceConfig.placeholder"),required:""},null,8,bi),[[J,a.value.name]])]),e("div",Ci,[e("label",null,[w(s(t(o)("config.namespaceConfig.code"))+" ",1),i[12]||(i[12]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=v=>a.value.code=v),disabled:!0,placeholder:t(o)("config.namespaceConfig.placeholder"),required:""},null,8,$i),[[J,a.value.code]])]),e("div",wi,[e("label",null,s(t(o)("config.namespaceConfig.host")),1),j(e("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=v=>a.value.host=v),placeholder:t(o)("config.namespaceConfig.placeholder"),required:""},null,8,ki),[[J,a.value.host]])]),e("div",Si,[e("label",null,s(t(o)("config.namespaceConfig.description")),1),j(e("input",{type:"text","onUpdate:modelValue":i[3]||(i[3]=v=>a.value.description=v),placeholder:t(o)("config.namespaceConfig.placeholder")},null,8,Ti),[[J,a.value.description]])])])):(c(),u("div",Ni,[C(t(N),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,s(t(o)("config.namespaceConfig.selectNameSpaceHint")),1)]))]),C(pe,{modelValue:A.value,"onUpdate:modelValue":i[8]||(i[8]=v=>A.value=v),title:t(o)("config.namespaceConfig.createNew"),onConfirm:x},{default:z(()=>[e("div",Ui,[e("div",xi,[e("label",null,[w(s(t(o)("config.namespaceConfig.name"))+" ",1),i[13]||(i[13]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":i[4]||(i[4]=v=>D.name=v),placeholder:t(o)("config.namespaceConfig.placeholder"),required:""},null,8,Vi),[[J,D.name]])]),e("div",Ai,[e("label",null,[w(s(t(o)("config.namespaceConfig.code"))+" ",1),i[14]||(i[14]=e("span",{class:"required"},"*",-1))]),j(e("input",{type:"text","onUpdate:modelValue":i[5]||(i[5]=v=>D.code=v),placeholder:t(o)("config.namespaceConfig.placeholder"),required:""},null,8,Ei),[[J,D.code]])]),e("div",Pi,[e("label",null,s(t(o)("config.namespaceConfig.host")),1),j(e("input",{type:"text","onUpdate:modelValue":i[6]||(i[6]=v=>D.host=v),placeholder:t(o)("config.namespaceConfig.placeholder"),required:""},null,8,Di),[[J,D.host]])]),e("div",Mi,[e("label",null,s(t(o)("config.namespaceConfig.description")),1),j(e("input",{type:"text","onUpdate:modelValue":i[7]||(i[7]=v=>D.description=v),placeholder:t(o)("config.namespaceConfig.placeholder")},null,8,Fi),[[J,D.description]])])])]),_:1},8,["modelValue","title"]),C(pe,{modelValue:E.value,"onUpdate:modelValue":i[10]||(i[10]=v=>E.value=v),title:t(o)("config.namespaceConfig.deleteConfirm")},{footer:z(()=>[e("button",{class:"cancel-btn",onClick:i[9]||(i[9]=v=>E.value=!1)},s(t(o)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:G},s(t(o)("common.delete")),1)]),default:z(()=>{var v;return[e("div",Ri,[C(t(N),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[w(s(t(o)("config.namespaceConfig.deleteConfirmText"))+" ",1),e("strong",null,s((v=a.value)==null?void 0:v.name),1),w(" "+s(t(o)("common.confirm"))+"？ ",1)]),e("p",Li,s(t(o)("config.namespaceConfig.deleteWarning")),1)])]}),_:1},8,["modelValue","title"])]}),_:1}))}}),qi=ae(Ii,[["__scopeId","data-v-c4f8fbf9"]]),Bi=ie({__name:"namespaceSwitch",setup(F){const{t:o}=ge(),n=Re(),m=Fe(),b=Ue(),{namespace:_,namespaces:V}=Pe(b),{setCurrentNs:p,setNamespaces:a}=b,k=(P,D)=>{if(bl(D.host)){const R=D.host,L=R.endsWith("/")?R.slice(0,-1):R,x=new URL(L);if(x.pathname.includes("index.html")){window.open(x.toString(),"_blank");return}try{const q=new URL(window.location.href),G=new URL(q.pathname+q.search+q.hash,L);window.open(G.toString(),"_blank?namespace="+P)}catch(q){console.error("Failed to construct new URL:",q);const G=window.location.pathname+window.location.search,ee=L+G;window.open(ee,"_blank?namespace="+P)}}else p(P)},A=async()=>{var x;const P=await _e.getAllNamespaces(),D=window.location.host;let R="";const L=P.find(q=>{var G;return(G=q.host)==null?void 0:G.includes(D)});L?R=L.code:R=((x=P[0])==null?void 0:x.code)||"",p(R),a(P.map(q=>({id:q.code,name:q.name,host:q.host})))},E=()=>{m.push({name:n.name,params:{...n.params,category:"namespace"},query:{namespace:_.value}})};return ve(async()=>{A()}),(P,D)=>(c(),u("div",null,[C(Ae,{modelValue:t(_),"onUpdate:modelValue":D[0]||(D[0]=R=>ze(_)?_.value=R:null),options:t(V),"dropdown-title":t(o)("config.namespaceConfig.namespace.namespace"),onChange:k,placeholder:t(o)("config.namespaceConfig.namespace.selectNamespace"),direction:"right",dropStyles:{minWidth:"220px"}},null,8,["modelValue","options","dropdown-title","placeholder"]),e("span",{onclick:"event.stopPropagation()",class:"setting-icon-wrapper",onClick:E},[C(t(N),{icon:"carbon:settings-edit",class:"setting-icon",width:"20"})])]))}}),Oi=ae(Bi,[["__scopeId","data-v-4727c0a4"]]),ji={class:"config-container"},Gi={class:"config-header"},Ji={class:"header-actions"},Ki={class:"header-actions-left"},Hi={class:"header-actions-right"},zi={class:"config-content"},Yi={class:"config-nav"},Wi=["onClick"],Xi={class:"config-details"},Qi=ie({__name:"index",setup(F){const{t:o}=ge(),n=Re(),m=Fe(),b=O(n.params.category||"basic"),_={basic:Me,agent:un,model:pa,mcp:dl,prompt:li,namespace:qi},V=te(()=>{const k=b.value;return _[k]||Me}),p=te(()=>[{key:"basic",label:o("config.categories.basic"),icon:"carbon:settings"},{key:"agent",label:o("config.categories.agent"),icon:"carbon:bot"},{key:"model",label:o("config.categories.model"),icon:"carbon:build-image"},{key:"mcp",label:o("config.categories.mcp"),icon:"carbon:tool-box"},{key:"prompt",label:o("config.categories.prompt"),icon:"carbon:repo-artifact"},{key:"namespace",label:o("config.categories.namespace"),disabled:!1,icon:"carbon:batch-job"}]);be(()=>n.params.category,k=>{k&&(b.value=k)});const a=k=>{m.push({name:n.name,params:{...n.params,category:k},query:n.query})};return(k,A)=>(c(),u("div",ji,[e("div",Gi,[e("div",Ji,[e("div",Ki,[e("button",{class:"action-btn",onClick:A[0]||(A[0]=E=>k.$router.push("/"))},[C(t(N),{icon:"carbon:arrow-left"}),w(" "+s(k.$t("backHome")),1)]),C(We)]),e("div",Hi,[C(Oi)])])]),e("div",zi,[e("nav",Yi,[(c(!0),u(Q,null,Z(p.value,(E,P)=>(c(),u(Q,null,[E.disabled?I("",!0):(c(),u("div",{key:P,class:se(["nav-item",{active:b.value===E.key}]),onClick:D=>a(E.key)},[C(t(N),{icon:E.icon,width:"20"},null,8,["icon"]),e("span",null,s(E.label),1)],10,Wi))],64))),256))]),e("div",Xi,[(c(),le(Ye(V.value)))])])]))}}),nc=ae(Qi,[["__scopeId","data-v-29da4edc"]]);export{nc as default};

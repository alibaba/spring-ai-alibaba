var Ee=Object.defineProperty;var xe=(I,t,s)=>t in I?Ee(I,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):I[t]=s;var fe=(I,t,s)=>xe(I,typeof t!="symbol"?t+"":t,s);import{_ as ae,I as O}from"./_plugin-vue_export-helper-DXKriEqe.js";import{d as le,c as r,o as c,e,t as o,f as ge,r as L,y as ce,g as q,h as be,i as V,u as g,b as M,q as P,w as N,v as X,F as j,j as K,p as W,C as Ve,a as re,A as ne,T as Ce,D as Pe,E as ke,s as ye,x as me,G as Me,k as Ue,H as Be,I as Se}from"./index-DtI_3UwD.js";import{L as Ge}from"./index--VQTQpj5.js";const Le={class:"switch"},Oe=["checked"],Fe={class:"switch-label"},Ie=le({__name:"index",props:{enabled:{type:Boolean},label:{}},emits:["update:switchValue"],setup(I,{emit:t}){const s=t,C=$=>{const v=$.target.checked;s("update:switchValue",v)};return($,v)=>(c(),r("label",Le,[e("input",{type:"checkbox",checked:$.enabled,onChange:C},null,40,Oe),v[0]||(v[0]=e("span",{class:"slider"},null,-1)),e("span",Fe,o($.label),1)]))}}),Re=ae(Ie,[["__scopeId","data-v-d484b4a3"]]);class pe{static async getConfigsByGroup(t){try{const s=await fetch(`${this.BASE_URL}/group/${t}`);if(!s.ok)throw new Error(`Failed to get ${t} group configuration: ${s.status}`);return await s.json()}catch(s){throw console.error(`Failed to get ${t} group configuration:`,s),s}}static async batchUpdateConfigs(t){if(!t||t.length===0)return{success:!0,message:"No configuration needs to be updated"};try{const s=await fetch(`${this.BASE_URL}/batch-update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Batch update configuration failed: ${s.status}`);return{success:!0,message:"Configuration saved successfully"}}catch(s){return console.error("Batch update configuration failed:",s),{success:!1,message:s instanceof Error?s.message:"Update failed, please try again"}}}static async getConfigById(t){try{const s=await fetch(`${this.BASE_URL}/${t}`);if(!s.ok)throw new Error(`Failed to get configuration item: ${s.status}`);return await s.json()}catch(s){throw console.error(`Failed to get configuration item[${t}]:`,s),s}}static async updateConfig(t){try{const s=await fetch(`${this.BASE_URL}/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Failed to update configuration item: ${s.status}`);return{success:!0,message:"Configuration updated successfully"}}catch(s){return console.error("Failed to update configuration item:",s),{success:!1,message:s instanceof Error?s.message:"Update failed, please try again"}}}}fe(pe,"BASE_URL","/api/config");const Ne={class:"config-panel"},De={class:"config-header"},je={class:"header-left"},Ke={class:"config-stats"},qe={class:"stat-item"},Je={class:"stat-value"},ze={key:0,class:"stat-item"},He={class:"stat-value modified"},Xe={class:"header-right"},Ye={class:"import-export-actions"},Qe={class:"action-btn",title:"导入配置"},We={class:"search-box"},Ze=["placeholder"],et={key:0,class:"loading-container"},tt={key:1,class:"config-groups"},st={class:"group-header"},ot={class:"group-info"},nt={class:"group-icon"},at={class:"group-actions"},lt=["onClick","disabled","title"],it={class:"sub-groups"},ct=["onClick"],rt={class:"sub-group-info"},dt={class:"sub-group-title"},ut={class:"item-count"},pt={class:"config-items"},gt={key:0,class:"config-item-content vertical-layout"},ft={class:"config-item-info"},vt={class:"config-item-header"},ht={class:"config-label"},mt={class:"type-badge boolean"},yt={key:0,class:"modified-badge"},_t=["title"],bt={class:"config-control"},Ct=["value","onChange"],$t=["value"],wt={key:1,class:"config-item-content vertical-layout"},kt={class:"config-item-info"},St={class:"config-item-header"},Tt={class:"config-label"},At={class:"type-badge select"},Et={key:0,class:"modified-badge"},xt=["title"],Vt={class:"config-control"},Pt=["value","onChange"],Mt=["value"],Ut={key:2,class:"config-item-content vertical-layout"},Bt={class:"config-item-info"},Gt={class:"config-item-header"},Lt={class:"config-label"},Ot={class:"type-badge textarea"},Ft={key:0,class:"modified-badge"},It=["title"],Rt={class:"config-control"},Nt=["value","onInput"],Dt={key:3,class:"config-item-content vertical-layout"},jt={class:"config-item-info"},Kt={class:"config-item-header"},qt={class:"config-label"},Jt={class:"type-badge number"},zt={key:0,class:"modified-badge"},Ht=["title"],Xt={key:0,class:"config-meta"},Yt={class:"range-info"},Qt={class:"config-control"},Wt=["value","onInput","min","max"],Zt={key:4,class:"config-item-content vertical-layout"},es={class:"config-item-info"},ts={class:"config-item-header"},ss={class:"config-label"},os={class:"type-badge string"},ns={key:0,class:"modified-badge"},as=["title"],ls={class:"config-control"},is=["value","onInput"],cs={key:2,class:"empty-state"},rs=le({__name:"basicConfig",setup(I){const{t}=ge(),s=L(!0),C=L(!1),$=L([]),v=L(new Map),d=L(new Set),S=ce({show:!1,text:"",type:"success"}),k=L(""),J={maxSteps:"智能体执行最大步数",resetAllAgents:"重置所有agent",headlessBrowser:"是否使用无头浏览器模式",browserTimeout:t("config.basicConfig.browserTimeout"),browserDebug:"浏览器debug模式",autoOpenBrowser:"启动时自动打开浏览器",consoleInteractive:"启用控制台交互模式",systemName:"系统名称",language:"默认语言",maxThreads:"最大线程数",timeoutSeconds:t("config.basicConfig.requestTimeout")},F={manus:"智能体设置",browser:"浏览器设置",interaction:"交互设置",system:"系统设置",performance:"性能设置"},E={manus:"🤖",browser:"🌐",interaction:"🖥️",system:"⚙️",performance:"⚡"},Z={agent:"智能体设置",browser:"浏览器设置",interaction:"交互设置",system:"系统设置",performance:"性能设置",general:"常规设置"},se=q(()=>$.value.some(n=>n.subGroups.some(p=>p.items.some(b=>v.value.get(b.id)!==b.configValue)))),B=n=>n==="true",x=n=>parseFloat(n)||0,f=n=>({maxSteps:1,browserTimeout:1,maxThreads:1,timeoutSeconds:5})[n]||1,U=n=>({maxSteps:100,browserTimeout:600,maxThreads:32,timeoutSeconds:300})[n]||1e4,Y=n=>typeof n=="string"?n:n.value,ie=n=>typeof n=="string"?n:n.label,de=(n,p)=>{if(typeof p=="boolean")return p.toString();if(typeof p=="string"){if(n.options&&n.options.length>0){const b=n.options.find(_=>(typeof _=="string"?_:_.label)===p||(typeof _=="string"?_:_.value)===p);if(b)return typeof b=="string"?b:b.value}return p}return String(p)},z=(n,p,b=!1)=>{let _;n.inputType==="BOOLEAN"||n.inputType==="CHECKBOX"?_=de(n,p):_=String(p),n.configValue!==_&&(n.configValue=_,n._modified=!0,(b||n.inputType==="BOOLEAN"||n.inputType==="CHECKBOX"||n.inputType==="SELECT")&&u())};let m=null;const u=()=>{m&&clearTimeout(m),m=window.setTimeout(()=>{i()},500)},h=(n,p="success")=>{S.text=n,S.type=p,S.show=!0,setTimeout(()=>{S.show=!1},3e3)},G=async()=>{try{s.value=!0;const p=["manus","browser","interaction","system","performance"].map(async _=>{try{const a=await pe.getConfigsByGroup(_);if(a.length===0)return null;const w=a.map(R=>({...R,displayName:R.description||J[R.configKey]||R.configKey,min:f(R.configKey),max:U(R.configKey)}));w.forEach(R=>{v.value.set(R.id,R.configValue)});const T=new Map;w.forEach(R=>{const H=R.configSubGroup||"general";T.has(H)||T.set(H,[]),T.get(H).push(R)});const D=Array.from(T.entries()).map(([R,H])=>({name:R,displayName:Z[R]||R,items:H}));return{name:_,displayName:F[_]||_,subGroups:D}}catch(a){return console.warn(`加载配置组 ${_} 失败，跳过:`,a),null}}),b=await Promise.all(p);$.value=b.filter(_=>_!==null),console.log("配置加载完成:",$.value)}catch(n){console.error("加载配置失败:",n),h(t("config.basicConfig.loadConfigFailed"),"error")}finally{s.value=!1}},i=async()=>{if(!(C.value||!se.value))try{C.value=!0;const n=[];if($.value.forEach(b=>{b.subGroups.forEach(_=>{const a=_.items.filter(w=>w._modified);n.push(...a)})}),n.length===0){h("没有需要保存的修改");return}const p=await pe.batchUpdateConfigs(n);p.success?(n.forEach(b=>{v.value.set(b.id,b.configValue),b._modified=!1}),h("配置保存成功")):h(p.message||"保存失败","error")}catch(n){console.error("保存配置失败:",n),h(t("config.basicConfig.saveFailed"),"error")}finally{C.value=!1}},l=async n=>{if(confirm(`确定要重置 "${F[n]||n}" 组的所有配置吗？`))try{C.value=!0;const b=$.value.find(w=>w.name===n);if(!b)return;const _=[];if(b.subGroups.forEach(w=>{w.items.forEach(T=>{const D=A(T.configKey);D!==T.configValue&&_.push({...T,configValue:D})})}),_.length===0){h("该组配置已是默认值");return}const a=await pe.batchUpdateConfigs(_);a.success?(await G(),h(`成功重置 ${_.length} 项配置`)):h(a.message||"重置失败","error")}catch(b){console.error("重置组配置失败:",b),h(t("config.basicConfig.resetFailed"),"error")}finally{C.value=!1}},A=n=>({systemName:"JTaskPilot",language:"zh-CN",maxThreads:"8",timeoutSeconds:"60",autoOpenBrowser:"false",headlessBrowser:"true"})[n]||"",y=(n,p)=>{const b=`${n}-${p}`;d.value.has(b)?d.value.delete(b):d.value.add(b)},ee=(n,p)=>d.value.has(`${n}-${p}`),Q=q(()=>{const n=$.value.reduce((b,_)=>b+_.subGroups.reduce((a,w)=>a+w.items.length,0),0),p=$.value.reduce((b,_)=>b+_.subGroups.reduce((a,w)=>a+w.items.filter(T=>v.value.get(T.id)!==T.configValue).length,0),0);return{total:n,modified:p}}),ue=q(()=>{if(!k.value.trim())return $.value;const n=k.value.toLowerCase();return $.value.map(p=>({...p,subGroups:p.subGroups.map(b=>({...b,items:b.items.filter(_=>_.displayName.toLowerCase().includes(n)||_.configKey.toLowerCase().includes(n)||_.description&&_.description.toLowerCase().includes(n))})).filter(b=>b.items.length>0)})).filter(p=>p.subGroups.length>0)}),oe=()=>{try{const n={timestamp:new Date().toISOString(),version:"1.0",configs:$.value.reduce((a,w)=>(w.subGroups.forEach(T=>{T.items.forEach(D=>{a[D.configKey]=D.configValue})}),a),{})},p=JSON.stringify(n,null,2),b=new Blob([p],{type:"application/json"}),_=document.createElement("a");_.href=URL.createObjectURL(b),_.download=`config-export-${new Date().toISOString().split("T")[0]}.json`,_.click(),h("配置导出成功")}catch(n){console.error("导出配置失败:",n),h("导出失败","error")}},$e=n=>{var a;const p=n.target,b=(a=p.files)==null?void 0:a[0];if(!b)return;const _=new FileReader;_.onload=async w=>{var T;try{const D=JSON.parse((T=w.target)==null?void 0:T.result);if(!D.configs)throw new Error("无效的配置文件格式");if(!confirm("确定要导入配置吗？这将覆盖当前配置。"))return;C.value=!0;const H=[];if($.value.forEach(Te=>{Te.subGroups.forEach(Ae=>{Ae.items.forEach(he=>{D.configs.hasOwnProperty(he.configKey)&&H.push({...he,configValue:D.configs[he.configKey]})})})}),H.length===0){h("没有找到可导入的配置项");return}const we=await pe.batchUpdateConfigs(H);we.success?(await G(),h(`成功导入 ${H.length} 项配置`)):h(we.message||"导入失败","error")}catch(D){console.error("导入配置失败:",D),h(t("config.basicConfig.importFailed"),"error")}finally{C.value=!1,p.value=""}},_.readAsText(b)};return be(()=>{G()}),(n,p)=>(c(),r("div",Ne,[e("div",De,[e("div",je,[e("h2",null,o(g(t)("config.basicConfig.title")),1),e("div",Ke,[e("span",qe,[p[1]||(p[1]=e("span",{class:"stat-label"},"总配置项:",-1)),e("span",Je,o(Q.value.total),1)]),Q.value.modified>0?(c(),r("span",ze,[p[2]||(p[2]=e("span",{class:"stat-label"},"已修改:",-1)),e("span",He,o(Q.value.modified),1)])):M("",!0)])]),e("div",Xe,[e("div",Ye,[e("button",{onClick:oe,class:"action-btn",title:"导出配置"}," 📤 "),e("label",Qe,[p[3]||(p[3]=P(" 📥 ")),e("input",{type:"file",accept:".json",onChange:$e,style:{display:"none"}},null,32)])]),e("div",We,[N(e("input",{"onUpdate:modelValue":p[0]||(p[0]=b=>k.value=b),type:"text",placeholder:n.$t("config.search"),class:"search-input"},null,8,Ze),[[X,k.value]]),p[4]||(p[4]=e("span",{class:"search-icon"},"🔍",-1))])])]),s.value?(c(),r("div",et,[p[5]||(p[5]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,o(n.$t("config.loading")),1)])):ue.value.length>0?(c(),r("div",tt,[(c(!0),r(j,null,K(ue.value,b=>(c(),r("div",{key:b.name,class:"config-group"},[e("div",st,[e("div",ot,[e("span",nt,o(E[b.name]||"⚙️"),1)]),e("div",at,[e("button",{onClick:_=>l(b.name),class:"reset-btn",disabled:C.value,title:n.$t("config.resetGroupConfirm")},o(n.$t("config.reset")),9,lt)]),p[6]||(p[6]=e("div",{class:"group-divider"},null,-1))]),e("div",it,[(c(!0),r(j,null,K(b.subGroups,_=>(c(),r("div",{key:_.name,class:"sub-group"},[e("div",{class:"sub-group-header",onClick:a=>y(b.name,_.name)},[e("div",rt,[p[7]||(p[7]=e("span",{class:"sub-group-icon"},"📁",-1)),e("h4",dt,o(_.displayName),1),e("span",ut,"("+o(_.items.length)+")",1)]),e("span",{class:W(["collapse-icon",{collapsed:ee(b.name,_.name)}])}," ▼ ",2)],8,ct),N(e("div",pt,[(c(!0),r(j,null,K(_.items,a=>(c(),r("div",{key:a.id,class:W(["config-item",{modified:v.value.get(a.id)!==a.configValue}])},[a.inputType==="BOOLEAN"||a.inputType==="CHECKBOX"?(c(),r("div",gt,[e("div",ft,[e("div",vt,[e("label",ht,[P(o(a.description||a.displayName)+" ",1),e("span",mt,o(a.inputType==="CHECKBOX"?n.$t("config.types.checkbox"):n.$t("config.types.boolean")),1),v.value.get(a.id)!==a.configValue?(c(),r("span",yt,o(n.$t("config.modified")),1)):M("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,_t)])]),e("div",bt,[a.options&&a.options.length>0?(c(),r("select",{key:0,class:"config-input select-input",value:a.configValue,onChange:w=>{var T;return z(a,((T=w.target)==null?void 0:T.value)||"")}},[(c(!0),r(j,null,K(a.options,w=>(c(),r("option",{key:Y(w),value:Y(w)},o(ie(w)),9,$t))),128))],40,Ct)):(c(),re(Re,{key:1,enabled:B(a.configValue),label:"","onUpdate:switchValue":w=>z(a,w)},null,8,["enabled","onUpdate:switchValue"]))])])):a.inputType==="SELECT"?(c(),r("div",wt,[e("div",kt,[e("div",St,[e("label",Tt,[P(o(a.description||a.displayName)+" ",1),e("span",At,o(n.$t("config.types.select")),1),v.value.get(a.id)!==a.configValue?(c(),r("span",Et,o(n.$t("config.modified")),1)):M("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,xt)])]),e("div",Vt,[e("select",{class:"config-input select-input",value:a.configValue,onChange:w=>{var T;return z(a,((T=w.target)==null?void 0:T.value)||"")}},[(c(!0),r(j,null,K(a.options||[],w=>(c(),r("option",{key:Y(w),value:Y(w)},o(ie(w)),9,Mt))),128))],40,Pt)])])):a.inputType==="TEXTAREA"?(c(),r("div",Ut,[e("div",Bt,[e("div",Gt,[e("label",Lt,[P(o(a.description||a.displayName)+" ",1),e("span",Ot,o(n.$t("config.types.textarea")),1),v.value.get(a.id)!==a.configValue?(c(),r("span",Ft,o(n.$t("config.modified")),1)):M("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,It)])]),e("div",Rt,[e("textarea",{class:"config-input textarea-input",value:a.configValue,onInput:w=>{var T;return z(a,((T=w.target)==null?void 0:T.value)||"")},onBlur:u,rows:"3"},null,40,Nt)])])):a.inputType==="NUMBER"?(c(),r("div",Dt,[e("div",jt,[e("div",Kt,[e("label",qt,[P(o(a.description||a.displayName)+" ",1),e("span",Jt,o(n.$t("config.types.number")),1),v.value.get(a.id)!==a.configValue?(c(),r("span",zt,o(n.$t("config.modified")),1)):M("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,Ht),a.min||a.max?(c(),r("div",Xt,[e("span",Yt,o(n.$t("config.range"))+": "+o(a.min||0)+" - "+o(a.max||"∞"),1)])):M("",!0)])]),e("div",Qt,[e("input",{type:"number",class:"config-input number-input",value:x(a.configValue),onInput:w=>{var T;return z(a,((T=w.target)==null?void 0:T.value)||"")},onBlur:u,min:a.min||1,max:a.max||1e4},null,40,Wt)])])):(c(),r("div",Zt,[e("div",es,[e("div",ts,[e("label",ss,[P(o(a.description||a.displayName)+" ",1),e("span",os,o(a.inputType==="TEXT"?n.$t("config.types.text"):n.$t("config.types.string")),1),v.value.get(a.id)!==a.configValue?(c(),r("span",ns,o(n.$t("config.modified")),1)):M("",!0)]),e("span",{class:"config-key",title:a.configKey},o(a.configKey),9,as)])]),e("div",ls,[e("input",{type:"text",class:"config-input text-input",value:a.configValue,onInput:w=>{var T;return z(a,((T=w.target)==null?void 0:T.value)||"")},onBlur:u},null,40,is)])]))],2))),128))],512),[[Ve,!ee(b.name,_.name)]])]))),128))])]))),128))])):(c(),r("div",cs,[e("p",null,o(n.$t("config.notFound")),1)])),V(Ce,{name:"message-fade"},{default:ne(()=>[S.show?(c(),r("div",{key:0,class:W(["message-toast",S.type])},o(S.text),3)):M("",!0)]),_:1})]))}}),ds=ae(rs,[["__scopeId","data-v-fa6106c6"]]),us={class:"modal-header"},ps={class:"modal-content"},gs={class:"modal-footer"},fs=le({__name:"index",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""}},emits:["update:modelValue","confirm"],setup(I){const{t}=ge(),s=C=>{C.target===C.currentTarget&&(C.stopPropagation(),C.preventDefault())};return(C,$)=>(c(),re(Pe,{to:"body"},[V(Ce,{name:"modal"},{default:ne(()=>[I.modelValue?(c(),r("div",{key:0,class:"modal-overlay",onClick:s},[e("div",{class:"modal-container",onClick:$[3]||($[3]=ye(()=>{},["stop"]))},[e("div",us,[e("h3",null,o(I.title),1),e("button",{class:"close-btn",onClick:$[0]||($[0]=v=>C.$emit("update:modelValue",!1))},[V(g(O),{icon:"carbon:close"})])]),e("div",ps,[ke(C.$slots,"default",{},void 0,!0)]),e("div",gs,[ke(C.$slots,"footer",{},()=>[e("button",{class:"cancel-btn",onClick:$[1]||($[1]=v=>C.$emit("update:modelValue",!1))},o(C.$t("common.cancel")),1),e("button",{class:"confirm-btn",onClick:$[2]||($[2]=v=>C.$emit("confirm"))},o(C.$t("common.confirm")),1)],!0)])])])):M("",!0)]),_:3})]))}}),_e=ae(fs,[["__scopeId","data-v-b5281b82"]]),vs={class:"tool-selection-content"},hs={class:"tool-controls"},ms={class:"search-container"},ys={class:"sort-container"},_s={class:"tool-summary"},bs={class:"summary-text"},Cs={key:0,class:"tool-groups"},$s=["onClick"],ws={class:"group-title-area"},ks={class:"group-name"},Ss={class:"group-count"},Ts={class:"group-enable-all"},As=["checked","onChange","data-group"],Es={class:"tool-info"},xs={class:"tool-selection-name"},Vs={key:0,class:"tool-selection-desc"},Ps={class:"tool-actions"},Ms=["checked","onChange"],Us={key:1,class:"empty-state"},Bs=le({__name:"index",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(I,{emit:t}){const s=I,C=t,$=q({get:()=>s.modelValue,set:m=>C("update:modelValue",m)}),v=L(""),d=L("group"),S=L(new Set),k=L([]),J=(m,u)=>{const h=document.querySelector(`input[data-group="${m}"]`);h&&(h.indeterminate=U(u))};me(()=>s.selectedToolIds,m=>{k.value=[...m]},{immediate:!0});const F=q(()=>{let m=s.tools.filter(u=>u&&u.key);if(v.value){const u=v.value.toLowerCase();m=m.filter(h=>h.name.toLowerCase().includes(u)||h.description.toLowerCase().includes(u)||h.serviceGroup&&h.serviceGroup.toLowerCase().includes(u))}switch(d.value){case"name":m=[...m].sort((u,h)=>u.name.localeCompare(h.name));break;case"enabled":m=[...m].sort((u,h)=>{const G=k.value.includes(u.key),i=k.value.includes(h.key);return G&&!i?-1:!G&&i?1:u.name.localeCompare(h.name)});break;case"group":default:m=[...m].sort((u,h)=>{const G=u.serviceGroup||"未分组",i=h.serviceGroup||"未分组";return G!==i?G.localeCompare(i):u.name.localeCompare(h.name)});break}return m}),E=q(()=>{const m=new Map;return F.value.forEach(u=>{const h=u.serviceGroup||"未分组";m.has(h)||m.set(h,[]),m.get(h).push(u)}),new Map([...m.entries()].sort())}),Z=q(()=>F.value.length);me([k,E],()=>{Ue(()=>{for(const[m,u]of E.value)J(m,u)})},{flush:"post",deep:!1});const se=m=>k.value.includes(m),B=(m,u)=>{u.stopPropagation();const G=u.target.checked;if(!m){console.error("toolKey is undefined, cannot proceed");return}G?k.value.includes(m)||(k.value=[...k.value,m]):k.value=k.value.filter(i=>i!==m)},x=m=>m.filter(u=>k.value.includes(u.key)),f=m=>m.length>0&&m.every(u=>k.value.includes(u.key)),U=m=>{const u=x(m).length;return u>0&&u<m.length},Y=(m,u)=>{u.stopPropagation();const G=u.target.checked,i=m.map(l=>l.key);if(G){const l=[...k.value];i.forEach(A=>{l.includes(A)||l.push(A)}),k.value=l}else k.value=k.value.filter(l=>!i.includes(l))},ie=m=>{S.value.has(m)?S.value.delete(m):S.value.add(m)},de=()=>{C("confirm",[...k.value]),C("update:modelValue",!1)},z=()=>{k.value=[...s.selectedToolIds],C("update:modelValue",!1)};return me($,m=>{if(m){S.value.clear();const u=Array.from(E.value.keys());u.length>1&&u.slice(1).forEach(h=>{S.value.add(h)})}}),(m,u)=>(c(),re(_e,{modelValue:$.value,"onUpdate:modelValue":[u[4]||(u[4]=h=>$.value=h),z],title:"选择工具",onConfirm:de},{default:ne(()=>[e("div",vs,[e("div",hs,[e("div",ms,[N(e("input",{"onUpdate:modelValue":u[0]||(u[0]=h=>v.value=h),type:"text",class:"search-input",placeholder:"搜索工具..."},null,512),[[X,v.value]])]),e("div",ys,[N(e("select",{"onUpdate:modelValue":u[1]||(u[1]=h=>d.value=h),class:"sort-select"},u[5]||(u[5]=[e("option",{value:"group"},"按服务组排序",-1),e("option",{value:"name"},"按名称排序",-1),e("option",{value:"enabled"},"按启用状态排序",-1)]),512),[[Me,d.value]])])]),e("div",_s,[e("span",bs," 共 "+o(E.value.size)+" 个服务组，"+o(Z.value)+" 个工具 (已选择 "+o(k.value.length)+" 个) ",1)]),E.value.size>0?(c(),r("div",Cs,[(c(!0),r(j,null,K(E.value,([h,G])=>(c(),r("div",{key:h,class:"tool-group"},[e("div",{class:W(["tool-group-header",{collapsed:S.value.has(h)}]),onClick:i=>ie(h)},[e("div",ws,[V(g(O),{icon:S.value.has(h)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),V(g(O),{icon:"carbon:folder",class:"group-icon"}),e("span",ks,o(h),1),e("span",Ss," ("+o(x(G).length)+"/"+o(G.length)+") ",1)]),e("div",{class:"group-actions",onClick:u[2]||(u[2]=ye(()=>{},["stop"]))},[e("label",Ts,[e("input",{type:"checkbox",class:"group-enable-checkbox",checked:f(G),onChange:i=>Y(G,i),"data-group":h},null,40,As),u[6]||(u[6]=e("span",{class:"enable-label"},"启用全部",-1))])])],10,$s),e("div",{class:W(["tool-group-content",{collapsed:S.value.has(h)}])},[(c(!0),r(j,null,K(G.filter(i=>i&&i.key),i=>(c(),r("div",{key:i.key,class:"tool-selection-item"},[e("div",Es,[e("div",xs,o(i.name),1),i.description?(c(),r("div",Vs,o(i.description),1)):M("",!0)]),e("div",Ps,[e("label",{class:"tool-enable-switch",onClick:u[3]||(u[3]=ye(()=>{},["stop"]))},[e("input",{type:"checkbox",class:"tool-enable-checkbox",checked:se(i.key),onChange:l=>B(i.key,l)},null,40,Ms),u[7]||(u[7]=e("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(c(),r("div",Us,[V(g(O),{icon:"carbon:tools",class:"empty-icon"}),u[8]||(u[8]=e("p",null,"没有找到工具",-1))]))])]),_:1},8,["modelValue"]))}}),Gs=ae(Bs,[["__scopeId","data-v-81d0fa5c"]]);class te{static async handleResponse(t){if(!t.ok)try{const s=await t.json();throw new Error(s.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAllAgents(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Agent list:",t),t}}static async getAgentById(t){try{const s=await fetch(`${this.BASE_URL}/${t}`);return await(await this.handleResponse(s)).json()}catch(s){throw console.error(`Failed to get Agent[${t}] details:`,s),s}}static async createAgent(t){try{const s=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to create Agent:",s),s}}static async updateAgent(t,s){try{const C=await fetch(`${this.BASE_URL}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await(await this.handleResponse(C)).json()}catch(C){throw console.error(`Failed to update Agent[${t}]:`,C),C}}static async deleteAgent(t){try{const s=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});if(s.status===400)throw new Error("Cannot delete default Agent");await this.handleResponse(s)}catch(s){throw console.error(`Failed to delete Agent[${t}]:`,s),s}}static async getAvailableTools(){try{const t=await fetch(`${this.BASE_URL}/tools`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools list:",t),t}}}fe(te,"BASE_URL","/api/agents");const Ls={class:"config-panel"},Os={class:"panel-header"},Fs={class:"panel-actions"},Is=["disabled"],Rs={class:"agent-layout"},Ns={class:"agent-list"},Ds={class:"list-header"},js={class:"agent-count"},Ks={key:0,class:"agents-container"},qs=["onClick"],Js={class:"agent-card-header"},zs={class:"agent-name"},Hs={class:"agent-desc"},Xs={key:0,class:"agent-tools"},Ys={key:0,class:"tool-more"},Qs={key:1,class:"loading-state"},Ws={key:2,class:"empty-state"},Zs={key:0,class:"agent-detail"},eo={class:"detail-header"},to={class:"detail-actions"},so={class:"form-item"},oo=["placeholder"],no={class:"form-item"},ao=["placeholder"],lo={class:"form-item"},io=["placeholder"],co={class:"tools-section"},ro={class:"assigned-tools"},uo={class:"section-header"},po={class:"tools-grid"},go={class:"tool-info"},fo={class:"tool-name"},vo={class:"tool-desc"},ho={key:0,class:"no-tools"},mo={key:1,class:"no-selection"},yo={class:"modal-form"},_o={class:"form-item"},bo=["placeholder"],Co={class:"form-item"},$o=["placeholder"],wo={class:"form-item"},ko=["placeholder"],So={class:"delete-confirm"},To={class:"warning-text"},Ao=le({__name:"agentConfig",setup(I){const{t}=ge(),s=L(!1),C=L(""),$=L(""),v=ce([]),d=L(null),S=ce([]),k=L(!1),J=L(!1),F=L(!1),E=ce({name:"",description:"",nextStepPrompt:""});q(()=>!d.value||!d.value.availableTools||!Array.isArray(d.value.availableTools)?S:S.filter(i=>!d.value.availableTools.includes(i.key)));const Z=i=>{const l=S.find(A=>A.key===i);return l?l.name:i},se=i=>{const l=S.find(A=>A.key===i);return l?l.description:""},B=(i,l)=>{l==="success"?($.value=i,setTimeout(()=>{$.value=""},3e3)):(C.value=i,setTimeout(()=>{C.value=""},5e3))},x=async()=>{s.value=!0;try{const[i,l]=await Promise.all([te.getAllAgents(),te.getAvailableTools()]),A=i.map(y=>({...y,availableTools:Array.isArray(y.availableTools)?y.availableTools:[]}));v.splice(0,v.length,...A),S.splice(0,S.length,...l),A.length>0&&await f(A[0])}catch(i){console.error("加载数据失败:",i),B(t("config.agentConfig.loadDataFailed")+": "+i.message,"error");const l=[{key:"search-web",name:"网络搜索",description:"在互联网上搜索信息",enabled:!0,serviceGroup:"搜索服务"},{key:"search-local",name:"本地搜索",description:"在本地文件中搜索内容",enabled:!0,serviceGroup:"搜索服务"},{key:"file-read",name:"读取文件",description:"读取本地或远程文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-write",name:"写入文件",description:"创建或修改文件内容",enabled:!0,serviceGroup:"文件服务"},{key:"file-delete",name:"删除文件",description:"删除指定的文件",enabled:!1,serviceGroup:"文件服务"},{key:"calculator",name:"计算器",description:"执行数学计算",enabled:!0,serviceGroup:"计算服务"},{key:"code-execute",name:"代码执行",description:"执行Python或JavaScript代码",enabled:!0,serviceGroup:"计算服务"},{key:"weather",name:"天气查询",description:"获取指定地区的天气信息",enabled:!0,serviceGroup:"信息服务"},{key:"currency",name:"汇率查询",description:"查询货币汇率信息",enabled:!0,serviceGroup:"信息服务"},{key:"email",name:"发送邮件",description:"发送电子邮件",enabled:!1,serviceGroup:"通信服务"},{key:"sms",name:"发送短信",description:"发送短信消息",enabled:!1,serviceGroup:"通信服务"}],A=[{id:"demo-1",name:"通用助手",description:"一个能够处理各种任务的智能助手",nextStepPrompt:"You are a helpful assistant that can answer questions and help with various tasks. What would you like me to help you with next?",availableTools:["search-web","calculator","weather"]},{id:"demo-2",name:"数据分析师",description:"专门用于数据分析和可视化的Agent",nextStepPrompt:"You are a data analyst assistant specialized in analyzing data and creating visualizations. Please provide the data you would like me to analyze.",availableTools:["file-read","file-write","calculator","code-execute"]}];S.splice(0,S.length,...l),v.splice(0,v.length,...A),A.length>0&&(d.value=A[0])}finally{s.value=!1}},f=async i=>{if(i)try{const l=await te.getAgentById(i.id);d.value={...l,availableTools:Array.isArray(l.availableTools)?l.availableTools:[]}}catch(l){console.error("加载Agent详情失败:",l),B(t("config.agentConfig.loadDetailsFailed")+": "+l.message,"error"),d.value={...i,availableTools:Array.isArray(i.availableTools)?i.availableTools:[]}}},U=()=>{E.name="",E.description="",E.nextStepPrompt="",k.value=!0},Y=async()=>{var i;if(!E.name.trim()||!E.description.trim()){B(t("config.agentConfig.requiredFields"),"error");return}try{const l={name:E.name.trim(),description:E.description.trim(),nextStepPrompt:((i=E.nextStepPrompt)==null?void 0:i.trim())||"",availableTools:[]},A=await te.createAgent(l);v.push(A),d.value=A,k.value=!1,B(t("config.agentConfig.createSuccess"),"success")}catch(l){B(t("config.agentConfig.createFailed")+": "+l.message,"error")}},ie=()=>{F.value=!0},de=i=>{d.value&&(d.value.availableTools=[...i])},z=async()=>{if(d.value){if(!d.value.name.trim()||!d.value.description.trim()){B(t("config.agentConfig.requiredFields"),"error");return}try{const i=await te.updateAgent(d.value.id,d.value),l=v.findIndex(A=>A.id===i.id);l!==-1&&(v[l]=i),d.value=i,B(t("config.agentConfig.saveSuccess"),"success")}catch(i){B(t("config.agentConfig.saveFailed")+": "+i.message,"error")}}},m=()=>{J.value=!0},u=async()=>{if(d.value)try{await te.deleteAgent(d.value.id);const i=v.findIndex(l=>l.id===d.value.id);i!==-1&&v.splice(i,1),d.value=v.length>0?v[0]:null,J.value=!1,B(t("config.agentConfig.deleteSuccess"),"success")}catch(i){B(t("config.agentConfig.deleteFailed")+": "+i.message,"error")}},h=()=>{const i=document.createElement("input");i.type="file",i.accept=".json",i.onchange=l=>{var y;const A=(y=l.target.files)==null?void 0:y[0];if(A){const ee=new FileReader;ee.onload=async Q=>{var ue;try{const oe=JSON.parse((ue=Q.target)==null?void 0:ue.result);if(!oe.name||!oe.description)throw new Error(t("config.agentConfig.invalidFormat"));const{id:$e,...n}=oe,p=await te.createAgent(n);v.push(p),d.value=p,B(t("config.agentConfig.importSuccess"),"success")}catch(oe){B(t("config.agentConfig.importFailed")+": "+oe.message,"error")}},ee.readAsText(A)}},i.click()},G=()=>{if(d.value)try{const i=JSON.stringify(d.value,null,2),l=new Blob([i],{type:"application/json"}),A=URL.createObjectURL(l),y=document.createElement("a");y.href=A,y.download=`agent-${d.value.name}-${new Date().toISOString().split("T")[0]}.json`,y.click(),URL.revokeObjectURL(A),B(t("config.agentConfig.exportSuccess"),"success")}catch(i){B(t("config.agentConfig.exportFailed")+": "+i.message,"error")}};return be(()=>{x()}),(i,l)=>{var A;return c(),r("div",Ls,[e("div",Os,[e("h2",null,o(g(t)("config.agentConfig.title")),1),e("div",Fs,[e("button",{class:"action-btn",onClick:h},[V(g(O),{icon:"carbon:upload"}),P(" "+o(g(t)("config.agentConfig.import")),1)]),e("button",{class:"action-btn",onClick:G,disabled:!d.value},[V(g(O),{icon:"carbon:download"}),P(" "+o(g(t)("config.agentConfig.export")),1)],8,Is)])]),e("div",Rs,[e("div",Ns,[e("div",Ds,[e("h3",null,o(g(t)("config.agentConfig.configuredAgents")),1),e("span",js,"("+o(v.length)+o(g(t)("config.agentConfig.agentCount"))+")",1)]),s.value?M("",!0):(c(),r("div",Ks,[(c(!0),r(j,null,K(v,y=>{var ee;return c(),r("div",{key:y.id,class:W(["agent-card",{active:((ee=d.value)==null?void 0:ee.id)===y.id}]),onClick:Q=>f(y)},[e("div",Js,[e("span",zs,o(y.name),1),V(g(O),{icon:"carbon:chevron-right"})]),e("p",Hs,o(y.description),1),y.availableTools&&Array.isArray(y.availableTools)&&y.availableTools.length>0?(c(),r("div",Xs,[(c(!0),r(j,null,K(y.availableTools.slice(0,3),Q=>(c(),r("span",{key:Q,class:"tool-tag"},o(Z(Q)),1))),128)),y.availableTools.length>3?(c(),r("span",Ys," +"+o(y.availableTools.length-3),1)):M("",!0)])):M("",!0)],10,qs)}),128))])),s.value?(c(),r("div",Qs,[V(g(O),{icon:"carbon:loading",class:"loading-icon"}),P(" "+o(g(t)("common.loading")),1)])):M("",!0),!s.value&&v.length===0?(c(),r("div",Ws,[V(g(O),{icon:"carbon:bot",class:"empty-icon"}),e("p",null,o(g(t)("config.agentConfig.noAgent")),1)])):M("",!0),e("button",{class:"add-btn",onClick:U},[V(g(O),{icon:"carbon:add"}),P(" "+o(g(t)("config.agentConfig.createNew")),1)])]),d.value?(c(),r("div",Zs,[e("div",eo,[e("h3",null,o(d.value.name),1),e("div",to,[e("button",{class:"action-btn primary",onClick:z},[V(g(O),{icon:"carbon:save"}),P(" "+o(g(t)("common.save")),1)]),e("button",{class:"action-btn danger",onClick:m},[V(g(O),{icon:"carbon:trash-can"}),P(" "+o(g(t)("common.delete")),1)])])]),e("div",so,[e("label",null,[P(o(g(t)("config.agentConfig.agentName"))+" ",1),l[12]||(l[12]=e("span",{class:"required"},"*",-1))]),N(e("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=y=>d.value.name=y),placeholder:g(t)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,oo),[[X,d.value.name]])]),e("div",no,[e("label",null,[P(o(g(t)("config.agentConfig.description"))+" ",1),l[13]||(l[13]=e("span",{class:"required"},"*",-1))]),N(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=y=>d.value.description=y),rows:"3",placeholder:g(t)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,ao),[[X,d.value.description]])]),e("div",lo,[e("label",null,o(g(t)("config.agentConfig.nextStepPrompt")),1),N(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=y=>d.value.nextStepPrompt=y),rows:"8",placeholder:g(t)("config.agentConfig.nextStepPromptPlaceholder")},null,8,io),[[X,d.value.nextStepPrompt]])]),e("div",co,[e("h4",null,o(g(t)("config.agentConfig.toolConfiguration")),1),e("div",ro,[e("div",uo,[e("span",null,o(g(t)("config.agentConfig.assignedTools"))+" ("+o((d.value.availableTools||[]).length)+")",1),S.length>0?(c(),r("button",{key:0,class:"action-btn small",onClick:ie},[V(g(O),{icon:"carbon:add"}),P(" "+o(g(t)("config.agentConfig.addRemoveTools")),1)])):M("",!0)]),e("div",po,[(c(!0),r(j,null,K(d.value.availableTools||[],y=>(c(),r("div",{key:y,class:"tool-item assigned"},[e("div",go,[e("span",fo,o(Z(y)),1),e("span",vo,o(se(y)),1)])]))),128)),!d.value.availableTools||d.value.availableTools.length===0?(c(),r("div",ho,[V(g(O),{icon:"carbon:tool-box"}),e("span",null,o(g(t)("config.agentConfig.noAssignedTools")),1)])):M("",!0)])])])])):(c(),r("div",mo,[V(g(O),{icon:"carbon:bot",class:"placeholder-icon"}),e("p",null,o(g(t)("config.agentConfig.selectAgentHint")),1)]))]),V(_e,{modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=y=>k.value=y),title:g(t)("config.agentConfig.newAgent"),onConfirm:Y},{default:ne(()=>[e("div",yo,[e("div",_o,[e("label",null,[P(o(g(t)("config.agentConfig.agentName"))+" ",1),l[14]||(l[14]=e("span",{class:"required"},"*",-1))]),N(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=y=>E.name=y),placeholder:g(t)("config.agentConfig.agentNamePlaceholder"),required:""},null,8,bo),[[X,E.name]])]),e("div",Co,[e("label",null,[P(o(g(t)("config.agentConfig.description"))+" ",1),l[15]||(l[15]=e("span",{class:"required"},"*",-1))]),N(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=y=>E.description=y),rows:"3",placeholder:g(t)("config.agentConfig.descriptionPlaceholder"),required:""},null,8,$o),[[X,E.description]])]),e("div",wo,[e("label",null,o(g(t)("config.agentConfig.nextStepPrompt")),1),N(e("textarea",{"onUpdate:modelValue":l[5]||(l[5]=y=>E.nextStepPrompt=y),rows:"8",placeholder:g(t)("config.agentConfig.nextStepPromptPlaceholder")},null,8,ko),[[X,E.nextStepPrompt]])])])]),_:1},8,["modelValue","title"]),V(Gs,{modelValue:F.value,"onUpdate:modelValue":l[7]||(l[7]=y=>F.value=y),tools:S,"selected-tool-ids":((A=d.value)==null?void 0:A.availableTools)||[],onConfirm:de},null,8,["modelValue","tools","selected-tool-ids"]),V(_e,{modelValue:J.value,"onUpdate:modelValue":l[9]||(l[9]=y=>J.value=y),title:g(t)("config.agentConfig.deleteConfirm")},{footer:ne(()=>[e("button",{class:"cancel-btn",onClick:l[8]||(l[8]=y=>J.value=!1)},o(g(t)("common.cancel")),1),e("button",{class:"confirm-btn danger",onClick:u},o(g(t)("common.delete")),1)]),default:ne(()=>{var y;return[e("div",So,[V(g(O),{icon:"carbon:warning",class:"warning-icon"}),e("p",null,[P(o(g(t)("config.agentConfig.deleteConfirmText"))+" ",1),e("strong",null,o((y=d.value)==null?void 0:y.name),1),P(" "+o(g(t)("common.confirm"))+"？",1)]),e("p",To,o(g(t)("config.agentConfig.deleteWarning")),1)])]}),_:1},8,["modelValue","title"]),C.value?(c(),r("div",{key:0,class:"error-toast",onClick:l[10]||(l[10]=y=>C.value="")},[V(g(O),{icon:"carbon:error"}),P(" "+o(C.value),1)])):M("",!0),$.value?(c(),r("div",{key:1,class:"success-toast",onClick:l[11]||(l[11]=y=>$.value="")},[V(g(O),{icon:"carbon:checkmark"}),P(" "+o($.value),1)])):M("",!0)])}}}),Eo=ae(Ao,[["__scopeId","data-v-3c68f2f0"]]);class ve{static async getAllMcpServers(){const t=await fetch(`${this.BASE_URL}/list`);if(!t.ok)throw new Error(`Failed to get MCP server list: ${t.status}`);return await t.json()}static async addMcpServer(t){try{const s=await fetch(`${this.BASE_URL}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Failed to add MCP server: ${s.status}`);return{success:!0,message:"Successfully added MCP server"}}catch(s){return console.error("Failed to add MCP server:",s),{success:!1,message:s instanceof Error?s.message:"Failed to add, please retry"}}}static async removeMcpServer(t){try{const s=await fetch(`${this.BASE_URL}/remove?id=${t}`);if(!s.ok)throw new Error(`Failed to delete MCP server: ${s.status}`);return{success:!0,message:"Successfully deleted MCP server"}}catch(s){return console.error(`Failed to delete MCP server[${t}]:`,s),{success:!1,message:s instanceof Error?s.message:"Failed to delete, please retry"}}}}fe(ve,"BASE_URL","/api/mcp");const xo={class:"mcp-config-panel"},Vo={class:"mcp-header"},Po={class:"header-left"},Mo={class:"mcp-stats"},Uo={class:"stat-item"},Bo={class:"stat-value"},Go={class:"header-right"},Lo={class:"search-box"},Oo={key:0,class:"loading-container"},Fo={key:1,class:"mcp-layout"},Io={class:"mcp-table-container"},Ro={key:0,class:"empty-state"},No={class:"empty-state-text"},Do={key:1,class:"mcp-table-wrapper"},jo={class:"mcp-table"},Ko={class:"mcp-id"},qo={class:"mcp-server-name"},Jo={class:"server-name-content"},zo={class:"mcp-connection-type"},Ho={class:"mcp-config"},Xo=["title"],Yo={class:"mcp-actions"},Qo=["onClick","disabled"],Wo={class:"add-mcp-container"},Zo={class:"mcp-form"},en={class:"mcp-form-group"},tn={class:"connection-type-options"},sn={class:"connection-type-option"},on={class:"connection-type-option"},nn={class:"mcp-form-group"},an=["placeholder"],ln={class:"mcp-form-actions"},cn=["disabled"],rn=["disabled"],dn=le({__name:"mcpConfig",setup(I){const{t}=ge(),s=L(!1),C=L([]),$=L(""),v=ce({connectionType:"STUDIO",configJson:""}),d=ce({show:!1,text:"",type:"success"});q(()=>v.connectionType==="STUDIO"?t("config.mcpConfig.studioExample"):t("config.mcpConfig.sseExample"));const S=q(()=>v.configJson.trim().length>0),k=q(()=>{if(!$.value.trim())return C.value;const x=$.value.toLowerCase();return C.value.filter(f=>f.mcpServerName.toLowerCase().includes(x)||f.connectionType.toLowerCase().includes(x)||f.connectionConfig.toLowerCase().includes(x))}),J=x=>x?x.length>50?x.substring(0,50)+"...":x:"",F=(x,f="success")=>{d.text=x,d.type=f,d.show=!0,setTimeout(()=>{d.show=!1},3e3)},E=async()=>{try{s.value=!0,C.value=await ve.getAllMcpServers()}catch(x){console.error("加载MCP服务器列表失败:",x),F("加载MCP服务器列表失败","error")}finally{s.value=!1}},Z=async()=>{if(!S.value){F(t("config.mcpConfig.configRequired"),"error");return}try{JSON.parse(v.configJson)}catch{F(t("config.mcpConfig.invalidJson"),"error");return}try{s.value=!0;const x={connectionType:v.connectionType,configJson:v.configJson},f=await ve.addMcpServer(x);f.success?(F("添加MCP服务器成功"),B(),await E()):F(f.message||t("config.mcpConfig.addFailed"),"error")}catch(x){console.error("添加MCP服务器失败:",x),F(t("config.mcpConfig.addFailed"),"error")}finally{s.value=!1}},se=async x=>{if(confirm("确定要删除这个MCP服务器配置吗？此操作不可恢复。"))try{s.value=!0;const f=await ve.removeMcpServer(x);f.success?(F("删除MCP服务器成功"),await E()):F(f.message||t("config.mcpConfig.deleteFailed"),"error")}catch(f){console.error("删除MCP服务器失败:",f),F(t("config.mcpConfig.deleteFailed"),"error")}finally{s.value=!1}},B=()=>{v.connectionType="STUDIO",v.configJson=""};return be(()=>{E()}),(x,f)=>(c(),r("div",xo,[e("div",Vo,[e("div",Po,[f[5]||(f[5]=e("h2",null,"MCP配置",-1)),e("div",Mo,[e("span",Uo,[f[4]||(f[4]=e("span",{class:"stat-label"},"总服务器:",-1)),e("span",Bo,o(C.value.length),1)])])]),e("div",Go,[e("div",Lo,[N(e("input",{"onUpdate:modelValue":f[0]||(f[0]=U=>$.value=U),type:"text",placeholder:"搜索MCP服务器...",class:"search-input"},null,512),[[X,$.value]]),f[6]||(f[6]=e("span",{class:"search-icon"},"🔍",-1))])])]),s.value?(c(),r("div",Oo,f[7]||(f[7]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在加载MCP服务器...",-1)]))):(c(),r("div",Fo,[e("div",Io,[f[11]||(f[11]=e("h3",{class:"section-title"},"已配置的MCP服务器",-1)),k.value.length===0?(c(),r("div",Ro,[f[8]||(f[8]=e("div",{class:"empty-state-icon"},"📂",-1)),e("div",No,o($.value?"未找到匹配的MCP服务器":"暂无MCP服务器配置"),1)])):(c(),r("div",Do,[e("table",jo,[f[10]||(f[10]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"服务器名称"),e("th",null,"连接类型"),e("th",null,"连接配置"),e("th",null,"操作")])],-1)),e("tbody",null,[(c(!0),r(j,null,K(k.value,U=>(c(),r("tr",{key:U.id,class:"mcp-row"},[e("td",Ko,o(U.id),1),e("td",qo,[e("div",Jo,[f[9]||(f[9]=e("span",{class:"server-icon"},"🔌",-1)),P(" "+o(U.mcpServerName),1)])]),e("td",zo,[e("span",{class:W(["connection-type-badge",U.connectionType.toLowerCase()])},o(U.connectionType),3)]),e("td",Ho,[e("div",{class:"config-preview",title:U.connectionConfig},o(J(U.connectionConfig)),9,Xo)]),e("td",Yo,[e("button",{onClick:Y=>se(U.id),class:"action-btn delete-btn",disabled:s.value}," 删除 ",8,Qo)])]))),128))])])]))]),e("div",Wo,[f[16]||(f[16]=e("div",{class:"add-mcp-header"},[e("h3",{class:"add-mcp-title"},"添加MCP服务器")],-1)),e("div",Zo,[e("div",en,[f[14]||(f[14]=e("label",{class:"form-label"},"连接类型：",-1)),e("div",tn,[e("div",sn,[N(e("input",{type:"radio",id:"mcp-connection-type-studio","onUpdate:modelValue":f[1]||(f[1]=U=>v.connectionType=U),value:"STUDIO"},null,512),[[Se,v.connectionType]]),f[12]||(f[12]=e("label",{for:"mcp-connection-type-studio",class:"radio-label"},[e("span",{class:"radio-title"},"STUDIO"),e("span",{class:"connection-type-desc"},"本地mcp server，目前市面上主流的是这个")],-1))]),e("div",on,[N(e("input",{type:"radio",id:"mcp-connection-type-sse","onUpdate:modelValue":f[2]||(f[2]=U=>v.connectionType=U),value:"SSE"},null,512),[[Se,v.connectionType]]),f[13]||(f[13]=e("label",{for:"mcp-connection-type-sse",class:"radio-label"},[e("span",{class:"radio-title"},"SSE"),e("span",{class:"connection-type-desc"},"通过http server等提供的，目前网络上比较少见")],-1))])])]),e("div",nn,[f[15]||(f[15]=e("label",{class:"form-label"},"mcp json配置：",-1)),N(e("textarea",{"onUpdate:modelValue":f[3]||(f[3]=U=>v.configJson=U),placeholder:g(t)("config.mcpConfig.configJsonPlaceholder"),class:"config-textarea",rows:"6"},null,8,an),[[X,v.configJson]])]),e("div",ln,[e("button",{onClick:Z,class:"action-btn add-btn",disabled:s.value},o(g(t)("common.add")),9,cn),e("button",{onClick:B,class:"action-btn reset-btn",disabled:s.value},o(g(t)("common.reset")),9,rn)])]),f[17]||(f[17]=Be('<div class="mcp-form-instructions" data-v-2a25ee6b><h4 data-v-2a25ee6b>使用说明：</h4><ol data-v-2a25ee6b><li data-v-2a25ee6b>找到你要用的mcp server的配置json： <ul class="indented-list" data-v-2a25ee6b><li data-v-2a25ee6b><strong data-v-2a25ee6b>本地(STDIO)</strong>：可以在<a href="https://mcp.so" target="_blank" rel="noopener" data-v-2a25ee6b>mcp.so</a>上找到，需要你有Node.js环境并理解你要配置的json里面的每一个项，做对应调整比如配置ak</li><li data-v-2a25ee6b><strong data-v-2a25ee6b>远程服务(SSE)</strong>：<a href="https://mcp.higress.ai/" target="_blank" rel="noopener" data-v-2a25ee6b>mcp.higress.ai/</a>上可以找到，有SSE和STREAMING两种，目前SSE协议更完备一些</li></ul></li><li data-v-2a25ee6b>将json配置复制到上面的输入框，本地选STUDIO，远程选STREAMING或SSE，提交</li><li data-v-2a25ee6b>这样mcp tools就注册成功了。</li><li data-v-2a25ee6b>然后需要在Agent配置里面，新建一个agent，然后增加指定你刚才添加的mcp tools，这样可以极大减少冲突，增强tools被agent选择的准确性</li></ol></div>',1))])])),V(Ce,{name:"message-fade"},{default:ne(()=>[d.show?(c(),r("div",{key:0,class:W(["message-toast",d.type])},o(d.text),3)):M("",!0)]),_:1})]))}}),un=ae(dn,[["__scopeId","data-v-2a25ee6b"]]),pn={class:"config-container"},gn={class:"config-header"},fn={class:"header-actions"},vn={class:"config-content"},hn={class:"config-nav"},mn=["onClick"],yn={class:"config-details"},_n=le({__name:"index",setup(I){const{t}=ge(),s=L("basic"),C=q(()=>[{key:"basic",label:t("config.categories.basic"),icon:"carbon:settings"},{key:"agent",label:t("config.categories.agent"),icon:"carbon:bot"},{key:"mcp",label:t("config.categories.mcp"),icon:"carbon:tool-box"}]);return($,v)=>(c(),r("div",pn,[e("div",gn,[e("div",fn,[V(Ge),e("button",{class:"action-btn",onClick:v[0]||(v[0]=d=>$.$router.push("/"))},[V(g(O),{icon:"carbon:arrow-left"}),P(" "+o($.$t("backHome")),1)])])]),e("div",vn,[e("nav",hn,[(c(!0),r(j,null,K(C.value,(d,S)=>(c(),r("div",{key:S,class:W(["nav-item",{active:s.value===d.key}]),onClick:k=>s.value=d.key},[V(g(O),{icon:d.icon,width:"20"},null,8,["icon"]),e("span",null,o(d.label),1)],10,mn))),128))]),e("div",yn,[s.value==="basic"?(c(),re(ds,{key:0})):M("",!0),s.value==="agent"?(c(),re(Eo,{key:1})):M("",!0),s.value==="mcp"?(c(),re(un,{key:2})):M("",!0)])])]))}}),kn=ae(_n,[["__scopeId","data-v-109cfe5c"]]);export{kn as default};

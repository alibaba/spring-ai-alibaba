"use strict";(self.webpackChunk_ice_lite_scaffold=self.webpackChunk_ice_lite_scaffold||[]).push([[792],{1366:function(t,e,n){var a=n(8188),i=n(9291),r=n(7294),l=n(3335),o=n(1133),u=n(7963),s=n(6981),c=n(1034),d=n(9166),p=n(5742),f=n(7893),g={whiteSpace:"pre-wrap",wordWrap:"break-word",overflow:"auto"};e.Z=function(t){var e=t.record,n=t.open,h=t.setOpen,m=(0,f.$G)(),v=m.t;m.i18n;var Z=(0,a._)(r.useState({title:"chat_client",input:"What is a document loader?",output:"A document loader is a tool used to load and process documents for various tasks such as text analysis, information extraction, and more."}),2),y=Z[0],k=Z[1];(0,r.useEffect)(function(){k({input:e.input,output:e.output,title:e.model})},[e]);var I=function(t){var n=[];Object.keys(t.attributes||[]).forEach(function(e){n.push({name:e,value:t.attributes[e]})});var a=JSON.parse(JSON.stringify(t));0==a.input.length&&(a.input=e.input),0==a.output.length&&(a.output=e.output),a.attributes=n,k(a)};return(0,i.tZ)("div",{children:(0,i.tZ)(l.Z,{title:"Trace Detail",width:"90%",onClose:function(){return h(!1)},open:n,children:(0,i.BX)(o.Z,{children:[(0,i.tZ)(u.Z,{span:6,style:{whiteSpace:"nowrap",overflowX:"auto",width:"100%",borderRight:"1px solid #d9d9d9",paddingRight:"10px"},children:(0,i.tZ)(s.Z,{onSelect:function(t,e){return I(e.selectedNodes[0])},showLine:!0,showIcon:!0,defaultExpandAll:!0,treeData:[e.traceDetail]})}),(0,i.tZ)(u.Z,{span:18,children:(0,i.tZ)(c.Z,{title:y.title,extra:(0,i.tZ)(d.ZP,{disabled:!0,children:v("gotoDebug")}),children:(0,i.BX)(o.Z,{children:[(0,i.BX)(u.Z,{span:16,style:{paddingRight:10},children:[(0,i.tZ)(c.Z,{title:"Input",style:{marginTop:10},children:(0,i.tZ)("pre",{style:g,children:JSON.stringify(y.input,null,2)})}),(0,i.tZ)(c.Z,{title:"Output",style:{marginTop:10},children:(0,i.tZ)("pre",{style:g,children:JSON.stringify(y.output,null,2)})}),(0,i.tZ)(c.Z,{title:"Messages",style:{marginTop:10},children:"aaa"})]}),(0,i.tZ)(u.Z,{span:7,children:(0,i.tZ)(p.Z,{pagination:!1,columns:[{title:"Name",dataIndex:"name"},{title:"Value",dataIndex:"value"}],dataSource:(null==y?void 0:y.attributes)||[]})})]})})})]})})})}},9287:function(t,e,n){n.r(e),n.d(e,{default:function(){return y}});var a=n(1010),i=n(8188),r=n(2729),l=n(7582),o=n(9291),u=n(5893),s=n(7294),c=n(2619),d=n(1034),p=n(5742),f=n(5958),g=n(1366),h=n(4070),m=n(6755);function v(){var t=(0,r._)(["\n      ","-table {\n        ","-table-container {\n          ","-table-body,\n          ","-table-content {\n            scrollbar-width: thin;\n            scrollbar-color: #eaeaea transparent;\n            scrollbar-gutter: stable;\n          }\n        }\n      }\n    "]);return v=function(){return t},t}var Z=(0,f.kc)(function(t){var e=t.css,n=t.token.antCls;return{customTable:e(v(),n,n,n,n)}});function y(){var t,e=(0,i._)((0,s.useState)([]),2),n=e[0],r=e[1],f=(0,i._)((0,s.useState)(!1),2),v=f[0],y=f[1],k=(0,i._)((0,s.useState)({}),2),I=k[0],_=k[1],b=[{title:"id",dataIndex:"id",key:"id",fixed:"left",width:100,ellipsis:!0,render:function(t,e){return(0,o.BX)("div",{style:{width:100},children:[(0,o.tZ)("a",{onClick:function(){_(e),y(!0)},style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),"..."]})}},{title:"timestamp",dataIndex:"timestamp",key:"timestamp",ellipsis:!0,width:100},{title:"name",dataIndex:"name",key:"name"},{title:"model",dataIndex:"model",filters:[{text:"gpt\u7CFB\u5217\u6A21\u578B",value:"gpt"},{text:"Claude\u7CFB\u5217",value:"claude"}],key:"model",onFilter:function(t,e){return e.model.startsWith(t)}},{title:"latency",key:"latencyMilliseconds",dataIndex:"latencyMilliseconds",render:function(t,e){var n=e.latencyMilliseconds;return(0,o.BX)("div",{children:[n," ms"]})}},{title:"usageDetails",dataIndex:"usageDetails",key:"usageDetails",render:function(t,e){var n=e.usageDetails;return(0,o.tZ)("span",{children:"".concat(null==n?void 0:n.input," \u2192 ").concat(null==n?void 0:n.output," (\u2211 ").concat(null==n?void 0:n.total,")")})}},{title:"Total Cost",dataIndex:"costDetails",key:"costDetails",render:function(t,e){var n=e.costDetails;return(0,o.tZ)("span",{children:"".concat(null==n?void 0:n.total,"$")})}},{title:"tags",key:"tags",dataIndex:"tags",render:function(t,e){var n=e.tags;return(0,o.tZ)(u.Fragment,{children:n.map(function(t){var e=t.length>5?"geekblue":"green";return"loser"===t&&(e="volcano"),(0,o.tZ)(c.Z,{color:e,children:t.toUpperCase()},t)})})}},{title:"calculatedTotalCost",key:"calculatedTotalCost",dataIndex:"calculatedTotalCost"},{title:"calculatedInputCost",key:"calculatedInputCost",dataIndex:"calculatedInputCost"},{title:"calculatedOutputCost",key:"calculatedOutputCost",dataIndex:"calculatedOutputCost"},{title:"Action",key:"operation",fixed:"right",width:100,render:function(){return(0,o.tZ)("a",{children:"\u67E5\u770B\u8BE6\u60C5"})}}],x=Z().styles,w=(t=(0,a._)(function(){var t;return(0,l.Jh)(this,function(e){switch(e.label){case 0:return[4,m.Z.getTraceDetailClient()];case 1:return console.log(t=e.sent()),r(t.map(function(t){var e=(0,h.l)(t);return console.log(e),e}).filter(function(t){return null!==t})),[2]}})}),function(){return t.apply(this,arguments)});return(0,s.useEffect)(function(){w()},[]),(0,o.tZ)("div",{children:(0,o.BX)(d.Z,{title:"Traces",children:[(0,o.tZ)(p.Z,{className:x.customTable,columns:b,dataSource:n,scroll:{x:"max-content"},rowKey:function(t){return t.id}}),(0,o.tZ)(g.Z,{record:I,open:v,setOpen:y})]})})}},6755:function(t,e,n){var a=n(1010),i=n(7582),r=n(7647);e.Z={getTraceDetailClient(){return(0,a._)(function(){return(0,i.Jh)(this,function(t){switch(t.label){case 0:return[4,(0,r.WY)("/studio/api/observation/getAITraceInfo")];case 1:return[2,t.sent()]}})})()},getTraceDetailClientById(t){return(0,a._)(function(){return(0,i.Jh)(this,function(e){switch(e.label){case 0:return[4,(0,r.WY)({url:"/studio/api/observation/detail?traceId=".concat(t),method:"get"})];case 1:return[2,e.sent()]}})})()}}},4070:function(t,e,n){function a(t){var e,n=t.scopeSpans.flatMap(function(t){return t.spans});if(n.length<2)return null;var a=new Map,r=0,l=0,o=0,u="",s="",c="";n.forEach(function(t){var e=t.attributes.reduce(function(t,e){return t[e.key]=e.value.stringValue,t},{}),n=i(t,"gen_ai.content.prompt")||"",d=i(t,"gen_ai.content.completion")||"";e["gen_ai.usage.input_tokens"]&&(r+=parseInt(e["gen_ai.usage.input_tokens"],10)),e["gen_ai.usage.output_tokens"]&&(l+=parseInt(e["gen_ai.usage.output_tokens"],10)),e["gen_ai.usage.total_tokens"]&&(o+=parseInt(e["gen_ai.usage.total_tokens"],10)),e["gen_ai.request.model"]&&(u=e["gen_ai.request.model"]),"chat"==e["gen_ai.operation.name"]&&(u=e["gen_ai.request.model"],t.events.forEach(function(t){var e=t.attributes.reduce(function(t,e){return t[e.key]=e.value.arrayValue.values.map(function(t){return{input:t.stringValue}}),t},{});e["gen_ai.prompt"]&&(s=e["gen_ai.prompt"]),e["gen_ai.completion"]&&(c=e["gen_ai.completion"])}));var p=t.endTimeUnixNano-t.startTimeUnixNano;a.set(t.spanId,{title:"".concat(t.name,"   ").concat((p/1e9).toFixed(2),"s"),input:n,key:t.spanId,output:d,attributes:e,costTime:p,detail:{},children:[]})}),n.forEach(function(t){if(t.parentSpanId&&a.has(t.parentSpanId)){var e=a.get(t.parentSpanId);e&&e.children.push(a.get(t.spanId))}});var d=n.find(function(t){return!t.parentSpanId});return d?(d.attributes.reduce(function(t,e){return t[e.key]=e.value.stringValue,t},{}),{id:d.traceId,latencyMilliseconds:(e=d.startTimeUnixNano,(parseInt(d.endTimeUnixNano,10)-parseInt(e,10))/1e6).toString(),model:u,promptTokens:r,completionTokens:l.toString(),totalTokens:o.toString(),tags:[],calculatedTotalCost:"0.0",calculatedInputCost:"0.0",calculatedOutputCost:"0.0",usageDetails:{input:r.toString(),output:l.toString(),total:o.toString()},input:s,output:c,timestamp:d.endTimeUnixNano,costDetails:{input:"0.0",output:"0.0",total:"0.0"},traceDetail:a.get(d.spanId)}):null}function i(t,e){var n=t.attributes.find(function(t){return t.key===e});return n?n.value.stringValue:void 0}n.d(e,{l:function(){return a}})}}]);
"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[4215,3185],{29944:function(Be,ye,t){t.d(ye,{Z:function(){return me}});var N=t(42035),i=t.n(N),X=t(13311),O=t.n(X),te=t(22453),se=t(18809),F=t(64251),B=t(72624),de=t(45753),re=t(2821),n=t(5693),q=t(35899),K=t(71938),J=t(73088),y=t(51747),T=t(4513),le=t(94815),ue=t(55432),l=t(2784),ce={"model-selector-form-label":"model-selector-form-label___Oy0rU"},oe=t(52322),ne=function(L){if(L===void 0)return 1;var d=Math.pow(.1,L);return Number(d.toFixed(L))},Se=(0,l.memo)(function(z){var L=z.value,d=z.onChange,H=z.schemaList,ie=z.disabled,Q=function(ae,W){var E=H.map(function(A){var V=L.find(function($){return $.key===A.code});return A.code===ae?O()({key:A==null?void 0:A.code,type:A.type,value:A.default_value,enable:V==null?void 0:V.enable},W):{key:A==null?void 0:A.code,type:A.type,value:(V==null?void 0:V.value)||A.default_value,enable:(V==null?void 0:V.enable)||!1}});d(E)},ee=(0,l.useMemo)(function(){return H!=null&&H.length?(0,oe.jsx)("div",{className:"flex flex-col gap-3",children:H.map(function(M){var ae,W=L.find(function(E){return E.key===M.code});return(0,oe.jsxs)("div",{className:"flex-justify-between gap-5",children:[(0,oe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,oe.jsx)(q.Z,{checked:!!(W!=null&&W.enable),disabled:ie,onChange:function(A){return Q(M.code,{enable:A.target.checked})}}),(0,oe.jsx)(K.Z.Text,{className:ce["model-selector-form-label"],ellipsis:{tooltip:M.name},style:{width:78},children:M.name})]}),M.type==="Number"&&(0,oe.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,oe.jsx)(F.Z,{disabled:!(W!=null&&W.enable)||ie,style:{width:236},onChange:function(A){return Q(M.code,{value:A})},min:M.min,max:M.max,step:ne(M.precision),value:(W==null?void 0:W.value)||M.default_value}),(0,oe.jsx)(J.Z,{disabled:!(W!=null&&W.enable)||ie,style:{width:70},precision:M.precision,value:(W==null?void 0:W.value)||M.default_value,onChange:function(A){return Q(M.code,{value:A})}})]}),M.type==="String"&&(M.options?(0,oe.jsx)(y.Z,{value:(W==null?void 0:W.value)||((ae=M.options)===null||ae===void 0?void 0:ae[0]),disabled:!(W!=null&&W.enable)||ie,className:"w-full",options:M.options.map(function(E){return{label:E,value:E}}),onSelect:function(A){return Q(M.code,{value:A})}}):(0,oe.jsx)(T.Z,{disabled:!(W!=null&&W.enable)||ie,className:"flex-1",value:(W==null?void 0:W.value)||M.default_value,onChange:function(A){return Q(M.code,{value:A.target.value})}})),M.type==="Boolean"&&(0,oe.jsx)(le.Z,{disabled:!(W!=null&&W.enable)||ie,checked:(W==null?void 0:W.value)||M.default_value,onChange:function(A){return Q(M.code,{value:A})}})]},M.code)})}):te.Z.get({id:"main.components.ModelConfigForm.index.selectModelFirst",dm:"\u8BF7\u5148\u9009\u62E9\u6A21\u578B"})},[L,d,H]);return(0,oe.jsx)(ue.Z,{placement:"bottomLeft",content:ee,trigger:["click"],children:(0,oe.jsx)(B.Z,{icon:(0,oe.jsx)(de.Z,{type:"spark-modify-line"})})})}),G=(0,l.memo)(function(z){var L=z.onChange,d=z.onSelect,H=z.value,ie=z.modelOptions,Q=ie===void 0?[]:ie,ee=z.disabled,M=(0,re.Z)({schemaList:[]}),ae=i()(M,2),W=ae[0],E=ae[1],A=function($,pe){var e;!((e=H.provider)!==null&&e!==void 0&&e.length)&&!(pe!=null&&pe.length)||!($!=null&&$.length)||(0,se.nd)(pe||H.provider,$).then(function(ge){E({schemaList:ge.data})})};return(0,n.Z)(function(){H.model_id&&A(H.model_id)}),(0,oe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,oe.jsx)(y.Z,{disabled:ee,placeholder:te.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.selectModel",dm:"\u8BF7\u9009\u62E9\u6A21\u578B"}),className:"flex-1 w-[240px]",value:H.model_id?H.model_id:void 0,options:Q,onChange:function($,pe){var e=$.split("@@@"),ge=i()(e,2),ke=ge[0],ve=ge[1];if(A(ve,ke),Array.isArray(pe)){var fe,We;d((fe=pe[0])===null||fe===void 0?void 0:fe.extra,(We=pe[0])===null||We===void 0?void 0:We.extra)}else d(pe==null?void 0:pe.extra,pe==null?void 0:pe.extra)}}),(0,oe.jsx)(Se,{disabled:ee,schemaList:W.schemaList,value:H.params,onChange:function($){L($)}})]})}),w=function(L){var d=L.value,H=L.onChange,ie=L.onSelectedModelChange,Q=L.disabled,ee=(0,l.useState)(null),M=i()(ee,2),ae=M[0],W=M[1],E=(0,re.Z)({modelOptions:[]}),A=i()(E,2),V=A[0],$=A[1];return(0,l.useEffect)(function(){ae&&(ie==null||ie(ae))},[ae]),(0,n.Z)(function(){(0,se.B7)("llm").then(function(pe){var e=pe.data.map(function(ge){return{label:ge.provider.name,options:ge.models.map(function(ke){return{label:ke.name||"",value:"".concat(ke.provider,"@@@").concat(ke.model_id),extra:ke}})}});$({modelOptions:e}),e.forEach(function(ge){ge.options.forEach(function(ke){ke.value.split("@@@")[1]===d.model_id&&W(ke.extra)})})})}),(0,oe.jsx)(oe.Fragment,{children:(0,oe.jsx)(G,{disabled:Q,onSelect:function(e,ge){W(ge),H({model_id:e.model_id,provider:e.provider,params:[]},ge)},onChange:function(e){H({model_id:ae==null?void 0:ae.model_id,provider:ae==null?void 0:ae.provider,params:e},ae)},value:d,modelOptions:V.modelOptions})})},me=(0,l.memo)(w)},19110:function(Be,ye){ye.Z={agentSystemPromptMaxLength:1e4,agentUserPromptMaxLength:1e4,agentAgentComponentMaxLimit:5,agentWorkflowComponentMaxLimit:5,agentKnowledgeBaseMaxLimit:10,agentMcpMaxLimit:5,agentToolMaxLimit:10,agentPresetQuestionMaxLimit:5,agentWelcomeMessageMaxLength:2e3,agentSSETimeout:"180000"}},1433:function(Be,ye,t){t.d(ye,{H:function(){return i}});var N=t(2784),i=N.createContext({})},30332:function(Be,ye,t){t.d(ye,{Z:function(){return de}});var N=t(22453),i=t(47202),X=t(92748),O=t(72580),te=t(91030),se={appStatus:"appStatus___nP3Su",tagName:"tagName___kc_Ei",backWrap:"backWrap___D7GLU",draft:"draft___CEd7j",publish:"publish___Gi4bv",draftAndPublish:"draftAndPublish____tE0a"},F=t(52322),B=function(re){return re.draft="",re.published="blue",re.published_editing="blue",re}(B||{});function de(re){var n=re.appStatus,q=re.autoSaveTime;return(0,F.jsxs)(te.Z,{className:se.appStatus,align:"center",children:[(0,F.jsx)(X.Z,{color:B[n],children:i.w[n]}),!!q&&(0,F.jsx)("div",{className:"text-[12px] leading-[32px]",style:{color:"var(--ag-ant-color-text-quaternary)"},children:(0,F.jsx)(O.Z,{tooltip:N.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppStatus.index.autosavedOn",dm:"\u5DF2\u4E8E{var1}\u81EA\u52A8\u4FDD\u5B58"},{var1:q}),children:N.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppStatus.index.autosavedOn",dm:"\u5DF2\u4E8E{var1}\u81EA\u52A8\u4FDD\u5B58"},{var1:q})})})]})}},95423:function(Be,ye,t){t.d(ye,{Z:function(){return ee}});var N=t(49616),i=t.n(N),X=t(12323),O=t.n(X),te=t(63260),se=t.n(te),F=t(87329),B=t.n(F),de=t(42035),re=t.n(de),n=t(22453),q=t(1905),K=t(3318),J=t(11246),y=t(8822),T=t(19612),le=t(45753),ue=t(72624),l=t(2821),ce=t(5693),oe=t(91030),ne=t(71938),Se=t(91569),G=t(12524),w=t.n(G),me=t(28879),z=t.n(me),L=t(2784),d=t(41714),H={historyPanelWrapper:"historyPanelWrapper___CqG_l",header:"header___J9GOr",list:"list___FD4Eg",timelineItemWrapper:"timelineItemWrapper___xrKvt",more:"more___f4JgB",hover:"hover___D2STt",timelineTitle:"timelineTitle___AzIyu",selected:"selected___YwyS9",disabled:"disabled___uTGSK",desc:"desc___FbgyA",inUse:"inUse___xh1Ov",timelineNew:"timelineNew___AUFoo",footer:"footer___BTO8j"},ie=t(52322),Q=function(ae){var W=ae.selected,E=ae.onSelect,A=ae.version,V=ae.versionConfig,$=ae.disabled,pe=ae.index,e=(0,L.useState)(!1),ge=re()(e,2),ke=ge[0],ve=ge[1];return(0,ie.jsx)("div",{className:w()(H.timelineItemWrapper,B()(B()(B()({},H.selected,W),H.disabled,$),H.hover,ke)),onClick:function(){if(A==="draft")return E("draft");E(A,pe)},onMouseOver:function(){ve(!0)},onMouseLeave:function(){ve(!1)},children:A==="draft"?(0,ie.jsx)("div",{style:{position:"relative"},children:n.Z.get({id:"main.components.HistoryPanel.index.currentDraft",dm:"\u5F53\u524D\u8349\u7A3F"})}):V&&(0,ie.jsxs)("div",{style:{position:"relative"},children:[(0,ie.jsx)(oe.Z,{justify:"space-between",align:"center",children:(0,ie.jsxs)(oe.Z,{gap:4,justify:"left",children:[pe===0?(0,ie.jsx)("div",{className:H.timelineTitle,children:n.Z.get({id:"main.components.HistoryPanel.index.liveVersion",dm:"\u7EBF\u4E0A\u7248\u672C"})}):(0,ie.jsxs)("div",{className:H.timelineTitle,children:[z()(V.gmt_modified).format("YYYY-MM-DD"),n.Z.get({id:"main.components.HistoryPanel.index.version",dm:"\u7248\u672C"})]}),pe===0&&(0,ie.jsx)("div",{className:H.timelineNew,children:n.Z.get({id:"main.components.HistoryPanel.index.latest",dm:"\u6700\u65B0"})})]})}),(0,ie.jsx)(oe.Z,{className:H.desc,children:z()(V.gmt_modified).format("YYYY-MM-DD HH:mm:ss")}),(0,ie.jsxs)(oe.Z,{className:H.desc,children:[(0,ie.jsx)("span",{style:{whiteSpace:"nowrap"},children:n.Z.get({id:"main.components.HistoryPanel.index.versionId",dm:"\u7248\u672CID\uFF1A"})}),V.version]}),(0,ie.jsxs)(oe.Z,{className:H.desc,children:[(0,ie.jsx)("span",{style:{whiteSpace:"nowrap"},children:n.Z.get({id:"main.components.HistoryPanel.index.publisher",dm:"\u53D1\u5E03\u4EBA\uFF1A"})}),(0,ie.jsx)(ne.Z.Text,{ellipsis:{tooltip:(0,K.rb)(V.modifier||"")},children:V.modifier})]})]})})};function ee(M){var ae=M.selectedVersion,W=ae===void 0?"draft":ae,E=M.appDetail,A=M.onSelectVersion,V=(0,l.Z)({versionConfigList:[],curConfig:null,pageNo:1}),$=re()(V,2),pe=$[0],e=$[1],ge=(0,L.useCallback)(function(){(0,q.Df)({app_id:E.app_id,current:pe.pageNo,size:10,status:"published"}).then(function(ve){e({versionConfigList:ve.data.records})})},[E.app_id]);(0,ce.Z)(function(){ge()}),(0,d.Z)("history-panel-fresh",ge);var ke=function(){J.Z.warning({title:n.Z.get({id:"main.components.HistoryPanel.index.confirmUseVersion",dm:"\u662F\u5426\u786E\u8BA4\u4F7F\u7528\u6B64\u7248\u672C\u5185\u5BB9"}),children:n.Z.get({id:"main.components.HistoryPanel.index.overwriteDraft",dm:"\u786E\u8BA4\u540E\uFF0C\u4F1A\u4F7F\u7528\u6B64\u7248\u672C\u8986\u76D6\u5F53\u524D\u8349\u7A3F\u5185\u5BB9\uFF01"}),onOk:function(){var fe=se()(O()().mark(function Ve(){var Re,Ae,xe,Ne;return O()().wrap(function(je){for(;;)switch(je.prev=je.next){case 0:if(E){je.next=2;break}return je.abrupt("return");case 2:return je.t1=y.CX,je.next=5,(0,q.YI)(E.app_id,W);case 5:if(je.t3=Re=je.sent,je.t2=je.t3===null,je.t2){je.next=9;break}je.t2=Re===void 0;case 9:if(!je.t2){je.next=13;break}je.t4=void 0,je.next=14;break;case 13:je.t4=Re.data.config;case 14:if(je.t5=je.t4,je.t0=(0,je.t1)(je.t5),je.t0){je.next=18;break}je.t0={};case 18:return Ae=je.t0,je.next=21,(0,q.KT)({app_id:E.app_id,name:E.name,description:E.description,config:Ae});case 21:A("draft"),ge(),xe=pe.versionConfigList.find(function(Ue){return Ue.version===W}),xe&&(Ne=n.Z.get({id:"main.components.HistoryPanel.index.returnedTo",dm:"\u5DF2\u56DE\u5230"})+z()(xe.gmt_modified).format("YYYY-MM-DD")+n.Z.get({id:"main.components.HistoryPanel.index.version",dm:"\u7248\u672C"}),T.Z.success(Ne));case 25:case"end":return je.stop()}},Ve)}));function We(){return fe.apply(this,arguments)}return We}()})};return(0,ie.jsxs)(oe.Z,{className:H.historyPanelWrapper,vertical:!0,children:[(0,ie.jsxs)("div",{className:H.header,children:[(0,ie.jsx)("div",{className:H.title,children:n.Z.get({id:"main.components.HistoryPanel.index.historyVersion",dm:"\u5386\u53F2\u7248\u672C"})}),(0,ie.jsx)(le.Z,{type:"spark-false-line",isCursorPointer:!0,onClick:function(){M.onClose()}})]}),(0,ie.jsx)("div",{className:H.list,children:(0,ie.jsx)(Se.Z,{items:[{children:(0,ie.jsx)(Q,{selected:W==="draft",onSelect:function(){return M.hasInitData&&A("draft")},version:"draft"}),color:W==="draft"?"var(--ag-ant-color-primary)":"var(--ag-ant-color-text-description)"}].concat(i()(pe.versionConfigList.map(function(ve,fe){return{children:(0,ie.jsx)(Q,{selected:W===ve.version,onSelect:function(Ve){M.hasInitData&&A(Ve,fe)},versionConfig:ve,version:ve.version,index:fe}),color:W===ve.version?"var(--ag-ant-color-primary)":"var(--ag-ant-color-text-description)"}})))})}),(0,ie.jsx)(oe.Z,{className:H.footer,align:"center",children:(0,ie.jsx)(ue.Z,{disabled:W==="draft",type:"primary",onClick:ke,children:n.Z.get({id:"main.components.HistoryPanel.index.overwriteDraft",dm:"\u8986\u76D6\u5F53\u524D\u8349\u7A3F"})})})]})}},20585:function(Be,ye,t){t.d(ye,{IM:function(){return l},ZP:function(){return oe}});var N=t(42035),i=t.n(N),X=t(19110),O=t(22453),te=t(43065),se=t(45753),F=t(69045),B=t(72624),de=t(2821),re=t(91030),n=t(81596),q=t(12524),K=t.n(q),J=t(2784),y=t(1433),T=t(90390),le={filters:"filters___C4UkM",loading:"loading___CR425",toolSelector:"toolSelector___fnjjS",page:"page___Zpmzi",titleWrap:"titleWrap___YPyUE",title:"title___EEdeZ",right:"right___sNk34",container:"container___D8Qd_",subArea:"subArea___QRYlt",expandBtn:"expandBtn___T5hR5",hidden:"hidden___ooNP0",footer:"footer___t1ciB",left:"left___hTSci",show:"show___Xj8N3",emptyCon:"emptyCon___MjnIA"},ue=t(52322),l=X.Z.agentToolMaxLimit;function ce(ne){var Se=ne.tool,G=ne.handleRemoveTool;return(0,ue.jsx)(T.Z,{iconType:"spark-plugin-line",name:Se.name,rightArea:(0,ue.jsx)(se.Z,{type:"spark-delete-line",isCursorPointer:!0,onClick:function(){G(Se)}})})}function oe(){var ne,Se=(0,J.useContext)(y.H),G=Se.appState,w=Se.onAppConfigChange,me=((ne=G.appBasicConfig)===null||ne===void 0?void 0:ne.config)||{},z=me.tools,L=z===void 0?[]:z,d=(0,de.Z)({expand:!1,selectVisible:!1}),H=i()(d,2),ie=H[0],Q=H[1],ee=function(W){w({tools:W})};(0,J.useEffect)(function(){L.length&&Q({expand:!0})},[L]);var M=function(W){ee(L.filter(function(E){return E.tool_id!==W.tool_id}))};return(0,ue.jsxs)(re.Z,{vertical:!0,gap:6,className:"mb-[20px]",children:[(0,ue.jsxs)("div",{className:le.titleWrap,children:[(0,ue.jsxs)(re.Z,{gap:8,className:"text-[13px] font-medium leading-[20px]",style:{color:"var(--ag-ant-color-text)"},align:"center",children:[(0,ue.jsxs)(re.Z,{align:"center",children:[(0,ue.jsx)("span",{children:O.Z.get({id:"main.components.PluginSelectorComp.index.plugin",dm:"\u63D2\u4EF6"})}),(0,ue.jsx)(F.Z,{content:O.Z.get({id:"main.components.PluginSelectorComp.index.callOpenApi",dm:"\u667A\u80FD\u4F53\u53EF\u4EE5\u901A\u8FC7\u63D2\u4EF6\u4E3B\u52A8\u8C03\u7528OpenAPI\uFF0C\u4F8B\u5982\u4FE1\u606F\u67E5\u8BE2\u3001\u6570\u636E\u5B58\u50A8\u7B49\u3002"})})]}),(0,ue.jsxs)("span",{className:"text-[12px] leading-[20px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:[L.length,"/",l]})]}),(0,ue.jsxs)("span",{className:le.right,children:[(0,ue.jsx)(B.Z,{style:{padding:0},onClick:function(){return Q({selectVisible:!0})},iconType:"spark-plus-line",type:"text",size:"small",children:O.Z.get({id:"main.components.PluginSelectorComp.index.plugin",dm:"\u63D2\u4EF6"})}),(0,ue.jsx)(n.Z,{type:"vertical",className:"ml-[16px] mr-[16px]"}),(0,ue.jsx)(se.Z,{onClick:function(){return Q({expand:!ie.expand})},className:K()(le.expandBtn,!ie.expand&&le.hidden),type:"spark-up-line"})]})]}),ie.expand&&(0,ue.jsx)(re.Z,{vertical:!0,gap:8,children:L.map(function(ae){return(0,ue.jsx)(ce,{handleRemoveTool:function(){return M(ae)},tool:ae},ae.tool_id)})}),ie.selectVisible&&(0,ue.jsx)(te.U_,{maxLen:l,value:L,onOk:ee,onClose:function(){return Q({selectVisible:!1})}})]})}},75438:function(Be,ye,t){t.d(ye,{Z:function(){return le}});var N=t(42035),i=t.n(N),X=t(22453),O=t(84546),te=t(72624),se=t(45753),F=t(5693),B=t(42991),de=t(91030),re=t(81596),n=t(12524),q=t.n(n),K=t(2784),J=t(10289),y={successIcon:"successIcon___YIdEs",title:"title___l5oqv",successCon:"successCon___TaLIf",desc:"desc___PG75B",shortTip:"shortTip___b_DsC",actions:"actions___rJJqi",actionCard:"actionCard___dWK7o",icon:"icon___DAQOS",imgCon:"imgCon___Z2w8j"},T=t(52322);function le(ue){var l=(0,K.useState)(5),ce=i()(l,2),oe=ce[0],ne=ce[1],Se=(0,K.useRef)(5),G=(0,K.useRef)(null),w=(0,J.s0)(),me=function(){G.current&&(clearInterval(G.current),G.current=null)};return(0,F.Z)(function(){me(),G.current=setInterval(function(){Se.current<=0&&(me(),ue.onClose()),Se.current--,ne(Se.current)},1e3)}),(0,B.Z)(function(){me()}),(0,T.jsx)(O.Z,{onCancel:ue.onClose,className:y.successModal,open:!0,footer:(0,T.jsx)(de.Z,{className:"w-full",justify:"flex-end",children:(0,T.jsx)(te.Z,{onClick:function(){ue.onClose(),w("/app")},children:X.Z.get({id:"main.components.PublishAppSuccessModal.index.notConfigureReturn",dm:"\u6682\u4E0D\u914D\u7F6E\uFF0C\u8FD4\u56DE\u5E94\u7528\u5217\u8868\uFF08{var1}S\uFF09"},{var1:oe})})}),title:X.Z.get({id:"main.components.PublishAppSuccessModal.index.appPublished",dm:"\u5E94\u7528\u53D1\u5E03\u6210\u529F\uFF01"}),width:600,children:(0,T.jsxs)(de.Z,{align:"center",vertical:!0,children:[(0,T.jsx)(de.Z,{className:y.successCon,gap:12,vertical:!0,children:(0,T.jsx)(de.Z,{align:"center",gap:8,className:"mt-[18px]",children:(0,T.jsx)("img",{className:"w-[60px] h-[60px]",src:"/images/congratulations.png"})})}),(0,T.jsx)("div",{className:y.shortTip,children:(0,T.jsx)(re.Z,{children:X.Z.get({id:"main.components.PublishAppSuccessModal.index.quickActions",dm:"\u4F60\u8FD8\u53EF\u4EE5\u8FDB\u884C\u4EE5\u4E0B\u64CD\u4F5C"})})}),(0,T.jsx)(de.Z,{align:"center",vertical:!0,gap:16,className:q()(y.actions,"w-full"),children:(0,T.jsxs)("div",{className:q()(y.actionCard),children:[(0,T.jsx)("div",{className:y.imgCon,children:(0,T.jsx)(se.Z,{className:y.icon,type:"spark-plugin-line"})}),(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsx)("div",{className:y.title,children:X.Z.get({id:"main.components.PublishAppSuccessModal.index.publishAppComponent",dm:"\u53D1\u5E03\u5E94\u7528\u7EC4\u4EF6"})}),(0,T.jsx)("div",{className:y.desc,children:X.Z.get({id:"main.components.PublishAppSuccessModal.index.publishAsAppComponent",dm:"\u53D1\u5E03\u4E3A\u5E94\u7528\u7EC4\u4EF6\uFF0C\u65B9\u4FBF\u5728\u667A\u80FD\u4F53\u6216\u5DE5\u4F5C\u6D41\u4E2D\u76F4\u63A5\u8C03\u7528\uFF01"})})]}),(0,T.jsxs)(te.Z,{className:"font-medium",type:"text",onClick:function(){return ue.onClickAction("comp")},children:[(0,T.jsx)("span",{children:X.Z.get({id:"main.components.PublishAppSuccessModal.index.immediatelyPublish",dm:"\u7ACB\u5373\u53D1\u5E03"})}),(0,T.jsx)(se.Z,{type:"spark-rightArrow-line"})]})]})})]})})}},90390:function(Be,ye,t){var N=t(45753),i=t(3318),X=t(11283),O=t(91030),te=t(71938),se=t(2784),F=t(52322);ye.Z=function(B){var de,re,n;return(0,F.jsxs)(O.Z,{justify:"space-between",style:{background:"var(--ag-ant-color-fill-tertiary)"},className:"w-full height-[32px] rounded-[6px] p-[6px_12px]",children:[(0,F.jsxs)(O.Z,{gap:4,className:"flex flex-1 items-center title",style:{width:"calc(100% - 24px)"},children:[(0,F.jsx)(N.Z,{type:B.iconType,size:"small"}),(0,F.jsx)(te.Z.Text,{ellipsis:{tooltip:(0,i.rb)(B.name)},style:{color:"var(--ag-ant-color-text-base)",width:"112px"},className:"text-[12px] text-normal leading-[20px]",children:B.name}),(0,F.jsx)(te.Z.Text,{style:{width:"calc(100% - 140px)",color:"var(--ag-ant-color-text-tertiary)"},ellipsis:{tooltip:(0,i.rb)((B==null?void 0:B.description)||"")},children:B==null?void 0:B.description}),(0,F.jsx)(X.Z,{content:(de=B.weightInfo)===null||de===void 0?void 0:de.description,children:(0,F.jsxs)(te.Z.Text,{style:{color:"var(--ag-ant-color-text-description)",fontSize:"12px",flexShrink:0,marginRight:"12px"},children:[(re=B.weightInfo)===null||re===void 0?void 0:re.label,(n=B.weightInfo)===null||n===void 0?void 0:n.value]})})]}),B.rightArea]})}},74029:function(Be,ye,t){t.d(ye,{Z:function(){return re}});var N=t(22453),i=t(45753),X=t(62603),O=t(91030),te=t(12524),se=t.n(te),F=t(52322),B=function(q){var K=q.modalType,J=q.diameter,y=J===void 0?28:J,T=q.offset,le=T===void 0?-8:T,ue="spark-text-line";return K==="textDialog"&&(ue="spark-text-line"),K==="textGenerate"&&(ue="spark-aiEdit-line"),K==="audio"&&(ue="spark-dial-line"),K==="video"&&(ue="spark-video-line"),(0,F.jsx)("div",{className:"absolute rounded-[14px] flex justify-center items-center border-2 border-white border-solid",style:{width:"".concat(y,"px"),height:"".concat(y,"px"),bottom:"".concat(le,"px"),right:"".concat(le,"px"),backgroundColor:"var(--ag-ant-color-text-base)"},children:(0,F.jsx)(i.Z,{type:ue,style:{color:"var(--ag-ant-color-bg-base)"},size:"small"})})},de=function(q){var K=q.modalType;return(0,F.jsxs)("div",{className:"relative w-[64px] h-[64px]",children:[(0,F.jsx)("img",{className:"w-full h-full",src:"/images/defaultAvatar.png",alt:""}),(0,F.jsx)(B,{modalType:K,diameter:24,offset:-4})]})};function re(n){var q,K=n.data,J=K.modalType,y=X.ZP.useConfig(),T=y.componentDisabled;return!((q=K.suggested_questions)!==null&&q!==void 0&&q.length)&&!K.prologue?(0,F.jsxs)(O.Z,{justify:"center",align:"center",style:{marginTop:"20vh"},vertical:!0,children:[(0,F.jsx)(de,{modalType:J}),(0,F.jsx)("div",{className:"text-[16px] text-center font-semibold mt-[24px]",style:{color:"var(--ag-ant-tooltip-bg)"},children:n.title||N.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.components.Welcome.index.inputQuestion",dm:"\u8F93\u5165\u95EE\u9898\u8FDB\u884C\u6D4B\u8BD5\u4F53\u9A8C"})})]}):(0,F.jsx)(O.Z,{justify:"center",align:"center",style:{marginTop:"20vh"},children:(0,F.jsxs)(O.Z,{className:"w-[400px]",vertical:!0,gap:12,align:"center",children:[K.icon?(0,F.jsxs)("div",{className:"relative w-[76px] h-[76px]",children:[(0,F.jsx)("img",{className:"w-full h-full",src:K.icon,alt:""}),(0,F.jsx)(B,{modalType:J})]}):(0,F.jsx)(de,{modalType:J}),(0,F.jsx)("div",{className:"text-[16px] text-center font-medium",style:{color:"var(--ag-ant-color-text)"},children:K.name}),(0,F.jsx)("div",{className:"text-[14px]",style:{color:"var(--ag-ant-color-text-secondary)"},children:K.prologue}),(K.suggested_questions||[]).map(function(le){return(0,F.jsxs)(O.Z,{className:se()("text-[14px] cursor-pointer px-[16px] py-[10px] rounded-[6px] w-full suggested-questions-item-wrapper",{"cursor-not-allowed":T}),onClick:function(){var l;T||(l=n.sparkChatRef)===null||l===void 0||(l=l.current)===null||l===void 0||l.onInput.onSubmit({query:le})},gap:12,justify:"space-between",align:"center",children:[(0,F.jsxs)(O.Z,{gap:12,className:"break-all",children:[(0,F.jsx)("img",{src:"/images/suggestQuestion.png",className:"w-[20px] h-[20px]",alt:""}),le]}),(0,F.jsx)("div",{className:"flex items-center justify-center w-[16px] h-[16px] rounded-[4px] suggested_questions-item-icon-wrapper",children:(0,F.jsx)(i.Z,{type:"spark-rightArrow-line",size:"small"})})]},le)})]})})}},71275:function(Be,ye,t){t.d(ye,{Dw:function(){return re},IW:function(){return X},Jp:function(){return B},PH:function(){return O},W6:function(){return F},Yj:function(){return n},_i:function(){return i},km:function(){return se},pt:function(){return q},x9:function(){return de},yM:function(){return te}});var N=t(22453),i=[{key:"name",type:"String",desc:""},{key:"age",type:"Number",desc:""}],X=[{key:"output",value_from:"refer",type:"String",value:void 0}],O=[{key:"output",type:"String",desc:N.Z.get({id:"main.pages.App.Workflow.constant.index.textOutput",dm:"\u6587\u672C\u8F93\u51FA"})}],te=[{key:"output",type:"String",desc:N.Z.get({id:"main.pages.App.Workflow.constant.index.textOutput",dm:"\u6587\u672C\u8F93\u51FA"})},{key:"reasoning_content",type:"String",desc:N.Z.get({id:"main.pages.App.Workflow.constant.index.depthThinkingContent",dm:"\u6DF1\u5EA6\u601D\u8003\u5185\u5BB9"})}],se=[{key:"input1",value_from:"input",value:"1",type:"Number"},{key:"input2",value_from:"input",value:"2",type:"Number"}],F=[{key:"output",type:"Number",desc:N.Z.get({id:"main.pages.App.Workflow.constant.index.twoNumbersSum",dm:"\u4E24\u6570\u76F8\u52A0\u7684\u7ED3\u679C"})}],B={retry_enabled:!1,max_retries:3,retry_interval:500},de={strategy:"noop"},re=function(y){return{strategy:"noop",default_values:y}},n={enabled:!1,type:"self",round:3,param:{key:"historyList",type:"Array<String>",value_from:"refer",value:void 0}},q={model_id:"",model_name:"",mode:"chat",provider:"",params:[],vision_config:{enable:!1,params:[{key:"imageContent",value_from:"refer",type:"File",value:void 0}]}},K={Number:[{label:N.Z.get({id:"main.pages.App.Workflow.constant.equal",dm:"\u7B49\u4E8E"}),value:"equals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEqual",dm:"\u4E0D\u7B49\u4E8E"}),value:"notEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.greaterThan",dm:"\u5927\u4E8E"}),value:"greater"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.greaterThanOrEqual",dm:"\u5927\u4E8E\u7B49\u4E8E"}),value:"greaterAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lessThan",dm:"\u5C0F\u4E8E"}),value:"less"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lessThanOrEqual",dm:"\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lessAndEqual"}],"Array<Boolean>":[{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],Boolean:[{label:N.Z.get({id:"main.pages.App.Workflow.constant.equal",dm:"\u7B49\u4E8E"}),value:"equals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEqual",dm:"\u4E0D\u7B49\u4E8E"}),value:"notEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.isTrue",dm:"\u4E3Atrue"}),value:"isTrue"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.isFalse",dm:"\u4E3Afalse"}),value:"isFalse"}],"Array<File>":[{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"}],"Array<Object>":[{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"}],String:[{label:N.Z.get({id:"main.pages.App.Workflow.constant.equal",dm:"\u7B49\u4E8E"}),value:"equals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEqual",dm:"\u4E0D\u7B49\u4E8E"}),value:"notEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],File:[{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"}],"Array<String>":[{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],"Array<Number>":[{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],Object:[{label:N.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:N.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}]}},71075:function(Be,ye,t){t.r(ye),t.d(ye,{FlowBase:function(){return bn},FlowEditor:function(){return yn},default:function(){return Ro}});var N=t(13311),i=t.n(N),X=t(12323),O=t.n(X),te=t(63260),se=t.n(te),F=t(42035),B=t.n(F),de=t(882),re=t(56388),n=t(22453),q=t(15127),K=t(1905),J=t(78308),y=t(45753),T=t(72624),le=t(51034),ue=t(3318),l=t(3636),ce=t(2821),oe=t(5693),ne=t(70020),Se=t(18561),G=t(88133),w=t(91030),me=t(71938),z=t(28879),L=t.n(z),d=t(2784),H=t(10289),ie=t(41714),Q=t(30332),ee=t(95423),M=t(75438),ae=t(5054),W=t(40755),E=t(45642),A=t(518),V=t(97948),$=t(17029),pe=t(43065),e=t(52322),ge={show:function(a){var r=document.createElement("div");document.body.appendChild(r);var o=(0,$.createRoot)(r),u=function(){var p;o.unmount(),r.remove(),(p=a.onCancel)===null||p===void 0||p.call(a)},c=function(p){var k;(k=a.onOk)===null||k===void 0||k.call(a,p),u()};o.render((0,e.jsx)(V.Z,{children:(0,e.jsx)(pe.hW,{value:a.value||[],maxLen:a.maxLen,onClose:u,onOk:c})}))}},ke=t(87329),ve=t.n(ke),fe=t(26186),We={"filter-selector":"filter-selector___eLkhs"};function Ve(s){var a=s.options,r=s.value,o=s.onSelect;return(0,e.jsx)(w.Z,{wrap:!0,className:We["filter-selector"],gap:8,children:a.map(function(u){var c=u.value===r;return(0,e.jsx)(fe.Z.CheckableTag,{checked:c,onClick:function(){c||o(u.value,u)},children:u.label},u.value)})})}var Re=t(65803),Ae=t(84546),xe=t(4513),Ne=t(35276),De=t(74465),je=t(56733),Ue=t(9454),Te=t(12524),we=t.n(Te),Oe={list:"list___PfHAj",card:"card___LQu3O",title:"title___CjiRp",desc:"desc___C_7CR",selected:"selected___aI2rq",search:"search___YEN4c","empty-wrap":"empty-wrap___J_OiS","list-wrap":"list-wrap___UMwzG"},ia=[{value:q.zd.AGENT,label:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.intelligentAgentComponent",dm:"\u667A\u80FD\u4F53\u7EC4\u4EF6"})},{value:q.zd.WORKFLOW,label:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.workflowComponent",dm:"\u5DE5\u4F5C\u6D41\u7EC4\u4EF6"})}];function qe(s){var a=(0,ce.Z)({activeTab:q.zd.AGENT,loading:!0,list:[],total:0,size:10,current:1,name:"",selectedComponent:null}),r=B()(a,2),o=r[0],u=r[1],c=(0,d.useRef)(!1),m=function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};u({loading:!0});var v=c.current?{name:o.name}:{};(0,q.l9)(i()(i()({current:o.current,size:o.size,type:o.activeTab,appCode:s.appCode},f),v)).then(function(h){u({list:h.records,total:h.total,loading:!1})})},p=function(){c.current=!0,u({current:1}),m({current:1})};(0,oe.Z)(function(){m()});var k=function(){if(!o.selectedComponent){G.ZP.warning(n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.selectComponent",dm:"\u8BF7\u9009\u62E9\u7EC4\u4EF6"}));return}s.onOk(o.selectedComponent)},g=(0,d.useMemo)(function(){return o.activeTab===q.zd.AGENT?n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.intelligent",dm:"\u667A\u80FD\u4F53"}):n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.workflow",dm:"\u5DE5\u4F5C\u6D41"})},[o.activeTab]),b=function(){window.open("#/component-manage/".concat(o.activeTab===q.zd.AGENT?"agent":"workflow"))};return(0,e.jsx)(Ae.Z,{onOk:k,open:!0,width:900,onCancel:s.onClose,title:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.selectAppComponent",dm:"\u9009\u62E9\u5E94\u7528\u7EC4\u4EF6"}),bodyProps:{style:{padding:0}},children:(0,e.jsxs)(w.Z,{className:"py-[18px]",vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"px-[24px]",children:(0,e.jsx)(Ve,{value:o.activeTab,onSelect:function(f){c.current=!1,u({activeTab:f,name:"",current:1}),m({current:1,type:f})},options:ia})}),(0,e.jsxs)(w.Z,{className:"px-[24px]",justify:"space-between",children:[(0,e.jsx)(xe.Z.Search,{className:Oe.search,value:o.name,onChange:function(f){return u({name:f.target.value})},onSearch:p,placeholder:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.searchComponentName",dm:"\u641C\u7D22\u7EC4\u4EF6\u540D\u79F0"})}),(0,e.jsxs)(Ne.ZP,{icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),onClick:b,children:[n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.add",dm:"\u6DFB\u52A0"}),g,n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.component",dm:"\u7EC4\u4EF6"})]})]}),(0,e.jsx)("div",{className:Oe["list-wrap"],children:o.loading?(0,e.jsx)(De.Z,{className:"loading-center",spinning:!0}):o.list.length?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(w.Z,{className:Oe.list,align:"flex-start",gap:12,wrap:!0,children:o.list.map(function(_){var f,v=((f=o.selectedComponent)===null||f===void 0?void 0:f.code)===_.code;return(0,e.jsxs)("div",{onClick:function(){v||u({selectedComponent:_})},className:we()(Oe.card,ve()({},Oe.selected,v)),children:[(0,e.jsxs)(w.Z,{gap:8,align:"center",children:[(0,e.jsx)("img",{src:Re.ek[_.type],alt:""}),(0,e.jsx)(w.Z,{align:"center",gap:4,className:"flex-1 w-1",children:(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:_.name},className:Oe.title,children:_.name})}),(0,e.jsx)(je.ZP,{checked:v})]}),(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:_.code},className:Oe.desc,children:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.id",dm:"ID\uFF1A{var1}"},{var1:_.code})})]},_.code)})})}):(0,e.jsx)("div",{className:Oe["empty-wrap"],children:(0,e.jsx)(le.Z,{title:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.noComponent",dm:"\u6682\u65E0{var1}\u7EC4\u4EF6"},{var1:g}),description:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.index.goToComponentManagementPageCreate",dm:"\u8BF7\u524D\u5F80\u7EC4\u4EF6\u7BA1\u7406\u9875\u9762\u8FDB\u884C\u7EC4\u4EF6\u521B\u5EFA"}),children:!c.current&&(0,e.jsx)(Ne.ZP,{type:"primary",className:"mt-4",onClick:b,children:n.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.goToCreate",dm:"\u524D\u5F80\u521B\u5EFA"})})})})}),(0,e.jsx)("div",{className:"px-[24px]",children:(0,e.jsx)(Ue.Z,{pageSize:o.size,total:o.total,hideOnSinglePage:!0,current:o.current,onChange:function(f,v){u({current:f,size:v}),m({current:f,size:v})}})})]})})}var Fe={show:function(a){var r=document.createElement("div");document.body.appendChild(r);var o=(0,$.createRoot)(r),u=function(){o.unmount(),r.remove()},c=function(p){var k;(k=a.onOk)===null||k===void 0||k.call(a,p),u()};o.render((0,e.jsx)(V.Z,{children:(0,e.jsx)(qe,{appCode:a.appCode,onClose:function(){var p;u(),(p=a.onCancel)===null||p===void 0||p.call(a)},onOk:c})}))}},Je=t(5217),ea=t.n(Je),Qe=t(49616),Ce=t.n(Qe),ha=t(53890),Pa=t(19612),Zn=t(30745),ja={add:"add___Ff_cd",form:"form___wP1tS",desc:"desc___VWoa4"},wn=function(a){return a.map(function(r){return i()(i()({},r),{},{id:(0,ha.Z)(4)})})};function An(s){var a=(0,d.useState)(wn(s.value)),r=B()(a,2),o=r[0],u=r[1],c=(0,d.useState)(!1),m=B()(c,2),p=m[0],k=m[1],g=function(R,x){u(o.map(function(S){return S.id===R?i()(i()({},S),x):S}))},b=function(R){u(o.filter(function(x){return x.id!==R}))},_=function(){u([].concat(Ce()(o),[{id:(0,ha.Z)(4),key:"",type:"String",desc:"",default_value:""}]))},f=function(R){var x=new Set,S=ea()(R),C;try{for(S.s();!(C=S.n()).done;){var P=C.value,Y=P.key.trim();if(!Y)return n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.enterVariableName",dm:"\u8BF7\u8F93\u5165\u53D8\u91CF\u540D"});if(!/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(Y))return n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.variableNameFormat",dm:"\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u548C$\uFF0C\u4E14\u4E0D\u80FD\u4EE5\u6570\u5B57\u5F00\u5934"});if(x.has(Y))return n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.variableNameExists",dm:"\u53D8\u91CF\u540D\u5DF2\u5B58\u5728"});x.add(Y)}}catch(j){S.e(j)}finally{S.f()}return null},v=function(){var R=f(o);if(R){Pa.Z.warning(R);return}k(!0);var x=o.map(function(S){return(0,Zn.Z)(S,["id"])});(0,K.KT)({app_id:s.appDetail.app_id,name:s.appDetail.name,type:s.appDetail.type,config:i()(i()({},s.appDetail.config),{},{global_config:i()(i()({},s.appDetail.config.global_config),{},{variable_config:i()(i()({},s.appDetail.config.global_config.variable_config),{},{conversation_params:x})})})}).then(function(){Pa.Z.success(n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.saveSuccess",dm:"\u4FDD\u5B58\u6210\u529F"})),s.onOk()}).finally(function(){k(!1)})};return(0,e.jsx)(Ae.Z,{onOk:v,width:640,onCancel:s.onClose,okButtonProps:{loading:p,title:p?n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.saving",dm:"\u4FDD\u5B58\u4E2D..."}):n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.save",dm:"\u4FDD\u5B58"})},open:!0,title:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.conversationVariable",dm:"\u4F1A\u8BDD\u53D8\u91CF"}),children:(0,e.jsxs)("div",{className:ja.form,children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:8,children:[(0,e.jsxs)(w.Z,{align:"center",className:ja.desc,gap:8,children:[(0,e.jsx)("span",{style:{width:120},children:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.variableName",dm:"\u53D8\u91CF\u540D"})}),(0,e.jsx)("span",{style:{width:100},children:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.variableType",dm:"\u53D8\u91CF\u7C7B\u578B"})}),(0,e.jsx)("span",{style:{width:176},children:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.variableDescription",dm:"\u53D8\u91CF\u63CF\u8FF0"})}),(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.defaultValue",dm:"\u9ED8\u8BA4\u503C"})})]}),o.map(function(h){return(0,e.jsxs)(w.Z,{gap:8,align:"center",className:ja.row,children:[(0,e.jsx)(xe.Z,{style:{width:120},value:h.key,onChange:function(x){return g(h.id,{key:x.target.value})},placeholder:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.enterVariableName",dm:"\u8BF7\u8F93\u5165\u53D8\u91CF\u540D"})}),(0,e.jsx)(l.oZ,{type:h.type,handleChange:function(x){g(h.id,{type:x})}}),(0,e.jsx)(xe.Z,{style:{width:176},value:h.desc,onChange:function(x){return g(h.id,{desc:x.target.value})},placeholder:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.enterDescription",dm:"\u8BF7\u8F93\u5165\u63CF\u8FF0"})}),(0,e.jsx)("div",{style:{width:140},children:(0,e.jsx)(l.qM,{placeholder:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.enterDefaultValue",dm:"\u8BF7\u8F93\u5165\u9ED8\u8BA4\u503C"}),type:h.type,value:h.default_value,onChange:function(x){return g(h.id,{default_value:x.value})}})}),(0,e.jsx)(y.Z,{type:"spark-delete-line",isCursorPointer:!0,size:"small",onClick:function(){return b(h.id)}})]},h.id)})]}),(0,e.jsx)(T.Z,{type:"dashed",className:ja.add,onClick:_,icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),children:n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.addVariable",dm:"\u6DFB\u52A0\u53D8\u91CF"})})]})})}var da=t(39389),Ta=t(76803),ua=t(94815),Sn={"slider-selector":"slider-selector___cp3jf"};function Nn(s){var a=(0,ce.Z)(s.data),r=B()(a,2),o=r[0],u=r[1],c=(0,d.useState)(!1),m=B()(c,2),p=m[0],k=m[1],g=function(){k(!0),(0,K.KT)({app_id:s.appDetail.app_id,name:s.appDetail.name,type:s.appDetail.type,config:i()(i()({},s.appDetail.config),{},{global_config:i()(i()({},s.appDetail.config.global_config),{},{history_config:o})})}).then(function(){G.ZP.success(n.Z.get({id:"main.pages.App.Workflow.components.GlobalVariableFormModal.index.saveSuccess",dm:"\u4FDD\u5B58\u6210\u529F"})),s.onOk()}).finally(function(){k(!1)})};return(0,e.jsx)(Ae.Z,{title:n.Z.get({id:"main.pages.App.Workflow.components.HistoryConfigModal.contextRoundSetting",dm:"\u4E0A\u4E0B\u6587\u8F6E\u6B21\u8BBE\u7F6E"}),open:!0,onOk:g,okButtonProps:{loading:p},onCancel:function(){return s.onCancel()},children:(0,e.jsxs)(Ta.Z,{layout:"vertical",children:[(0,e.jsx)(Ta.Z.Item,{label:n.Z.get({id:"main.pages.App.Workflow.components.HistoryConfigModal.enableContext",dm:"\u662F\u5426\u5F00\u542F\u4E0A\u4E0B\u6587"}),children:(0,e.jsx)(ua.Z,{checked:o.history_switch,onChange:function(_){u({history_switch:_})}})}),(0,e.jsx)(Ta.Z.Item,{label:n.Z.get({id:"main.pages.App.Workflow.components.HistoryConfigModal.maxMemoryRounds",dm:"\u6700\u5927\u8BB0\u5FC6\u8F6E\u6B21"}),children:(0,e.jsx)(da.Z,{disabled:!o.history_switch,min:1,step:1,value:o.history_max_round,onChange:function(_){u({history_max_round:_})},max:50,className:Sn["slider-selector"]})})]})})}function Pn(s){var a,r=s.onSave,o=s.appDetail,u=(0,d.useState)(!1),c=B()(u,2),m=c[0],p=c[1];return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ne.Z,{title:n.Z.get({id:"main.pages.App.Workflow.components.HistoryConfigModal.contextRoundSetting",dm:"\u4E0A\u4E0B\u6587\u8F6E\u6B21\u8BBE\u7F6E"}),children:(0,e.jsx)(J.Z,{shape:"default",icon:(0,e.jsx)(y.Z,{type:"spark-setting-line"}),onClick:function(){return p(!0)}})}),m&&(0,e.jsx)(Nn,{appDetail:o,data:((a=o.config.global_config)===null||a===void 0?void 0:a.history_config)||{history_switch:!0,history_max_round:3},onOk:function(){r(),p(!1)},onCancel:function(){return p(!1)}})]})}var Ua=t(73088),ca=t(51747),Ka=t(36488),Tn=t(53707),Ha=t(55432),Xe={"remote-url-input-form":"remote-url-input-form___YFZND","remote-url-input-form-title":"remote-url-input-form-title___B87k3","remote-url-input-form-actions":"remote-url-input-form-actions___hm65P","file-input":"file-input___OMQQb","upload-btn-wrap":"upload-btn-wrap___bs2jU","file-item":"file-item___uu1Ij","file-preview":"file-preview___vdtdJ","file-logo":"file-logo___arlsx","file-logo-icon":"file-logo-icon___pRfXP","file-progress":"file-progress___u7gY4","file-name":"file-name___d_JMW","file-size":"file-size___a8Z4X","file-loading-icon":"file-loading-icon___KXA5y",spin:"spin___nI0tN"},En=function(a){return/^image\/(jpeg|png|gif|bmp|webp)$/i.test(a.type)},Wn=function(a){return a<1024?"".concat(a,"B"):a<1024*1024?"".concat((a/1024).toFixed(2),"KB"):"".concat((a/1024/1024).toFixed(2),"MB")},Ga={localFile:n.Z.get({id:"main.components.VariableBaseInput.FileInput.local",dm:"\u672C\u5730"}),remoteUrl:n.Z.get({id:"main.components.VariableBaseInput.FileInput.link",dm:"\u94FE\u63A5"})},Mn=(0,d.memo)(function(s){var a=s.file,r=s.onDelete;return(0,e.jsxs)(w.Z,{className:Xe["file-item"],gap:8,align:"center",children:[(0,e.jsx)("div",{className:Xe["file-logo"],children:(0,e.jsx)(y.Z,{className:Xe["file-logo-icon"],type:"spark-link-line"})}),(0,e.jsxs)(w.Z,{className:"flex-1 w-1",vertical:!0,children:[(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:a.name},className:Xe["file-name"],children:a.name}),(0,e.jsx)("div",{className:Xe["file-size"],children:Ga[a.source]})]}),(0,e.jsx)(y.Z,{onClick:r,isCursorPointer:!0,type:"spark-delete-line"})]})}),In=(0,d.memo)(function(s){var a=(0,d.useState)(""),r=B()(a,2),o=r[0],u=r[1],c=function(){o.trim()&&s.onSubmit({id:(0,ha.Z)(4),name:o.split("/").pop()||o,type:"custom",source:"remoteUrl",url:o,percent:1})};return(0,e.jsxs)("div",{className:Xe["remote-url-input-form"],children:[(0,e.jsx)("div",{className:Xe["remote-url-input-form-title"],children:n.Z.get({id:"main.components.VariableBaseInput.FileInput.link",dm:"\u94FE\u63A5"})}),(0,e.jsx)(xe.Z,{placeholder:n.Z.get({id:"main.components.VariableBaseInput.FileInput.enterLink",dm:"\u8BF7\u8F93\u5165\u94FE\u63A5"}),value:o,onChange:function(p){return u(p.target.value)}}),(0,e.jsxs)(w.Z,{className:Xe["remote-url-input-form-actions"],gap:8,children:[(0,e.jsx)(T.Z,{disabled:s.disabled,onClick:c,type:"primary",children:n.Z.get({id:"main.components.VariableBaseInput.FileInput.submit",dm:"\u63D0\u4EA4"})}),(0,e.jsx)(T.Z,{children:n.Z.get({id:"main.components.VariableBaseInput.FileInput.cancel",dm:"\u53D6\u6D88"})})]})]})}),Ln=(0,d.memo)(function(s){var a=s.value,r=s.onChange,o=s.isSingle,u=(0,d.useState)([]),c=B()(u,2),m=c[0],p=c[1],k=(0,d.useState)(!1),g=B()(k,2),b=g[0],_=g[1];(0,d.useEffect)(function(){a||p([])},[a]),(0,d.useEffect)(function(){var h=[];m.forEach(function(R){R.percent===1&&h.push({name:R.name,type:R.type,size:R.size,source:R.source,url:R.url,mime_type:R.mime_type})}),r(JSON.stringify(o?h[0]:h))},[m]);var f=function(R){p(function(x){return[].concat(Ce()(x),[R])})},v=function(R){p(function(x){return x.filter(function(S){return S.id!==R.id})})};return(0,e.jsxs)("div",{className:we()(Xe["file-input"],ve()({},Xe.hasFiles,!!m.length)),children:[(0,e.jsxs)(w.Z,{gap:8,children:[(0,e.jsx)(Tn.Z,{fileList:[],className:Xe["upload-btn-wrap"],multiple:!o,maxCount:o?1:void 0,disabled:o&&m.length>=1,customRequest:function(R){var x=R.file,S={id:(0,ha.Z)(4),percent:0,name:x.name,type:"custom",source:"localFile",size:x.size,url:"",mime_type:x.type};p(function(C){return[].concat(Ce()(C),[S])}),(0,Ka.ZP)({file:R.file,category:"temp",onProgress:function(P){p(function(Y){return Y.map(function(j){return j.id===S.id?i()(i()({},j),{},{percent:P.percent}):j})})}}).then(function(){var C=se()(O()().mark(function P(Y){var j;return O()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(!En(x)){U.next=7;break}return U.next=3,(0,Ka.pC)(Y.path);case 3:U.t1=U.sent,U.t0={previewUrl:U.t1},U.next=8;break;case 7:U.t0={};case 8:j=U.t0,p(function(Z){return Z.map(function(I){return I.id===S.id?i()(i()({},I),{},{percent:1,url:Y.path},j):I})});case 10:case"end":return U.stop()}},P)}));return function(P){return C.apply(this,arguments)}}())},children:(0,e.jsx)(T.Z,{className:"w-full",variant:"filled",disabled:o&&m.length>=1,icon:(0,e.jsx)(y.Z,{type:"spark-upload-line"}),children:n.Z.get({id:"main.components.VariableBaseInput.FileInput.local",dm:"\u672C\u5730"})})}),(0,e.jsx)(Ha.Z,{open:b&&!(o&&m.length>=1),onOpenChange:_,destroyTooltipOnHide:!0,content:(0,e.jsx)(In,{disabled:o&&m.length>=1,onSubmit:function(R){f(R),_(!1)},onCancel:function(){_(!1)}}),trigger:["click"],children:(0,e.jsx)(T.Z,{disabled:o&&m.length>=1,className:"flex-1",variant:"filled",icon:(0,e.jsx)(y.Z,{type:"spark-link-line"}),children:n.Z.get({id:"main.components.VariableBaseInput.FileInput.link",dm:"\u94FE\u63A5"})})})]}),(0,e.jsx)(w.Z,{className:Xe["file-list"],vertical:!0,gap:12,children:m.map(function(h){return h.source==="remoteUrl"?(0,e.jsx)(Mn,{onDelete:function(){return v(h)},file:h},h.id):(0,e.jsxs)(w.Z,{className:Xe["file-item"],gap:8,align:"center",children:[h.previewUrl?(0,e.jsx)("img",{alt:h.name,className:Xe["file-preview"],src:h.previewUrl}):(0,e.jsx)("div",{className:Xe["file-logo"],children:h.percent!==1&&h.percent!==void 0?(0,e.jsx)(y.Z,{className:Xe["file-loading-icon"],type:"spark-loading-line"}):(0,e.jsx)(y.Z,{type:"spark-imageFiles-line"})}),(0,e.jsxs)(w.Z,{className:"flex-1 w-1",vertical:!0,children:[(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:h.name},className:Xe["file-name"],children:h.name}),h.percent!==1&&h.percent!==void 0?(0,e.jsxs)("div",{className:Xe["file-progress"],children:[n.Z.get({id:"main.components.VariableBaseInput.FileInput.uploadProgress",dm:"\u4E0A\u4F20\u8FDB\u5EA6&nbsp;"}),parseInt("".concat(h.percent*100)),"%"]}):(0,e.jsxs)("div",{className:Xe["file-size"],children:[Wn(h.size||0),"/",Ga[h.source]]})]}),(0,e.jsx)(y.Z,{onClick:function(){return v(h)},isCursorPointer:!0,type:"spark-delete-line"})]},h.id)})})]})}),za=(0,d.memo)(function(s){var a=s.value,r=s.onChange,o=s.type,u=s.placeholder,c=s.disabled,m=s.variant,p=s.prefix,k=(0,d.useMemo)(function(){switch(o){case"Number":return(0,e.jsx)(Ua.Z,{className:"w-full",placeholder:u||n.Z.get({id:"main.components.VariableBaseInput.index.inputValue",dm:"\u8F93\u5165\u53D8\u91CF\u503C"}),stringMode:!0,prefix:p,variant:m,disabled:c,value:a,onChange:function(b){return r({value:b?b.toString():void 0})}});case"String":return(0,e.jsx)(xe.Z,{disabled:c,prefix:p,placeholder:u||n.Z.get({id:"main.components.VariableBaseInput.index.inputValue",dm:"\u8F93\u5165\u53D8\u91CF\u503C"}),variant:m,value:a,onChange:function(b){return r({value:b.target.value})}});case"Boolean":return(0,e.jsx)(ca.Z,{disabled:c,variant:m,className:"w-full",value:a,placeholder:n.Z.get({id:"main.components.VariableBaseInput.index.select",dm:"\u8BF7\u9009\u62E9"}),options:[{label:n.Z.get({id:"main.components.VariableBaseInput.index.yes",dm:"\u662F"}),value:"true"},{label:n.Z.get({id:"main.components.VariableBaseInput.index.no",dm:"\u5426"}),value:"false"}],onChange:function(b){return r({value:b})}});case"Object":case"Array<Object>":case"Array<String>":case"Array<Number>":case"Array<Boolean>":return(0,e.jsx)(l.Nw,{disabled:c,type:o,value:a,onChange:function(b){return r({value:b})}});case"File":case"Array<File>":return(0,e.jsx)(Ln,{value:a,isSingle:o==="File",onChange:function(b){return r({value:b})}});default:return null}},[o,a,r]);return k}),Ea=t(74029),ba=t(46639),$a=function(a){return(0,ba.W)({url:"/console/v1/apps/workflow/debug/run-task",method:"POST",data:a}).then(function(r){return r.data.data})},Ja=function(a){return(0,ba.W)({url:"/console/v1/apps/workflow/debug/resume-task",method:"POST",data:a})},Dn=function(a){return(0,ba.W)({url:"/console/v1/apps/workflow/debug/part-graph/run-task",method:"POST",data:a}).then(function(r){return r.data.data})},On=function(a){return(0,ba.W)({url:"/console/v1/apps/workflow/debug/init",method:"POST",data:a}).then(function(r){return r.data.data})},Wa=function(a){return(0,ba.W)({url:"/console/v1/apps/workflow/debug/get-task-process",method:"POST",data:a}).then(function(r){return r.data.data})},Ya=t(95559),Ma=t(42991),Vn=t(16782),Rn=t(42893),Fn=function(a){return(0,Rn.M)(function(r){return i()({appId:"",showTest:!1,debugInputParams:[],setAppId:function(u){return r({appId:u})},setShowTest:function(u){return r({showTest:u})},setDebugInputParams:function(u){return r({debugInputParams:u})},globalVariableList:[],setGlobalVariableList:function(u){return r({globalVariableList:u})},selectedVersion:"draft",setSelectedVersion:function(u){return r({selectedVersion:u})}},a)})},Qa=(0,d.createContext)(null),Bn=function(a){var r=a.children,o=a.initialState,u=o===void 0?{}:o,c=(0,d.useRef)();return c.current||(c.current=Fn(u)),(0,e.jsx)(Qa.Provider,{value:c.current,children:r})};function Le(s){var a=(0,d.useContext)(Qa);if(!a)throw new Error("useWorkflowContext must be used within a WorkflowProvider");return(0,Vn.o)(a,s)}var Xa=t(26224),Un=t(90257),Ca=t(92748),la={tokenItem:"tokenItem___yOZuX",icon:"icon___mVp_N",tokenTag:"tokenTag___ZKGJX",tagResult:"tagResult___L9L_U",success:"success___xFY6k",fail:"fail___rATRv",executing:"executing___gFEPu",spin:"spin___pWo83"},Za=(0,d.memo)(function(a){var r=a.status,o=a.usages,u=o===void 0?[]:o,c=a.execTime,m=(0,d.useMemo)(function(){return u.reduce(function(k,g){return{input:k.input+g.prompt_tokens,output:k.output+g.completion_tokens,total:k.total+g.total_tokens}},{input:0,output:0,total:0})},[u]),p=(0,d.useMemo)(function(){return r==="success"?(0,e.jsx)(y.Z,{className:la.icon,type:"spark-checkCircle-fill"}):r==="fail"?(0,e.jsx)(y.Z,{className:la.icon,type:"spark-warningCircle-fill"}):(0,e.jsx)(y.Z,{className:la.icon,type:"spark-loading-line"})},[r]);return(0,e.jsxs)("div",{className:"flex gap-[4px]",children:[!!m.total&&(0,e.jsx)(Un.Z,{menu:{items:[{type:"item",key:"output",label:(0,e.jsxs)("div",{className:la.tokenItem,children:[(0,e.jsx)("span",{children:"Output Tokens"}),(0,e.jsx)("span",{children:m.output})]})},{type:"item",key:"input",label:(0,e.jsxs)("div",{className:la.tokenItem,children:[(0,e.jsx)("span",{children:"Input Tokens"}),(0,e.jsx)("span",{children:m.input})]})},{type:"divider"},{type:"item",key:"total",label:(0,e.jsxs)("div",{className:la.tokenItem,children:[(0,e.jsx)("span",{children:"Total Tokens"}),(0,e.jsx)("span",{children:m.total})]})}],selectable:!1},children:(0,e.jsx)(Ca.Z,{color:"mauve",className:la.tokenTag,bordered:!0,icon:(0,e.jsx)(y.Z,{className:la.icon,type:"spark-token-line"}),children:m.total})}),(0,e.jsx)(Ca.Z,{color:r==="executing"?"mauve":"",icon:p,bordered:!0,className:we()(la.tagResult,la[r]),children:c})]})}),Ie={"result-panel-list":"result-panel-list___wRE95","node-result-panel":"node-result-panel___gXHfR","node-result-panel-child":"node-result-panel-child___tcU67","node-result-header":"node-result-header___qxRoX","node-result-title":"node-result-title___yiuiN","node-result-content":"node-result-content___eJikT",tag:"tag___yIGrz","viewer-container":"viewer-container___OO2Fr","json-view-header":"json-view-header___gzsfW",icon:"icon___anJTV","json-view-content":"json-view-content___jLFZA","text-view-content":"text-view-content___gY4sm","no-padding":"no-padding___gzMgs","condition-result-item":"condition-result-item___Y6yaa",active:"active___QaQ_6","condition-result-tag":"condition-result-tag___TM2KO","condition-title":"condition-title___nIvPw","condition-desc":"condition-desc___xlYDT","logic-label":"logic-label___UOiy_","condition-sub-branch-item":"condition-sub-branch-item___E66i2","condition-item-left":"condition-item-left___IR3Ta","condition-item-right":"condition-item-right___YrgCD","condition-item-right-icon":"condition-item-right-icon___ni0_2","condition-item-right-value":"condition-item-right-value___iDfQr","condition-item-variable-tooltip":"condition-item-variable-tooltip___KIeEk","condition-item-variable-key":"condition-item-variable-key___rQpfF"},qa=t(1261),Kn=t(12901),ma=(0,d.memo)(function(a){var r=a.type,o=r===void 0?"json":r,u=(0,d.useState)(!0),c=B()(u,2),m=c[0],p=c[1],k=(0,d.useState)("md"),g=B()(k,2),b=g[0],_=g[1],f=(0,d.useMemo)(function(){if(!a.value)return"";try{return JSON.stringify(JSON.parse(a.value),null,2)}catch(h){return a.value}},[a.value]),v=(0,d.useMemo)(function(){return o==="json"?(0,e.jsx)(Kn.ZP,{language:"json",readOnly:!0,value:f}):(0,e.jsx)("div",{className:Ie["text-view-content"],children:b==="md"?(0,e.jsx)(qa.Z,{baseFontSize:12,content:a.value}):(0,e.jsx)("div",{className:we()(Ie["text-view-content"],Ie["no-padding"]),children:a.value})})},[o,f,a.value,m,b]);return(0,e.jsxs)("div",{className:Ie["viewer-container"],children:[(0,e.jsxs)("div",{className:Ie["json-view-header"],children:[(0,e.jsx)("span",{children:a.label}),(0,e.jsxs)(w.Z,{align:"center",gap:8,children:[o==="text"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.Z,{onClick:function(){return _("text")},className:Ie.icon,type:"spark-text-line"}),(0,e.jsx)("span",{onClick:function(){return _("md")},className:Ie.icon,children:"M"})]}),(0,e.jsx)(Xa.r,{className:Ie.icon,expand:m,setExpand:p})]})]}),m&&(0,e.jsx)("div",{className:Ie["json-view-content"],children:v})]})}),Hn=t(4008),Gn=t.n(Hn),zn=t(73306),$n={and:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.JudgeResult.all",dm:"\u6240\u6709"}),or:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.JudgeResult.any",dm:"\u4EFB\u610F"})},en=function(a){var r,o=a.text,u=a.nodes,c=a.nodeSchemaMap;if(!o)return null;var m=(0,l.Hc)(o.replace(/[\[]]/g,""))[0],p=m.split(".");if(!p.length)return null;var k=Gn()(p),g=k[0],b=k.slice(1);if(g==="sys"||g==="conversation"){var _;return{nodeName:g,variableKey:b[b.length-1],nodeIconType:(_=c[g])===null||_===void 0?void 0:_.iconType}}var f=u.find(function(v){return v.id===g});return f?{nodeName:f.data.label,variableKey:b[b.length-1],nodeIconType:(r=c[f.type])===null||r===void 0?void 0:r.iconType}:null};function Jn(s){var a=s.subBranch;return(0,e.jsxs)(w.Z,{align:"center",className:Ie["condition-sub-branch-item"],gap:8,children:[a.leftInfo?(0,e.jsx)(zn.Z,{title:(0,e.jsxs)(w.Z,{className:Ie["condition-item-variable-tooltip"],gap:8,align:"center",children:[(0,e.jsx)(y.Z,{type:a.leftInfo.nodeIconType}),(0,e.jsxs)("span",{children:[a.leftInfo.nodeName,"/",(0,e.jsx)("span",{className:Ie["condition-item-variable-key"],children:a.leftInfo.variableKey})]})]}),children:(0,e.jsxs)(w.Z,{className:Ie["condition-item-left"],align:"center",gap:8,children:[(0,e.jsxs)("span",{children:[a.leftInfo.variableKey,":\xA0",a.leftValue]}),(0,e.jsx)(y.Z,{type:"spark-arrow-right-line"})]})}):(0,e.jsxs)("span",{className:Ie["condition-item-left"],children:[a.leftKey,":\xA0",a.leftValue]}),(0,e.jsx)("span",{children:(0,l.eL)(a.operator)}),(0,e.jsxs)(w.Z,{className:Ie["condition-item-right"],align:"center",children:[(0,e.jsx)("div",{className:Ie["condition-item-right-icon"],children:a.rightKey?(0,e.jsx)(y.Z,{size:"small",type:"spark-quotation-line"}):(0,e.jsx)(y.Z,{size:"small",type:"spark-edit-line"})}),(0,e.jsx)("div",{className:Ie["condition-item-right-value"],children:a.rightValue})]})]})}var Yn=(0,d.memo)(function(a){var r=(0,l._J)(function(c){return c.nodes}),o=(0,l.oR)(function(c){return c.nodeSchemaMap}),u=(0,d.useMemo)(function(){var c=[];if(!a.input)return c;try{c=JSON.parse(a.input).map(function(m){return i()(i()({},m),{},{subBranches:m.subBranches.map(function(p){return i()(i()({},p),{},{leftInfo:en({text:p.leftKey,nodes:r,nodeSchemaMap:o}),rightInfo:en({text:p.rightKey,nodes:r,nodeSchemaMap:o})})})})})}catch(m){console.error(m)}return c},[a.input,r]);return u.length?(0,e.jsx)("div",{children:u.map(function(c){var m,p=c.conditionId===((m=a.multiBranchResults)===null||m===void 0||(m=m[0])===null||m===void 0?void 0:m.condition_id);return(0,e.jsxs)(w.Z,{vertical:!0,gap:8,className:we()(Ie["condition-result-item"],ve()({},Ie.active,p)),children:[(0,e.jsxs)(w.Z,{gap:16,align:"center",children:[(0,e.jsx)("div",{style:{maxWidth:100},className:Ie["condition-title"],children:c.label}),(0,e.jsxs)(w.Z,{className:Ie["condition-desc"],align:"center",gap:4,children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.BranchTitleHeader.index.whenSatisfy",dm:"\u5F53\u6EE1\u8DB3\u4EE5\u4E0B"})}),(0,e.jsx)("span",{className:Ie["logic-label"],children:$n[c.logic]}),(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.BranchTitleHeader.index.conditions",dm:"\u6761\u4EF6\u65F6"})})]}),p&&(0,e.jsx)(Ca.Z,{className:Ie["condition-result-tag"],color:"success",children:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.JudgeResult.successHitThisCondition",dm:"\u6210\u529F\uFF1A\u547D\u4E2D\u672C\u6761\u4EF6"})})]}),c.subBranches.map(function(k,g){return(0,e.jsx)(Jn,{subBranch:k},g)})]},c.conditionId)})}):(0,e.jsxs)(w.Z,{align:"center",className:we()(Ie["condition-result-item"],Ie.active),justify:"space-between",children:[(0,e.jsx)("span",{className:Ie["condition-title"],children:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.JudgeResult.hitDefaultCondition",dm:"\u547D\u4E2D\u3010\u9ED8\u8BA4\u3011\u6761\u4EF6"})}),(0,e.jsx)(Ca.Z,{className:Ie["condition-result-tag"],color:"success",children:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.JudgeResult.successHitThisCondition",dm:"\u6210\u529F\uFF1A\u547D\u4E2D\u672C\u6761\u4EF6"})})]})}),Qn={failBranch:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.exceptionBranch",dm:"\u5F02\u5E38\u5206\u652F"}),defaultValue:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.defaultValue",dm:"\u9ED8\u8BA4\u503C"})};function Xn(s){var a,r=s.nodeResult,o=(0,ce.Z)({current:1,showError:!1}),u=B()(o,2),c=u[0],m=u[1],p=(0,d.useState)(!0),k=B()(p,2),g=k[0],b=k[1],_=(0,d.useMemo)(function(){return r.batches.filter(function(x){return x.node_status==="fail"})},[r.batches]),f=(0,d.useMemo)(function(){return c.showError?_:r.batches},[r,c.showError,_]),v=(0,d.useMemo)(function(){return r.batches.length?f[c.current-1]:r},[c.current,f,r]),h=(0,d.useMemo)(function(){var x,S;return(0,e.jsxs)(e.Fragment,{children:[!!((x=v.retry)!==null&&x!==void 0&&x.happened)&&(0,e.jsxs)(fe.Z,{className:Ie.tag,children:[n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.retryProcessing",dm:"\u91CD\u8BD5\u5904\u7406\uFF1A"}),v.retry.retry_times]}),!!((S=v.try_catch)!==null&&S!==void 0&&S.happened)&&(0,e.jsxs)(fe.Z,{className:Ie.tag,children:[n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.exceptionHandling",dm:"\u5F02\u5E38\u5904\u7406\uFF1A"}),Qn[v.try_catch.strategy]]})]})},[v]),R=(0,d.useMemo)(function(){switch(v.node_type){case"Start":return(0,e.jsx)(ma,{label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.input",dm:"\u8F93\u5165"}),value:v.input});case"Judge":return(0,e.jsx)(Yn,{multiBranchResults:v.multi_branch_results,input:v.input});case"End":return(0,e.jsx)(ma,{type:v.output_type,label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.output",dm:"\u8F93\u51FA"}),value:v.output});case"LLM":return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ma,{label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.input",dm:"\u8F93\u5165"}),value:v.input}),h,(0,e.jsx)(ma,{type:v.output_type,label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.output",dm:"\u8F93\u51FA"}),value:v.output})]});case"Input":return(0,e.jsx)(ma,{label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.input",dm:"\u8F93\u5165"}),value:v.input});case"Output":return(0,e.jsx)(ma,{label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.output",dm:"\u8F93\u51FA"}),type:v.output_type,value:JSON.stringify({output:v.output})});default:return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ma,{label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.input",dm:"\u8F93\u5165"}),value:v.input}),h,!!v.output&&(0,e.jsx)(ma,{type:v.output_type,label:n.Z.get({id:"main.pages.App.Workflow.components.NodeResultPanel.index.output",dm:"\u8F93\u51FA"}),value:v.output})]})}},[v]);return(0,e.jsxs)("div",{className:we()(Ie["node-result-panel"],ve()({},Ie["node-result-panel-child"],r.parent_node_id)),children:[(0,e.jsxs)("div",{className:we()(Ie["node-result-header"],"flex-justify-between"),onClick:function(){b(!g)},children:[(0,e.jsxs)("div",{className:"flex items-center gap-[6px]",children:[(0,e.jsx)(l.Dx,{size:"small",nodeType:r.node_type}),(0,e.jsx)("span",{className:Ie["node-result-title"],children:r.node_name}),(0,e.jsx)(Xa.r,{expand:g,setExpand:function(){b(!g)}})]}),(0,e.jsxs)(w.Z,{onClick:function(S){return S.stopPropagation()},gap:8,children:[((a=r.batches)===null||a===void 0?void 0:a.length)>0&&(0,e.jsx)(Ue.Z,{total:r.batches.length,pageSize:1,current:c.current,onChange:function(S){return m({current:S})},size:"small",simple:!0,showSizeChanger:!1}),(0,e.jsx)(Za,{usages:r.usages,status:r.node_status,execTime:r.node_exec_time})]})]}),g&&(0,e.jsx)("div",{className:Ie["node-result-content"],children:R})]})}var Ia=(0,d.memo)(function(s){var a=s.data,r=a===void 0?[]:a,o=s.statusInfo,u=(0,d.useMemo)(function(){return r.filter(function(c){return!["IteratorStart","IteratorEnd","ParallelStart","ParallelEnd"].includes(c.node_type)})},[r]);return u.length?(0,e.jsxs)("div",{className:"flex flex-col gap-[12px]",children:[o&&(0,e.jsx)("div",{className:"flex justify-end",children:(0,e.jsx)(Za,i()({},o))}),(0,e.jsx)("div",{className:Ie["result-panel-list"],children:u.map(function(c){return(0,e.jsx)(Xn,{nodeResult:c},c.node_id)})})]}):null}),Uo=null,qn=t(60603),et=t(21744),na=t(58541),at={form:"form___wiPM1"},an=(0,d.memo)(function(a){var r=na.Z.useForm(),o=B()(r,1),u=o[0],c=(0,d.useState)(!1),m=B()(c,2),p=m[0],k=m[1],g=a.nodeData.node_content,b=(0,d.useMemo)(function(){return["success","stop"].includes(a.nodeData.node_status)||p},[a.nodeData.node_status,p]);(0,d.useEffect)(function(){var f={};g.forEach(function(v){f[v.key]=v.value||""}),u.setFieldsValue(f)},[g]);var _=function(){u.validateFields().then(function(v){k(!0);var h=[];Object.keys(v).forEach(function(R){h.push({key:R,value:v[R]})}),a.onSubmit({input_params:h,resume_node_id:a.nodeData.node_id,resume_parent_id:a.nodeData.parent_node_id})})};return(0,e.jsxs)(na.Z,{className:at.form,disabled:b,form:u,children:[g.map(function(f){return(0,e.jsx)(na.Z.Item,{label:f.key,name:f.key,required:f.required,rules:[{required:f.required,message:n.Z.get({id:"main.pages.App.Workflow.components.UserInputForm.index.enter",dm:"\u8BF7\u8F93\u5165"})}],children:(0,e.jsx)(xe.Z,{placeholder:n.Z.get({id:"main.pages.App.Workflow.components.UserInputForm.index.enter",dm:"\u8BF7\u8F93\u5165"})})},f.key)}),(0,e.jsx)(T.Z,{className:"w-full",disabled:b,type:"primary",onClick:_,children:a.nodeData.node_status==="success"?n.Z.get({id:"main.pages.App.Workflow.components.UserInputForm.index.submitted",dm:"\u5DF2\u63D0\u4EA4"}):n.Z.get({id:"main.pages.App.Workflow.components.UserInputForm.index.submit",dm:"\u63D0\u4EA4"})})]})}),oa={"var-group-name":"var-group-name___FeDrk","var-key":"var-key___GSaRD","var-key-type":"var-key-type___RxlXp","var-key-desc":"var-key-desc___XgF3u",tabs:"tabs___kqo8B",segmented:"segmented___f53w7","result-title":"result-title___RnZYw","result-panel-list":"result-panel-list___wTa3A","result-panel-content":"result-panel-content___k2WEW","test-button":"test-button___PjBy5"};function nn(s){var a=Le(function(p){return p.debugInputParams}),r=Le(function(p){return p.setDebugInputParams}),o=function(k){var g=a.map(function(b){return b.key===k.key&&b.source===k.source?k:b});r(g)},u=(0,d.useMemo)(function(){var p=[],k=[];return a.forEach(function(g){g.source==="user"?p.push(g):(!s.disableShowQuery||g.key!=="query")&&k.push(g)}),{userParams:p,systemParams:k}},[a,s.disableShowQuery]),c=u.userParams,m=u.systemParams;return(0,e.jsxs)("div",{className:we()("flex flex-1 overflow-y-auto flex-col gap-[24px]",{"px-[20px]":s.showPadding}),children:[(0,e.jsxs)("div",{className:"flex flex-col gap-[12px]",children:[(0,e.jsx)("div",{className:oa["var-group-name"],children:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.InputParamsForm.index.customVariable",dm:"\u81EA\u5B9A\u4E49\u53D8\u91CF"})}),c.map(function(p){return(0,e.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-[4px]",children:[(0,e.jsxs)("div",{className:"flex gap-[4px] items-center",children:[(0,e.jsx)("span",{className:oa["var-key"],children:p.key}),(0,e.jsx)("span",{className:oa["var-key-type"],children:"[".concat(p.type,"]")})]}),(0,e.jsx)("div",{className:oa["var-key-desc"],children:p.desc})]}),(0,e.jsx)(za,{type:p.type,value:p.value,onChange:function(g){o(i()(i()({},p),{},{value:g.value}))}})]},p.key)})]}),!!m.length&&(0,e.jsxs)("div",{className:"flex flex-col gap-[12px]",children:[(0,e.jsx)("div",{className:oa["var-group-name"],children:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.InputParamsForm.index.builtinVariable",dm:"\u5185\u7F6E\u53D8\u91CF"})}),m.map(function(p){return(0,e.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-[4px]",children:[(0,e.jsxs)("div",{className:"flex gap-[4px] items-center",children:[(0,e.jsx)("span",{className:oa["var-key"],children:p.key}),(0,e.jsx)("span",{className:oa["var-key-type"],children:"[".concat(p.type,"]")})]}),(0,e.jsx)("div",{className:oa["var-key-desc"],children:p.desc})]}),(0,e.jsx)(xe.Z,{placeholder:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.InputParamsForm.index.enter",dm:"\u8BF7\u8F93\u5165"}),value:p.value,onChange:function(g){return o(i()(i()({},p),{},{value:g.target.value}))}})]},p.key)})]})]})}function nt(s){return(0,e.jsx)(Ya.Z,{open:!0,placement:"bottom",height:"100%",onClose:s.onClose,getContainer:!1,title:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.InputParamsForm.index.inputParamConfiguration",dm:"\u5165\u53C2\u53D8\u91CF\u914D\u7F6E"}),children:(0,e.jsx)(nn,{disableShowQuery:s.disableShowQuery})})}var tt=(0,d.memo)(nn),tn=function(a){var r=a.data;return(0,e.jsx)("div",{className:oa["result-panel-content"],children:(0,e.jsx)(qa.Z,{baseFontSize:12,content:r.text||""})})},La=function(a){if(!a)return[];var r=[];return a.node_results.forEach(function(o){o.usages&&(r=[].concat(Ce()(r),Ce()(o.usages)))}),r},rt=(0,d.memo)(function(){var a=Le(function(Z){return Z.debugInputParams}),r=(0,l.j8)(),o=r.updateTaskStore,u=(0,l.oR)(function(Z){return Z.setSelectedNode}),c=(0,l.oR)(function(Z){return Z.setShowResults}),m=Le(function(Z){return Z.appId}),p=(0,l.PW)(),k=p.focusElement,g=(0,d.useRef)(null),b=(0,d.useRef)(null),_=(0,d.useRef)(!1),f=(0,ce.Z)({loading:!1,taskInfo:null,activeTab:"input"}),v=B()(f,2),h=v[0],R=v[1],x=(0,d.useRef)(null),S=(0,d.useRef)(""),C=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(x.current){var _e=x.current,be=_e.scrollHeight-_e.scrollTop-_e.offsetHeight<=100;if(I||be)var Me=setTimeout(function(){_e.scrollTo({top:_e.scrollHeight-_e.offsetHeight,left:0,behavior:"smooth"}),clearTimeout(Me)},100)}},P=function(){b.current&&(clearTimeout(b.current),b.current=null)};(0,Ma.Z)(function(){_.current=!0,P()});var Y=function(){u(null),R({loading:!0,activeTab:"result"}),$a({app_id:m,inputs:a}).then(function(I){g.current=I.task_id,c(!0),j()})},j=function Z(){P(),g.current&&Wa({task_id:g.current}).then(function(I){if(!_.current){var _e=I.node_results[I.node_results.length-1];_e.node_id!==S.current&&(k({nodeId:_e.node_id}),S.current=_e.node_id),o(I),C(I.task_results.some(function(be){return be.node_type==="Input"&&be.node_status==="pause"})),R({taskInfo:I}),I.task_status==="executing"?b.current=setTimeout(function(){Z()},500):(R({loading:!1}),P())}})},D=(0,d.useMemo)(function(){return La(h.taskInfo)},[h.taskInfo]),U=function(I){g.current&&(u(null),Ja(i()({app_id:m,task_id:g.current},I)).then(function(){c(!0),j()}))};return(0,e.jsxs)("div",{className:"h-full flex flex-col gap-[12px]",children:[(0,e.jsx)(qn.Z,{value:h.activeTab,className:oa.segmented,onChange:function(I){return R({activeTab:I})},options:[{label:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.input",dm:"\u8F93\u5165"}),value:"input"},{label:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.result",dm:"\u7ED3\u679C"}),value:"result"}]}),(0,e.jsx)(et.Z,{className:oa.tabs,activeKey:h.activeTab,items:[{label:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.input",dm:"\u8F93\u5165"}),key:"input",children:(0,e.jsxs)("div",{className:"h-full flex flex-col gap-[12px] pb-[20px]",children:[(0,e.jsx)(tt,{showPadding:!0}),(0,e.jsx)(T.Z,{className:we()("mx-[20px] gap-[8px]",oa["test-button"]),loading:h.loading,type:"primaryLess",onClick:Y,children:h.loading?n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.testing",dm:"\u6D4B\u8BD5\u4E2D..."}):n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.startTesting",dm:"\u5F00\u59CB\u6D4B\u8BD5"})})]})},{label:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.output",dm:"\u8F93\u51FA"}),key:"result",children:(0,e.jsx)("div",{ref:x,className:"h-full overflow-y-auto relative px-[20px] pb-[16px] flex flex-col gap-[12px]",children:h.taskInfo?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex-justify-between",children:[(0,e.jsx)("div",{className:oa["result-title"],children:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.runResult",dm:"\u8FD0\u884C\u7ED3\u679C"})}),h.taskInfo&&(0,e.jsx)(Za,{usages:D,status:h.taskInfo.task_status,execTime:h.taskInfo.task_exec_time})]}),(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)(Ia,{data:h.taskInfo.node_results}),h.taskInfo.task_results.map(function(Z){return Z.node_type==="Input"?(0,e.jsx)(an,{nodeData:Z,onSubmit:U},"".concat(Z.node_id,"_index")):(0,e.jsx)(tn,{data:{text:Z.node_content}},"".concat(Z.node_id,"_index"))})]})]}):(0,e.jsx)(Ea.Z,{data:{},title:n.Z.get({id:"main.pages.App.Workflow.components.TaskTestPanel.index.outputResultDisplayed",dm:"\u8F93\u51FA\u7ED3\u679C\u5728\u8FD9\u91CC\u5C55\u793A"})})})}]})]})}),ta={"drawer-title":"drawer-title___l2Tzi",drawer:"drawer___vfNBC","drawer-mask":"drawer-mask___pn1Qs","ag-ant-drawer-header-title":"ag-ant-drawer-header-title___j9RX2","single-var-name":"single-var-name___rzxVf","single-var-type":"single-var-type___IYqoY","single-var-desc":"single-var-desc___DOc7Q","panel-form-title":"panel-form-title___cqdap","test-form":"test-form___dJtgf","test-form-inputs":"test-form-inputs____f_Lj","test-result":"test-result___FlFK7","title-wrap":"title-wrap___FDvFv",title:"title____f8b5","test-result-content":"test-result-content___Y_QjV"},ot=function(a){var r=(0,l.Hc)(a.replace(/[\[]]/g,""))[0],o=r.split(".");return o[o.length-1]},it=function(a){var r=a.selectedNodeData,o=a.nodes,u=a.variableKeyList,c=a.globalVariableList,m=a.systemVariableList,p=a.nodeSchemaMap,k=[];if(!u.length)return k;var g={};return u.forEach(function(b){var _,f=b.match(/\${([^.]+)\./),v=f?f[1]:b;if(!g[v])switch(v){case"conversation":g[v]=c[0].children.map(function(Y){return{type:Y.type,key:Y.value,nodeType:"conversation",nodeTitle:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.conversationVariable",dm:"\u4F1A\u8BDD\u53D8\u91CF"})}});break;case"sys":g[v]=m[0].children.map(function(Y){return{type:Y.type,key:Y.value,nodeType:"sys",nodeTitle:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.builtinVariable",dm:"\u5185\u7F6E\u53D8\u91CF"})}});break;default:var h=o.find(function(Y){return Y.id===v});if(h)if(h.id!==r.parentId){var R=(0,l.VB)({outputParams:h.data.output_params,nodeId:h.id,flat:!0});g[v]=R.map(function(Y){return{type:Y.type,key:Y.value,nodeTitle:h.data.label,nodeType:h.type}})}else{var x,S;if(!p[h.type].getParentNodeVariableList)return;var C=(x=p[h.type])===null||x===void 0||(S=x.getParentNodeVariableList)===null||S===void 0?void 0:S.call(x,h);if(!C)return;g[v]=C[0].children.map(function(Y){return{type:Y.type,key:Y.value,nodeTitle:h.data.label,nodeType:h.type}})}break}var P=(_=g[v])===null||_===void 0?void 0:_.find(function(Y){return Y.key===b});P&&k.push({type:P.type,key:b,value:void 0,displayKey:ot(b),nodeTitle:P.nodeTitle,nodeType:P.nodeType})}),k},st=function(a){var r=a.match(/\${([^}]+)}/);return r?r[1]:a},lt=function(a){var r=a.selectedNodeData,o=(0,l.oR)(function(be){return be.nodeSchemaMap}),u=(0,l._J)(function(be){return be.nodes}),c=(0,l._J)(function(be){return be.edges}),m=Le(function(be){return be.appId}),p=Le(function(be){return be.globalVariableList}),k=(0,l.bx)(),g=k.getSystemVariableList,b=(0,ce.Z)({inputs:[],taskInfo:null,loading:!1}),_=B()(b,2),f=_[0],v=_[1],h=(0,d.useRef)(null),R=(0,d.useRef)(null),x=(0,l.oR)(function(be){return be.setShowResults}),S=(0,l.j8)(),C=S.updateTaskStore;(0,oe.Z)(function(){var be,Me,he=g(),Ze=it({selectedNodeData:r,nodes:u,variableKeyList:((be=o[r.type])===null||be===void 0||(Me=be.getRefVariables)===null||Me===void 0?void 0:Me.call(be,r.data))||[],globalVariableList:p,nodeSchemaMap:o,systemVariableList:he});v({inputs:Ze})});var P=function(){h.current&&(clearTimeout(h.current),h.current=null)};(0,Ma.Z)(function(){P()});var Y=function be(){P(),R.current&&Wa({task_id:R.current}).then(function(Me){Me.node_results=Me.node_results.filter(function(he){return!["Start","End"].includes(he.node_type)}),Me.task_results=Me.task_results.filter(function(he){return!["Start","End"].includes(he.node_type)}),C(Me),v({taskInfo:Me}),Me.task_status==="executing"?h.current=setTimeout(function(){be()},500):(v({loading:!1}),P())})},j=function(){var Me=o[r.type].isGroup?{block:{nodes:[],edges:[]}}:{};if(o[r.type].isGroup){var he=u.filter(function(Ze){return Ze.parentId===r.id});Me.block&&(Me.block.nodes=he.map(function(Ze){return{id:Ze.id,name:Ze.data.label,type:Ze.type,config:Ze.data}}),c.forEach(function(Ze){he.some(function(Ye){return[Ze.source,Ze.target].includes(Ye.id)})&&Me.block.edges.push({source:Ze.source,target:Ze.target,id:Ze.id,target_handle:Ze.targetHandle,source_handle:Ze.sourceHandle})}))}Dn({app_id:m,nodes:[{id:r.id,name:r.data.label,type:r.type,config:i()(i()({},r.data),{},{node_param:i()(i()({},r.data.node_param),Me)})}],edges:[],input_params:f.inputs.map(function(Ze){return{key:st(Ze.key),type:Ze.type,value:Ze.value}})}).then(function(Ze){v({loading:!0}),x(!0),R.current=Ze.task_id,Y()})},D=(0,d.useMemo)(function(){return(0,e.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,e.jsx)("span",{className:we()(ta["drawer-title"],"font-semibold"),children:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.testRun",dm:"\u6D4B\u8BD5\u8FD0\u884C"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"size-[28px] flex-center",children:(0,e.jsx)(y.Z,{type:o[r.type].iconType})}),(0,e.jsx)("span",{className:ta["drawer-title"],children:r.data.label})]})]})},[r.type,r.data.label,o]),U=function(Me){v({inputs:f.inputs.map(function(he){return he.key===Me.key?i()(i()({},he),{},{value:Me.value}):he})})},Z=function(){var Me;P(),v({loading:!1,taskInfo:i()(i()({},f.taskInfo),{},{task_status:"interrupted",node_results:(((Me=f.taskInfo)===null||Me===void 0?void 0:Me.node_results)||[]).map(function(he){return i()(i()({},he),{},{node_status:["executing","pause"].includes(he.node_status)?"interrupted":he.node_status})})})})},I=function(){v({inputs:f.inputs.map(function(Me){return i()(i()({},Me),{},{value:void 0})})})},_e=(0,d.useMemo)(function(){return La(f.taskInfo)},[f.taskInfo]);return(0,e.jsx)(Ya.Z,{onClose:a.onClose,open:!0,className:ta.drawer,height:"90%",placement:"bottom",getContainer:!1,title:D,maskClassName:ta["drawer-mask"],children:(0,e.jsxs)("div",{className:"h-full flex-col flex",children:[(0,e.jsxs)("div",{className:ta["test-form"],children:[f.inputs.length?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:ta["panel-form-title"],children:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.inputVariables",dm:"\u8F93\u5165\u53D8\u91CF"})}),(0,e.jsx)("div",{className:ta["test-form-inputs"],children:f.inputs.map(function(be){return(0,e.jsxs)("div",{className:"flex flex-col gap-[8px]",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-[4px]",children:[(0,e.jsxs)("div",{className:"flex items-center gap-[4px]",children:[(0,e.jsxs)(w.Z,{align:"center",gap:2,children:[(0,e.jsx)(l.Dx,{noWidth:!0,showBg:!1,nodeType:be.nodeType}),(0,e.jsx)("span",{className:ta["single-var-node-title"],children:be.nodeTitle}),"/",(0,e.jsx)(me.Z.Text,{style:{maxWidth:100},className:ta["single-var-name"],children:be.displayKey||be.key})]}),(0,e.jsx)("span",{className:ta["single-var-type"],children:be.type})]}),(0,e.jsx)("div",{className:ta["single-var-desc"]})]}),(0,e.jsx)(za,{value:be.value,type:be.type,onChange:function(he){U(i()(i()({},be),{},{value:he.value}))}})]},be.key)})})]}):(0,e.jsx)("div",{className:"flex-center",children:(0,e.jsx)(le.Z,{size:150,description:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index\u6682\u65E0\u8F93\u5165",dm:"\u6682\u65E0\u8F93\u5165"})})}),(0,e.jsxs)("div",{className:"flex gap-[8px]",children:[(0,e.jsx)(T.Z,{loading:f.loading,onClick:j,color:"default",variant:"solid",children:f.loading?n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.running",dm:"\u8FD0\u884C\u4E2D..."}):n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.run",dm:"\u8FD0\u884C"})}),f.loading&&(0,e.jsx)(T.Z,{onClick:Z,children:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.stop",dm:"\u505C\u6B62"})}),(0,e.jsx)(T.Z,{disabled:f.loading,onClick:I,children:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.reset",dm:"\u91CD\u7F6E"})})]})]}),(0,e.jsxs)("div",{className:ta["test-result"],children:[(0,e.jsxs)("div",{className:ta["title-wrap"],children:[(0,e.jsx)("span",{className:ta.title,children:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.runResult",dm:"\u8FD0\u884C\u7ED3\u679C"})}),f.taskInfo&&(0,e.jsx)(Za,{usages:_e,status:f.taskInfo.task_status,execTime:f.taskInfo.task_exec_time})]}),(0,e.jsx)("div",{className:ta["test-result-content"],children:f.taskInfo?(0,e.jsx)(Ia,{data:f.taskInfo.node_results}):(0,e.jsx)(Ea.Z,{data:{},title:n.Z.get({id:"main.pages.App.Workflow.components.SingleNodeDrawer.index.outputResultDisplayed",dm:"\u8F93\u51FA\u7ED3\u679C\u5728\u8FD9\u91CC\u5C55\u793A"})})})]})]})})},dt=(0,d.memo)(lt),ut=(0,d.memo)(function(){var a=(0,l.oR)(function(u){return u.taskStore}),r=(0,l.oR)(function(u){return u.showResults}),o=(0,l.oR)(function(u){return u.setShowResults});return!a||r?null:(0,e.jsx)(ne.Z,{title:n.Z.get({id:"main.pages.App.Workflow.components.TaskResultShowBtn.index.showTestResult",dm:"\u5C55\u793A\u6D4B\u8BD5\u7ED3\u679C"}),children:(0,e.jsx)(J.Z,{icon:(0,e.jsx)(y.Z,{type:"spark-visable-line"}),onClick:function(){o(!0)}})})}),ya=t(11424),ct=t(87252),rn=t(41431),pt=t(32248),on=t(28245),sn={header:"header___hfj83","chat-container":"chat-container___VKXjD"},mt=function(a){return(0,e.jsx)(an,{nodeData:a.data,onSubmit:function(o){return a.context.onInput({params:o,type:"resume"})}})},gt=function(a){return(0,e.jsx)(Ia,{data:a.data.results,statusInfo:a.data.statusInfo})},ft=(0,d.memo)(function(){var a=Le(function(ze){return ze.debugInputParams}),r=Le(function(ze){return ze.appId}),o=(0,l.oR)(function(ze){return ze.setShowResults}),u=(0,l.oR)(function(ze){return ze.taskStore}),c=(0,l.j8)(),m=c.updateTaskStore,p=(0,l.PW)(),k=p.focusElement,g=(0,d.useState)(void 0),b=B()(g,2),_=b[0],f=b[1],v=(0,d.useState)(!1),h=B()(v,2),R=h[0],x=h[1],S=(0,l.oR)(function(ze){return ze.setSelectedNode}),C=(0,d.useState)(!1),P=B()(C,2),Y=P[0],j=P[1],D=(0,d.useRef)(""),U=(0,d.useRef)({answer:void 0,query:{id:"",cards:[],content:"",role:"user",inputs:[],msgStatus:"finished"}}),Z=(0,d.useRef)(null),I=(0,d.useRef)(!1),_e=(0,d.useRef)(null),be=function(Ee){var Ke,$e=(Ke=_e.current)===null||Ke===void 0?void 0:Ke.updateMessage(Ee);return $e},Me=function(){Z.current&&(clearTimeout(Z.current),Z.current=null)},he=function(){if(_e.current){var Ee=(0,ya.LH)("welcome",{modalType:"textDialog"});_e.current.updateMessage({id:"welcome",cards:[Ee],role:"assistant",content:""})}};(0,oe.Z)(function(){he()}),(0,Ma.Z)(function(){I.current=!0,Me()});var Ze=function(Ee){var Ke,$e;(Ke=_e.current)===null||Ke===void 0||Ke.removeMessage(Ee);var He=($e=_e.current)===null||$e===void 0?void 0:$e.getMessages();if(He){var ra=He[He.length-1];Cn({query:ra.content,type:"regenerate"})}},Ye=function(Ee){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(0,ya.LH)("Footer",{right:(0,e.jsx)(ct.p4,{data:(0,on.Z)([{icon:(0,e.jsx)(ne.Z,{placement:"top",title:n.Z.get({id:"main.pages.App.Workflow.components.ChatTestPanel.index.clickCopyRequestId",dm:"\u70B9\u51FB\u590D\u5236Request ID"}),trigger:"hover",children:(0,e.jsx)(y.Z,{type:"spark-debug-line"})}),label:"",onClick:function(){(0,ue.JG)(Ee.task_id),G.ZP.success(n.Z.get({id:"main.pages.App.Workflow.components.ChatTestPanel.index.copySuccess",dm:"\u590D\u5236\u6210\u529F"}))}},Ke&&{icon:(0,e.jsx)(ne.Z,{placement:"top",title:n.Z.get({id:"main.pages.App.Workflow.components.ChatTestPanel.index.regenerate",dm:"\u91CD\u65B0\u751F\u6210"}),trigger:"hover",children:(0,e.jsx)(y.Z,{type:"spark-replace-line",size:"small"})}),label:"",onClick:function(){var He,ra=(He=_e.current)===null||He===void 0?void 0:He.getMessage(Ee.id);Ee&&Ze(ra)}}])})})},kn=function(Ee){if(U.current.answer){m(Ee),["fail","success"].includes(Ee.task_status)&&(U.current.answer.msgStatus="finished"),Ee.task_status==="stop"&&(U.current.answer.msgStatus="interrupted");var Ke=Ee.task_results,$e=[];Ke.forEach(function(He){He.node_type==="Input"?$e.push((0,ya.LH)("formCard",He)):$e.push((0,ya.LH)("textCard",{text:He.node_content||""}))}),U.current.answer.cards=(0,on.Z)([(0,ya.LH)("nodeResultCard",{results:Ee.node_results,statusInfo:{usages:La(Ee),status:Ee.task_status,execTime:Ee.task_exec_time}})].concat($e,[["fail","success","stop"].includes(Ee.task_status)&&Ye(U.current.answer)])),be(U.current.answer),Ke.some(function(He){return He.node_type==="Input"&&He.node_status==="pause"})&&setTimeout(function(){var He;(He=_e.current)===null||He===void 0||He.scrollToBottom()},200)}},jn=function ze(){var Ee;Me(),U.current.answer&&U.current.answer.task_id&&Wa({task_id:(Ee=U.current.answer)===null||Ee===void 0?void 0:Ee.task_id}).then(function(Ke){if(!(!U.current.answer||U.current.answer.msgStatus==="interrupted"||I.current)){var $e=Ke.node_results[Ke.node_results.length-1];if($e.node_id!==D.current&&(k({nodeId:$e.node_id}),D.current=$e.node_id),kn(Ke),Ke.task_status==="executing")Z.current=setTimeout(function(){ze()},500);else{if(Ke.task_status!=="pause"){var He;x(!1),(He=_e.current)===null||He===void 0||He.setLoading(!1)}Me()}}})},Fo=function(Ee){U.current.answer={id:(0,rn.Z)(),cards:[],task_id:Ee,content:"",msgStatus:"generating",role:"assistant"},be(U.current.answer),jn()},Cn=function(Ee){var Ke,$e=Ee.query,He=Ee.params,ra=Ee.type;if(o(!0),S(null),ra==="resume"){if(!U.current.answer)return;Ja(i()({app_id:r,task_id:U.current.answer.task_id},He)).then(function(){jn()});return}if(!_){var Ba;(Ba=_e.current)===null||Ba===void 0||Ba.removeAllMessages()}ra==="regenerate"&&U.current.answer&&(U.current.answer.cards=(U.current.answer.cards||[]).map(function(sa){return sa.code==="Footer"?Ye(U.current.answer,!1):sa})),x(!0),(Ke=_e.current)===null||Ke===void 0||Ke.setLoading(!0),U.current.answer=void 0,ra!=="regenerate"&&(U.current.query={id:(0,rn.Z)(),cards:[],content:$e,role:"user",msgStatus:"finished",inputs:a.map(function(sa){return sa.source==="sys"&&sa.key==="query"?i()(i()({},sa),{},{value:$e}):sa})}),be(U.current.query),$a({conversation_id:_,app_id:r,inputs:U.current.query.inputs}).then(function(sa){_!==sa.conversation_id&&f(sa.conversation_id),Fo(sa.task_id)})},Bo=function(){var Ee;if(Me(),x(!1),(Ee=_e.current)===null||Ee===void 0||Ee.setLoading(!1),U.current.answer){var Ke,$e,He=i()(i()({},u),{},{task_status:"stop",node_results:u==null||(Ke=u.node_results)===null||Ke===void 0?void 0:Ke.map(function(ra){return i()(i()({},ra),{},{node_status:["executing","pause"].includes(ra.node_status)?"stop":ra.node_status})}),task_results:u==null||($e=u.task_results)===null||$e===void 0?void 0:$e.map(function(ra){return i()(i()({},ra),{},{node_status:["executing","pause"].includes(ra.node_status)?"stop":ra.node_status})})});kn(He)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(w.Z,{className:"h-full",vertical:!0,children:[(0,e.jsxs)(w.Z,{gap:8,className:sn.header,children:[(0,e.jsx)(ne.Z,{placement:"bottom",title:n.Z.get({id:"main.pages.App.Workflow.components.ChatTestPanel.index.paramConfig",dm:"\u5165\u53C2\u53C2\u6570\u914D\u7F6E"}),children:(0,e.jsx)(J.Z,{icon:(0,e.jsx)(y.Z,{type:"spark-setting-line",size:"small"}),bordered:!1,onClick:function(){return j(!0)}})}),(0,e.jsx)(ne.Z,{title:R?n.Z.get({id:"main.pages.App.Workflow.components.ChatTestPanel.index.dialogGenerating",dm:"\u6B63\u5728\u8FDB\u884C\u5BF9\u8BDD\u4E2D\uFF0C\u8BF7\u6682\u505C"}):n.Z.get({id:"main.pages.App.Workflow.components.ChatTestPanel.index.clearHistory",dm:"\u6E05\u7A7A\u8BB0\u5F55"}),children:(0,e.jsx)(J.Z,{icon:(0,e.jsx)(y.Z,{type:"spark-clear-line",size:"small"}),bordered:!1,disabled:R,onClick:function(){var Ee;f(void 0),(Ee=_e.current)===null||Ee===void 0||Ee.removeAllMessages(),he()}})})]}),(0,e.jsx)("div",{className:we()("flex-1 h-[1px]",sn["chat-container"]),children:(0,e.jsx)(pt.Z,{cardConfig:{nodeResultCard:gt,formCard:mt,textCard:tn,welcome:Ea.Z},uiConfig:{background:"transparent"},onInput:Cn,onStop:Bo,ref:_e})})]}),Y&&(0,e.jsx)(nt,{disableShowQuery:!0,onClose:function(){return j(!1)}})]})}),vt={testTypeSelector:"testTypeSelector___yvrOO"},ht=[{label:n.Z.get({id:"main.pages.App.Workflow.components.TestPanel.index.textChat",dm:"\u6587\u672C\u5BF9\u8BDD"}),value:"chat",desc:n.Z.get({id:"main.pages.App.Workflow.components.TestPanel.index.chatBasedInteraction",dm:"\u57FA\u4E8ELLM\u7684\u5BF9\u8BDD\u578B\u4EA4\u4E92\uFF0C\u9002\u5408\u8FDB\u884C\u590D\u6742\u7684\u591A\u8F6E\u5BF9\u8BDD"})},{label:n.Z.get({id:"main.pages.App.Workflow.components.TestPanel.index.textGeneration",dm:"\u6587\u672C\u751F\u6210"}),value:"task",desc:n.Z.get({id:"main.pages.App.Workflow.components.TestPanel.index.singleRoundInteraction",dm:"\u9762\u5411\u5355\u8F6E\u4EFB\u52A1\u7684\u751F\u6210\u5F0F\u4EA4\u4E92\uFF0C\u9002\u5408\u8FDB\u884C\u4FE1\u606F\u62BD\u53D6\u548C\u6587\u672C\u521B\u4F5C"})}];function xt(){var s=Le(function(_){return _.showTest}),a=Le(function(_){return _.setShowTest}),r=(0,d.useState)("task"),o=B()(r,2),u=o[0],c=o[1],m=(0,l.oR)(function(_){return _.taskStore}),p=(0,l.j8)(),k=p.clearTaskStore,g=(0,d.useMemo)(function(){return(0,e.jsxs)("div",{className:"flex gap-[8px] items-center",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.TestPanel.index.test",dm:"\u6D4B\u8BD5"})}),(0,e.jsx)(l.hk,{className:vt.testTypeSelector,onChange:function(f){if((m==null?void 0:m.task_status)==="executing"||(m==null?void 0:m.task_status)==="pause"){G.ZP.warning(n.Z.get({id:"main.pages.App.Workflow.components.TestPanel.executingWorkflow",dm:"\u6B63\u5728\u6267\u884C\u5DE5\u4F5C\u6D41\uFF0C\u8BF7\u5148\u505C\u6B62"}));return}c(f)},value:u,variant:"borderless",options:ht,popupMatchSelectWidth:!1})]})},[u,m==null?void 0:m.task_status]),b=function(){if((m==null?void 0:m.task_status)==="executing"||(m==null?void 0:m.task_status)==="pause"){G.ZP.warning(n.Z.get({id:"main.pages.App.Workflow.components.TestPanel.executingWorkflow",dm:"\u6B63\u5728\u6267\u884C\u5DE5\u4F5C\u6D41\uFF0C\u8BF7\u5148\u505C\u6B62"}));return}a(!1),k()};return s?(0,e.jsx)(l.Ux,{minWidth:500,defaultWidth:500,maxWidth:600,children:(0,e.jsx)(l.lk,{noPadding:!0,onClose:b,title:g,children:u==="chat"?(0,e.jsx)(ft,{}):(0,e.jsx)(rt,{})})}):null}var _t=(0,d.memo)(function(a){var r=(0,l.oR)(function(u){return u.taskStore}),o=(0,d.useMemo)(function(){return["executing","pause"].includes((r==null?void 0:r.task_status)||"")},[r==null?void 0:r.task_status]);return(0,e.jsx)(ne.Z,{trigger:"hover",title:o?n.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.dialogProcessingProhibitedSwitchVersion",dm:"\u5BF9\u8BDD\u8FDB\u884C\u4E2D\uFF0C\u7981\u6B62\u5207\u6362\u7248\u672C"}):n.Z.get({id:"main.components.HistoryPanel.index.historyVersion",dm:"\u5386\u53F2\u7248\u672C"}),children:(0,e.jsx)(T.Z,{iconType:"spark-auditLog-line",onClick:function(){a.setShowHistoryPanel(!0)},disabled:o,children:n.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.versionManagement",dm:"\u7248\u672C\u7BA1\u7406"})})})}),bt=function(){var a=Le(function(u){return u.globalVariableList}),r=Le(function(u){return u.setGlobalVariableList}),o=(0,d.useCallback)(function(u){r(u!=null&&u.length?[{label:n.Z.get({id:"main.pages.App.Workflow.hooks.useGlobalVariableList.index.conversationVariable",dm:"\u4F1A\u8BDD\u53D8\u91CF"}),nodeId:"conversation",nodeType:"conversation",children:u.map(function(c){return{label:c.key,value:"${conversation.".concat(c.key,"}"),type:c.type}})}]:[])},[r]);return{globalVariableList:a,initGlobalVariableList:o}},ln=function(){var a=Le(function(c){return c.appId}),r=Le(function(c){return c.showTest}),o=Le(function(c){return c.setDebugInputParams}),u=(0,d.useCallback)(function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;!a||!r&&!c||On({app_id:a}).then(function(m){o(m)})},[a,r]);return{initDebug:u}},yt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({hasFailBranch:a.data.node_param.try_catch_config.strategy==="failBranch"},a))}),kt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),jt=(0,d.memo)(function(a){var r=a.data.node_param;return(0,e.jsxs)(l.Hd,i()(i()({disableShowSourceHandle:!0},a),{},{children:[r.conditions.map(function(o){return o.id==="default"?null:(0,e.jsxs)("div",{className:"spark-flow-judge-branch flex-justify-between",children:[(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:o.subject},style:{maxWidth:200,fontSize:12},children:o.id==="default"?n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.node.default",dm:"\u9ED8\u8BA4"}):o.subject||n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.node.noIntentionConfigured",dm:"\u6682\u672A\u914D\u7F6E\u610F\u56FE"})}),(0,e.jsx)(l.Wp,{className:"spark-flow-judge-branch-handle",nodeType:a.type,nodeId:a.id,handleId:"".concat(a.id,"_").concat(o.id)})]},o.id)}),(0,e.jsxs)("div",{className:"spark-flow-judge-branch flex-justify-between",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.node.default",dm:"\u9ED8\u8BA4"})}),(0,e.jsx)(l.Wp,{className:"spark-flow-judge-branch-handle",nodeType:a.type,nodeId:a.id,handleId:"".concat(a.id,"_default")})]})]}))}),Ct=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({disableShowSourceHandle:!0},a))}),Zt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),wt=(0,d.memo)(function(a){return(0,e.jsx)(l.Gw,i()({},a))}),At=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({disableAction:!0,disableShowSourceHandle:!0},a))}),St=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({disableAction:!0,disableShowTargetHandle:!0},a))}),Nt={"judge-label":"judge-label___ZL4Uk"},Pt=(0,d.memo)(function(a){var r=a.data.node_param;return(0,e.jsxs)(l.Hd,i()(i()({disableShowSourceHandle:!0},a),{},{children:[r.branches.map(function(o){return o.id==="default"?null:(0,e.jsxs)("div",{className:"spark-flow-judge-branch flex-justify-between",children:[(0,e.jsx)(me.Z.Text,{className:Nt["judge-label"],ellipsis:{tooltip:o.label},style:{maxWidth:200},children:o.label}),(0,e.jsx)("span",{children:o.id==="default"?"ELSE":"IF"}),(0,e.jsx)(l.Wp,{className:"spark-flow-judge-branch-handle",nodeType:a.type,nodeId:a.id,handleId:"".concat(a.id,"_").concat(o.id)})]},o.id)}),(0,e.jsxs)("div",{className:"spark-flow-judge-branch flex-justify-between",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.nodes.Judge.node.default",dm:"\u9ED8\u8BA4"})}),(0,e.jsx)("span",{children:"ELSE"}),(0,e.jsx)(l.Wp,{className:"spark-flow-judge-branch-handle",nodeType:a.type,nodeId:a.id,handleId:"".concat(a.id,"_default")})]})]}))}),Tt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({hasFailBranch:a.data.node_param.try_catch_config.strategy==="failBranch"},a))}),Et=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),Wt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),Mt=(0,d.memo)(function(a){return(0,e.jsx)(l.Gw,i()({},a))}),It=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({disableAction:!0,disableShowSourceHandle:!0},a))}),Lt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({disableAction:!0,disableShowTargetHandle:!0},a))}),Dt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),Ot=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({hasFailBranch:a.data.node_param.try_catch_config.strategy==="failBranch"},a))}),Vt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),Rt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({hasFailBranch:a.data.node_param.try_catch_config.strategy==="failBranch"},a))}),Ft=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({disableShowTargetHandle:!0},a))}),Bt=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),Ut=(0,d.memo)(function(a){return(0,e.jsx)(l.Hd,i()({},a))}),Kt={Start:Ft,End:Ct,LLM:Tt,Output:Wt,Script:Rt,Judge:Pt,Classifier:jt,VariableHandle:Ut,VariableAssign:Bt,ParameterExtractor:Dt,API:yt,Retrieval:Vt,Input:Zt,AppComponent:kt,MCP:Et,Plugin:Ot,Iterator:wt,Parallel:Mt,IteratorStart:St,IteratorEnd:At,ParallelStart:Lt,ParallelEnd:It},Ht=Kt,dn={valueInput:"valueInput___MnRxN",form:"form___xqZhv"};function Gt(s){var a,r,o,u,c=(0,ce.Z)(s.value),m=B()(c,2),p=m[0],k=m[1],g=(0,d.useCallback)(function(_){k({auth_config:i()(i()({},p.auth_config||{}),_)})},[p]),b=(0,d.useCallback)(function(){var _,f;if(p.auth_type!=="NoAuth"&&!((_=p.auth_config)!==null&&_!==void 0&&_.value)){G.ZP.error(n.Z.get({id:"main.pages.App.Workflow.components.AuthConfigFormModal.index.enterToken",dm:"\u8BF7\u8F93\u5165TOKEN\u503C"}));return}if(p.auth_type==="ApiKeyAuth"&&!((f=p.auth_config)!==null&&f!==void 0&&f.key)){G.ZP.error(n.Z.get({id:"main.pages.App.Workflow.components.AuthConfigFormModal.index.enterKey",dm:"\u8BF7\u8F93\u5165KEY"}));return}s.onOk(p),s.onClose()},[p]);return(0,e.jsx)(Ae.Z,{width:560,open:!0,onCancel:s.onClose,onOk:b,title:n.Z.get({id:"main.pages.App.Workflow.components.AuthConfigFormModal.index.auth",dm:"\u9274\u6743"}),children:(0,e.jsxs)(na.Z,{className:dn.form,layout:"vertical",children:[(0,e.jsx)(na.Z.Item,{required:!0,rules:[{required:!0,message:n.Z.get({id:"main.pages.App.Workflow.components.AuthConfigFormModal.index.selectAuthMethod",dm:"\u8BF7\u9009\u62E9\u9274\u6743\u65B9\u5F0F"})}],label:n.Z.get({id:"main.pages.App.Workflow.components.AuthConfigFormModal.index.authMethod",dm:"\u9274\u6743\u65B9\u5F0F"}),children:(0,e.jsx)(je.ZP.Group,{value:p.auth_type,onChange:function(f){k({auth_type:f.target.value,auth_config:f.target.value==="NoAuth"?void 0:i()(i()({},p.auth_config||{}),{},{key:"token"})})},options:[{label:"none",value:"NoAuth"},{label:"Bearer Token",value:"BearerAuth"},{label:"Api Key",value:"ApiKeyAuth"}]})}),p.auth_type==="BearerAuth"&&(0,e.jsx)(na.Z.Item,{label:"Token",children:(0,e.jsx)(l.Fm,{value:(a=p.auth_config)===null||a===void 0?void 0:a.value,onChange:function(f){return g({value:f})},variableList:s.variableList})}),p.auth_type==="ApiKeyAuth"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(na.Z.Item,{label:"Key",children:(0,e.jsx)(xe.Z,{onChange:function(f){return g({key:f.target.value})},value:(r=p.auth_config)===null||r===void 0?void 0:r.key,placeholder:n.Z.get({id:"main.pages.App.Workflow.components.AuthConfigFormModal.index.enterKey",dm:"\u8BF7\u8F93\u5165KEY"})})}),(0,e.jsx)(na.Z.Item,{label:"Value",children:(0,e.jsx)("div",{className:dn.valueInput,children:(0,e.jsx)(l.Fm,{value:(o=p.auth_config)===null||o===void 0?void 0:o.value,onChange:function(f){return g({value:f})},variableList:s.variableList})})}),(0,e.jsx)(na.Z.Item,{label:"Add to",children:(0,e.jsx)(ca.Z,{placeholder:n.Z.get({id:"main.pages.App.Workflow.components.AuthConfigFormModal.index.select",dm:"\u8BF7\u9009\u62E9"}),popupMatchSelectWidth:!1,style:{width:"100%"},onChange:function(f){return g({add_to:f})},value:(u=p.auth_config)===null||u===void 0?void 0:u.add_to,options:[{label:"Header",value:"Header"},{label:"Query",value:"QueryParams"}]})})]})]})})}var zt={"info-icon":"info-icon___L3rPp"},Pe=(0,d.memo)(function(a){return(0,e.jsx)(Ha.Z,{content:a.tip,destroyTooltipOnHide:!0,children:(0,e.jsx)(y.Z,{className:zt["info-icon"],size:"small",type:"spark-info-line"})})}),$t=[{label:n.Z.get({id:"main.pages.App.Workflow.components.ErrorCatchForm.index.defaultValue",dm:"\u9ED8\u8BA4\u503C"}),value:"defaultValue",desc:n.Z.get({id:"main.pages.App.Workflow.components.ErrorCatchForm.index.index.outputSpecifiedContent",dm:"\u5F53\u53D1\u751F\u5F02\u5E38\u65F6\uFF0C\u8F93\u51FA\u6307\u5B9A\u5185\u5BB9\u3002"})},{label:n.Z.get({id:"main.pages.App.Workflow.components.ErrorCatchForm.index.index.exceptionBranch",dm:"\u5F02\u5E38\u5206\u652F"}),value:"failBranch",desc:n.Z.get({id:"main.pages.App.Workflow.components.ErrorCatchForm.index.exceptionBranch",dm:"\u5F53\u53D1\u751F\u5F02\u5E38\u65F6\uFF0C\u6267\u884C\u5F02\u5E38\u5206\u652F\u3002"})}],wa=(0,d.memo)(function(a){var r=a.value,o=a.onChange,u=a.nodeId,c=a.disabled,m=a.onChangeType,p=(0,l.KP)(),k=p.handleRemoveEdgeByTargetId,g=function(_,f){var v=Ce()(r.default_values||[]);v[_]=i()(i()({},v[_]),f),o(i()(i()({},r),{},{default_values:v}))};return(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"flex-justify-between",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.ErrorCatchForm.index.executeExceptionBranch",dm:"\u5F02\u5E38\u5904\u7406"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.components.ErrorCatchForm.index.handleErrors",dm:"\u9488\u5BF9\u62A5\u9519\u7B49\u5F02\u5E38\u60C5\u51B5\uFF0C\u8282\u70B9\u6839\u636E\u914D\u7F6E\u7EE7\u7EED\u6267\u884C\u3002"})})]}),(0,e.jsx)(ua.Z,{checked:r.strategy!=="noop",disabled:c,onChange:function(_){k("".concat(u,"_fail")),m(_?"failBranch":"noop")}})]}),r.strategy!=="noop"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.components.ErrorCatchForm.index.handlingMethod",dm:"\u5904\u7406\u65B9\u5F0F"})}),(0,e.jsx)(l.hk,{disabled:c,value:r.strategy,onChange:function(_){k("".concat(u,"_fail")),o(i()(i()({},r),{},{strategy:_}))},options:$t})]}),r.strategy==="defaultValue"&&!!r.default_values&&r.default_values.map(function(b,_){return(0,e.jsxs)(d.Fragment,{children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[b.key,(0,e.jsx)("div",{className:"spark-flow-panel-form-title-desc",children:"(".concat(b.type,")")})]}),(0,e.jsx)(l.qM,{disabled:c,type:b.type,value:b.value,onChange:function(v){g(_,{value:v.value})}})]},_)})]})}),ka={"panel-form-area":"panel-form-area___zSYdr","panel-form-area-label":"panel-form-area-label___GeSJc","panel-slider-selector":"panel-slider-selector___amYGQ"};function Aa(s){var a=s.value,r=s.onChange,o=s.disabled;return(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"flex-justify-between",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.components.RetryForm.index.retryOnFailure",dm:"\u5931\u8D25\u65F6\u91CD\u8BD5"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.components.RetryForm.index.retryWhenError",dm:"\u5F00\u542F\u540E\uFF0C\u5F53\u53D1\u751F\u9519\u8BEF\u65F6\u8282\u70B9\u4F1A\u5C1D\u8BD5\u91CD\u65B0\u6267\u884C\u3002"})})]}),(0,e.jsx)(ua.Z,{checked:a.retry_enabled,onChange:function(c){return r(i()(i()({},a),{},{retry_enabled:c}))},disabled:o})]}),a.retry_enabled&&(0,e.jsxs)("div",{className:we()(ka["panel-form-area"],"flex flex-col gap-[20px] "),children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("span",{className:ka["panel-form-area-label"],children:n.Z.get({id:"main.pages.App.Workflow.components.RetryForm.index.maxRetryTimes",dm:"\u6700\u5927\u91CD\u8BD5\u6B21\u6570"})}),(0,e.jsx)(da.Z,{disabled:o,value:a.max_retries,onChange:function(c){return r(i()(i()({},a),{},{max_retries:c}))},step:1,className:we()("flex-1 ml-[20px] mr-[12px]",ka["panel-slider-selector"]),min:1,max:10,inputNumberWrapperStyle:{width:64}})]}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("span",{className:ka["panel-form-area-label"],children:n.Z.get({id:"main.pages.App.Workflow.components.RetryForm.index.retryInterval",dm:"\u91CD\u8BD5\u95F4\u9694"})}),(0,e.jsx)(da.Z,{disabled:o,className:we()("flex-1 ml-[20px]",ka["panel-slider-selector"]),value:a.retry_interval,onChange:function(c){return r(i()(i()({},a),{},{retry_interval:c}))},step:100,min:300,max:1e4,inputNumberWrapperStyle:{width:64}})]})]})]})}var Ge=t(71275);function un(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=s.input_schema;return Object.keys(r.properties).sort(function(o){return(r.required||[]).includes(o)?-1:1}).map(function(o){var u=a.find(function(c){return c.key===o})||{};return i()({key:o,value_from:"refer",value:void 0},u)})}var aa=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};a.forEach(function(o){!o.value||o.value_from==="input"||r[o.value]||(r[o.value]=!0)})};function fa(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=/\${(.*?)}/g,o=s.match(r);o==null||o.forEach(function(u){a[u]||(a[u]=!0,u.substring(2,u.length-1))})}function Jt(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=r.disableShowLeft,u=o===void 0?!1:o;s.forEach(function(c){var m;(m=c.conditions)===null||m===void 0||m.forEach(function(p){var k=p.left,g=p.right;k.value_from==="refer"&&k.value&&!u&&!a[k.value]&&(a[k.value]=!0),g.value_from==="refer"&&g.value&&!a[g.value]&&(a[g.value]=!0)})})}function Da(s,a){var r=s.enabled,o=s.type,u=s.param;!r||o==="self"||u.value||a.push({label:n.Z.get({id:"main.pages.App.Workflow.utils.index.memory",dm:"\u8BB0\u5FC6"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.contextVariableRequired",dm:"\u4E0A\u4E0B\u6587\u53D8\u91CF\u4E0D\u80FD\u4E3A\u7A7A"})})}function Yt(s,a){var r;s.strategy==="defaultValue"&&!((r=s.default_values)!==null&&r!==void 0&&(r=r[0])!==null&&r!==void 0&&r.value)&&a.push({label:n.Z.get({id:"main.pages.App.Workflow.utils.index.exceptionHandling",dm:"\u5F02\u5E38\u5904\u7406"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.defaultValueRequired",dm:"\u9ED8\u8BA4\u503C\u4E0D\u80FD\u4E3A\u7A7A"})})}function Oa(s,a){s!=null&&s.model_id||a.push({label:n.Z.get({id:"main.pages.App.Workflow.utils.index.modelSelection",dm:"\u6A21\u578B\u9009\u62E9"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})})}function pa(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=new Set,u=!1,c=!1,m=!1,p=!1;!s.length&&!r.disableCheckEmptyList&&a.push({label:r.label||n.Z.get({id:"main.pages.App.Workflow.utils.index.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})});var k=ea()(s),g;try{for(k.s();!(g=k.n()).done;){var b=g.value;if(!b.key&&!u){u=!0;continue}if(r.checkValue&&!b.value&&!p){p=!0;continue}if(!/^[a-zA-Z0-9]*$/.test(b.key)&&!c){c=!0;continue}if(o.has(b.key)&&!m){m=!0;continue}o.add(b.key)}}catch(_){k.e(_)}finally{k.f()}m&&a.push({label:r.label||n.Z.get({id:"main.pages.App.Workflow.utils.index.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.variableNameDuplicate",dm:"\u53D8\u91CF\u540D\u4E0D\u80FD\u91CD\u590D"})}),p&&a.push({label:r.label||n.Z.get({id:"main.pages.App.Workflow.utils.index.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.valueNotNull",dm:"\u503C\u4E0D\u80FD\u4E3A\u7A7A"})}),u&&a.push({label:r.label||n.Z.get({id:"main.pages.App.Workflow.utils.index.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.variableNameRequired",dm:"\u53D8\u91CF\u540D\u4E0D\u80FD\u4E3A\u7A7A"})}),c&&a.push({label:r.label||n.Z.get({id:"main.pages.App.Workflow.utils.index.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.utils.index.variableNameAlphanumeric",dm:"\u53D8\u91CF\u540D\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u548C\u6570\u5B57"})})}var cn=function(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o={label:"index",type:"Number",value:"${".concat(a.id,".index}")};switch(a.type){case"Iterator":var u=[{label:a.data.label,nodeId:a.id,nodeType:a.type,children:[o]}];if(a.data.node_param.iterator_type==="byArray"&&(u[0].children=[].concat(Ce()(u[0].children),Ce()((0,l.n_)(a)))),!r.disableShowVariableParameters){var c;(c=a.data.node_param.variable_parameters)===null||c===void 0||c.forEach(function(m){u[0].children.push({label:m.key,value:"${".concat(a.id,".").concat(m.key,"}"),type:m.type})})}return u;case"Parallel":return[{label:a.data.label,nodeId:a.id,nodeType:a.type,children:[o].concat(Ce()((0,l.n_)(a)))}];default:return[]}},Va=[{key:"output",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.schema.outputResult",dm:"\u8F93\u51FA\u7ED3\u679C"})}],Qt=function(a){var r=[];return a.node_param.url||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.schema.apiAddress",dm:"API\u5730\u5740"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.schema.required",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),r},Xt=function(a){var r={},o=a.node_param,u=o.headers,c=u===void 0?[]:u,m=o.params,p=m===void 0?[]:m;if(fa(a.node_param.url,r),aa(c,r),aa(p,r),["raw","json"].includes(a.node_param.body.type)&&fa(a.node_param.body.data,r),a.node_param.body.type==="form-data"){var k=a.node_param.body.data;aa(k,r)}return Object.keys(r)},qt={type:"API",title:"API",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.schema.callCustomApiService",dm:"\u901A\u8FC7Post\u6216Get\u7684\u65B9\u5F0F\uFF0C\u8C03\u7528\u81EA\u5B9A\u4E49API\u670D\u52A1\uFF0C\u8F93\u51FAAPI\u8C03\u7528\u7ED3\u679C\u3002"}),iconType:"spark-api-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.schema.tool",dm:"\u5DE5\u5177"}),defaultParams:{input_params:[],output_params:Va,node_param:{output_type:"json",authorization:{auth_type:"NoAuth",auth_config:void 0},headers:[{key:"header1",value_from:"refer",value:void 0,type:"String"}],method:"get",params:[],body:{type:"raw",data:""},timeout:{read:3},retry_config:Ge.Jp,try_catch_config:Ge.x9,url:""}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-blue-hover)",checkValid:function(a){return Qt(a)},getRefVariables:function(a){return Xt(a)}},er=[{label:"GET",value:"get"},{label:"POST",value:"post"},{label:"PUT",value:"put"},{label:"DELETE",value:"delete"},{label:"PATCH",value:"patch"}],ar=[{label:"none",value:"none"},{label:"form-data",value:"form-data"},{label:"raw",value:"raw"},{label:"JSON",value:"json"}],xa=function(a){var r=[];return a.forEach(function(o){!o.key&&!o.type||r.push({key:o.key,value:void 0,type:o.type})}),r},nr=(0,d.memo)(function(a){var r=a.id,o=a.data,u=(0,l.Ii)(),c=u.handleNodeDataUpdate,m=(0,l.bx)(),p=m.getVariableList,k=Le(function(j){return j.globalVariableList}),g=(0,l._J)(function(j){return j.nodes}),b=(0,l._J)(function(j){return j.edges}),_=(0,d.useState)(!1),f=B()(_,2),v=f[0],h=f[1],R=(0,l.nS)(),x=R.nodesReadOnly,S=(0,d.useMemo)(function(){return p({nodeId:r})},[r,g,b]),C=(0,d.useMemo)(function(){return[].concat(Ce()(k),Ce()(S))},[k,S]),P=function(D){c({id:r,data:{node_param:i()(i()({},o.node_param),D)}})},Y=(0,d.useMemo)(function(){switch(o.node_param.authorization.auth_type){case"BearerAuth":return"Bearer Token";case"ApiKeyAuth":return"Api Key";default:return n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.none",dm:"\u65E0"})}},[o.node_param.authorization]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"flex-justify-between",children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.apiAddress",dm:"API\u5730\u5740"})}),(0,e.jsxs)(T.Z,{disabled:x,className:"spark-flow-text-btn",size:"small",onClick:function(){h(!0)},type:"text",icon:(0,e.jsx)(y.Z,{type:"spark-setting-line"}),children:[n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.authentication",dm:"\u9274\u6743"}),"(".concat(Y,")")]})]}),(0,e.jsx)(l.hk,{disabled:x,value:o.node_param.method,onChange:function(D){return P({method:D})},options:er}),(0,e.jsx)(l.Fm,{disabled:x,variableList:C,value:o.node_param.url,onChange:function(D){return P({url:D})},maxLength:Number.MAX_SAFE_INTEGER})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.headerSetting",dm:"Header\u8BBE\u7F6E"})}),(0,e.jsx)(l.U6,{disabled:x,value:o.node_param.headers,variableList:C,onChange:function(D){return P({headers:D})}})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.paramSetting",dm:"Param\u8BBE\u7F6E"})}),(0,e.jsx)(l.U6,{disabled:x,variableList:C,value:o.node_param.params,onChange:function(D){return P({params:D})}})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.bodySetting",dm:"Body\u8BBE\u7F6E"})}),(0,e.jsx)(je.ZP.Group,{disabled:x,value:o.node_param.body.type,onChange:function(D){return P({body:i()(i()({},o.node_param.body),{},{type:D.target.value,data:D.target.value==="form-data"?[]:""})})},options:ar}),o.node_param.body.type==="none"?null:o.node_param.body.type==="form-data"?(0,e.jsx)(l.U6,{disabled:x,onChange:function(D){return P({body:i()(i()({},o.node_param.body),{},{data:D})})},value:o.node_param.body.data}):(0,e.jsx)(l.Fm,{disabled:x,variableList:C,value:o.node_param.body.data,onChange:function(D){return P({body:i()(i()({},o.node_param.body),{},{data:D})})},maxLength:Number.MAX_SAFE_INTEGER})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.timeoutSetting",dm:"\u8D85\u65F6\u8BBE\u7F6E\uFF08\u79D2\uFF09"})}),(0,e.jsx)(Ua.Z,{disabled:x,className:"w-full",onChange:function(D){return P({timeout:{read:D}})},placeholder:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.enterTimeoutTime",dm:"\u8BF7\u8F93\u5165\u8D85\u65F6\u65F6\u95F4"}),max:120,min:1,value:o.node_param.timeout.read,step:1})]})}),(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.output",dm:"\u8F93\u51FA"})}),(0,e.jsx)(ca.Z,{disabled:x,value:o.node_param.output_type,options:[{label:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.rawData",dm:"\u539F\u59CB\u6570\u636E"}),value:"primitive"},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.APINode.panel.jsonData",dm:"JSON\u6570\u636E"}),value:"json"}],onChange:function(D){c({id:r,data:{output_params:Va,node_param:i()(i()({},o.node_param),{},{output_type:D,try_catch_config:i()(i()({},o.node_param.try_catch_config),{},{default_values:xa(Va)})})}})}})]}),o.node_param.output_type==="primitive"?(0,e.jsx)(l.kq,{data:o.output_params}):(0,e.jsx)(l.TN,{readyOnly:x,value:o.output_params,onChange:function(D){return c({id:r,data:{output_params:D,node_param:i()(i()({},o.node_param),{},{try_catch_config:i()(i()({},o.node_param.try_catch_config),{},{default_values:xa(D)})})}})}})]}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(Aa,{disabled:x,value:o.node_param.retry_config,onChange:function(D){return P({retry_config:D})}})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(wa,{disabled:x,nodeId:r,value:o.node_param.try_catch_config,onChangeType:function(D){var U=D==="failBranch"?{default_values:xa(o.output_params)}:{};P({try_catch_config:i()(i()({},o.node_param.try_catch_config),{},{strategy:D},U)})},onChange:function(D){return P({try_catch_config:D})}})}),v&&(0,e.jsx)(Gt,{variableList:C,value:o.node_param.authorization,onClose:function(){return h(!1)},onOk:function(D){P({authorization:D}),h(!1)}})]})}),tr={"slider-selector":"slider-selector___j_lJG"},rr=[{label:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.nodeCache",dm:"\u672C\u8282\u70B9\u7F13\u5B58"}),value:"self",desc:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.contextualInfoOnlyInNode",dm:"\u6A21\u578B\u53EA\u4F1A\u8BB0\u5F97\u672C\u8282\u70B9\u5185\u53D1\u751F\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F\u3002"})},{label:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.customCache",dm:"\u81EA\u5B9A\u4E49\u7F13\u5B58"}),value:"custom",desc:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.globalContextualInfo",dm:"\u6A21\u578B\u4F1A\u8BB0\u5F97\u5168\u5C40\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F\u3002"})}],Sa=(0,d.memo)(function(a){var r=a.value,o=a.onChange,u=a.variableList,c=a.disabled;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:we()("flex items-center justify-between"),children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.memory",dm:"\u8BB0\u5FC6"})}),(0,e.jsx)(ua.Z,{value:r.enabled,onChange:function(p){return o(i()(i()({},r),{},{enabled:p}))},disabled:c})]}),r.enabled&&(0,e.jsx)(l.hk,{value:r.type,onChange:function(p){return o(i()(i()({},r),{},{type:p}))},options:rr,disabled:c})]}),r.enabled&&(r.type==="custom"?(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.contextVariables",dm:"\u4E0A\u4E0B\u6587\u53D8\u91CF"})}),(0,e.jsx)(l.W3,{disabled:c,variableList:u,value:r.param,onChange:function(p){return o(i()(i()({},r),{},{param:i()(i()({},r.param),p)}))}})]}):(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.memoryRounds",dm:"\u8BB0\u5FC6\u8F6E\u6B21"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.components.ShortMemoryForm.index.memoryRoundsDefinition",dm:"\u4EE3\u8868\u8BB0\u5FC6\u7684\u8F6E\u6B21\uFF0C\u4E00\u6B21\u8F93\u5165\u4E00\u6B21\u8F93\u51FA\u4EE3\u8868\u4E00\u8F6E\u3002"})})]}),(0,e.jsx)(da.Z,{disabled:c,min:1,max:50,step:1,value:r.round,onChange:function(p){return o(i()(i()({},r),{},{round:p}))},inputNumberWrapperStyle:{width:54},className:we()("flex-1",tr["slider-selector"])})]}))]})}),pn={"app-component-name":"app-component-name___LvtPc","app-component-item":"app-component-item___nExTi"},or=(0,d.memo)(function(a){var r=(0,l.Ii)(),o=r.handleNodeDataUpdate,u=Le(function(C){return C.globalVariableList}),c=(0,l.bx)(),m=c.getVariableList,p=(0,l._J)(function(C){return C.nodes}),k=(0,l._J)(function(C){return C.edges}),g=(0,l.nS)(),b=g.nodesReadOnly,_=(0,ce.Z)({loading:!0}),f=B()(_,2),v=f[0],h=f[1],R=(0,d.useMemo)(function(){return m({nodeId:a.id})},[a.id,p,k]),x=(0,d.useMemo)(function(){return[].concat(Ce()(u),Ce()(R))},[u,R]),S=(0,d.useCallback)(function(C){o({id:a.id,data:{node_param:i()(i()({},a.data.node_param),C)}})},[a.data.node_param]);return(0,d.useEffect)(function(){if(!a.data.node_param.code){h({loading:!1});return}h({loading:!0}),(0,q.cZ)(a.data.node_param.code).then(function(C){o({id:a.id,data:{input_params:C.input.map(function(P){var Y=a.data.input_params.find(function(j){return j.key===P.alias})||{};return i()({key:P.alias,type:P.type,value_from:"refer",value:void 0},Y)}),output_params:C.output.map(function(P){return{key:P.field,type:P.type,desc:P.description}})}}),h({loading:!1})}).finally(function(){h({loading:!1})})},[a.data.node_param.code]),v.loading?(0,e.jsx)(De.Z,{spinning:!0,className:"loading-center"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.panel.component",dm:"\u7EC4\u4EF6"})}),(0,e.jsxs)(w.Z,{className:pn["app-component-item"],gap:4,justify:"space-between",align:"center",children:[(0,e.jsx)(y.Z,{size:"small",type:"spark-agent-line"}),(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:a.data.node_param.name},className:we()(pn["app-component-name"]),children:a.data.node_param.name})]})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.panel.inputVariables",dm:"\u8F93\u5165\u53D8\u91CF"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.panel.inputVariablesForThisNode",dm:"\u8F93\u5165\u672C\u8282\u70B9\u9700\u8981\u5904\u7406\u7684\u53D8\u91CF\uFF0C\u7528\u4E8E\u8BC6\u522B\u9700\u8981\u5904\u7406\u7684\u5185\u5BB9\uFF0C\u652F\u6301\u5F15\u7528\u524D\u7F6E\u3002"})})]}),(0,e.jsx)(l.U6,{disabledKey:!0,disabled:b,onChange:function(P){o({id:a.id,data:{input_params:P}})},value:a.data.input_params,variableList:x})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{justify:"space-between",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.panel.streamSwitch",dm:"\u6D41\u5F0F\u5F00\u5173"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.panel.outputInStream",dm:"\u672C\u8282\u70B9\u6A21\u578B\u8F93\u51FA\u7684\u5185\u5BB9\u4F1A\u4EE5\u6D41\u5F0F\u7684\u65B9\u5F0F\u8F93\u51FA\u3002"})})]}),(0,e.jsx)(ua.Z,{disabled:b,checked:a.data.node_param.stream_switch,onChange:function(P){return S({stream_switch:P})}})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(Sa,{variableList:x,value:a.data.node_param.short_memory,onChange:function(P){return S({short_memory:P})}})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.panel.outputVariables",dm:"\u8F93\u51FA\u672C\u8282\u70B9\u5904\u7406\u7ED3\u679C\u7684\u53D8\u91CF\uFF0C\u7528\u4E8E\u540E\u7EED\u8282\u70B9\u8BC6\u522B\u548C\u5904\u7406\u672C\u8282\u70B9\u7684\u5904\u7406\u7ED3\u679C\u3002"})})]}),(0,e.jsx)(l.kq,{data:a.data.output_params})]})})]})}),ir=t(29944),Ra=(0,d.memo)(function(a){var r,o,u,c=(0,d.useState)(),m=B()(c,2),p=m[0],k=m[1],g=(0,d.useMemo)(function(){var b;return p==null||(b=p.tags)===null||b===void 0?void 0:b.includes("vision")},[p]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ir.Z,{onChange:function(_){a.onChange(i()(i()({},a.value),_))},disabled:a.disabled,value:{model_id:a.value.model_id,provider:a.value.provider,params:a.value.params},onSelectedModelChange:function(_){var f,v,h=((f=_.tags)===null||f===void 0?void 0:f.includes("vision"))||!1,R=a.value.vision_config||Ge.pt.vision_config;a.onChange(i()(i()({},a.value),{},{vision_config:i()(i()({},R),{},{enable:h?R.enable:!1})}),{isSupportReasoning:((v=_.tags)===null||v===void 0?void 0:v.includes("reasoning"))||!1,isSupportVision:h}),k(_)}}),g&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(w.Z,{justify:"space-between",align:"center",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.ModelConfigFormWrap.index.visual",dm:"\u89C6\u89C9"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.components.ModelConfigFormWrap.index.inputContentForIntent",dm:"\u8F93\u5165\u9700\u8981\u7528\u505A\u610F\u56FE\u5224\u65AD\u7684\u5185\u5BB9\u3002"})})]}),(0,e.jsx)(ua.Z,{disabled:a.disabled,onChange:function(_){a.onChange(i()(i()({},a.value),{},{vision_config:i()(i()({},a.value.vision_config),{},{enable:_})}))},checked:(r=a.value.vision_config)===null||r===void 0?void 0:r.enable})]}),!!((o=a.value.vision_config)!==null&&o!==void 0&&o.enable)&&(0,e.jsx)(l.W3,{disabled:a.disabled,prefix:"File",value:((u=a.value.vision_config)===null||u===void 0?void 0:u.params[0])||{},onChange:function(_){var f;a.onChange(i()(i()({},a.value),{},{vision_config:i()(i()({},a.value.vision_config),{},{params:[i()(i()({},((f=a.value.vision_config)===null||f===void 0?void 0:f.params[0])||{}),_)]})}))},variableList:a.variableList})]})]})}),mn=10,sr=[{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.fastMode",dm:"\u5FEB\u901F\u6A21\u5F0F"}),value:"efficient",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.classificationModelAvoidsThinkingProcess",dm:"\u5206\u7C7B\u6A21\u578B\u4F1A\u907F\u514D\u8F93\u51FA\u601D\u8003\u8FC7\u7A0B\uFF0C\u63D0\u5347\u901F\u5EA6\uFF0C\u9002\u7528\u4E8E\u7B80\u5355\u573A\u666F"})},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.efficiencyMode",dm:"\u6548\u679C\u6A21\u5F0F"}),value:"advanced",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.classificationModelThinksStepByStep",dm:"\u5206\u7C7B\u6A21\u578B\u4F1A\u4E00\u6B65\u4E00\u6B65\u7684\u601D\u8003\uFF0C\u66F4\u7CBE\u51C6\u7684\u5339\u914D\u5BF9\u5E94\u7684\u5206\u7C7B"})}],lr=(0,d.memo)(function(a){var r=(0,l.Ii)(),o=r.handleNodeDataUpdate,u=(0,l.bx)(),c=u.getVariableList,m=Le(function(j){return j.globalVariableList}),p=(0,l._J)(function(j){return j.nodes}),k=(0,l._J)(function(j){return j.edges}),g=(0,l.nS)(),b=g.nodesReadOnly,_=(0,d.useMemo)(function(){return c({nodeId:a.id})},[a.id,p,k]),f=(0,d.useMemo)(function(){return[].concat(Ce()(m),Ce()(_))},[m,_]),v=(0,d.useMemo)(function(){var j=[];return f.forEach(function(D){var U=(0,l.BA)(D.children,["Array<String>","Array<Object>"]);U.length&&j.push(i()(i()({},D),{},{children:U}))}),j},[f]),h=(0,d.useCallback)(function(j){o({id:a.id,data:{node_param:i()(i()({},a.data.node_param),j)}})},[a.data.node_param]),R=(0,d.useCallback)(function(j,D){h({conditions:a.data.node_param.conditions.map(function(U,Z){return i()(i()({},U),{},{subject:Z===j?D:U.subject})})})},[a.data.node_param]),x=(0,d.useCallback)(function(j){h({conditions:a.data.node_param.conditions.filter(function(D,U){return U!==j})})},[a.data.node_param]),S=(0,d.useCallback)(function(){a.data.node_param.conditions.length>=mn+1||h({conditions:[].concat(Ce()(a.data.node_param.conditions),[{id:(0,l.EL)(4),subject:""}])})},[a.data.node_param]),C=(0,d.useCallback)(function(j){o({id:a.id,data:{input_params:[i()({key:"input",value_from:"refer",type:"String"},j)]}})},[a.id,a.data.input_params]),P=(0,d.useMemo)(function(){var j=[];return f.forEach(function(D){var U=(0,l.BA)(D.children,["String"]);U.length>0&&j.push(i()(i()({},D),{},{children:U}))}),j},[f]),Y=(0,d.useMemo)(function(){var j=[];return f.forEach(function(D){var U=(0,l.BA)(D.children,["File","Array<File>"]);U.length>0&&j.push(i()(i()({},D),{},{children:U}))}),j},[f]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.inputVariables",dm:"\u8F93\u5165\u53D8\u91CF"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.inputContentForIntentionJudgment",dm:"\u8F93\u5165\u9700\u8981\u7528\u505A\u610F\u56FE\u5224\u65AD\u7684\u5185\u5BB9\u3002"})})]}),(0,e.jsx)(l.W3,{disabled:b,onChange:C,value:a.data.input_params[0],variableList:P,prefix:"String"})]}),(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.modelSelection",dm:"\u6A21\u578B\u9009\u62E9"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.selectAppropriateModel",dm:"\u6309\u9700\u9009\u5408\u9002\u6A21\u578B\u8F85\u52A9\u8BC6\u522B\u3002"})})]}),(0,e.jsx)(Ra,{disabled:b,variableList:Y,value:a.data.node_param.model_config,onChange:function(D){return h({model_config:D})}})]})]}),(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.intentionClassification",dm:"\u610F\u56FE\u5206\u7C7B"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.configureIntentionBranches",dm:"\u914D\u7F6E\u9700\u8981\u6A21\u578B\u6765\u5224\u65AD\u7684\u610F\u56FE\u5206\u652F\u3002"})})]}),a.data.node_param.conditions.map(function(j,D){return j.id==="default"?null:(0,e.jsx)(l.zg,{disabled:b,variableList:f,value:j.subject,onChange:function(Z){return R(D,Z)},onDelete:function(){return x(D)}},D)}),(0,e.jsx)(T.Z,{onClick:S,type:"link",size:"small",className:"self-start spark-flow-text-btn",icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),disabled:b,children:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.addIntention",dm:"\u6DFB\u52A0\u610F\u56FE\uFF08{var1}/{var2}\uFF09"},{var1:a.data.node_param.conditions.length-1,var2:mn})}),(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.otherIntention",dm:"\u5176\u4ED6\u610F\u56FE"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.executeThisBranchWhenNoIntentionMatches",dm:"\u5F53\u6A21\u578B\u5224\u65AD\u6240\u6709\u610F\u56FE\u5747\u4E0D\u6EE1\u8DB3\u65F6\u6267\u884C\u8BE5\u5206\u652F\u3002"})})]})]}),(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.thinkingMode",dm:"\u601D\u8003\u6A21\u5F0F"})}),(0,e.jsx)(l.hk,{disabled:b,options:sr,value:a.data.node_param.mode_switch,onChange:function(D){return h({mode_switch:D})}})]})]}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(Sa,{disabled:b,variableList:v,value:a.data.node_param.short_memory,onChange:function(D){return h({short_memory:D})}})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.prompt",dm:"\u63D0\u793A\u8BCD"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.provideAdditionalRequirements",dm:"\u4E3A\u610F\u56FE\u8BC6\u522B\u6A21\u578B\u63D0\u4F9B\u989D\u5916\u7684\u8981\u6C42\u6216\u7EA6\u675F\u3002"})})]}),(0,e.jsx)(l.Fm,{disabled:b,variableList:f,value:a.data.node_param.instruction,onChange:function(D){return h({instruction:D})},maxLength:Number.MAX_SAFE_INTEGER})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.panel.outputSpecificResult",dm:"\u8F93\u51FA\u5177\u4F53\u7684\u8BC6\u522B\u7ED3\u679C\uFF0C\u6548\u679C\u6A21\u5F0F\u4E0B\u4F1A\u8F93\u51FA\u8BE6\u7EC6\u7684\u601D\u8003\u8FC7\u7A0B\u3002"})})]}),(0,e.jsx)(l.kq,{data:a.data.output_params})]})})]})}),dr=(0,d.memo)(function(s){var a=(0,l.Ii)(),r=a.handleNodeDataUpdate,o=(0,l.bx)(),u=o.getVariableList,c=Le(function(v){return v.globalVariableList}),m=(0,l._J)(function(v){return v.nodes}),p=(0,l._J)(function(v){return v.edges}),k=(0,l.nS)(),g=k.nodesReadOnly,b=(0,d.useMemo)(function(){return u({nodeId:s.id})},[s.id,m,p]),_=(0,d.useMemo)(function(){return[].concat(Ce()(c),Ce()(b))},[c,b]),f=(0,d.useCallback)(function(v){r({id:s.id,data:{node_param:i()(i()({},s.data.node_param),v)}})},[s.data.node_param]);return(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.End.panel.outputMode",dm:"\u8F93\u51FA\u6A21\u5F0F"})}),(0,e.jsx)(ca.Z,{disabled:g,value:s.data.node_param.output_type,options:[{label:n.Z.get({id:"main.pages.App.Workflow.nodes.End.panel.textOutput",dm:"\u6587\u672C\u8F93\u51FA"}),value:"text"},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.End.panel.jsonOutput",dm:"JSON\u8F93\u51FA"}),value:"json"}],onChange:function(h){return f({output_type:h,json_params:Ge.IW,text_template:"",stream_switch:!1})}}),s.data.node_param.output_type==="text"?(0,e.jsx)(l.Fm,{disabled:g,variableList:_,value:s.data.node_param.text_template,onChange:function(h){f({text_template:h})},maxLength:Number.MAX_SAFE_INTEGER}):(0,e.jsx)(l.U6,{disabled:g,onChange:function(h){return f({json_params:h})},disabledValueFrom:!0,variableList:_,value:s.data.node_param.json_params}),s.data.node_param.output_type==="text"&&(0,e.jsxs)("div",{className:"flex-justify-between w-full",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.End.panel.streamOutput",dm:"\u6D41\u5F0F\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.End.panel.outputContentInStream",dm:"\u5F00\u542F\u540E\uFF0C\u8282\u70B9\u7684\u6765\u6E90\u4E8E\u5927\u6A21\u578B\u7684\u8F93\u51FA\u5185\u5BB9\u5C06\u7528\u6D41\u5F0F\u5448\u73B0\u3002"})})]}),(0,e.jsx)(ua.Z,{disabled:g,checked:s.data.node_param.stream_switch,onChange:function(h){f({stream_switch:h})}})]})]})}),ur=(0,d.memo)(function(a){var r=a.id,o=a.data,u=(0,l.Ii)(),c=u.handleNodeDataUpdate,m=(0,l.nS)(),p=m.nodesReadOnly;return(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.InputNode.panel.input",dm:"\u8F93\u5165"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.InputNode.panel.injectContentIntoProcess",dm:"\u8F93\u5165\u9700\u8981\u6CE8\u5165\u6D41\u7A0B\u7684\u5185\u5BB9\u3002"})})]}),(0,e.jsx)("div",{className:"spark-flow-panel-form-second-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.InputNode.panel.customVariables",dm:"\u81EA\u5B9A\u4E49\u53D8\u91CF"})}),(0,e.jsx)(l.TN,{readyOnly:p,value:o.output_params,onChange:function(g){c({id:r,data:{output_params:g}})}})]})})}),cr=(0,d.memo)(function(a){var r=a.value,o=a.onChange,u=a.variableList,c=a.disabled,m=(0,d.useCallback)(function(g,b){var _=r.map(function(f,v){return v===g?i()(i()({},f),b):f});o(_)},[o,r]),p=(0,d.useCallback)(function(g){var b=r.filter(function(_,f){return f!==g});o(b)},[o,r]),k=(0,d.useCallback)(function(){var g=[].concat(Ce()(r),[{key:"",value:"",value_from:"refer",type:"String"}]);o(g)},[o,r]);return(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)(w.Z,{gap:8,className:"spark-flow-inputs-form-label",children:[(0,e.jsx)("div",{style:{width:140},children:n.Z.get({id:"main.pages.App.Workflow.components.IteratorVariableForm.index.variableName",dm:"\u53D8\u91CF\u540D"})}),(0,e.jsx)("div",{children:n.Z.get({id:"main.pages.App.Workflow.components.IteratorVariableForm.index.value",dm:"\u503C"})})]}),r.map(function(g,b){return(0,e.jsxs)(w.Z,{gap:8,children:[(0,e.jsx)("div",{style:{width:140},children:(0,e.jsx)(xe.Z,{disabled:c,className:"flex-1",placeholder:n.Z.get({id:"main.pages.App.Workflow.components.IteratorVariableForm.index.enterVariableName",dm:"\u8BF7\u8F93\u5165\u53D8\u91CF\u540D"}),value:g.key,onChange:function(f){return m(b,{key:f.target.value})}})}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)(l.W3,{disabled:c,value:g,onChange:function(f){return m(b,f)},variableList:u})}),(0,e.jsx)(y.Z,{onClick:c?void 0:function(){return p(b)},isCursorPointer:!c,className:c?"spark-flow-disabled-icon-btn":"",type:"spark-delete-line"})]},b)}),(0,e.jsx)(T.Z,{className:"spark-flow-text-btn self-start",icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),type:"link",size:"small",disabled:c,onClick:k,children:n.Z.get({id:"main.pages.App.Workflow.components.IteratorVariableForm.index.addVariable",dm:"\u6DFB\u52A0\u53D8\u91CF"})})]})}),pr=[{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.useArrayLoop",dm:"\u4F7F\u7528\u6570\u7EC4\u5FAA\u73AF"}),value:"byArray"},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.specifyLoopCount",dm:"\u6307\u5B9A\u5FAA\u73AF\u6B21\u6570"}),value:"byCount"}],mr=(0,d.memo)(function(a){var r=(0,l._J)(function(x){return x.nodes}),o=(0,l._J)(function(x){return x.edges}),u=(0,l.Ii)(),c=u.handleNodeDataUpdate,m=(0,l.bx)(),p=m.getSubNodesVariables,k=m.getVariableList,g=(0,l.nS)(),b=g.nodesReadOnly,_=(0,d.useMemo)(function(){return k({nodeId:a.id})},[a.id,r,o]),f=(0,d.useMemo)(function(){var x=[];return _.forEach(function(S){var C=(0,l.BA)(S.children,["Array<String>","Array<Boolean>","Array<File>","Array<Number>","Array<String>"]);C.length>0&&x.push(i()(i()({},S),{},{children:C}))}),x},[a.id,_]),v=(0,d.useMemo)(function(){return p(a.id)},[a.id,r]),h=(0,d.useCallback)(function(x){c({id:a.id,data:{node_param:i()(i()({},a.data.node_param),x)}})},[a.data.node_param,c]),R=(0,d.useMemo)(function(){var x,S=[];return(x=a.data.node_param.variable_parameters)===null||x===void 0||x.forEach(function(C){C.value&&S.push({label:C.key,value:"${".concat(a.id,".").concat(C.key,"}"),type:C.type})}),S.length?[{label:a.data.label,nodeId:a.id,nodeType:"Iterator",children:S}]:[]},[a.data.node_param.variable_parameters,a.data.label,a.id]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.loopType",dm:"\u5FAA\u73AF\u7C7B\u578B"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.twoTypesOfLoops",dm:"\u5206\u4E3A\u6307\u5B9A\u5FAA\u73AF\u6B21\u6570\u548C\u6570\u7EC4\u5FAA\u73AF\u4E24\u79CD\uFF0C\u533A\u522B\u5728\u5FAA\u73AF\u7684\u8F6E\u6B21\uFF0C\u524D\u8005\u4E3A\u56FA\u5B9A\u8F6E\u6B21\uFF0C\u540E\u8005\u4E3A\u6570\u7EC4\u957F\u5EA6\u3002"})})]}),(0,e.jsx)(ca.Z,{disabled:b,options:pr,value:a.data.node_param.iterator_type,onChange:function(S){return h({iterator_type:S})}})]}),a.data.node_param.iterator_type==="byArray"?(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.loopArray",dm:"\u5FAA\u73AF\u6570\u7EC4"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.loopBodyInput",dm:"\u5FAA\u73AF\u4F53\u7684\u8F93\u5165\uFF0C\u5FC5\u987B\u662F\u6570\u7EC4\uFF08List\uFF09\u7C7B\u578B\u6570\u636E\uFF0C\u5FAA\u73AF\u4F1A\u6309\u7167\u6570\u7EC4\u7684\u7D22\u5F15\u987A\u5E8F\u6267\u884C\u3002"})})]}),(0,e.jsx)(l.U6,{disabled:b,onChange:function(S){return c({id:a.id,data:{input_params:S}})},defaultType:"Array<String>",variableList:f,disabledTypes:["String","Boolean","Number","File","Object","Array<File>"],value:a.data.input_params})]}):(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.loopCount",dm:"\u5FAA\u73AF\u6B21\u6570"})}),(0,e.jsx)(da.Z,{disabled:b,value:a.data.node_param.count_limit,onChange:function(S){return h({count_limit:S})},min:1,max:500,step:1,inputNumberWrapperStyle:{width:54}})]})]}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.middleVariable",dm:"\u4E2D\u95F4\u53D8\u91CF"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.variableUsedInLoopBody",dm:"\u5FAA\u73AF\u4F53\u4E2D\u7528\u5230\u7684\u53D8\u91CF\uFF0C\u53EF\u4EE5\u7528\u4E8E\u5FAA\u73AF\u4F53\u4E2D\u3002"})})]}),(0,e.jsx)(cr,{disabled:b,value:a.data.node_param.variable_parameters,onChange:function(S){return h({variable_parameters:S})},variableList:_})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.terminationCondition",dm:"\u7EC8\u6B62\u6761\u4EF6"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.setTerminationCondition",dm:"\u7528\u6237\u81EA\u884C\u8BBE\u5B9A\u7684\u5FAA\u73AF\u9000\u51FA\u6761\u4EF6\uFF0C\u901A\u8FC7\u53D8\u91CF\u8BBE\u7F6E\u8282\u70B9\u66F4\u65B0\u5FAA\u73AF\u4F53\u4E2D\u95F4\u53D8\u91CF\u8FBE\u6210\u7528\u6237\u63D0\u524D\u8BBE\u7F6E\u7684\u7EC8\u6B62\u6761\u4EF6\u7684\u65B9\u5F0F\uFF0C\u8BA9\u5FAA\u73AF\u4F53\u63D0\u524D\u7ED3\u675F\u5FAA\u73AF\uFF0C\u5F53\u672A\u8BBE\u7F6E\u5FAA\u73AF\u7EC8\u6B62\u6761\u4EF6\u65F6\uFF0C\u4F1A\u6839\u636E\u5FAA\u73AF\u7C7B\u578B\u5224\u65AD\u9000\u51FA\u3002"})})]}),(0,e.jsx)(l.j5,{areaStyle:{padding:"20px 0"},disabled:b,value:a.data.node_param.terminations,onChange:function(S){return h({terminations:S})},leftVariableList:R,rightVariableList:_})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.panel.outputVariable",dm:"\u8F93\u51FA\u53D8\u91CF"})}),(0,e.jsx)(l.U6,{disabled:b,value:a.data.output_params,disabledValueFrom:!0,variableList:v,onChange:function(S){c({id:a.id,data:{output_params:S}})}})]})})]})}),gr=(0,d.memo)(function(a){var r=(0,l.Ii)(),o=r.handleNodeDataUpdate,u=(0,l.bx)(),c=u.getVariableList,m=Le(function(h){return h.globalVariableList}),p=(0,l._J)(function(h){return h.nodes}),k=(0,l._J)(function(h){return h.edges}),g=(0,l.nS)(),b=g.nodesReadOnly,_=(0,d.useMemo)(function(){return c({nodeId:a.id})},[a.id,p,k]),f=(0,d.useMemo)(function(){return[].concat(Ce()(m),Ce()(_))},[m,_]),v=(0,d.useCallback)(function(h){o({id:a.id,data:{node_param:i()(i()({},a.data.node_param),h)}})},[a.data.node_param,o,a.id]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.j5,{leftVariableList:f,rightVariableList:f,value:a.data.node_param.branches,onChange:function(R){return v({branches:R})},disabled:b}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Judge.panel.other",dm:"\u5176\u4ED6"})})})]})}),fr=(0,d.memo)(function(s){var a=(0,l.Ii)(),r=a.handleNodeDataUpdate,o=(0,l.bx)(),u=o.getVariableList,c=Le(function(x){return x.globalVariableList}),m=(0,l._J)(function(x){return x.nodes}),p=(0,l._J)(function(x){return x.edges}),k=(0,l.nS)(),g=k.nodesReadOnly,b=(0,d.useMemo)(function(){return u({nodeId:s.id})},[s.id,m,p]),_=(0,d.useMemo)(function(){return[].concat(Ce()(c),Ce()(b))},[c,b]),f=(0,d.useCallback)(function(x){r({id:s.id,data:{node_param:i()(i()({},s.data.node_param),x)}})},[s.data.node_param,r]),v=(0,d.useMemo)(function(){var x=[];return _.forEach(function(S){var C=(0,l.BA)(S.children,["Array<String>","Array<Object>"]);C.length&&x.push(i()(i()({},S),{},{children:C}))}),x},[_]),h=(0,d.useMemo)(function(){var x=[];return _.forEach(function(S){var C=(0,l.BA)(S.children,["File","Array<File>"]);C.length>0&&x.push(i()(i()({},S),{},{children:C}))}),x},[_]),R=(0,d.useCallback)(function(x,S){var C=S?{output_params:S.isSupportReasoning?Ge.yM:Ge.PH}:{};r({id:s.id,data:i()({node_param:i()(i()({},s.data.node_param),{},{model_config:i()(i()({},s.data.node_param.model_config),x)})},C)})},[s.data.node_param.model_config,f]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.modelSelection",dm:"\u6A21\u578B\u9009\u62E9"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.configureModel",dm:"\u8BF7\u81EA\u884C\u914D\u7F6E\u6A21\u578B\uFF0C\u6839\u636E\u4E1A\u52A1\u573A\u666F\u9009\u62E9\u5373\u53EF\u3002"})})]}),(0,e.jsx)(Ra,{disabled:g,variableList:h,value:s.data.node_param.model_config,onChange:R})]}),(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.prompt",dm:"\u63D0\u793A\u8BCD"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.systemInstruction",dm:"\u4E3A\u6A21\u578B\u63D0\u4F9B\u7CFB\u7EDF\u7EA7\u7684\u6307\u4EE4\uFF0C\u5982\u4EBA\u8BBE\u3001\u7EA6\u675F\u7B49\u3002"})})]}),(0,e.jsx)(l.Fm,{disabled:g,onChange:function(S){return f({sys_prompt_content:S})},value:s.data.node_param.sys_prompt_content,variableList:_,maxLength:Number.MAX_SAFE_INTEGER})]}),(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.userPrompt",dm:"\u7528\u6237\u63D0\u793A\u8BCD"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.interactionContent",dm:"\u7528\u6237\u548C\u6A21\u578B\u7684\u4EA4\u4E92\u5185\u5BB9\uFF0C\u5982\u8981\u6C42\u3001\u6307\u4EE4\u7B49\u3002"})})]}),(0,e.jsx)(l.Fm,{disabled:g,onChange:function(S){return f({prompt_content:S})},value:s.data.node_param.prompt_content,variableList:_,maxLength:Number.MAX_SAFE_INTEGER})]}),(0,e.jsx)(Sa,{disabled:g,onChange:function(S){return f({short_memory:S})},value:s.data.node_param.short_memory,variableList:v})]}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.panel.outputContent",dm:"\u6A21\u578B\u8FD0\u884C\u7ED3\u675F\u540E\u7684\u8F93\u51FA\u5185\u5BB9\u3002"})})]}),(0,e.jsx)(l.kq,{data:s.data.output_params})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(Aa,{disabled:g,value:s.data.node_param.retry_config,onChange:function(S){return f({retry_config:S})}})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(wa,{disabled:g,nodeId:s.id,value:s.data.node_param.try_catch_config,onChange:function(S){f({try_catch_config:S})},onChangeType:function(S){var C=S==="failBranch"?{default_values:xa(s.data.output_params)}:{};f({try_catch_config:i()(i()({},s.data.node_param.try_catch_config),{},{strategy:S},C)})}})})]})}),vr=t(13341),hr=(0,d.memo)(function(a){var r=(0,l.Ii)(),o=r.handleNodeDataUpdate,u=(0,l.bx)(),c=u.getVariableList,m=Le(function(S){return S.globalVariableList}),p=(0,l._J)(function(S){return S.nodes}),k=(0,l._J)(function(S){return S.edges}),g=(0,l.nS)(),b=g.nodesReadOnly,_=(0,ce.Z)({loading:!0}),f=B()(_,2),v=f[0],h=f[1],R=(0,d.useMemo)(function(){return c({nodeId:a.id})},[a.id,p,k]),x=(0,d.useMemo)(function(){return[].concat(Ce()(m),Ce()(R))},[m,R]);return(0,d.useEffect)(function(){if(!a.data.node_param.tool_name){h({loading:!1});return}h({loading:!0}),(0,vr.b4)({server_code:a.data.node_param.server_code,need_tools:!0}).then(function(S){var C,P=(C=S.data.tools)===null||C===void 0?void 0:C.find(function(Y){return Y.name===a.data.node_param.tool_name});P&&o({id:a.id,data:{input_params:un(P,a.data.input_params),node_param:i()(i()({},a.data.node_param),{},{tool_name:P.name,server_name:S.data.name})}}),h({loading:!1})}).finally(function(){h({loading:!1})})},[a.id]),v.loading?(0,e.jsx)(De.Z,{spinning:!0,className:"loading-center"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.MCP.panel.input",dm:"\u8F93\u5165"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.MCP.panel.inputVariables",dm:"\u8F93\u5165\u53D8\u91CF\uFF0CMCP\u5DE5\u5177\u7684\u8F93\u5165\u53C2\u6570\u3002"})})]}),(0,e.jsx)(l.U6,{disabledKey:!0,onChange:function(C){o({id:a.id,data:{input_params:C}})},value:a.data.input_params,variableList:x,disabled:b})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.MCP.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.MCP.panel.outputVariables",dm:"\u8F93\u51FA\u672C\u8282\u70B9\u5904\u7406\u7ED3\u679C\u7684\u53D8\u91CF\uFF0C\u7528\u4E8E\u540E\u7EED\u8282\u70B9\u8BC6\u522B\u548C\u5904\u7406\u672C\u8282\u70B9\u7684\u5904\u7406\u7ED3\u679C\u3002"})})]}),(0,e.jsx)(l.kq,{data:a.data.output_params})]})})]})}),xr=(0,d.memo)(function(s){var a=(0,l.Ii)(),r=a.handleNodeDataUpdate,o=(0,l.bx)(),u=o.getVariableList,c=Le(function(v){return v.globalVariableList}),m=(0,l._J)(function(v){return v.nodes}),p=(0,l._J)(function(v){return v.edges}),k=(0,l.nS)(),g=k.nodesReadOnly,b=(0,d.useMemo)(function(){return u({nodeId:s.id})},[s.id,m,p]),_=(0,d.useMemo)(function(){return[].concat(Ce()(c),Ce()(b))},[c,b]),f=(0,d.useCallback)(function(v){r({id:s.id,data:{node_param:i()(i()({},s.data.node_param),v)}})},[s.data.node_param]);return(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Output.panel.outputContent",dm:"\u8F93\u51FA\u5185\u5BB9"})}),(0,e.jsx)(l.Fm,{variableList:_,value:s.data.node_param.output,onChange:function(h){return f({output:h})},disabled:g,maxLength:Number.MAX_SAFE_INTEGER})]}),(0,e.jsxs)("div",{className:"flex-justify-between w-full",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Output.panel.streamOutput",dm:"\u6D41\u5F0F\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Output.panel.streamMode",dm:"\u5F00\u542F\u540E\uFF0C\u8282\u70B9\u7684\u6765\u6E90\u4E8E\u5927\u6A21\u578B\u7684\u8F93\u51FA\u5185\u5BB9\u5C06\u7528\u6D41\u5F0F\u5448\u73B0\u3002"})})]}),(0,e.jsx)(ua.Z,{disabled:g,checked:s.data.node_param.stream_switch,onChange:function(h){f({stream_switch:h})}})]})]})}),Fa={form:"form___vYVnU","label-wrap":"label-wrap___ex9xm"},_r=(0,d.memo)(function(a){var r=a.value,o=a.onChange;return(0,e.jsxs)("div",{className:Fa.form,children:[(0,e.jsxs)(w.Z,{align:"center",gap:8,children:[(0,e.jsxs)(w.Z,{className:Fa["label-wrap"],gap:4,align:"center",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.ParallelConfigForm.index.maxBatchCount",dm:"\u6279\u5904\u7406\u6B21\u6570\u4E0A\u9650"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.components.ParallelConfigForm.index.batchExecutionLimit",dm:"\u6279\u5904\u7406\u8FD0\u884C\u7684\u6B21\u6570\u4E0D\u5927\u4E8E\u6279\u5904\u7406\u6B21\u6570\u4E0A\u9650"})})]}),(0,e.jsx)(da.Z,{min:1,max:200,step:1,value:r.batch_size,inputNumberWrapperStyle:{width:54},className:"flex-1",onChange:function(c){return o({batch_size:c})}})]}),(0,e.jsxs)(w.Z,{align:"center",gap:8,children:[(0,e.jsxs)(w.Z,{className:Fa["label-wrap"],gap:4,align:"center",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.ParallelConfigForm.index.parallelCount",dm:"\u5E76\u884C\u8FD0\u884C\u6570\u91CF"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.components.ParallelConfigForm.index.concurrentLimit",dm:"\u6279\u5904\u7406\u7684\u5E76\u53D1\u9650\u5236\uFF0C\u8BBE\u7F6E\u4E3A 1 \u8868\u793A\u4E32\u884C\u6267\u884C\u6240\u6709\u4EFB\u52A1"})})]}),(0,e.jsx)(da.Z,{min:1,max:10,step:1,inputNumberWrapperStyle:{width:54},className:"flex-1",value:r.concurrent_size,onChange:function(c){return o({concurrent_size:c})}})]})]})}),br=[{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.terminateOnError",dm:"\u9519\u8BEF\u65F6\u7EC8\u6B62"}),value:"terminated"},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.ignoreErrorContinue",dm:"\u5FFD\u7565\u9519\u8BEF\u5E76\u7EE7\u7EED"}),value:"continueOnError"},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.removeErrorOutput",dm:"\u79FB\u9664\u9519\u8BEF\u8F93\u51FA"}),value:"removeErrorOutput"}],yr=(0,d.memo)(function(a){var r=(0,l._J)(function(R){return R.nodes}),o=(0,l._J)(function(R){return R.edges}),u=(0,l.Ii)(),c=u.handleNodeDataUpdate,m=(0,l.bx)(),p=m.getSubNodesVariables,k=m.getVariableList,g=(0,l.nS)(),b=g.nodesReadOnly,_=(0,d.useMemo)(function(){return k({nodeId:a.id})},[a.id,r,o]),f=(0,d.useMemo)(function(){var R=[];return _.forEach(function(x){var S=(0,l.BA)(x.children,["Array<String>","Array<Boolean>","Array<File>","Array<Number>","Array<String>"]);S.length>0&&R.push(i()(i()({},x),{},{children:S}))}),R},[a.id,_]),v=(0,d.useMemo)(function(){return p(a.id)},[a.id,r]),h=(0,d.useCallback)(function(R){c({id:a.id,data:{node_param:i()(i()({},a.data.node_param),R)}})},[a.data.node_param,c]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.batchSettings",dm:"\u6279\u5904\u7406\u8BBE\u7F6E"})}),(0,e.jsx)(_r,{value:a.data.node_param,onChange:h})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.batchArray",dm:"\u6279\u5904\u7406\u6570\u7EC4"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.batchInput",dm:"\u6279\u5904\u7406\u7684\u8F93\u5165\u5FC5\u987B\u662F\u6570\u7EC4\uFF08List\uFF09\u7C7B\u578B\u6570\u636E\uFF0C\u6D41\u7A0B\u4F1A\u6309\u7167\u6570\u7EC4\u7684\u7D22\u5F15\u987A\u5E8F\u6267\u884C\u3002"})})]}),(0,e.jsx)(l.U6,{disabled:b,onChange:function(x){return c({id:a.id,data:{input_params:x}})},variableList:f,value:a.data.input_params})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.outputVariable",dm:"\u8F93\u51FA\u53D8\u91CF"})}),(0,e.jsx)(l.U6,{disabled:b,disabledValueFrom:!0,value:a.data.output_params,variableList:v,onChange:function(x){c({id:a.id,data:{output_params:x}})}})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.errorResponseMethod",dm:"\u9519\u8BEF\u54CD\u5E94\u65B9\u6CD5"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.errorHandling",dm:"\u5F53\u6279\u5904\u7406\u4E2D\u67D0\u4E00\u4E2A\u5B50\u8282\u70B9\u8FD0\u884C\u5931\u8D25\u65F6\uFF0C\u6839\u636E\u7528\u6237\u9009\u62E9\u7684\u65B9\u5F0F\u8FDB\u884C\u5904\u7406\u3002"})})]}),(0,e.jsx)(ca.Z,{disabled:b,value:a.data.node_param.error_strategy,onChange:function(x){return h({error_strategy:x})},options:br,placeholder:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.panel.selectErrorMethod",dm:"\u8BF7\u9009\u62E9\u9519\u8BEF\u54CD\u5E94\u65B9\u6CD5"})})]})})]})}),gn={"spark-flow-horizontal-form-item":"spark-flow-horizontal-form-item___TeyvP"};function kr(s){var a=s.onCancel,r=s.onOk,o=s.initialValues,u=s.extractParams,c=na.Z.useForm(),m=B()(c,1),p=m[0],k=function(){var g=se()(O()().mark(function b(){var _;return O()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,p.validateFields();case 3:_=v.sent,r(_),v.next=10;break;case 7:v.prev=7,v.t0=v.catch(0),console.error("Validate Failed:",v.t0);case 10:case"end":return v.stop()}},b,null,[[0,7]])}));return function(){return g.apply(this,arguments)}}();return(0,e.jsx)(Ae.Z,{title:o?n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.editParam",dm:"\u7F16\u8F91\u53C2\u6570"}):n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.addParam",dm:"\u65B0\u589E\u53C2\u6570"}),open:!0,onCancel:a,onOk:k,destroyOnClose:!0,width:640,maskClosable:!1,className:gn["extract-param-edit-modal"],children:(0,e.jsxs)(na.Z,{form:p,layout:"vertical",initialValues:o||{key:"",type:"String",desc:"",required:!1},preserve:!1,children:[(0,e.jsx)(na.Z.Item,{label:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.name",dm:"\u540D\u79F0"}),name:"key",rules:[{required:!0,message:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.enterParamName",dm:"\u8BF7\u8F93\u5165\u53C2\u6570\u540D\u79F0"})},{pattern:/^[a-zA-Z_$][a-zA-Z0-9_$]*$/,message:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.nameFormat",dm:"\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u548C$\uFF0C\u4E14\u4E0D\u80FD\u4EE5\u6570\u5B57\u5F00\u5934"})},{validator:function(b,_){if(!_)return Promise.resolve();var f=u.some(function(v){return v.key===_&&(o===void 0||o.key!==_)});return f?Promise.reject(new Error(n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.paramNameExists",dm:"\u53C2\u6570\u540D\u79F0\u5DF2\u5B58\u5728"}))):Promise.resolve()}}],children:(0,e.jsx)(xe.Z,{placeholder:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.enter",dm:"\u8BF7\u8F93\u5165"})})}),(0,e.jsx)(na.Z.Item,{label:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.type",dm:"\u7C7B\u578B"}),name:"type",rules:[{required:!0,message:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.index.selectParameterType",dm:"\u8BF7\u9009\u62E9\u53C2\u6570\u7C7B\u578B"})}],children:(0,e.jsx)(ca.Z,{placeholder:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.selectType",dm:"\u9009\u62E9\u7C7B\u578B"}),options:l.yK.map(function(g){return{label:g.label,value:g.value,disabled:g.disabled}})})}),(0,e.jsx)(na.Z.Item,{label:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.description",dm:"\u63CF\u8FF0"}),name:"desc",rules:[{required:!0,message:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.enterDescription",dm:"\u8BF7\u8F93\u5165\u53C2\u6570\u63CF\u8FF0"})}],children:(0,e.jsx)(xe.Z.TextArea,{placeholder:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.paramDescription",dm:"\u53C2\u6570\u63CF\u8FF0"}),style:{height:"100px",resize:"none"},showCount:!0,maxLength:1e3})}),(0,e.jsx)(na.Z.Item,{layout:"horizontal",colon:!1,className:gn["spark-flow-horizontal-form-item"],label:(0,e.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.required",dm:"\u5FC5\u586B"})}),(0,e.jsx)("span",{className:"text-desc",children:n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.requiredReferenceOnly",dm:"\u5FC5\u586B\u4EC5\u4F5C\u4E3A\u6A21\u578B\u63A8\u7406\u7684\u53C2\u8003\uFF0C\u4E0D\u7528\u4E8E\u53C2\u6570\u8F93\u51FA\u7684\u5F3A\u5236\u9A8C\u8BC1\u3002"})})]}),name:"required",children:(0,e.jsx)(ua.Z,{})})]})})}var _a={"extract-param-item":"extract-param-item___Zv5iw","extract-param-item-key":"extract-param-item-key___mRcft","extract-param-item-info":"extract-param-item-info___CHtDI","extract-param-item-type":"extract-param-item-type___Kjxao","extract-param-item-desc":"extract-param-item-desc___qDdN0","extract-param-item-actions":"extract-param-item-actions___bITke"},jr=(0,d.memo)(function(a){var r=a.data,o=a.onDelete,u=a.onEdit,c=a.disabled;return(0,e.jsxs)("div",{className:we()(_a["extract-param-item"],"flex items-center gap-4"),children:[(0,e.jsxs)("div",{className:"flex gap-[4px] items-center",children:[(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:r.key},className:_a["extract-param-item-key"],children:r.key}),(0,e.jsx)("span",{className:_a["extract-param-item-type"],children:"[".concat(r.type,"]")})]}),(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:r.desc},className:we()("flex-1 w-[1px]",_a["extract-param-item-desc"]),children:r.desc}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:_a["extract-param-item-info"],children:r.required?n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamItem.index.required",dm:"\u5FC5\u586B"}):n.Z.get({id:"main.pages.App.Workflow.components.ExtractParamItem.index.optional",dm:"\u975E\u5FC5\u586B"})}),(0,e.jsxs)("div",{className:we()("flex gap-[8px]",_a["extract-param-item-actions"]),children:[(0,e.jsx)(y.Z,{onClick:u,className:c?"disabled-icon-btn":"",type:"spark-edit-line",isCursorPointer:!c}),(0,e.jsx)(y.Z,{onClick:o,className:c?"disabled-icon-btn":"",type:"spark-delete-line",isCursorPointer:!c})]})]})]})}),Cr=(0,d.memo)(function(a){var r=a.id,o=a.data,u=(0,l.Ii)(),c=u.handleNodeDataUpdate,m=(0,l.bx)(),p=m.getVariableList,k=Le(function(he){return he.globalVariableList}),g=(0,l._J)(function(he){return he.nodes}),b=(0,l._J)(function(he){return he.edges}),_=(0,l.nS)(),f=_.nodesReadOnly,v=(0,ce.Z)({showExtractParamEditModal:!1,editExtractParam:void 0}),h=B()(v,2),R=h[0],x=h[1],S=(0,d.useMemo)(function(){return p({nodeId:r})},[r,g,b]),C=(0,d.useMemo)(function(){return[].concat(Ce()(k),Ce()(S))},[k,S]),P=(0,d.useCallback)(function(he){c({id:r,data:{node_param:i()(i()({},o.node_param),he)}})},[r,o.node_param]),Y=(0,d.useCallback)(function(he){var Ze=[{key:"_is_completed",type:"Boolean",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.completeParsing",dm:"\u662F\u5426\u5B8C\u6574\u89E3\u6790"})},{key:"_reason",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.unsuccessfulReason",dm:"\u672A\u6210\u529F\u89E3\u6790\u7684\u539F\u56E0"})}];he.forEach(function(Ye){Ze.unshift({key:Ye.key,type:Ye.type,desc:Ye.desc||""})}),c({id:r,data:{node_param:i()(i()({},o.node_param),{},{extract_params:he}),output_params:Ze}})},[P,o.node_param]),j=(0,d.useCallback)(function(){x({showExtractParamEditModal:!0})},[]),D=(0,d.useCallback)(function(he){x({showExtractParamEditModal:!0,editExtractParam:he})},[]),U=(0,d.useCallback)(function(he){Y(o.node_param.extract_params.filter(function(Ze){return Ze.key!==he}))},[r,o]),Z=(0,d.useCallback)(function(he){var Ze=R.editExtractParam;Y(Ze?o.node_param.extract_params.map(function(Ye){return Ye.key===Ze.key?he:Ye}):[].concat(Ce()(o.node_param.extract_params),[he])),x({showExtractParamEditModal:!1,editExtractParam:void 0})},[Y,o.node_param,R.editExtractParam]),I=(0,d.useCallback)(function(he){c({id:r,data:{input_params:[i()({key:"input",value_from:"refer",type:"String"},he)]}})},[r,o.input_params,c]),_e=(0,d.useMemo)(function(){var he=[];return C.forEach(function(Ze){var Ye=(0,l.BA)(Ze.children,["Array<String>","Array<Object>"]);Ye.length&&he.push(i()(i()({},Ze),{},{children:Ye}))}),he},[C]),be=(0,d.useMemo)(function(){var he=[];return C.forEach(function(Ze){var Ye=(0,l.BA)(Ze.children,["String"]);Ye.length>0&&he.push(i()(i()({},Ze),{},{children:Ye}))}),he},[C]),Me=(0,d.useMemo)(function(){var he=[];return C.forEach(function(Ze){var Ye=(0,l.BA)(Ze.children,["File","Array<File>"]);Ye.length>0&&he.push(i()(i()({},Ze),{},{children:Ye}))}),he},[C]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.input",dm:"\u8F93\u5165"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.enterText",dm:"\u8BF7\u8F93\u5165\u9700\u8981\u8FDB\u884C\u53C2\u6570\u63D0\u53D6\u7684\u6587\u672C\u5185\u5BB9\u3002"})})]}),(0,e.jsx)(l.W3,{disabled:f,variableList:be,value:o.input_params[0],onChange:I,prefix:"String"})]}),(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.modelSelection",dm:"\u6A21\u578B\u9009\u62E9"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.modelChoice",dm:"\u7528\u4E8E\u53C2\u6570\u63D0\u53D6\u7684\u6A21\u578B\uFF0C\u6839\u636E\u4E1A\u52A1\u60C5\u51B5\u81EA\u884C\u9009\u62E9\u5373\u53EF\u3002"})})]}),(0,e.jsx)(Ra,{disabled:f,variableList:Me,value:o.node_param.model_config,onChange:function(Ze){return P({model_config:Ze})}})]})]}),(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"flex-justify-between",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.extractParameters",dm:"\u63D0\u53D6\u53C2\u6570"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.parameterExtraction",dm:"\u6A21\u578B\u5C06\u6839\u636E\u540D\u79F0\u3001\u7C7B\u578B\u4EE5\u53CA\u63CF\u8FF0\u4ECE\u8F93\u5165\u4E2D\u63D0\u53D6\u53C2\u6570\u3002"})})]}),(0,e.jsx)(T.Z,{disabled:f,type:"link",onClick:j,size:"small",className:"self-start spark-flow-text-btn",icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),children:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.addVariable",dm:"\u6DFB\u52A0\u53D8\u91CF"})})]}),o.node_param.extract_params.map(function(he){return(0,e.jsx)(jr,{disabled:f,onEdit:function(){return D(he)},data:he,onDelete:function(){return U(he.key)}},he.key)})]}),(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.prompt",dm:"\u63D0\u793A\u8BCD"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.additionalRules",dm:"\u7528\u4E8E\u8F85\u52A9\u6A21\u578B\u8FDB\u884C\u53C2\u6570\u63D0\u53D6\u7684\u989D\u5916\u89C4\u5219\u3002"})})]}),(0,e.jsx)(l.Fm,{disabled:f,variableList:C,value:o.node_param.instruction,onChange:function(Ze){return P({instruction:Ze})},maxLength:Number.MAX_SAFE_INTEGER})]})]}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(Sa,{disabled:f,onChange:function(Ze){return P({short_memory:Ze})},value:o.node_param.short_memory,variableList:_e})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.panel.outputParameters",dm:"\u6A21\u578B\u63D0\u53D6\u7684\u53C2\u6570\u5C06\u4F5C\u4E3A\u8F93\u51FA\u53C2\u6570\u8FD4\u56DE\u3002"})})]}),(0,e.jsx)(l.kq,{data:o.output_params})]})}),R.showExtractParamEditModal&&(0,e.jsx)(kr,{onCancel:function(){return x({showExtractParamEditModal:!1})},onOk:Z,extractParams:o.node_param.extract_params,initialValues:R.editExtractParam})]})}),Zr=t(69163),wr=(0,d.memo)(function(a){var r=(0,ce.Z)({loading:!0,detail:null}),o=B()(r,2),u=o[0],c=o[1],m=(0,l.bx)(),p=m.getVariableList,k=Le(function(C){return C.globalVariableList}),g=(0,l._J)(function(C){return C.nodes}),b=(0,l._J)(function(C){return C.edges}),_=(0,l.nS)(),f=_.nodesReadOnly,v=(0,l.Ii)(),h=v.handleNodeDataUpdate,R=(0,d.useMemo)(function(){return p({nodeId:a.id})},[a.id,g,b]),x=(0,d.useMemo)(function(){return[].concat(Ce()(k),Ce()(R))},[k,R]);(0,d.useEffect)(function(){if(!a.data.node_param.tool_id){c({loading:!1,detail:null});return}(0,Zr.R)(a.data.node_param.plugin_id,a.data.node_param.tool_id).then(function(C){if(c({loading:!1,detail:C==null?void 0:C.data}),C!=null&&C.data){var P,Y;h({id:a.id,data:{input_params:(((P=C.data.config)===null||P===void 0?void 0:P.input_params)||[]).map(function(j){return a.data.input_params.find(function(D){return D.key===j.key})||{key:j.key,type:j.type,value_from:"refer",value:void 0}}),output_params:(((Y=C.data.config)===null||Y===void 0?void 0:Y.output_params)||[]).map(function(j){return{key:j.key,type:j.type,desc:j.description}}),node_param:i()(i()({},a.data.node_param),{},{plugin_name:C.data.name,tool_id:C.data.tool_id,tool_name:C.data.name})}})}}).catch(function(){c({loading:!1})})},[a.data.node_param.tool_id,a.data.node_param.plugin_id]);var S=(0,d.useCallback)(function(C){h({id:a.id,data:{node_param:i()(i()({},a.data.node_param),C)}})},[a.data.node_param,h]);return u.loading?(0,e.jsx)(De.Z,{spinning:!0,className:"loading-center"}):u.detail?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.panel.input",dm:"\u8F93\u5165"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.panel.inputVariables",dm:"\u8F93\u5165\u672C\u8282\u70B9\u9700\u8981\u5904\u7406\u7684\u53D8\u91CF\uFF0C\u7528\u4E8E\u8BC6\u522B\u9700\u8981\u5904\u7406\u7684\u5185\u5BB9\uFF0C\u652F\u6301\u5F15\u7528\u524D\u7F6E\u3002"})})]}),(0,e.jsx)(l.U6,{disabledKey:!0,disabled:f,onChange:function(P){h({id:a.id,data:{input_params:P}})},value:a.data.input_params,variableList:x})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.panel.outputVariables",dm:"\u8F93\u51FA\u672C\u8282\u70B9\u5904\u7406\u7ED3\u679C\u7684\u53D8\u91CF\uFF0C\u7528\u4E8E\u540E\u7EED\u8282\u70B9\u8BC6\u522B\u548C\u5904\u7406\u672C\u8282\u70B9\u7684\u5904\u7406\u7ED3\u679C\u3002"})})]}),(0,e.jsx)(l.kq,{data:a.data.output_params})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(Aa,{disabled:f,value:a.data.node_param.retry_config,onChange:function(P){return S({retry_config:P})}})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(wa,{disabled:f,nodeId:a.id,value:a.data.node_param.try_catch_config,onChange:function(P){return S({try_catch_config:P})},onChangeType:function(P){var Y=P==="failBranch"?{default_values:xa(a.data.output_params)}:{};S({try_catch_config:i()(i()({},a.data.node_param.try_catch_config),{},{strategy:P},Y)})}})})]}):(0,e.jsx)("div",{className:"loading-center",children:(0,e.jsx)(le.Z,{title:n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.panel.toolNotFound",dm:"\u672A\u627E\u5230\u5DE5\u5177"}),description:n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.panel.toolNotExist",dm:"\u5DE5\u5177\u4E0D\u5B58\u5728\uFF0C\u8BF7\u5220\u9664\u540E\u91CD\u65B0\u6DFB\u52A0"})})})}),Ar=t(21141),Sr=t(76077),ga={"panel-form-area":"panel-form-area___BBza2","panel-form-area-label":"panel-form-area-label___HgpD4","add-knowledge-btn":"add-knowledge-btn___sP9ZQ","loading-container":"loading-container___vdNtb","knowledge-name":"knowledge-name___zsxra","knowledge-item":"knowledge-item___FF69f","right-add":"right-add___sk83L"},Nr=(0,d.memo)(function(a){var r=a.id,o=a.data,u=(0,l.Ii)(),c=u.handleNodeDataUpdate,m=(0,ce.Z)({list:[],loading:!0,showKnowledgeSelect:!1}),p=B()(m,2),k=p[0],g=p[1],b=(0,l.bx)(),_=b.getVariableList,f=Le(function(Z){return Z.globalVariableList}),v=(0,l._J)(function(Z){return Z.nodes}),h=(0,l._J)(function(Z){return Z.edges}),R=(0,l.nS)(),x=R.nodesReadOnly,S=(0,d.useMemo)(function(){return _({nodeId:r})},[r,v,h]),C=(0,d.useMemo)(function(){return[].concat(Ce()(f),Ce()(S))},[f,S]),P=(0,d.useCallback)(function(){if(!o.node_param.knowledge_base_ids.length){g({list:[],loading:!1});return}(0,Sr.Y6)(o.node_param.knowledge_base_ids).then(function(Z){g({list:Z,loading:!1})})},[r]),Y=(0,d.useCallback)(function(Z){c({id:r,data:{node_param:i()(i()({},o.node_param),Z)}})},[o.node_param]);(0,d.useEffect)(function(){P()},[r,P]);var j=(0,d.useCallback)(function(Z){g({list:k.list.filter(function(I){return I.kb_id!==Z})}),Y({knowledge_base_ids:o.node_param.knowledge_base_ids.filter(function(I){return I!==Z})})},[o.node_param.knowledge_base_ids,k.list]),D=(0,d.useCallback)(function(Z){c({id:r,data:{input_params:[i()({key:"input",value_from:"refer",type:"String"},Z)]}})},[r,o.input_params]),U=(0,d.useMemo)(function(){var Z=[];return C.forEach(function(I){var _e=(0,l.BA)(I.children,["String"]);_e.length>0&&Z.push(i()(i()({},I),{},{children:_e}))}),Z},[C]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.input",dm:"\u8F93\u5165"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.matchedInformation",dm:"\u8F93\u5165\u9700\u8981\u4ECE\u77E5\u8BC6\u5E93\u4E2D\u5339\u914D\u7684\u4FE1\u606F\u3002"})})]}),(0,e.jsx)(l.W3,{disabled:x,onChange:D,value:o.input_params[0],variableList:U,prefix:"String"})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:k.loading?(0,e.jsx)("div",{className:ga["loading-container"],children:(0,e.jsx)(De.Z,{className:"loading-center"})}):(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"flex-justify-between",children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.knowledgeBase",dm:"\u77E5\u8BC6\u5E93"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.contentFromConfigured",dm:"\u5185\u5BB9\u53EA\u4F1A\u4ECE\u8BBE\u7F6E\u7684\u77E5\u8BC6\u5E93\u4E2D\u68C0\u7D22\u3002"})})]}),!!k.list.length&&(0,e.jsx)(T.Z,{disabled:x,className:ga["right-add"],size:"small",icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),type:"text",onClick:function(){return g({showKnowledgeSelect:!0})},children:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.knowledgeBase",dm:"\u77E5\u8BC6\u5E93"})})]}),k.list.length?(0,e.jsx)(w.Z,{vertical:!0,gap:12,children:k.list.map(function(Z){return(0,e.jsxs)(w.Z,{className:ga["knowledge-item"],gap:12,justify:"space-between",align:"center",children:[(0,e.jsxs)(w.Z,{className:"flex-1 w-[1px]",align:"center",gap:4,children:[(0,e.jsx)(y.Z,{size:"small",type:"spark-book-line"}),(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:Z.name},className:we()(ga["knowledge-name"]),children:Z.name})]}),(0,e.jsx)(y.Z,{size:"small",onClick:function(){return j(Z.kb_id)},type:"spark-delete-line",className:x?"disabled-icon-btn":"",isCursorPointer:!x})]},Z.kb_id)})}):(0,e.jsx)(T.Z,{disabled:x,onClick:function(){return g({showKnowledgeSelect:!0})},icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),type:"dashed",className:ga["add-knowledge-btn"],children:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.selectKnowledgeBase",dm:"\u9009\u62E9\u77E5\u8BC6\u5E93"})}),(0,e.jsxs)("div",{className:ga["panel-form-area"],children:[(0,e.jsxs)("div",{className:"flex items-center gap-[12px]",children:[(0,e.jsxs)("div",{className:ga["panel-form-area-label"],children:[(0,e.jsx)("span",{children:"topK"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.topMatches",dm:"\u4ECE\u6BCF\u4E2A\u77E5\u8BC6\u5E93\u4E2D\u8FD4\u56DE\u7684\u6700\u9AD8\u8FD1\u4F3C\u503C\u7684\u4E2A\u6570\u3002"})})]}),(0,e.jsx)(da.Z,{disabled:x,value:o.node_param.top_k,onChange:function(I){Y({top_k:I})},step:1,className:"flex-1 ml-[20px] mr-[12px]",min:1,precision:0,max:20,inputNumberWrapperStyle:{width:54}})]}),(0,e.jsxs)("div",{className:"flex items-center gap-[12px]",children:[(0,e.jsxs)("div",{className:ga["panel-form-area-label"],children:[(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.similarityThreshold",dm:"\u76F8\u4F3C\u5EA6\u9608\u503C"})}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.returnOnlyAboveThreshold",dm:"\u53EA\u6709\u9AD8\u4E8E\u8BE5\u76F8\u4F3C\u5EA6\u7684\u5185\u5BB9\u4F1A\u8FD4\u56DE"})})]}),(0,e.jsx)(da.Z,{disabled:x,value:o.node_param.similarity_threshold,onChange:function(I){Y({similarity_threshold:I})},step:.01,className:"flex-1 ml-[20px] mr-[12px]",min:.01,precision:2,max:1,inputNumberWrapperStyle:{width:54}})]})]})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.panel.matchedContent",dm:"\u8F93\u51FA\u5339\u914D\u5230\u7684\u5185\u5BB9\u4EE5\u53CA\u5173\u952E\u5B57\u6BB5\u3002"})})]}),(0,e.jsx)(l.kq,{data:o.output_params})]})}),k.showKnowledgeSelect&&(0,e.jsx)(Ar.d7,{value:k.list,onClose:function(){return g({showKnowledgeSelect:!1})},onOk:function(I){g({list:I,showKnowledgeSelect:!1}),Y({knowledge_base_ids:I.map(function(_e){return _e.kb_id})})}})]})}),Pr={"script-code-mirror-container":"script-code-mirror-container___N_isB"},Tr=[{label:"Python",value:"python"},{label:"JavaScript",value:"javascript"}],Er=function(a,r){return a.map(function(o){var u=r==null?void 0:r.find(function(c){return c.type===o.type&&c.key===o.key});return{type:o.type,key:o.key,value:u==null?void 0:u.value}})},Wr=(0,d.memo)(function(s){var a=(0,l.Ii)(),r=a.handleNodeDataUpdate,o=(0,l.bx)(),u=o.getVariableList,c=(0,l._J)(function(C){return C.nodes}),m=(0,l._J)(function(C){return C.edges}),p=Le(function(C){return C.globalVariableList}),k=(0,d.useState)(!1),g=B()(k,2),b=g[0],_=g[1],f=(0,l.nS)(),v=f.nodesReadOnly,h=(0,d.useMemo)(function(){return u({nodeId:s.id})},[s.id,c,m]),R=(0,d.useMemo)(function(){return[].concat(Ce()(p),Ce()(h))},[p,h]),x=(0,d.useCallback)(function(C){r({id:s.id,data:{node_param:i()(i()({},s.data.node_param),C)}})},[s.data.node_param]),S=(0,d.useCallback)(function(C){r({id:s.id,data:{output_params:C,node_param:i()(i()({},s.data.node_param),{},{try_catch_config:i()(i()({},s.data.node_param.try_catch_config),{},{default_values:Er(C,s.data.node_param.try_catch_config.default_values)})})}})},[s.data]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.Script.panel.input",dm:"\u8F93\u5165"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.panel.parametersOrConstants",dm:"\u811A\u672C\u9700\u8981\u5F15\u7528\u7684\u5165\u53C2\u6216\u5E38\u91CF\u3002"})})]}),(0,e.jsx)(l.U6,{disabled:v,value:s.data.input_params,variableList:R,onChange:function(P){return r({id:s.id,data:{input_params:P}})}})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"flex-justify-between",children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.panel.code",dm:"\u4EE3\u7801"})}),(0,e.jsxs)(w.Z,{align:"center",gap:8,children:[(0,e.jsx)(ca.Z,{disabled:v,value:s.data.node_param.script_type,popupMatchSelectWidth:!1,onChange:function(P){return x({script_type:P,script_content:l.AJ[P]})},options:Tr}),(0,e.jsx)(T.Z,{onClick:function(){return _(!0)},icon:(0,e.jsx)(y.Z,{type:"spark-fullscreen-line"}),children:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.panel.fullScreenEdit",dm:"\u5168\u5C4F\u7F16\u8F91"})})]})]}),(0,e.jsx)("div",{className:Pr["script-code-mirror-container"],children:(0,e.jsx)(l.RS,{disabled:v,value:s.data.node_param.script_content,onChange:function(P){return x({script_content:P})},inputParams:s.data.input_params,outputParams:s.data.output_params,language:s.data.node_param.script_type})})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-title",children:[n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.output",dm:"\u8F93\u51FA"}),(0,e.jsx)(Pe,{tip:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.panel.output",dm:"\u811A\u672C\u7684\u8F93\u51FA\u5185\u5BB9\u4EE5\u53CA\u7ED3\u6784\u3002"})})]}),(0,e.jsx)(l.TN,{readyOnly:v,value:s.data.output_params,onChange:S})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(Aa,{disabled:v,value:s.data.node_param.retry_config,onChange:function(P){return x({retry_config:P})}})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsx)(wa,{disabled:v,nodeId:s.id,value:s.data.node_param.try_catch_config,onChange:function(P){return x({try_catch_config:P})},onChangeType:function(P){var Y=P==="failBranch"?{default_values:xa(s.data.output_params)}:{};x({try_catch_config:i()(i()({},s.data.node_param.try_catch_config),{},{strategy:P},Y)})}})}),b&&(0,e.jsx)(l.xB,{disabled:v,language:s.data.node_param.script_type,value:s.data.node_param.script_content,inputParams:s.data.input_params,outputParams:s.data.output_params,onClose:function(){return _(!1)},onOk:function(P){var Y=P.language,j=P.value;x({script_type:Y,script_content:j}),_(!1)}})]})}),Mr=(0,d.memo)(function(s){var a=(0,l.Ii)(),r=a.handleNodeDataUpdate,o=(0,l.nS)(),u=o.nodesReadOnly;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{gap:12,vertical:!0,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Start.panel.input",dm:"\u8F93\u5165"})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-second-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Start.panel.customVariables",dm:"\u81EA\u5B9A\u4E49\u53D8\u91CF"})}),(0,e.jsx)(l.TN,{readyOnly:u,value:s.data.output_params,onChange:function(m){r({id:s.id,data:{output_params:m}})}})]})}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{gap:12,vertical:!0,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-second-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.Start.panel.predefinedVariables",dm:"\u9884\u7F6E\u53D8\u91CF"})}),(0,e.jsx)(l.TN,{readyOnly:!0,value:[{key:"query",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Start.panel.userQuery",dm:"\u7528\u6237\u7684query"})}]})]})})]})}),Ir=[{label:(0,e.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,e.jsx)(y.Z,{size:"small",type:"spark-quotation-line"}),n.Z.get({id:"spark-flow.components.CustomInputsControl.index.reference",dm:"\u5F15\u7528"})]}),value:"refer"},{label:(0,e.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,e.jsx)(y.Z,{size:"small",type:"spark-edit-line"}),n.Z.get({id:"spark-flow.components.CustomInputsControl.index.input",dm:"\u8F93\u5165"})]}),value:"input"},{label:(0,e.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,e.jsx)(y.Z,{size:"small",type:"spark-clear-line"}),n.Z.get({id:"spark-flow.components.CustomInputsControl.index.clear",dm:"\u6E05\u7A7A"})]}),value:"clear"}],Lr=(0,d.memo)(function(a){var r=a.id,o=a.parentId,u=a.data,c=(0,l.Ii)(),m=c.handleNodeDataUpdate,p=Le(function(j){return j.globalVariableList}),k=(0,l.bx)(),g=k.getVariableList,b=(0,l._J)(function(j){return j.nodes}),_=(0,l._J)(function(j){return j.edges}),f=(0,l.nS)(),v=f.nodesReadOnly,h=(0,d.useMemo)(function(){var j=g({nodeId:r,disableShowVariableParameters:!!o});return j},[r,b,_,o]),R=(0,d.useCallback)(function(j){m({id:r,data:{node_param:i()(i()({},u.node_param),j)}})},[u,r]),x=(0,d.useCallback)(function(j){R({inputs:j})},[u,r]),S=function(){var D=[].concat(Ce()(u.node_param.inputs),[{id:(0,l.EL)(4),left:{value_from:"refer",type:"String"},right:{value_from:"refer",type:"String"}}]);x(D)},C=(0,d.useCallback)(function(j){var D=u.node_param.inputs.filter(function(U){return U.id!==j});x(D)},[u,r]),P=(0,d.useMemo)(function(){var j;if(!o)return p;var D=b.find(function(I){return I.id===o});if((D==null?void 0:D.type)!=="Iterator"||!D)return p;var U=Ce()(p),Z=[];return(j=D.data.node_param.variable_parameters)===null||j===void 0||j.forEach(function(I){I.value&&Z.push({label:I.key,value:"${".concat(D.id,".").concat(I.key,"}"),type:I.type})}),Z.length&&U.push({label:D.data.label,nodeId:D.id,nodeType:D.type,children:Z}),U},[p,o,b]),Y=(0,d.useCallback)(function(j,D){var U=u.node_param.inputs.map(function(Z){return Z.id===j?i()(i()({},Z),D):Z});x(U)},[u,r]);return(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.panel.setVariable",dm:"\u8BBE\u7F6E\u53D8\u91CF"})}),(0,e.jsxs)("div",{className:"spark-flow-panel-form-title-desc flex gap-[36px]",children:[(0,e.jsx)("span",{style:{width:"40%"},children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.panel.variable",dm:"\u53D8\u91CF"})}),(0,e.jsx)("span",{children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.panel.setValue",dm:"\u8BBE\u7F6E\u503C"})})]}),u.node_param.inputs.map(function(j){return(0,e.jsxs)("div",{className:"flex gap-[8px] items-center",children:[(0,e.jsx)("div",{style:{width:"40%"},children:(0,e.jsx)(l.W3,{disabled:v,variableList:P,value:j.left,onChange:function(U){Y(j.id,{left:i()(i()({},j.left),U),right:i()(i()({},j.right),{},{value:void 0,type:U.type})})}})}),(0,e.jsx)(y.Z,{className:"spark-flow-icon-base-color text-xl",type:"spark-leftArrow-line"}),(0,e.jsxs)(Se.Z.Compact,{style:{flex:1},children:[(0,e.jsx)(ca.Z,{disabled:v,style:{width:60},className:"flex-shrink-0 spark-flow-variable-from-select",value:j.right.value_from,onChange:function(U){return Y(j.id,{right:i()(i()({},j.right),{},{value_from:U,value:void 0})})},options:Ir,labelRender:function(U){return(0,l.Vi)(U.value)},popupMatchSelectWidth:!1}),(0,e.jsx)(l.g1,{disabledType:!0,isCompact:!0,disabled:v,data:j.right||"String",variableList:h,onChange:function(U){Y(j.id,{right:i()(i()({},j.right),U)})}})]}),(0,e.jsx)(y.Z,{type:"spark-delete-line",onClick:function(){return C(j.id)},isCursorPointer:!v,className:v?"disabled-icon-btn":""})]},j.id)}),(0,e.jsx)(T.Z,{type:"link",onClick:S,disabled:v,size:"small",className:"self-start spark-flow-text-btn",icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.panel.addVariable",dm:"\u6DFB\u52A0\u53D8\u91CF"})})]})})}),va={"spark-flow-group-variable-form":"spark-flow-group-variable-form___RUEnt","spark-flow-group-variable-form-label":"spark-flow-group-variable-form-label___i2GgN","spark-flow-hover-icon":"spark-flow-hover-icon___KKWn4","spark-flow-name-input-ok-btn":"spark-flow-name-input-ok-btn___g2Tt9","spark-flow-name-input-cancel-btn":"spark-flow-name-input-cancel-btn___kCyFp"},Dr=(0,d.memo)(function(a){var r=a.data,o=a.onDelete,u=a.onChange,c=a.handleCheckGroupName,m=a.variableList,p=a.disabled,k=(0,ce.Z)({isEdit:!1,tempName:r.group_name}),g=B()(k,2),b=g[0],_=g[1],f=(0,d.useRef)(!1),v=(0,d.useCallback)(function(U){var Z,I=U.filter(function(_e){return!!_e.type});u(i()(i()({},r),{},{variables:U,output_type:((Z=I[0])===null||Z===void 0?void 0:Z.type)||"String"}))},[r,u]),h=(0,d.useCallback)(function(U,Z){var I=r.variables.map(function(_e){return _e.id===U?i()(i()({},_e),Z):_e});v(I)},[r,v]),R=(0,d.useCallback)(function(U){var Z=r.variables.filter(function(I){return I.id!==U});v(Z)},[r,v]),x=(0,d.useCallback)(function(){v([].concat(Ce()(r.variables),[{id:(0,l.EL)(4),value:"",value_from:"refer"}]))},[r,v]),S=(0,d.useMemo)(function(){if(r.variables.length<=1)return m;var U=[];return m.forEach(function(Z){var I=(0,l.BA)(Z.children,[r.output_type]);I.length&&U.push(i()(i()({},Z),{},{children:I}))}),U},[m,r.variables,r.output_type]),C=(0,d.useCallback)(function(U,Z){return(0,e.jsxs)("div",{className:we()(va["spark-flow-group-variable-form-item"],"flex gap-2"),children:[Z,(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)(l.W3,{disabled:p,variableList:S,value:U,onChange:function(_e){h(U.id,_e)}})}),(0,e.jsx)(y.Z,{onClick:function(){p||R(U.id)},className:p?"disabled-icon-btn":"",type:"spark-delete-line",isCursorPointer:!p})]})},[h,S,r.variables]),P=(0,d.useCallback)(function(){c(b.tempName).then(function(){u(i()(i()({},r),{},{group_name:b.tempName})),_({isEdit:!1})}).catch(function(U){return Pa.Z.warning(U)})},[b.tempName,r]),Y=(0,d.useCallback)(function(){f.current=!0},[]),j=(0,d.useCallback)(function(){f.current=!1},[]),D=(0,d.useCallback)(function(U){f.current||(P(),U.preventDefault())},[P]);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:we()(va["spark-flow-group-variable-form"],"flex flex-col gap-[12px]"),children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[b.isEdit?(0,e.jsxs)("div",{className:"flex gap-[8px] items-center w-full",children:[(0,e.jsx)(xe.Z,{value:b.tempName,onChange:function(Z){return _({tempName:Z.target.value})},onCompositionStart:Y,onCompositionEnd:j,onPressEnter:D}),(0,e.jsx)(y.Z,{onClick:P,type:"spark-true-line",isCursorPointer:!0,className:va["spark-flow-name-input-ok-btn"]}),(0,e.jsx)(y.Z,{onClick:function(){_({isEdit:!1,tempName:r.group_name})},type:"spark-false-line",isCursorPointer:!0,className:va["spark-flow-name-input-cancel-btn"]})]}):(0,e.jsxs)("div",{className:we()("flex gap-[4px] items-center",va["spark-flow-panel-form-title"]),children:[!!r.output_type&&(0,e.jsxs)("div",{className:"spark-flow-var-type",children:["[",r.output_type,"]"]}),(0,e.jsx)(me.Z.Text,{style:{maxWidth:200},ellipsis:{tooltip:r.group_name},children:r.group_name}),(0,e.jsx)(y.Z,{className:we()(va["spark-flow-hover-icon"],p?"disabled-icon-btn":""),isCursorPointer:!p,type:"spark-edit-line",onClick:function(){p||_({isEdit:!0,tempName:r.group_name})}})]}),!b.isEdit&&(0,e.jsx)(y.Z,{onClick:p?void 0:o,className:we()(p?"disabled-icon-btn":"",va["spark-flow-hover-icon"]),isCursorPointer:!p,type:"spark-delete-line"})]}),(0,e.jsx)(l.Ff,{disabled:p,items:r.variables,onChange:v,getItemId:function(Z){return Z.id},renderItem:C,className:"flex flex-col gap-[8px]"}),(0,e.jsx)(T.Z,{className:"spark-flow-text-btn self-start",icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),type:"link",size:"small",onClick:x,disabled:p,children:n.Z.get({id:"main.pages.App.Workflow.components.GroupVariableForm.index.addVariable",dm:"\u6DFB\u52A0\u53D8\u91CF"})})]})})}),Or=[{label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.aggregateGroup",dm:"\u805A\u5408\u5206\u7EC4"}),value:"group",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.controlReturn",dm:"\u5C06\u6309\u7167\u805A\u5408\u7B56\u7565\u5BF9\u5206\u7EC4\u5185\u7684\u503C\u8FDB\u884C\u8FD4\u56DE\u63A7\u5236"})},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.textOutput",dm:"\u6587\u672C\u8F93\u51FA"}),value:"template",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.textType",dm:"\u8F93\u51FA\u6587\u672C\u7C7B\u578B"})},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.jsonOutput",dm:"JSON\u8F93\u51FA"}),value:"json",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.jsonType",dm:"\u8F93\u51FA\u683C\u5F0F\u5316\u7684Json\u7C7B\u578B"})}],Vr=[{label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.firstNonEmptyValue",dm:"\u8FD4\u56DE\u6BCF\u4E2A\u5206\u7EC4\u4E2D\u7B2C\u4E00\u4E2A\u975E\u7A7A\u7684\u503C"}),value:"firstNotNull"},{label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.lastNonEmptyValue",dm:"\u8FD4\u56DE\u6BCF\u4E2A\u5206\u7EC4\u4E2D\u6700\u540E\u4E00\u4E2A\u975E\u7A7A\u7684\u503C"}),value:"lastNotNull"}],Rr=(0,d.memo)(function(a){var r,o=a.id,u=a.data,c=(0,l.Ii)(),m=c.handleNodeDataUpdate,p=(0,l.bx)(),k=p.getVariableList,g=Le(function(Z){return Z.globalVariableList}),b=(0,l._J)(function(Z){return Z.nodes}),_=(0,l._J)(function(Z){return Z.edges}),f=(0,l.nS)(),v=f.nodesReadOnly,h=(0,d.useMemo)(function(){return k({nodeId:o})},[o,b,_]),R=(0,d.useMemo)(function(){return[].concat(Ce()(g),Ce()(h))},[g,h]),x=(0,d.useCallback)(function(Z){m({id:o,data:i()(i()({},u),{},{node_param:i()(i()({},u.node_param),{},{groups:Z}),output_params:Z.map(function(I){return{key:I.group_name,type:I.output_type}})})})},[u]),S=(0,d.useCallback)(function(Z){x(u.node_param.groups.filter(function(I){return I.group_id!==Z}))},[u]),C=(0,d.useCallback)(function(Z){x(u.node_param.groups.map(function(I){return I.group_id===Z.group_id?Z:I}))},[u]),P=(0,d.useCallback)(function(){var Z={group_id:(0,l.EL)(4),group_name:(0,l.GJ)("Group",u.node_param.groups.map(function(I){return I.group_name})),output_type:"String",variables:[{id:(0,l.EL)(4),type:"String",value_from:"refer",value:void 0}]};x([].concat(Ce()(u.node_param.groups),[Z]))},[u]),Y=(0,d.useCallback)(function(Z){var I=[{key:"output",type:"String"}];Z==="group"?I=u.node_param.groups.map(function(_e){return{key:_e.group_name,type:_e.output_type}}):Z==="json"&&(I=u.node_param.json_params.map(function(_e){return{key:_e.key,type:_e.type}})),m({id:o,data:{node_param:i()(i()({},u.node_param),{},{type:Z}),output_params:I}})},[u]),j=(0,d.useCallback)(function(Z){m({id:o,data:{node_param:i()(i()({},u.node_param),{},{json_params:Z}),output_params:Ce()(Z)}})},[u]),D=function(I,_e){return I.trim()?u.node_param.groups.some(function(be){return be.group_name===I&&be.group_id!==_e.group_id})?Promise.reject(n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.groupNameExists",dm:"\u5206\u7EC4\u540D\u79F0\u5DF2\u5B58\u5728"})):/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(I)?Promise.resolve(!0):Promise.reject(n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.onlyLettersNumbersUnderscoreAndDollar",dm:"\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u548C$\uFF0C\u4E14\u4E0D\u80FD\u4EE5\u6570\u5B57\u5F00\u5934"})):Promise.reject(n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.enterGroupName",dm:"\u8BF7\u8F93\u5165\u5206\u7EC4\u540D\u79F0"}))},U=(0,d.useCallback)(function(Z){m({id:o,data:{node_param:i()(i()({},u.node_param),Z)}})},[u,o,m]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"spark-flow-panel-form-section",children:[(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.outputMode",dm:"\u8F93\u51FA\u6A21\u5F0F"})}),(0,e.jsx)(l.hk,{disabled:v,options:Or,value:u.node_param.type,onChange:Y})]}),u.node_param.type==="template"&&(0,e.jsx)(l.Fm,{disabled:v,variableList:R,value:u.node_param.template_content,onChange:function(I){return U({template_content:I})},maxLength:Number.MAX_SAFE_INTEGER}),u.node_param.type==="json"&&(0,e.jsx)(l.U6,{disabled:v,value:u.node_param.json_params,onChange:j,variableList:R}),u.node_param.type==="group"&&(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.groupingStrategy",dm:"\u5206\u7EC4\u7B56\u7565"})}),(0,e.jsx)(l.hk,{disabled:v,options:Vr,value:u.node_param.group_strategy,onChange:function(I){return U({group_strategy:I})}}),(r=u.node_param.groups)===null||r===void 0?void 0:r.map(function(Z){return(0,e.jsx)(Dr,{disabled:v,variableList:R,data:Z,handleCheckGroupName:function(_e){return D(_e,Z)},onDelete:function(){return S(Z.group_id)},onChange:C},Z.group_id)}),(0,e.jsx)(T.Z,{disabled:v,onClick:P,variant:"dashed",icon:(0,e.jsx)(y.Z,{type:"spark-plus-line"}),children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.addGroup",dm:"\u6DFB\u52A0\u5206\u7EC4"})})]})]}),(0,e.jsx)("div",{className:"spark-flow-panel-form-section",children:(0,e.jsxs)(w.Z,{vertical:!0,gap:12,children:[(0,e.jsx)("div",{className:"spark-flow-panel-form-title",children:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.panel.output",dm:"\u8F93\u51FA"})}),(0,e.jsx)(l.kq,{data:u.output_params})]})})]})});function Fr(s){switch(s.type){case"Start":return(0,e.jsx)(Mr,{id:s.id,data:s.data});case"End":return(0,e.jsx)(dr,{id:s.id,data:s.data});case"LLM":return(0,e.jsx)(fr,{id:s.id,data:s.data});case"Output":return(0,e.jsx)(xr,{id:s.id,data:s.data});case"Script":return(0,e.jsx)(Wr,{id:s.id,data:s.data});case"Judge":return(0,e.jsx)(gr,{id:s.id,data:s.data});case"Classifier":return(0,e.jsx)(lr,{id:s.id,data:s.data});case"VariableHandle":return(0,e.jsx)(Rr,{id:s.id,data:s.data});case"VariableAssign":return(0,e.jsx)(Lr,{id:s.id,parentId:s.parentId,data:s.data});case"ParameterExtractor":return(0,e.jsx)(Cr,{id:s.id,data:s.data});case"API":return(0,e.jsx)(nr,{id:s.id,data:s.data});case"Retrieval":return(0,e.jsx)(Nr,{id:s.id,data:s.data});case"Input":return(0,e.jsx)(ur,{id:s.id,data:s.data});case"AppComponent":return(0,e.jsx)(or,{id:s.id,data:s.data});case"MCP":return(0,e.jsx)(hr,{id:s.id,data:s.data});case"Plugin":return(0,e.jsx)(wr,{id:s.id,data:s.data});case"Iterator":return(0,e.jsx)(mr,{id:s.id,data:s.data});case"Parallel":return(0,e.jsx)(yr,{id:s.id,data:s.data});default:return(0,e.jsx)("div",{children:n.Z.get({id:"main.pages.App.Workflow.nodes.getConfigPanel.unsupportedNode",dm:"\u672A\u652F\u6301\u7684\u8282\u70B9"})})}}var Br=function(a){var r={},o=a.input_params,u=o===void 0?[]:o;return aa(u,r),Object.keys(r)},Ur={type:"AppComponent",title:n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.schema.appComponent",dm:"\u5E94\u7528\u7EC4\u4EF6"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.schema.referencePublishedWorkflowOrAgent",dm:"\u5F15\u7528\u53D1\u5E03\u4E3A\u7EC4\u4EF6\u7684\u5DE5\u4F5C\u6D41/\u667A\u80FD\u4F53\u3002"}),iconType:"spark-osWidget-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.AppComponent.schema.tool",dm:"\u5DE5\u5177"}),defaultParams:{input_params:[],output_params:[],node_param:{name:"",code:"",type:"basic",output_type:"json",stream_switch:!1,short_memory:Ge.Yj}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-blue-hover)",customAdd:!0,getRefVariables:function(a){return Br(a)}},Kr=function(a){var r=[];return a.input_params[0].value||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.inputVariable",dm:"\u8F93\u5165\u53D8\u91CF"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),Oa(a.node_param.model_config,r),a.node_param.conditions.some(function(o){return!o.subject&&o.id!=="default"})&&r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.intentionClassification",dm:"\u610F\u56FE\u5206\u7C7B"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),Da(a.node_param.short_memory,r),r},Hr=function(a){var r={},o=a.input_params,u=o===void 0?[]:o;return aa(u,r),fa(a.node_param.instruction,r),a.node_param.model_config.vision_config.enable&&aa(a.node_param.model_config.vision_config.params,r),a.node_param.conditions.forEach(function(c){fa(c.subject,r)}),Object.keys(r)},Gr={type:"Classifier",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.intentionClassification",dm:"\u610F\u56FE\u5206\u7C7B"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.callLargeModelForIntentionJudgment",dm:"\u8C03\u7528\u5927\u6A21\u578B\uFF0C\u6839\u636E\u8BBE\u5B9A\u8FDB\u884C\u610F\u56FE\u5224\u65AD\u4EE5\u51B3\u5B9A\u5206\u652F\u6267\u884C\u3002"}),iconType:"spark-effciency-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[{key:"input",type:"String",value_from:"refer",value:void 0}],node_param:{conditions:[{id:"default",subject:""}],model_config:Ge.pt,short_memory:Ge.Yj,instruction:"",mode_switch:"efficient"},output_params:[{key:"subject",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.hitSubject",dm:"\u547D\u4E2D\u4E3B\u9898"})},{key:"thought",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Classifier.schema.thinkingProcess",dm:"\u601D\u8003\u8FC7\u7A0B"})}]},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-orange-hover)",checkValid:function(a){return Kr(a)},getRefVariables:function(a){return Hr(a)}},zr=function(a){var r=[];return a.node_param.output_type==="json"&&pa(a.node_param.json_params,r,{label:n.Z.get({id:"main.pages.App.Workflow.nodes.End.schema\u8F93\u51FA",dm:"\u8F93\u51FA"})}),a.node_param.output_type==="text"&&(a.node_param.text_template||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.End.schema\u6587\u672C\u6A21\u677F",dm:"\u6587\u672C\u6A21\u677F"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.End.schema\u4E0D\u80FD\u4E3A\u7A7A",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})})),r},$r={type:"End",title:n.Z.get({id:"main.pages.App.Workflow.nodes.End.schema.end",dm:"\u7ED3\u675F"}),iconType:"spark-flag-line",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.End.schema.endNode",dm:"\u7ED3\u675F\u8282\u70B9"}),defaultParams:{input_params:[],output_params:[],node_param:{output_type:"text",text_template:"",json_params:Ge.IW,stream_switch:!1}},isSystem:!0,hideInMenu:!0,allowSingleTest:!1,disableConnectSource:!0,groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.End.schema.basic",dm:"\u57FA\u7840"}),bgColor:"var(--ag-ant-color-purple-hover)",checkValid:function(a){return zr(a)}},Jr=function(a){var r=[];return pa(a.output_params,r),r},Yr={type:"Input",title:n.Z.get({id:"main.pages.App.Workflow.nodes.InputNode.schema.processInput",dm:"\u6D41\u7A0B\u8F93\u5165"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.InputNode.schema.supplementInformationInProcess",dm:"\u5728\u6D41\u7A0B\u4E2D\u8FDB\u884C\u4FE1\u606F\u7684\u8865\u5145\u3002"}),iconType:"spark-processInput-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.InputNode.schema.interaction",dm:"\u4EA4\u4E92"}),defaultParams:{input_params:[],output_params:[],node_param:{}},isSystem:!1,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-teal-hover)",checkValid:function(a){return Jr(a)}},Qr=function(a){var r=[];return a.node_param.iterator_type==="byArray"&&!a.node_param.variable_parameters.filter(function(o){return!o.value}).length&&r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.schema.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),pa(a.node_param.variable_parameters,r,{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.schema.intermediateVariable",dm:"\u4E2D\u95F4\u53D8\u91CF"}),disableCheckEmptyList:!0}),pa(a.output_params,r,{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.schema.output",dm:"\u8F93\u51FA"}),checkValue:!0}),r},Xr=function(a){var r={};return a.node_param.iterator_type==="byArray"&&aa(a.input_params,r),aa(a.node_param.variable_parameters,r),Jt(a.node_param.terminations,r,{disableShowLeft:!0}),Object.keys(r)},qr={type:"Iterator",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.schema.loop",dm:"\u5FAA\u73AF"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.schema.repeatTasksBySettingLogic",dm:"\u901A\u8FC7\u5728\u753B\u5E03\u4E2D\u8BBE\u5B9A\u903B\u8F91\u5E76\u914D\u7F6E\u89C4\u5219\uFF0C\u91CD\u590D\u6267\u884C\u4E00\u7CFB\u5217\u4EFB\u52A1\u3002"}),iconType:"spark-cycleDiagram-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Iterator.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[],output_params:[],node_param:{iterator_type:"byArray",count_limit:100,variable_parameters:[],terminations:[]}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-orange-hover)",isGroup:!0,checkValid:function(a){return Qr(a)},getRefVariables:function(a){return Xr(a)},getParentNodeVariableList:cn},eo={type:"IteratorEnd",title:n.Z.get({id:"main.pages.App.Workflow.nodes.IteratorEnd.schema.iterationEnd",dm:"\u8FED\u4EE3\u7ED3\u675F"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.IteratorEnd.schema.iterationEndNode",dm:"\u8FED\u4EE3\u7ED3\u675F\u8282\u70B9"}),iconType:"spark-flag-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.IteratorEnd.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[],output_params:[],node_param:{}},isSystem:!0,hideInMenu:!0,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,notAllowConfig:!0,bgColor:"var(--ag-ant-color-purple-hover)"},ao={type:"IteratorStart",title:n.Z.get({id:"main.pages.App.Workflow.nodes.IteratorStart.schema.iterationStart",dm:"\u5FAA\u73AF\u5F00\u59CB"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.IteratorStart.schema.iterationStartNode",dm:"\u5FAA\u73AF\u5F00\u59CB\u8282\u70B9"}),iconType:"spark-processStart-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.IteratorStart.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[],output_params:[],node_param:{}},isSystem:!0,hideInMenu:!0,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,notAllowConfig:!0,bgColor:"var(--ag-ant-color-purple-hover)"},no={type:"Judge",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Judge.schema.conditionJudgment",dm:"\u6761\u4EF6\u5224\u65AD"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Judge.schema.decideBranchBasedOnConditions",dm:"\u4F9D\u636E\u8BBE\u5B9A\u6761\u4EF6\u51B3\u5B9A\u5206\u652F\uFF0C\u82E5\u8BBE\u5B9A\u7684\u6761\u4EF6\u6210\u7ACB\u5219\u4EC5\u8FD0\u884C\u5BF9\u5E94\u5206\u652F\uFF0C\u82E5\u5747\u4E0D\u6210\u7ACB\u5219\u8FD0\u884C\u201C\u5176\u4ED6\u201D\u5206\u652F\u3002"}),iconType:"spark-conditionalJudgment-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Judge.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[],output_params:[],node_param:{branches:[{id:"default",label:n.Z.get({id:"main.pages.App.Workflow.nodes.Judge.schema.defaultCondition",dm:"\u9ED8\u8BA4\u6761\u4EF6"})}]}},isSystem:!1,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-orange-hover)"},to=function(a){var r=[];return Oa(a.node_param.model_config,r),a.node_param.sys_prompt_content||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.schema.prompt",dm:"\u63D0\u793A\u8BCD"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.schema.requiredField",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),a.node_param.prompt_content||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.schema.userPrompt",dm:"\u7528\u6237\u63D0\u793A\u8BCD"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.schema.requiredField",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),Yt(a.node_param.try_catch_config,r),Da(a.node_param.short_memory,r),r},ro=function(a){var r={},o=a.node_param,u=o.prompt_content,c=o.sys_prompt_content;return fa(u,r),fa(c,r),a.node_param.model_config.vision_config.enable&&aa(a.node_param.model_config.vision_config.params,r),Object.keys(r)},oo={type:"LLM",title:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.schema.largeModel",dm:"\u5927\u6A21\u578B"}),iconType:"spark-modePlaza-line",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.schema.callLargeModel",dm:"\u8C03\u7528\u5927\u6A21\u578B\uFF0C\u4F9D\u636E\u914D\u7F6E\u9879\u4EE5\u53CAPrompt\u8FDB\u884C\u5185\u5BB9\u751F\u6210\u3002"}),defaultParams:{input_params:[],output_params:Ge.PH,node_param:{sys_prompt_content:"",prompt_content:"",short_memory:Ge.Yj,model_config:Ge.pt,retry_config:Ge.Jp,try_catch_config:(0,Ge.Dw)(Ge.PH)}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.LLM.schema.basic",dm:"\u57FA\u7840"}),bgColor:"var(--ag-ant-color-purple-hover)",getRefVariables:function(a){return ro(a)},checkValid:function(a){return to(a)}},io=function(a){var r={},o=a.input_params;return aa(o,r),Object.keys(r)},so={type:"MCP",title:"MCP",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.MCP.schema.quickCall",dm:"\u5FEB\u6377\u8C03\u7528\u7B26\u5408MCP\u534F\u8BAE\u7684\u5DE5\u5177\u3002"}),iconType:"spark-MCP-mcp-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.MCP.schema.tool",dm:"\u5DE5\u5177"}),defaultParams:{input_params:[],output_params:[{key:"output",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.MCP.schema.result",dm:"\u7ED3\u679C"})}],node_param:{tool_name:"",server_code:"",server_name:""}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-blue-hover)",customAdd:!0,getRefVariables:function(a){return io(a)}},lo=function(a){var r=[];return a.node_param.output||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.Output.schema.outputContent",dm:"\u8F93\u51FA\u5185\u5BB9"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.Output.schema.requiredField",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),r},uo={type:"Output",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Output.schema.flowOutput",dm:"\u6D41\u7A0B\u8F93\u51FA"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Output.schema.interaction",dm:"\u5C06\u6D41\u7A0B\u7684\u4E2D\u95F4\u4FE1\u606F\u8F93\u51FA\u3002"}),iconType:"spark-processOutput-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Output.schema.output",dm:"\u4EA4\u4E92"}),defaultParams:{input_params:[],output_params:[],node_param:{output:"",stream_switch:!0}},isSystem:!1,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-teal-hover)",checkValid:function(a){return lo(a)}},co=function(a){var r=[];return pa(a.input_params,r,{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.schema.batchProcessingArray",dm:"\u6279\u5904\u7406\u6570\u7EC4"})}),pa(a.output_params,r,{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.schema.output",dm:"\u8F93\u51FA"}),checkValue:!0}),r},po=function(a){var r={};return aa(a.input_params,r),Object.keys(r)},mo={type:"Parallel",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.schema.batchProcessing",dm:"\u6279\u5904\u7406"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.schema.bulkProcessing",dm:"\u652F\u6301\u5BF9\u6570\u7EC4\u8FDB\u884C\u7684\u6279\u91CF\u5904\u7406\uFF0C\u63D0\u5347\u901F\u5EA6\u3002"}),iconType:"spark-summary-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Parallel.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[],output_params:[],node_param:{batch_size:100,concurrent_size:5,error_strategy:"terminated"}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-orange-hover)",isGroup:!0,checkValid:function(a){return co(a)},getRefVariables:function(a){return po(a)},getParentNodeVariableList:cn},go={type:"ParallelEnd",title:n.Z.get({id:"main.pages.App.Workflow.nodes.ParallelEnd.schema.parallelEnd",dm:"\u5E76\u884C\u7ED3\u675F"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParallelEnd.schema.parallelEndNode",dm:"\u5E76\u884C\u7ED3\u675F\u8282\u70B9"}),iconType:"spark-flag-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.ParallelEnd.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[],output_params:[],node_param:{}},isSystem:!0,hideInMenu:!0,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,notAllowConfig:!0,bgColor:"var(--ag-ant-color-purple-hover)"},fo={type:"ParallelStart",title:n.Z.get({id:"main.pages.App.Workflow.nodes.ParallelStart.schema.parallelStart",dm:"\u5E76\u884C\u5F00\u59CB"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParallelStart.schema.parallelStartNode",dm:"\u5E76\u884C\u5F00\u59CB\u8282\u70B9"}),iconType:"spark-processStart-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.ParallelStart.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:[],output_params:[],node_param:{}},isSystem:!0,hideInMenu:!0,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,notAllowConfig:!0,bgColor:"var(--ag-ant-color-purple-hover)"},vo=function(a){var r,o=[];return Oa(a.node_param.model_config,o),(r=a.input_params[0])!==null&&r!==void 0&&r.value||o.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),a.node_param.extract_params.length||o.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.extractParameters",dm:"\u63D0\u53D6\u53C2\u6570"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),Da(a.node_param.short_memory,o),o},ho=function(a){var r={};return aa(a.input_params,r),fa(a.node_param.instruction,r),a.node_param.model_config.vision_config.enable&&aa(a.node_param.model_config.vision_config.params,r),Object.keys(r)},xo={type:"ParameterExtractor",title:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.parameterExtraction",dm:"\u53C2\u6570\u63D0\u53D6"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.extractStructuredParameters",dm:"\u901A\u8FC7\u6A21\u578B\u63D0\u53D6\u4E00\u6BB5\u6587\u672C\u4E2D\u7ED3\u6784\u5316\u53C2\u6570\u3002"}),iconType:"spark-config-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.variable",dm:"\u53D8\u91CF"}),defaultParams:{input_params:[{key:"input",value_from:"refer",type:"String",value:""}],output_params:[{key:"city",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.city",dm:"\u57CE\u5E02"})},{key:"date",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.date",dm:"\u65E5\u671F"})},{key:"_is_completed",type:"Boolean",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.completeParsing",dm:"\u662F\u5426\u5B8C\u6574\u89E3\u6790"})},{key:"_reason",type:"String",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.unsuccessfulReason",dm:"\u672A\u6210\u529F\u89E3\u6790\u7684\u539F\u56E0"})}],node_param:{model_config:Ge.pt,instruction:"",extract_params:[{key:"city",type:"String",required:!0,desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.city",dm:"\u57CE\u5E02"})},{key:"date",type:"String",required:!0,desc:n.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.date",dm:"\u65E5\u671F"})}],short_memory:Ge.Yj}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-pink-hover)",checkValid:function(a){return vo(a)},getRefVariables:function(a){return ho(a)}},_o=function(a){var r={};return aa(a.input_params,r),Object.keys(r)},bo={type:"Plugin",title:n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.schema.plugin",dm:"\u63D2\u4EF6"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.schema.extendFunctionality",dm:"\u901A\u8FC7\u6DFB\u52A0\u63D2\u4EF6\u6269\u5C55\u5E94\u7528\u80FD\u529B\uFF0C\u6267\u884C\u5916\u90E8\u64CD\u4F5C\u3002"}),iconType:"spark-plugin-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.PluginNode.schema.tool",dm:"\u5DE5\u5177"}),defaultParams:{input_params:[],output_params:[],node_param:{plugin_id:"",tool_id:"",tool_name:"",plugin_name:"",retry_config:Ge.Jp,try_catch_config:Ge.x9}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-blue-hover)",customAdd:!0,getRefVariables:function(a){return _o(a)}},yo=function(a){var r,o=[],u=a.input_params;return u.some(function(c){return!c.value})&&o.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.schema.input",dm:"\u8F93\u5165"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.schema.requiredField",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),(r=a.node_param.knowledge_base_ids)!==null&&r!==void 0&&r.length||o.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.schema.knowledgeBase",dm:"\u77E5\u8BC6\u5E93"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.schema.requiredField",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),o},ko=function(a){var r={};return aa(a.input_params,r),Object.keys(r)},jo={type:"Retrieval",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.schema.knowledgeBase",dm:"\u77E5\u8BC6\u5E93"}),iconType:"spark-book-line",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.schema.retrieveMatchingInfo",dm:"\u5728\u9009\u5B9A\u7684\u77E5\u8BC6\u4E2D\uFF0C\u6839\u636E\u8F93\u5165\u53D8\u91CF\u53EC\u56DE\u6700\u5339\u914D\u7684\u4FE1\u606F\u3002"}),defaultParams:{input_params:[{key:"input",type:"String",value_from:"refer",value:void 0}],output_params:[{key:"chunk_list",type:"Array<Object>",properties:[{key:"doc_id",type:"String"},{key:"doc_name",type:"String"},{key:"title",type:"String"},{key:"text",type:"String"},{key:"score",type:"Number"},{key:"page_number",type:"Number"},{key:"chunk_id",type:"String"}]}],node_param:{knowledge_base_ids:[],prompt_strategy:"",top_k:10,similarity_threshold:.8}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Retrieval.schema.basic",dm:"\u57FA\u7840"}),checkValid:function(a){return yo(a)},bgColor:"var(--ag-ant-color-purple-hover)",getRefVariables:function(a){return ko(a)}},Co=function(a){var r={};return aa(a.input_params,r),Object.keys(r)},Zo=function(a){var r=[];return pa(a.input_params,r),a.node_param.script_content||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.schema.scriptContent",dm:"\u811A\u672C\u5185\u5BB9"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.schema.requiredField",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),pa(a.output_params,r,{label:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.schema.output",dm:"\u8F93\u51FA"})}),r},wo={type:"Script",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.schema.script",dm:"\u811A\u672C"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.schema.2",dm:"\u63D0\u4F9B\u81EA\u5B9A\u4E49\u903B\u8F91\u6269\u5C55\uFF0C\u7528\u811A\u672C\u89C4\u5219\u5904\u7406\u6570\u636E\u3002"}),iconType:"spark-fileCode-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Script.schema.logic",dm:"\u903B\u8F91"}),defaultParams:{input_params:Ge.km,output_params:Ge.W6,node_param:{script_content:l.AJ.javascript,script_type:"javascript",retry_config:Ge.Jp,try_catch_config:Ge.x9}},isSystem:!1,allowSingleTest:!0,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-orange-hover)",getRefVariables:function(a){return Co(a)},checkValid:function(a){return Zo(a)}},Ao={type:"Start",title:n.Z.get({id:"main.pages.App.Workflow.nodes.Start.schema.start",dm:"\u5F00\u59CB"}),iconType:"spark-processStart-line",desc:n.Z.get({id:"main.pages.App.Workflow.nodes.Start.schema.startNode",dm:"\u5F00\u59CB\u8282\u70B9"}),defaultParams:{input_params:[],output_params:Ge._i,node_param:{}},isSystem:!0,hideInMenu:!0,allowSingleTest:!1,disableConnectSource:!0,groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.Start.schema.basis",dm:"\u57FA\u7840"}),checkValid:function(){return[]},bgColor:"var(--ag-ant-color-purple-hover)"},So=function(a){var r=[],o=!1,u=!1;return a.node_param.inputs.length||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.setVariable",dm:"\u8BBE\u7F6E\u53D8\u91CF"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),a.node_param.inputs.forEach(function(c){!c.left.value&&!o&&(o=!0,r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.setVariable",dm:"\u8BBE\u7F6E\u53D8\u91CF"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.leftValueNotNull",dm:"\u5DE6\u503C\u4E0D\u80FD\u4E3A\u7A7A"})})),!c.right.value&&c.right.value_from!=="clear"&&!u&&(u=!0,r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.setVariable",dm:"\u8BBE\u7F6E\u53D8\u91CF"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.rightValueNotNull",dm:"\u53F3\u503C\u4E0D\u80FD\u4E3A\u7A7A"})}))}),r},No={type:"VariableAssign",title:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.variableAssignment",dm:"\u53D8\u91CF\u8D4B\u503C"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.assignVariables",dm:"\u7528\u4E8E\u5BF9\u53D8\u91CF\u8FDB\u884C\u8D4B\u503C\u3002"}),iconType:"spark-variableSetting-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableAssign.schema.variable",dm:"\u53D8\u91CF"}),defaultParams:{input_params:[],output_params:[],node_param:{inputs:[{id:(0,l.EL)(4),left:{value_from:"refer",value:void 0,type:"String"},right:{value_from:"refer",value:void 0,type:"String"}}]}},isSystem:!1,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-pink-hover)",checkValid:function(a){return So(a)}},Po=function(a){var r=[];return a.node_param.type==="template"?a.node_param.template_content||r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.outputContent",dm:"\u8F93\u51FA\u5185\u5BB9"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}):a.node_param.type==="json"?pa(a.node_param.json_params,r,{label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.outputContent",dm:"\u8F93\u51FA\u5185\u5BB9"})}):a.node_param.type==="group"&&a.node_param.groups.some(function(o){return o.variables.some(function(u){return!u.value})})&&r.push({label:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.group",dm:"\u5206\u7EC4"}),error:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.notNull",dm:"\u4E0D\u80FD\u4E3A\u7A7A"})}),r},To={type:"VariableHandle",title:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.variableProcessing",dm:"\u53D8\u91CF\u5904\u7406"}),desc:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.processVariables",dm:"\u5BF9\u53D8\u91CF\u8FDB\u884C\u591A\u79CD\u65B9\u6CD5\u7684\u5904\u7406\u3002"}),iconType:"spark-variableProcessing-line",groupLabel:n.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.variable",dm:"\u53D8\u91CF"}),defaultParams:{input_params:[],output_params:[{key:"Group1",type:"String",desc:void 0}],node_param:{type:"group",group_strategy:"firstNotNull",groups:[{group_id:(0,l.EL)(4),group_name:"Group1",output_type:"String",variables:[{id:(0,l.EL)(4),value_from:"refer",value:void 0,type:"String"},{id:(0,l.EL)(4),value_from:"refer",value:void 0,type:"String"}]}],json_params:[],template_content:""}},isSystem:!1,allowSingleTest:!1,disableConnectSource:!0,disableConnectTarget:!0,bgColor:"var(--ag-ant-color-pink-hover)",checkValid:function(a){return Po(a)}},Eo={type:"sys",title:n.Z.get({id:"main.pages.App.Workflow.constant.NodeSchema.index.system",dm:"\u7CFB\u7EDF"}),iconType:"spark-summary-line",desc:n.Z.get({id:"main.pages.App.Workflow.constant.NodeSchema.index.system",dm:"\u7CFB\u7EDF"}),defaultParams:{input_params:[],output_params:[],node_param:{}},bgColor:"var(--ag-ant-color-purple-hover)",hideInMenu:!0},Wo={type:"conversation",title:n.Z.get({id:"main.pages.App.Workflow.constant.NodeSchema.index.conversation",dm:"\u4F1A\u8BDD"}),iconType:"spark-summary-line",desc:n.Z.get({id:"main.pages.App.Workflow.constant.NodeSchema.index.conversationVariable",dm:"\u4F1A\u8BDD\u53D8\u91CF"}),defaultParams:{input_params:[],output_params:[],node_param:{}},bgColor:"var(--ag-ant-color-purple-hover)",hideInMenu:!0},Na={sys:Eo,conversation:Wo,Start:Ao,End:$r,LLM:oo,Retrieval:jo,Input:Yr,Output:uo,Script:wo,Judge:no,Classifier:Gr,VariableHandle:To,VariableAssign:No,ParameterExtractor:xo,MCP:so,API:qt,AppComponent:Ur,Plugin:bo,Iterator:qr,Parallel:mo,IteratorStart:ao,IteratorEnd:eo,ParallelStart:fo,ParallelEnd:go},Mo=t(74875),Io=t.n(Mo),Lo=["block"],fn=function(a){return{id:a.id,type:a.type,position:{x:a.position.x||0,y:a.position.y||0},width:a.width,height:a.height,parentId:a.parent_id,zIndex:a.parent_id?1002:void 0,data:{label:a.name,desc:a.desc,input_params:a.config.input_params,output_params:a.config.output_params,node_param:a.config.node_param}}},vn=function(a){return{id:a.id,source:a.source,target:a.target,targetHandle:a.target_handle,sourceHandle:a.source_handle}},hn=function(a){var r,o,u;return{id:a.id,name:a.data.label,parent_id:a.parentId,desc:a.data.desc,config:{input_params:a.data.input_params,output_params:a.data.output_params,node_param:a.data.node_param},position:{x:a.position.x,y:a.position.y},width:((r=a.measured)===null||r===void 0?void 0:r.width)||320,height:(o=Na[a.type])!==null&&o!==void 0&&o.isGroup?(u=a.measured)===null||u===void 0?void 0:u.height:void 0,type:a.type}},xn=function(a){return{id:a.id,source:a.source,target:a.target,source_handle:a.sourceHandle||a.source,target_handle:a.targetHandle||a.target}},Do=function(a){var r=a.nodes,o=a.edges,u=o.filter(function(g){return!!g.source&&!!g.target}),c=[],m={};r.forEach(function(g){g.parentId?(m[g.parentId]||(m[g.parentId]=[]),m[g.parentId].push(g)):c.push(g)});var p=[];u.forEach(function(g){c.filter(function(b){return[g.source,g.target].includes(b.id)}).length===2&&p.push(xn(g))});var k=c.map(function(g){var b,_=hn(g);if(!((b=Na[g.type])!==null&&b!==void 0&&b.isGroup))return _;var f=[];return u.forEach(function(v){m[g.id].some(function(h){return[v.source,v.target].includes(h.id)})&&f.push(xn(v))}),i()(i()({},_),{},{config:i()(i()({},_.config),{},{node_param:i()(i()({},_.config.node_param),{},{block:{nodes:m[g.id].map(hn),edges:f}})})})});return{nodes:k,edges:p}},_n=function(a){var r=[],o=a.edges.map(vn);if(a)return a.nodes.forEach(function(u){var c,m=fn(u);if(!((c=Na[u.type])!==null&&c!==void 0&&c.isGroup))r.push(m);else{var p=m.data.node_param,k=p.block,g=Io()(p,Lo);r.push(i()(i()({},m),{},{data:i()(i()({},m.data),{},{node_param:g})}));var b=k||{},_=b.nodes,f=_===void 0?[]:_,v=b.edges,h=v===void 0?[]:v;f.forEach(function(R){r.push(fn(R))}),h.forEach(function(R){o.push(i()(i()({},vn(R)),{},{zIndex:1002}))})}}),{nodes:r,edges:o}},Oo=n.Z.getCurrentLanguage(),bn=(0,d.memo)(function(s){var a,r=s.actionLoading,o=s.init,u=s.appDetail,c=s.handlePublish,m=Le(function(I){return I.setShowTest}),p=ln(),k=p.initDebug,g=(0,re.d)(),b=(0,d.useState)(!1),_=B()(b,2),f=_[0],v=_[1],h=Le(function(I){return I.selectedVersion}),R=(0,l.oR)(function(I){return I.checkList}),x=(0,l.oR)(function(I){return I.setShowCheckList}),S=Le(function(I){return I.setSelectedVersion}),C=(0,l.PW)(),P=C.onFlowClearState,Y=(0,d.useState)(!1),j=B()(Y,2),D=j[0],U=j[1],Z=(0,d.useCallback)(function(I){if(S(I),P({readyOnly:I!=="draft"}),m(!1),I==="draft"){o(!0);return}(0,K.YI)(u.app_id,I).then(function(_e){try{var be=JSON.parse(_e.data.config);(0,ie.W)({type:"update-flow-data",data:_n({nodes:(be==null?void 0:be.nodes)||[],edges:(be==null?void 0:be.edges)||[]})})}catch(Me){}})},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)(l.hY,{})}),(0,e.jsxs)("div",{className:"flex flex-1 h-1 relative",children:[(0,e.jsx)(l.ev,{}),(0,e.jsxs)("div",{className:"relative flex-1",children:[(0,e.jsx)(l.Zw,{nodeTypes:Ht}),(0,e.jsx)(l.UB,{}),(0,e.jsxs)(l.pk,{children:[(0,e.jsx)(l._8,{singleTestPanel:dt}),(0,e.jsx)(xt,{})]})]}),f&&(0,e.jsx)(ee.Z,{hasInitData:!0,appDetail:s.appDetail,onSelectVersion:Z,selectedVersion:h,onClose:function(){v(!1)}})]})]}),g.rightPortal((0,e.jsxs)("div",{className:"flex gap-[8px]",children:[(0,e.jsx)(_t,{setShowHistoryPanel:v}),h==="draft"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ne.Z,{title:n.Z.get({id:"main.pages.App.Workflow.index.index.conversationVariablesRecordParameters",dm:"\u901A\u8FC7\u4F1A\u8BDD\u53D8\u91CF,\u53EF\u4EE5\u5728\u6D41\u7A0B\u7684\u5168\u751F\u547D\u5468\u671F\u4E2D\u8BB0\u5F55\u53C2\u6570\u4FE1\u606F,\u5E76\u5728\u8282\u70B9\u4E2D\u88AB\u5F15\u7528"}),children:(0,e.jsx)(J.Z,{onClick:function(){return U(!0)},shape:"default",icon:(0,e.jsx)(y.Z,{type:"spark-intervention-line"})})}),(0,e.jsx)(Pn,{appDetail:s.appDetail,onSave:s.init}),(0,e.jsx)(ut,{}),(0,e.jsxs)(Se.Z.Compact,{children:[(0,e.jsx)(T.Z,{disabled:r,onClick:function(){m(!0),k(!0)},children:n.Z.get({id:"main.pages.App.Workflow.index.index.test",dm:"\u6D4B\u8BD5"})}),(0,e.jsx)(l.xj,{})]}),(0,e.jsx)(T.Z,{disabled:r,onClick:function(){if(R.length){G.ZP.warning(n.Z.get({id:"main.pages.App.Workflow.index.checkNodeConfiguration",dm:"\u8BF7\u5148\u68C0\u67E5\u8282\u70B9\u914D\u7F6E"})),x(!0);return}c()},type:"primary",children:n.Z.get({id:"main.pages.App.Workflow.index.index.publish",dm:"\u53D1\u5E03"})})]}):(0,e.jsx)(T.Z,{icon:(0,e.jsx)(y.Z,{type:"spark-processOutput-line"}),onClick:se()(O()().mark(function I(){return O()().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:Z("draft"),G.ZP.success(n.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.returnedToCurrentVersion",dm:"\u5DF2\u56DE\u5230\u5F53\u524D\u7248\u672C"}));case 2:case"end":return be.stop()}},I)})),children:n.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.returnToCurrentVersion",dm:"\u56DE\u5230\u5F53\u524D\u7248\u672C"})})]})),D&&(0,e.jsx)(An,{value:(a=s.appDetail.config.global_config)===null||a===void 0||(a=a.variable_config)===null||a===void 0?void 0:a.conversation_params,appDetail:s.appDetail,onClose:function(){return U(!1)},onOk:function(){U(!1),s.init()}})]})}),yn=(0,d.memo)(function(s){var a=Le(function(x){return x.appId}),r=ln(),o=r.initDebug,u=(0,d.useState)(!1),c=B()(u,2),m=c[0],p=c[1],k=(0,d.useState)(!1),g=B()(k,2),b=g[0],_=g[1],f=(0,d.useCallback)(function(){p(!0),(0,K.b1)(a).then(function(){_(!0),s.init(),(0,ie.W)({type:"history-panel-fresh"})}).finally(function(){p(!1)})},[]),v=(0,d.useCallback)(function(){var x=se()(O()().mark(function S(C){return O()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return p(!0),Y.prev=1,Y.next=4,s.onSave(Do(C));case 4:o(),Y.next=9;break;case 7:Y.prev=7,Y.t0=Y.catch(1);case 9:p(!1);case 10:case"end":return Y.stop()}},S,null,[[1,7]])}));return function(S){return x.apply(this,arguments)}}(),[s.onSave,o]),h=(0,d.useCallback)(function(x){return new Promise(function(S){switch(x.type){case"AppComponent":Fe.show({appCode:a,onCancel:function(){return S(null)},onOk:function(){var C=se()(O()().mark(function Y(j){var D;return O()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,(0,q.cZ)(j.code);case 2:D=Z.sent,S(i()(i()({},x),{},{data:i()(i()({},x.data),{},{input_params:D.input.map(function(I){return{key:I.alias,type:I.type,value_from:"refer",value:void 0}}),output_params:D.output.map(function(I){return{key:I.field,type:I.type,desc:I.description}}),node_param:i()(i()({},x.data.node_param),{},{name:j.name,code:j.code,type:j.type,output_type:D.output_type})})}));case 4:case"end":return Z.stop()}},Y)}));function P(Y){return C.apply(this,arguments)}return P}()});break;case"MCP":A.gj.show({onCancel:function(){return S(null)},onOk:function(P,Y){S(i()(i()({},x),{},{data:i()(i()({},x.data),{},{node_param:i()(i()({},x.data.node_param),{},{tool_name:P.name,server_code:Y.server_code,server_name:Y.name}),input_params:un(P)})}))}});break;case"Plugin":ge.show({onCancel:function(){return S(null)},onOk:function(P){var Y,j;S(i()(i()({},x),{},{data:i()(i()({},x.data),{},{input_params:(((Y=P[0].config)===null||Y===void 0?void 0:Y.input_params)||[]).map(function(D){return{key:D.key,type:D.type,value_from:"refer",value:void 0}}),output_params:(((j=P[0].config)===null||j===void 0?void 0:j.output_params)||[]).map(function(D){return{key:D.key,type:D.type,desc:D.description}}),node_param:i()(i()({},x.data.node_param),{},{tool_id:P[0].tool_id,tool_name:P[0].name,plugin_id:P[0].plugin_id,plugin_name:P[0].name})})}))}});break}})},[a]),R=function(S){s.setActiveTab("channel"),_(!1),S==="comp"&&setTimeout(function(){W.e.emit("openCompCfg")},200)};return(0,e.jsx)(l.NT,{locale:Oo,initialState:{nodeSchemaMap:Na,getConfigPanel:Fr,onDebounceChange:v,onAddCustomNode:h},children:(0,e.jsxs)(l.tV,{children:[(0,e.jsx)(bn,{appDetail:s.appDetail,actionLoading:m,handlePublish:f,init:s.init}),b&&(0,e.jsx)(M.Z,{onClickAction:R,onClose:function(){return _(!1)}})]})})});function Vo(){var s,a,r=(0,d.useState)("config"),o=B()(r,2),u=o[0],c=o[1],m=(0,ce.Z)({loading:!0,appDetail:void 0,showEditNameModal:!1,autoSaveTime:"",show:!1}),p=B()(m,2),k=p[0],g=p[1],b=bt(),_=b.initGlobalVariableList,f=(0,d.useRef)(void 0),v=Le(function(C){return C.selectedVersion}),h=(0,H.UO)(),R=h.id,x=(0,d.useCallback)(se()(O()().mark(function C(){var P,Y,j,D=arguments;return O()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(Y=D.length>0&&D[0]!==void 0?D[0]:!1,R){Z.next=4;break}return g({loading:!1}),Z.abrupt("return");case 4:return Z.next=6,(0,K.le)(R);case 6:if(j=Z.sent,f.current=j,g({loading:!1,appDetail:j}),_((P=j.config.global_config)===null||P===void 0||(P=P.variable_config)===null||P===void 0?void 0:P.conversation_params),!(!j.config||!Y)){Z.next=12;break}return Z.abrupt("return");case 12:try{setTimeout(function(){var I,_e;(0,ie.W)({type:"update-flow-data",data:_n({nodes:((I=j.config)===null||I===void 0?void 0:I.nodes)||[],edges:((_e=j.config)===null||_e===void 0?void 0:_e.edges)||[]})})},100)}catch(I){g({loading:!1})}case 13:case"end":return Z.stop()}},C)})),[R]);(0,oe.Z)(function(){x(!0)});var S=(0,d.useCallback)(function(C){return f.current?(0,K.KT)({app_id:f.current.app_id,name:f.current.name,type:f.current.type,config:i()(i()({},f.current.config),C)}).then(function(P){var Y,j,D=((Y=f.current)===null||Y===void 0?void 0:Y.status)==="published"?"published_editing":(j=f.current)===null||j===void 0?void 0:j.status;return g({autoSaveTime:L()().format("HH:mm:ss"),appDetail:i()(i()({},f.current),{},{status:D})}),P}):Promise.resolve()},[]);return!k.loading&&!k.appDetail?(0,e.jsx)("div",{className:"loading-center",children:(0,e.jsx)(le.Z,{description:n.Z.get({id:"main.pages.App.Workflow.index.index.applicationDoesNotExist",dm:"\u5E94\u7528\u4E0D\u5B58\u5728"})})}):(0,e.jsxs)(d.Fragment,{children:[(0,e.jsx)("div",{className:"relative h-full",children:(0,e.jsx)(de.Z,{loading:k.loading,fullScreen:!0,activeTab:u,onTabChange:function(P){c(P),P==="config"&&x(!0)},breadcrumbLinks:[{title:n.Z.get({id:"main.pages.App.Workflow.index.index.applicationManagement",dm:"\u5E94\u7528\u7BA1\u7406"}),path:"/app/workflow"},{title:(0,e.jsxs)(w.Z,{align:"center",gap:8,children:[(0,e.jsx)(me.Z.Text,{ellipsis:{tooltip:(0,ue.rb)(((s=k.appDetail)===null||s===void 0?void 0:s.name)||"",{getPopupContainer:function(){return document.body}})},children:(0,e.jsx)("span",{className:"text-[16px]",children:(a=k.appDetail)===null||a===void 0||(a=a.name)===null||a===void 0?void 0:a.trim()})}),v==="draft"&&(0,e.jsx)(y.Z,{onClick:function(){g({showEditNameModal:!0})},type:"spark-edit-line"})]})}],left:!!k.appDetail&&(0,e.jsx)(Q.Z,{appStatus:k.appDetail.status,autoSaveTime:k.autoSaveTime}),tabs:[{label:n.Z.get({id:"main.pages.App.Workflow.index.index.canvasConfiguration",dm:"\u753B\u5E03\u914D\u7F6E"}),key:"config",children:k.appDetail&&(0,e.jsx)(yn,{init:x,appDetail:k.appDetail,onSave:S,setActiveTab:c})},{label:n.Z.get({id:"main.pages.App.Workflow.index.publishChannel",dm:"\u53D1\u5E03\u6E20\u9053"}),key:"channel",children:k.appDetail&&(0,e.jsx)(ae.Z,{type:k.appDetail.type,app_id:k.appDetail.app_id,status:k.appDetail.status})}]})}),k.showEditNameModal&&k.appDetail&&(0,e.jsx)(E.a,{name:k.appDetail.name,app_id:k.appDetail.app_id,description:k.appDetail.description,onClose:function(){g({showEditNameModal:!1})},onOk:function(){g({showEditNameModal:!1}),x(!0)}})]})}var Ro=(0,d.memo)(function(){var s=(0,H.UO)(),a=s.id;return(0,e.jsx)(Bn,{initialState:{appId:a},children:(0,e.jsx)(Vo,{})})})},40755:function(Be,ye,t){t.d(ye,{e:function(){return ce}});var N=t(87329),i=t.n(N),X=t(42035),O=t.n(X),te=t(23939),se=t(87629),F=t(15127),B=t(45753),de=t(2821),re=t(5693),n=t(35276),q=t(81596),K=t(12524),J=t.n(K),y=t(2784),T=t(28842),le=t(22453),ue=t(96100),l=t(52322),ce=(0,ue.n)("channel-config");ye.Z=(0,y.memo)(function(ne){var Se=ne.app_id,G=ne.disabled,w=G===void 0?!1:G,me=ne.type,z=(0,de.Z)({referVisible:!1,editVisible:!1,createVisible:!1,detail:null}),L=O()(z,2),d=L[0],H=L[1],ie=function(){(0,F.AE)(Se).then(function(ee){H(ee?{detail:ee}:{detail:null})})};return(0,re.Z)(function(){ie()}),(0,y.useEffect)(function(){return ce.on("openCompCfg",function(){H({createVisible:!0})}),function(){ce.removeAllListeners()}},[]),(0,l.jsxs)("div",{className:J()(T.Z.card,i()({},T.Z.disabled,w)),children:[(0,l.jsx)("div",{className:T.Z["img-con"],children:(0,l.jsx)("img",{alt:"appComponent",src:"/images/appComponent.svg"})}),(0,l.jsxs)("div",{className:"flex flex-col gap-[4px] flex-1",children:[(0,l.jsx)("div",{className:T.Z.name,children:le.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.component",dm:"\u7EC4\u4EF6"})}),(0,l.jsx)("div",{className:T.Z.desc,children:le.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.configureInput",dm:"\u4EE5\u7EC4\u4EF6\u7684\u5F62\u5F0F\u53D1\u5E03\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u5E94\u7528\uFF0C\u9700\u8981\u914D\u7F6E\u5165\u53C2\uFF0C\u53D1\u5E03\u540E\u7528\u6237\u53EF\u4EE5\u901A\u8FC7\u7EC4\u4EF6\u7684\u65B9\u5F0F\u5728\u5176\u4ED6\u5E94\u7528\u4E2D\u9ED1\u76D2\u7684\u5F15\u7528\u8FD9\u4E2A\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u7684\u5185\u5BB9"})})]}),w?null:d.detail?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.ZP,{onClick:function(){return H({referVisible:!0})},size:"small",type:"text",icon:(0,l.jsx)(B.Z,{type:"spark-projectNo-line"}),className:"self-center",children:le.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.referenceDetails",dm:"\u7EC4\u4EF6\u5F15\u7528\u8BE6\u60C5"})}),(0,l.jsx)(q.Z,{className:"self-center",type:"vertical",style:{margin:0}}),(0,l.jsx)(n.ZP,{onClick:function(){return H({editVisible:!0})},size:"small",type:"text",icon:(0,l.jsx)(B.Z,{type:"spark-edit-line"}),className:"self-center",children:le.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.edit",dm:"\u7F16\u8F91"})})]}):(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(n.ZP,{onClick:function(){H({createVisible:!0})},size:"small",type:"text",className:"self-center",icon:(0,l.jsx)(B.Z,{type:"spark-plus-line"}),children:le.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.create",dm:"\u521B\u5EFA"})})}),d.referVisible&&d.detail&&(0,l.jsx)(se.Z,{data:d.detail,onClose:function(){return H({referVisible:!1})}}),d.editVisible&&d.detail&&(0,l.jsx)(te.Z,{onOk:function(){H({editVisible:!1})},data:d.detail,onClose:function(){return H({editVisible:!1})}}),d.createVisible&&(0,l.jsx)(te.Z,{onOk:function(){ie(),H({createVisible:!1})},onClose:function(){H({createVisible:!1})},data:{app_id:Se,type:me}})]})})},5054:function(Be,ye,t){t.d(ye,{Z:function(){return Se}});var N=t(87329),i=t.n(N),X=t(22453),O=t(12524),te=t.n(O),se=t(2784),F=t(42035),B=t.n(F),de=t(85545),re=t(15127),n=t(72624),q=t(45753),K=t(95559),J=t(77751),y=t(19612),T=t(12901),le=t(50381),ue=t.n(le),l=t(52322);function ce(G){var w=(0,se.useState)(!1),me=B()(w,2),z=me[0],L=me[1],d=X.Z.get({id:"main.pages.App.components.ChannelConfig.index.viewApi",dm:"\u67E5\u770BAPI"}),H=(0,se.useMemo)(function(){return G.type===re.zd.WORKFLOW?`curl -X 'POST' \\
'`.concat(de.v2.get(),`/api/v1/apps/workflow/completions' \\
-H 'accept: */*' \\
-H 'Authorization: Bearer sk-xxxxxxxxxxxxxxxxxx' \\
-H 'Content-Type: application/json' \\
-d '{
  "app_id": "`).concat(G.appId,`",
  "inputParams": [
    {
      "key": "query",
      "type": "String",
      "desc": "user questions",
      "required": false,
      "source": "sys",
      "value": "What is Spring AI Alibaba?"
    }
  ],
  "stream": true
}'`):`curl -X 'POST' \\
'`.concat(de.v2.get(),`/api/v1/apps/chat/completions' \\
-H 'accept: */*' \\
-H 'Authorization: Bearer sk-xxxxxxxxxxxxxxxxxx' \\
-H 'Content-Type: application/json' \\
-d '{
  "app_id": "`).concat(G.appId,`",
  "messages": [
    {
      "role": "user",
      "content": "What is Spring AI Alibaba?",
      "content_type": "text"
    }
  ],
  "stream": true
}'`)},[G.appId,G.type]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.Z,{onClick:function(){return L(!0)},type:"text",size:"small",className:"self-center",icon:(0,l.jsx)(q.Z,{type:"spark-fileCode-line"}),children:d}),(0,l.jsx)(K.Z,{open:z,onClose:function(){return L(!1)},width:640,title:d,children:(0,l.jsx)(J.Z,{title:"curl",expandOnPanelClick:!1,extra:(0,l.jsx)(q.Z,{type:"spark-copy-line",size:"small",onClick:function(){ue()(H),y.Z.success(X.Z.get({id:"main.pages.App.index.copySuccess",dm:"\u590D\u5236\u6210\u529F"}))}}),children:(0,l.jsx)(T.ZP,{language:[],value:H,readOnly:!0})})})]})}var oe=t(28842),ne=t(40755),Se=(0,se.memo)(function(w){var me=(0,se.useMemo)(function(){return w.status==="draft"},[w.status]);return(0,l.jsxs)("div",{className:oe.Z.container,children:[(0,l.jsx)("div",{className:oe.Z.title,children:X.Z.get({id:"main.pages.App.components.ChannelConfig.index.callMethod",dm:"\u8C03\u7528\u65B9\u5F0F"})}),(0,l.jsxs)("div",{className:te()(oe.Z.card,i()({},oe.Z.disabled,me)),children:[(0,l.jsx)("div",{className:oe.Z["img-con"],children:(0,l.jsx)("img",{alt:"applicationApi",src:"/images/applicationApi.svg"})}),(0,l.jsxs)("div",{className:"flex flex-col gap-[4px] flex-1",children:[(0,l.jsx)("div",{className:oe.Z.name,children:X.Z.get({id:"main.pages.App.components.ChannelConfig.index.apiCall",dm:"API\u8C03\u7528"})}),(0,l.jsx)("div",{className:oe.Z.desc,children:X.Z.get({id:"main.pages.App.components.ChannelConfig.index.callWithApiKey",dm:`\u4EE5API\u7684\u5F62\u5F0F\u8C03\u7528\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u5E94\u7528\uFF0C\u9700\u8981\u4F20\u5165\u5E94\u7528ID\u3001API-KEY\u7B49\u53C2\u6570\u503C\uFF0C\u652F\u6301\u901A\u8FC7\u517C\u5BB9
            OpenAI \u534F\u8BAE\u7684 Http \u534F\u8BAE\u53D1\u8D77\u8BF7\u6C42`})})]}),(0,l.jsx)(ce,{type:w.type,appId:w.app_id})]}),(0,l.jsx)(ne.Z,{type:w.type,disabled:me,app_id:w.app_id})]})})},45642:function(Be,ye,t){t.d(ye,{a:function(){return re}});var N=t(42035),i=t.n(N),X=t(22453),O=t(1905),te=t(58541),se=t(19612),F=t(84546),B=t(4513),de=t(52322),re=function(q){var K=te.Z.useForm(),J=i()(K,1),y=J[0],T=function(){y.validateFields().then(function(ue){(0,O.KT)({app_id:q.app_id,name:ue.name,description:ue.description}).then(function(){se.Z.success(X.Z.get({id:"main.pages.App.components.EditNameModal.index.updateSuccess",dm:"\u66F4\u65B0\u6210\u529F"})),q.onOk()})})};return(0,de.jsx)(F.Z,{open:!0,onCancel:q.onClose,onOk:T,title:X.Z.get({id:"main.pages.App.components.EditNameModal.index.editAppName",dm:"\u7F16\u8F91\u5E94\u7528\u540D\u79F0"}),children:(0,de.jsxs)(te.Z,{initialValues:{name:q.name,description:q.description},form:y,layout:"vertical",children:[(0,de.jsx)(te.Z.Item,{required:!0,rules:[{required:!0,message:X.Z.get({id:"main.pages.App.components.EditNameModal.index.enterAppName",dm:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0"})}],label:X.Z.get({id:"main.pages.App.components.EditNameModal.index.appName",dm:"\u5E94\u7528\u540D\u79F0"}),name:"name",children:(0,de.jsx)(B.Z,{style:{height:36,marginBottom:12},maxLength:(q==null?void 0:q.maxLength)||50,showCount:{formatter:function(ue){var l=ue.count,ce=ue.maxLength;return(0,de.jsxs)(de.Fragment,{children:[l,"/",ce]})}},placeholder:X.Z.get({id:"main.pages.App.components.EditNameModal.index.enterAppName",dm:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0"})})}),(0,de.jsx)(te.Z.Item,{label:X.Z.get({id:"main.pages.App.components.EditNameModal.index.appDescription",dm:"\u5E94\u7528\u63CF\u8FF0"}),name:"description",children:(0,de.jsx)(B.Z.TextArea,{style:{height:150},maxLength:200,placeholder:X.Z.get({id:"main.pages.App.components.EditNameModal.index.enterAppDescription",dm:"\u8BF7\u8F93\u5165\u5E94\u7528\u63CF\u8FF0"})})})]})})}},21141:function(Be,ye,t){t.d(ye,{Sc:function(){return ee},d7:function(){return Q}});var N=t(49616),i=t.n(N),X=t(13311),O=t.n(X),te=t(42035),se=t.n(te),F=t(87329),B=t.n(F),de=t(6927),re=t(22453),n=t(76077),q=t(19612),K=t(72624),J=t(45753),y=t(51034),T=t(84546),le=t(95559),ue=t(2821),l=t(5693),ce=t(35899),oe=t(71938),ne=t(74465),Se=t(9454),G=t(12524),w=t.n(G),me=t(2784),z={card:"card___SGuz7",active:"active___ILvDd",title:"title___CAZdV",desc:"desc___szLOw","list-wrap":"list-wrap___c3haO",drawer:"drawer___d4qTy",page:"page___tSPMe","drawer-wrap":"drawer-wrap___btfkL","modal-wrap":"modal-wrap___GmyAo"},L=t(52322),d=10;function H(M){var ae=(0,me.useMemo)(function(){return M.value.some(function(W){return W.kb_id===M.item.kb_id})},[M.value,M.item.kb_id]);return(0,L.jsxs)("div",{className:w()(z.card,B()({},z.active,ae)),onClick:function(){return M.onCheckChange(!ae)},children:[(0,L.jsx)(ce.Z,{checked:ae,onChange:function(E){return M.onCheckChange(E.target.checked)}}),(0,L.jsx)("img",{src:"/images/knowledge.svg",alt:""}),(0,L.jsxs)("div",{className:"flex flex-col flex-1 w-[1px] gap-[4px]",children:[(0,L.jsxs)("div",{className:"flex gap-[8px]",children:[(0,L.jsx)(oe.Z.Text,{ellipsis:!0,className:z.title,children:M.item.name}),(0,L.jsx)("span",{children:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.knowledgeCount",dm:"{var1}\u4E2A\u77E5\u8BC6"},{var1:M.item.total_docs})})]}),(0,L.jsx)(oe.Z.Text,{ellipsis:{tooltip:M.item.description},className:z.desc,children:M.item.description})]})]})}function ie(M){var ae=M.mode,W=ae===void 0?"modal":ae,E=(0,ue.Z)({list:[],loading:!1,current:1,size:10,name:"",total:0}),A=se()(E,2),V=A[0],$=A[1],pe=(0,me.useRef)(!1),e=function(){var fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$({loading:!0});var We=pe.current?{name:V.name}:{};(0,n.eU)(O()(O()({current:V.current,size:V.size},fe),We)).then(function(Ve){$({list:Ve.records,total:Ve.total,loading:!1})}).catch(function(){$({loading:!1})})},ge=function(){pe.current=!!V.name,$({current:1}),e({current:1})},ke=function(fe,We){if(fe){if(M.value.length>=d){q.Z.warning(re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.maxTenKnowledge",dm:"\u6700\u591A\u53EA\u80FD\u9009\u62E910\u4E2A\u77E5\u8BC6\u5E93"}));return}M.onChange([].concat(i()(M.value),[We]))}else M.onChange(M.value.filter(function(Ve){return We.kb_id!==Ve.kb_id}))};return(0,l.Z)(function(){e()}),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"flex-justify-between px-[24px]",children:[(0,L.jsx)(de.Z,{onSearch:ge,placeholder:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.enterKnowledgeName",dm:"\u8BF7\u8F93\u5165\u77E5\u8BC6\u5E93\u540D\u79F0"}),onChange:function(fe){return $({name:fe})},value:V.name,className:z.search}),(0,L.jsx)(K.Z,{onClick:function(){return window.open("/knowledge")},icon:(0,L.jsx)(J.Z,{type:"spark-plus-line"}),children:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.createNewKnowledge",dm:"\u521B\u5EFA\u65B0\u77E5\u8BC6\u5E93"})})]}),(0,L.jsx)("div",{className:w()(z["list-wrap"],z[W]),children:V.loading?(0,L.jsx)("div",{className:"loading-center",children:(0,L.jsx)(ne.Z,{className:"loading-center",spinning:!0})}):V.list.length?(0,L.jsx)("div",{className:"flex flex-col gap-[16px]",children:V.list.map(function(ve){return(0,L.jsx)(H,{item:ve,value:M.value,onCheckChange:function(We){ke(We,ve)}},ve.kb_id)})}):(0,L.jsx)("div",{className:"loading-center",children:(0,L.jsx)(y.Z,{title:pe.current?re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.noSearchResult",dm:"\u672A\u641C\u7D22\u51FA\u6765\u7B26\u5408\u6761\u4EF6\u7684\u77E5\u8BC6\u5E93"}):re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.noKnowledge",dm:"\u6682\u65E0\u77E5\u8BC6\u5E93"}),description:pe.current?re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.tryAnotherSearch",dm:"\u6362\u4E2A\u641C\u7D22\u6761\u4EF6\u8BD5\u8BD5"}):re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.goCreateFirst",dm:"\u8BF7\u5148\u524D\u5F80\u77E5\u8BC6\u5E93\u7BA1\u7406\u521B\u5EFA\u77E5\u8BC6\u5E93"}),children:!pe.current&&(0,L.jsx)(K.Z,{className:"mt-[12px]",onClick:function(){return window.open("/knowledge")},type:"primary",children:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.goCreate",dm:"\u524D\u5F80\u521B\u5EFA"})})})})}),(0,L.jsx)(Se.Z,{className:z.page,current:V.current,pageSize:V.size,total:V.total,hideOnSinglePage:!0,onChange:function(fe,We){$({current:fe,size:We}),e({current:fe,size:We})}})]})}function Q(M){var ae=(0,me.useState)(M.value||[]),W=se()(ae,2),E=W[0],A=W[1];return(0,L.jsx)(T.Z,{title:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.selectKnowledge",dm:"\u9009\u62E9\u77E5\u8BC6\u5E93"}),onOk:function(){return M.onOk(E)},open:!0,width:640,className:z["modal-wrap"],onCancel:M.onClose,children:(0,L.jsx)("div",{className:"py-[18px] gap-[12px] flex flex-col",children:(0,L.jsx)(ie,{value:E,onChange:A})})})}function ee(M){var ae=(0,me.useState)(M.value||[]),W=se()(ae,2),E=W[0],A=W[1];return(0,L.jsx)(le.Z,{title:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.selectKnowledge",dm:"\u9009\u62E9\u77E5\u8BC6\u5E93"}),footer:(0,L.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"w-full",children:[(0,L.jsx)("div",{style:{color:"var(--ag-ant-color-text-tertiary)",fontSize:"14px",fontWeight:"normal",lineHeight:"24px"},children:!!(E!=null&&E.length)&&re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.addedKnowledgeBase",dm:"\u5DF2\u6DFB\u52A0\u77E5\u8BC6\u5E93{var1}/{var2}\u4E2A"},{var1:E==null?void 0:E.length,var2:d})}),(0,L.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,L.jsx)(K.Z,{onClick:M.onClose,children:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,L.jsx)(K.Z,{type:"primary",onClick:function(){return M.onOk(E)},children:re.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.confirm",dm:"\u786E\u5B9A"})})]})]}),onClose:M.onClose,open:!0,width:640,className:z["drawer-wrap"],children:(0,L.jsx)("div",{className:"py-[18px] h-full overflow-y-auto flex flex-col gap-[12px]",children:(0,L.jsx)(ie,{mode:"drawer",value:E,onChange:A})})})}},518:function(Be,ye,t){t.d(ye,{Oy:function(){return W},gj:function(){return A}});var N=t(49616),i=t.n(N),X=t(42035),O=t.n(X),te=t(22453),se=t(97948),F=t(93185),B=t(13341),de=t(76042),re=t(4513),n=t(45753),q=t(19612),K=t(63781),J=t(51034),y=t(95559),T=t(72624),le=t(84546),ue=t(2821),l=t(91030),ce=t(74465),oe=t(66520),ne=t(2784),Se=t(17029),G=t(87329),w=t.n(G),me=t(3318),z=t(35899),L=t(71938),d=t(56733),H=t(12524),ie=t.n(H),Q={"mcp-server-wrapper":"mcp-server-wrapper___gIbje",active:"active___zojjr",expanded:"expanded___BQbUP","fold-icon":"fold-icon___bcvV1",rotated:"rotated___NtW1a","tools-container":"tools-container___aRfg6",desc:"desc___H4ivZ"},ee=t(52322),M=function(V){var $,pe,e=V.item,ge=V.selectMode,ke=V.selectedServers,ve=ke===void 0?[]:ke,fe=V.selectedTool,We=(0,ne.useState)(!1),Ve=O()(We,2),Re=Ve[0],Ae=Ve[1],xe=(0,ne.useState)(!0),Ne=O()(xe,2),De=Ne[0],je=Ne[1],Ue=(0,ne.useState)(0),Te=O()(Ue,2),we=Te[0],Oe=Te[1],ia=(0,ne.useRef)(null);(0,ne.useEffect)(function(){var Fe;Ae(ge==="server"?!!ve.find(function(Je){return Je.server_code===e.server_code}):!!((Fe=e.tools)!==null&&Fe!==void 0&&Fe.find(function(Je){return Je.name===(fe==null?void 0:fe.name)})))},[e,ge,fe,ve]),(0,ne.useEffect)(function(){ge==="tool"&&Re&&je(!1)},[Re,ge]),(0,ne.useEffect)(function(){ia.current&&Oe(De?0:ia.current.scrollHeight)},[De,e.tools]);var qe=function(){je(!De)};return(0,ee.jsxs)("div",{children:[(0,ee.jsx)("div",{className:ie()(Q["mcp-server-wrapper"],w()(w()({},Q.active,Re),Q.expanded,!De)),style:{padding:"12px 16px"},children:(0,ee.jsxs)(l.Z,{gap:8,children:[ge==="server"&&(0,ee.jsx)(z.Z,{checked:Re,onChange:function(Je){if(Je.target.checked){var ea;(ea=V.onSelectServer)===null||ea===void 0||ea.call(V,e)}else{var Qe;(Qe=V.onRemoveServer)===null||Qe===void 0||Qe.call(V,e.server_code)}},disabled:e.status===de.YI.DISABLED}),(0,ee.jsxs)(l.Z,{gap:8,className:"w-full h-[52px] flex-1",align:"center",children:[(0,ee.jsx)(l.Z,{align:"center",className:"h-[40px] w-[40px]",children:(0,ee.jsx)(l.Z,{align:"center",justify:"center",className:"h-[40px] w-[40px] rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)"},children:(0,ee.jsx)(n.Z,{className:"h-full w-full rounded-[6px]",type:"spark-MCP-mcp-line"})})}),(0,ee.jsxs)("div",{style:{width:"calc(100% - 48px)"},children:[(0,ee.jsxs)(l.Z,{justify:"space-between",className:"header leading-[22px] h-[22px]",children:[(0,ee.jsx)("div",{className:"text-[16px] font-semibold  mr-[4px] ",style:{color:"var(--ag-ant-color-text-base)",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",width:0,flex:1},children:e.name}),(0,ee.jsxs)(l.Z,{style:{color:"var(--ag-ant-color-text)"},children:[!!(($=e.tools)!==null&&$!==void 0&&$.length)&&(0,ee.jsxs)("span",{className:"mr-[4px] cursor-pointer",onClick:qe,children:[te.Z.get({id:"main.pages.App.components.MCPSelector.MCPServerListItem.index.tool",dm:"\u5DE5\u5177"}),e.tools.length]}),e.status===de.YI.DISABLED?null:(0,ee.jsx)(n.Z,{type:"spark-down-line",isCursorPointer:!0,className:"".concat(Q["fold-icon"]," ").concat(De?"":Q.rotated),onClick:qe})]})]}),(0,ee.jsx)(L.Z.Paragraph,{className:Q.desc,style:{marginBottom:0},ellipsis:{rows:1,tooltip:(0,me.rb)(e.description)},children:e.description})]})]})]})}),!De&&!!((pe=e.tools)!==null&&pe!==void 0&&pe.length)&&(0,ee.jsx)("div",{ref:ia,className:"".concat(Q["tools-container"]),style:{borderTop:"none",padding:"8px 12px",maxHeight:"".concat(we,"px"),overflow:"hidden",display:De?"none":"block"},children:(0,ee.jsx)(l.Z,{gap:9,style:{marginLeft:20},vertical:!0,children:e.tools.map(function(Fe){return(0,ee.jsxs)(l.Z,{className:"h-[60px] flex-1 rounded-[6px]",align:"center",children:[ge==="tool"&&(0,ee.jsx)(d.ZP,{checked:(fe==null?void 0:fe.name)===Fe.name,onChange:function(ea){if(ea.target.checked){var Qe;(Qe=V.onSelectTool)===null||Qe===void 0||Qe.call(V,Fe,e)}},disabled:e.status===de.YI.DISABLED}),ge==="server"&&(0,ee.jsxs)(l.Z,{gap:8,className:"h-[60px] flex-1 rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)",padding:"8px 12px"},align:"center",children:[(0,ee.jsx)(l.Z,{align:"center",className:"h-[20px] w-[20px] rounded-[4px]",style:{backgroundColor:"var(--ag-ant-color-text-base)"},children:(0,ee.jsx)(n.Z,{className:"w-full h-full rounded-[4px]",type:"spark-tool-line",style:{color:"var(--ag-ant-color-bg-base)"}})}),(0,ee.jsxs)("div",{className:"flex-1",children:[(0,ee.jsx)(l.Z,{justify:"space-between",className:"header",children:(0,ee.jsx)("div",{className:"text-[16px] font-semibold leading-6",style:{color:"var(--ag-ant-color-text-base)"},children:(0,ee.jsx)(L.Z.Paragraph,{className:Q.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,me.rb)(Fe.name)},children:Fe.name})})}),(0,ee.jsx)(L.Z.Paragraph,{className:Q.desc,style:{marginBottom:0},ellipsis:{rows:1,tooltip:(0,me.rb)(Fe.description)},children:Fe.description})]})]}),ge==="tool"&&(0,ee.jsxs)(l.Z,{gap:8,className:"h-[72px] flex-1 rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)",padding:"8px 12px"},vertical:!0,children:[(0,ee.jsxs)(l.Z,{align:"center",gap:12,className:"h-[28px]",children:[(0,ee.jsx)(l.Z,{align:"center",className:"h-[20px] w-[20px] rounded-[4px]",style:{backgroundColor:"var(--ag-ant-color-text-base)"},children:(0,ee.jsx)(n.Z,{className:"w-full h-full rounded-[4px]",type:"spark-tool-line",style:{color:"var(--ag-ant-color-bg-base)"}})}),(0,ee.jsx)("div",{className:"text-[16px] font-semibold leading-6",style:{color:"var(--ag-ant-color-text-base)"},children:(0,ee.jsx)(L.Z.Paragraph,{className:Q.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,me.rb)(Fe.name)},children:Fe.name})})]}),(0,ee.jsx)(L.Z.Paragraph,{className:Q.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,me.rb)(Fe.description)},children:Fe.description})]})]},Fe.name)})})})]})},ae=function($){var pe,e,ge=(0,ue.Z)({need_tools:!0,status:de.YI.ENABLED,current:1,size:10,name:""}),ke=O()(ge,2),ve=ke[0],fe=ke[1],We=(0,ne.useState)(0),Ve=O()(We,2),Re=Ve[0],Ae=Ve[1],xe=(0,ne.useState)([]),Ne=O()(xe,2),De=Ne[0],je=Ne[1],Ue=(0,ne.useState)(!1),Te=O()(Ue,2),we=Te[0],Oe=Te[1],ia=function(){Oe(!0),(0,B.Pk)(ve).then(function(Je){je(Je.data.records),Ae(Je.data.total)}).finally(function(){Oe(!1)})};(0,ne.useEffect)(function(){ia()},[ve]);var qe=(0,oe.Z)(function(Fe){fe({current:1,name:Fe.target.value})},500);return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(l.Z,{justify:"space-between",className:"mb-[16px]",children:[(0,ee.jsx)(re.Z,{onChange:qe,prefix:(0,ee.jsx)(n.Z,{type:"spark-search-line"}),placeholder:te.Z.get({id:"main.pages.App.components.MCPSelector.index.inputHere",dm:"\u5728\u6B64\u8F93\u5165"}),allowClear:!0,style:{width:220}}),(0,ee.jsx)(F.x,{isOpenNew:!0,buttonProps:{type:"default"}})]}),we?(0,ee.jsx)(ce.Z,{className:"w-full h-full"}):(0,ee.jsx)(l.Z,{vertical:!0,gap:16,children:De.length?(0,ee.jsxs)(ee.Fragment,{children:[De.map(function(Fe){return(0,ee.jsx)(M,{item:Fe,selectedServers:$.selectedServers,onSelectServer:function(ea){var Qe;if($.selectedServers&&$.selectedServers.length>=de.rR){q.Z.warning(te.Z.get({id:"main.pages.App.components.MCPSelector.index.reachedMaxLimit",dm:"\u5DF2\u8FBE\u5230\u6700\u5927\u6570\u91CF\u9650\u5236"}));return}(Qe=$.onMcpServersChange)===null||Qe===void 0||Qe.call($,[].concat(i()($.selectedServers||[]),[ea]))},onRemoveServer:function(ea){var Qe,Ce;(Qe=$.onMcpServersChange)===null||Qe===void 0||Qe.call($,(Ce=$.selectedServers||[])===null||Ce===void 0?void 0:Ce.filter(function(ha){return ha.server_code!==ea}))},selectMode:$.mode,onSelectTool:function(ea,Qe){var Ce;(Ce=$.onSelectTool)===null||Ce===void 0||Ce.call($,ea,Qe)},selectedTool:$.selectedTool,fetchList:ia},Fe.server_code)}),(0,ee.jsx)(K.Z,{pageSize:ve.size,current:ve.current,total:Re,hideOnSinglePage:!0,hideTips:!0,onChange:function(Je,ea){fe({current:Je,size:ea})},pageSizeOptions:[10,20]})]}):(0,ee.jsx)(l.Z,{className:"h-full",align:"center",justify:"center",children:(0,ee.jsx)(J.Z,{title:(pe=ve.name)!==null&&pe!==void 0&&pe.length?te.Z.get({id:"main.pages.App.components.MCPSelector.index.noSearchResult",dm:"\u6682\u65E0\u641C\u7D22\u7ED3\u679C"}):te.Z.get({id:"main.pages.App.components.MCPSelector.index.noCustomMcpService",dm:"\u6682\u65E0\u81EA\u5B9A\u4E49MCP\u670D\u52A1"}),description:!((e=ve.name)!==null&&e!==void 0&&e.length)&&(0,ee.jsx)(F.x,{isOpenNew:!0,text:te.Z.get({id:"main.pages.App.components.MCPSelector.index.goCreate",dm:"\u53BB\u521B\u5EFA"})})})})})]})},W=function($){var pe=(0,ne.useState)(i()($.selectedServers||[])),e=O()(pe,2),ge=e[0],ke=e[1];return(0,ee.jsx)(y.Z,{title:te.Z.get({id:"main.pages.App.components.MCPSelector.index.selectMcpService",dm:"\u9009\u62E9MCP\u670D\u52A1"}),open:!0,width:640,onClose:$.onClose,footer:(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"w-full",children:[(0,ee.jsx)("div",{style:{color:"var(--ag-ant-color-text-tertiary)",fontSize:"14px",fontWeight:"normal",lineHeight:"24px"},children:!!ge.length&&te.Z.get({id:"main.pages.App.components.MCPSelector.index.addedMcpVar1Var2",dm:"\u5DF2\u6DFB\u52A0MCP{var1}/{var2}"},{var1:ge.length,var2:de.rR})}),(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,ee.jsx)(T.Z,{type:"default",onClick:function(){$.onClose()},children:te.Z.get({id:"main.pages.App.components.MCPSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,ee.jsx)(T.Z,{type:"primary",onClick:function(){$.onOk(ge),$.onClose(),q.Z.success(te.Z.get({id:"main.pages.App.components.MCPSelector.index.addSuccess",dm:"\u6DFB\u52A0\u6210\u529F\uFF01"}))},children:te.Z.get({id:"main.pages.Setting.ModelService.components.ModelServiceProviderModal.index.confirm",dm:"\u786E\u8BA4"})})]})]}),children:(0,ee.jsx)(ae,{mode:"server",onMcpServersChange:ke,selectedServers:ge})})},E=function($){var pe=(0,ne.useState)($.selectedMcpTool),e=O()(pe,2),ge=e[0],ke=e[1],ve=(0,ne.useState)(void 0),fe=O()(ve,2),We=fe[0],Ve=fe[1];return(0,ee.jsx)(le.Z,{width:740,title:te.Z.get({id:"main.pages.App.components.MCPSelector.index.11",dm:"\u9009\u62E9MCP\u5DE5\u5177"}),open:!0,onCancel:$.onClose,bodyProps:{style:{padding:0}},footer:(0,ee.jsxs)("div",{className:"justify-end flex gap-[8px]",children:[(0,ee.jsx)(T.Z,{onClick:$.onClose,children:te.Z.get({id:"main.pages.App.components.MCPSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,ee.jsx)(T.Z,{type:"primary",onClick:function(){if(!ge||!We){q.Z.warning(te.Z.get({id:"main.pages.App.components.MCPSelector.index.selectMcpTool",dm:"\u8BF7\u9009\u62E9MCP\u5DE5\u5177"}));return}$.onOk(ge,We),$.onClose()},children:te.Z.get({id:"main.pages.App.components.MCPSelector.index.confirm",dm:"\u786E\u5B9A"})})]}),children:(0,ee.jsx)("div",{className:"p-[16px_24px] max-h-[400px] overflow-y-auto",children:(0,ee.jsx)(ae,{mode:"tool",onSelectTool:function(Ae,xe){ke(Ae),Ve(xe)},selectedTool:ge})})})},A={show:function($){var pe=document.createElement("div");document.body.appendChild(pe);var e=(0,Se.createRoot)(pe),ge=function(){var fe;e.unmount(),pe.remove(),(fe=$.onCancel)===null||fe===void 0||fe.call($)},ke=function(fe,We){var Ve;(Ve=$.onOk)===null||Ve===void 0||Ve.call($,fe,We),ge()};e.render((0,ee.jsx)(se.Z,{children:(0,ee.jsx)(E,{selectedMcpTool:$.selectedMcpTool,onClose:ge,onOk:ke})}))}}},43065:function(Be,ye,t){t.d(ye,{U_:function(){return W},hW:function(){return ae}});var N=t(49616),i=t.n(N),X=t(13311),O=t.n(X),te=t(42035),se=t.n(te),F=t(22453),B=t(69163),de=t(4513),re=t(72624),n=t(84546),q=t(95559),K=t(2821),J=t(5693),y=t(88133),T=t(91030),le=t(74465),ue=t(77813),l=t(9454),ce=t(12524),oe=t.n(ce),ne=t(2784),Se=t(20585),G={topDesc:"topDesc___cXyfX"},w=t(87329),me=t.n(w),z=t(45753),L=t(3318),d=t(71938),H=t(35899),ie={"plugin-list-wrapper":"plugin-list-wrapper___Tzd3H",expanded:"expanded___fSdub","fold-icon":"fold-icon___obQyN",rotated:"rotated___MEe30","tools-container":"tools-container___FjWqX","check-item":"check-item___QuVRZ",desc:"desc___I0YEJ"},Q=t(52322),ee=function(E){var A=E.item,V=E.selectedTools,$=(0,ne.useState)([]),pe=se()($,2),e=pe[0],ge=pe[1],ke=(0,ne.useState)(!1),ve=se()(ke,2),fe=ve[0],We=ve[1],Ve=(0,ne.useState)(!0),Re=se()(Ve,2),Ae=Re[0],xe=Re[1],Ne=(0,ne.useState)(0),De=se()(Ne,2),je=De[0],Ue=De[1],Te=(0,ne.useRef)(null);(0,ne.useEffect)(function(){A.plugin_id&&(0,B.cy)(A.plugin_id).then(function(Oe){ge(Oe.data.records)})},[A]),(0,ne.useEffect)(function(){We(!!(V!=null&&V.find(function(Oe){return Oe.plugin_id===A.plugin_id})))},[A,V]),(0,ne.useEffect)(function(){fe&&xe(!1)},[fe]),(0,ne.useEffect)(function(){Te.current&&Ue(Ae?0:Te.current.scrollHeight)},[Ae]);var we=function(){xe(!Ae)};return(0,Q.jsxs)("div",{children:[(0,Q.jsx)("div",{className:oe()(ie["plugin-list-wrapper"],me()({},ie.expanded,!Ae)),style:{padding:"12px 16px"},children:(0,Q.jsx)(T.Z,{gap:8,children:(0,Q.jsxs)(T.Z,{gap:8,className:"w-full h-[52px] flex-1",align:"center",children:[(0,Q.jsx)(T.Z,{align:"center",className:"h-[40px] w-[40px]",children:(0,Q.jsx)(T.Z,{align:"center",justify:"center",className:oe()("h-[40px] w-[40px] rounded-[6px]",ie["check-item"]),style:{border:"1px solid var(--ag-ant-color-border-secondary)"},children:(0,Q.jsx)("img",{src:"/images/plugin.svg",alt:""})})}),(0,Q.jsxs)("div",{style:{width:"calc(100% - 48px)"},children:[(0,Q.jsxs)(T.Z,{justify:"space-between",className:"header leading-[22px] h-[22px]",children:[(0,Q.jsx)("div",{className:"text-[16px] font-semibold  mr-[4px] ",style:{color:"var(--ag-ant-color-text-base)",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",width:0,flex:1},children:A.name}),(0,Q.jsxs)(T.Z,{style:{color:"var(--ag-ant-color-text)"},children:[!!(e!=null&&e.length)&&(0,Q.jsxs)("span",{className:"mr-[4px] cursor-pointer",onClick:we,children:[F.Z.get({id:"main.pages.App.components.PluginSelector.PluginListItem.index.tool",dm:"\u5DE5\u5177"}),e.length]}),(0,Q.jsx)(z.Z,{type:"spark-down-line",isCursorPointer:!0,className:"".concat(ie["fold-icon"]," ").concat(Ae?"":ie.rotated),onClick:we})]})]}),(0,Q.jsx)(d.Z.Paragraph,{className:ie.desc,style:{marginBottom:0},ellipsis:{rows:1,tooltip:(0,L.rb)(A.description)},children:A.description})]})]})})}),!Ae&&!!(e!=null&&e.length)&&(0,Q.jsx)("div",{ref:Te,className:"".concat(ie["tools-container"]),style:{borderTop:"none",padding:"8px 12px",maxHeight:"".concat(je,"px"),overflow:"hidden",display:Ae?"none":"block"},children:(0,Q.jsx)(T.Z,{gap:9,style:{marginLeft:20},vertical:!0,children:e.map(function(Oe){return(0,Q.jsx)(T.Z,{className:"h-[60px] flex-1 rounded-[6px]",align:"center",children:(0,Q.jsxs)(T.Z,{gap:8,flex:1,children:[(0,Q.jsx)(H.Z,{checked:!!(V!=null&&V.find(function(ia){return ia.tool_id===Oe.tool_id})),onChange:function(qe){if(qe.target.checked){var Fe;(Fe=E.onSelectTool)===null||Fe===void 0||Fe.call(E,Oe)}else{var Je;(Je=E.onRemoveTool)===null||Je===void 0||Je.call(E,Oe)}},disabled:!Oe.enabled}),(0,Q.jsxs)(T.Z,{flex:1,gap:8,className:"h-[72px] flex-1 rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)",padding:"8px 12px"},vertical:!0,children:[(0,Q.jsx)(T.Z,{align:"center",gap:12,className:"h-[28px]",children:(0,Q.jsx)("div",{className:"text-[16px] font-semibold leading-6",style:{color:"var(--ag-ant-color-text-base)"},children:(0,Q.jsx)(d.Z.Paragraph,{className:ie.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,L.rb)(Oe.name)},children:Oe.name})})}),(0,Q.jsx)(d.Z.Paragraph,{className:ie.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,L.rb)(Oe.description)},children:Oe.description})]})]})},Oe.tool_id)})})})]})};function M(E){var A=E.value,V=A===void 0?[]:A,$=E.maxLength,pe=$===void 0?Se.IM:$,e=(0,K.Z)({current:1,size:10,name:"",loading:!0,list:[],total:0}),ge=se()(e,2),ke=ge[0],ve=ge[1],fe=function(){var Ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},xe=O()({current:ke.current,size:ke.size},Ae);ve({loading:!0}),(0,B.hZ)(xe).then(function(Ne){ve({list:Ne.data.records,total:Ne.data.total,loading:!1})})};(0,J.Z)(function(){fe()});var We=function(Ae){var xe;if(V.length>=pe){y.ZP.warning(F.Z.get({id:"main.pages.App.components.PluginSelector.index.reachMaxLimit",dm:"\u5DF2\u8FBE\u5230\u6700\u5927\u6570\u91CF\u9650\u5236"}));return}var Ne=[].concat(i()(V),i()(Ae));(xe=E.onChange)===null||xe===void 0||xe.call(E,Ne)},Ve=function(Ae){var xe;(xe=E.onChange)===null||xe===void 0||xe.call(E,V.filter(function(Ne){return Ne.tool_id!==Ae.tool_id}))};return(0,Q.jsxs)(T.Z,{className:oe()("p-[8px]",E.className),vertical:!0,children:[(0,Q.jsxs)(T.Z,{justify:"space-between",align:"center",children:[(0,Q.jsx)(de.Z.Search,{style:{width:280},width:280,value:ke.name,onChange:function(Ae){return ve({name:Ae.target.value})},placeholder:F.Z.get({id:"main.pages.App.components.PluginSelector.index.searchPluginName",dm:"\u641C\u7D22\u63D2\u4EF6\u540D\u79F0"}),onSearch:function(){ve({current:1}),fe({current:1,name:ke.name})}}),(0,Q.jsx)(re.Z,{style:{flexShrink:0},onClick:function(){return window.open("/component/plugin/create")},iconType:"spark-plus-line",children:F.Z.get({id:"main.pages.App.components.PluginSelector.index.createPlugin",dm:"\u521B\u5EFA\u63D2\u4EF6"})})]}),(0,Q.jsxs)("span",{className:G.topDesc,children:[F.Z.get({id:"main.pages.App.components.PluginSelector.index.publishedPluginSupportAddToSmartAgentWorkflowApp",dm:"\u5DF2\u53D1\u5E03\u7684\u63D2\u4EF6\u652F\u6301\u6DFB\u52A0\u5230\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u5E94\u7528\u4E2D\uFF0C\u53EF\u524D\u5F80"}),"\xA0",(0,Q.jsx)("a",{target:"_blank",href:"/component/plugin",children:F.Z.get({id:"main.pages.App.components.PluginSelector.index.pluginList",dm:"\u63D2\u4EF6\u5217\u8868"})}),"\xA0",F.Z.get({id:"main.pages.App.components.PluginSelector.index.manage",dm:"\u7BA1\u7406"})]}),(0,Q.jsx)(T.Z,{vertical:!0,gap:12,className:oe()(G.list),children:ke.loading?(0,Q.jsx)(le.Z,{spinning:!0}):ke.list.length?ke.list.map(function(Re){return(0,Q.jsx)(ee,{item:Re,selectedTools:V,onSelectTool:function(xe){return We([xe])},onRemoveTool:function(xe){return Ve(xe)}},Re.plugin_id)}):(0,Q.jsx)(ue.Z,{description:F.Z.get({id:"main.pages.App.components.PluginSelector.index.noAvailablePlugin",dm:"\u6682\u65E0\u53EF\u7528\u63D2\u4EF6"}),style:{marginTop:90}})}),(0,Q.jsx)(l.Z,{hideOnSinglePage:!0,style:{justifyContent:"flex-end",paddingTop:12},pageSize:ke.size,current:ke.current,total:ke.total,onChange:function(Ae,xe){ve({current:Ae,size:xe}),fe({current:Ae,size:xe})}})]})}function ae(E){var A,V=E.maxLen,$=V===void 0?1:V,pe=(0,K.Z)({selectedTools:E.value||[]}),e=se()(pe,2),ge=e[0],ke=e[1];return(0,Q.jsx)(n.Z,{width:880,onCancel:E.onClose,open:!0,title:F.Z.get({id:"main.pages.App.components.PluginSelector.index.selectPlugin",dm:"\u9009\u62E9\u63D2\u4EF6"}),onOk:function(){var fe;return(fe=E.onOk)===null||fe===void 0?void 0:fe.call(E,ge.selectedTools)},okButtonProps:{disabled:((A=ge.selectedTools)===null||A===void 0?void 0:A.length)>$},children:(0,Q.jsx)("div",{className:"h-[400px] overflow-y-auto",children:(0,Q.jsx)(M,{className:G.modelCon,value:ge.selectedTools,maxLength:$,onChange:function(fe){return ke({selectedTools:fe})}})})})}function W(E){var A=(0,ne.useState)(E.value||[]),V=se()(A,2),$=V[0],pe=V[1],e=(0,ne.useMemo)(function(){return(0,Q.jsx)(T.Z,{align:"center",className:G.drawerTitle,gap:4,children:F.Z.get({id:"main.pages.App.components.PluginSelector.index.selectPlugin",dm:"\u9009\u62E9\u63D2\u4EF6"})})},[E]);return(0,Q.jsx)(q.Z,{className:G.toolSelectDrawer,width:640,open:!0,onClose:E.onClose,title:e,footer:(0,Q.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"w-full",children:[(0,Q.jsx)("div",{style:{color:"var(--ag-ant-color-text-tertiary)",fontSize:"14px",fontWeight:"normal",lineHeight:"24px"},children:!!$.length&&F.Z.get({id:"main.pages.App.components.PluginSelector.index.addedToolVar1Var2",dm:"\u5DF2\u6DFB\u52A0\u5DE5\u5177{var1}/{var2}"},{var1:($==null?void 0:$.length)||0,var2:E.maxLen||10})}),(0,Q.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,Q.jsx)(re.Z,{type:"default",onClick:function(){E.onClose()},children:F.Z.get({id:"main.pages.App.components.PluginSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,Q.jsx)(re.Z,{type:"primary",onClick:function(){E.onOk($),E.onClose(),y.ZP.success(F.Z.get({id:"main.pages.App.components.PluginSelector.index.addSuccess",dm:"\u6DFB\u52A0\u6210\u529F\uFF01"}))},children:F.Z.get({id:"main.pages.App.components.PluginSelector.index.confirm",dm:"\u786E\u8BA4"})})]})]}),children:(0,Q.jsx)(M,{value:$,onChange:function(ke){return pe(ke)},className:G.listWrap})})}},96100:function(Be,ye,t){t.d(ye,{n:function(){return re}});var N=t(324),i=t.n(N),X=t(80828),O=t.n(X),te=t(87329),se=t.n(te),F=t(30686),B,de=function(){function n(q,K){i()(this,n),se()(this,"eventEmitter",void 0),se()(this,"name",void 0),se()(this,"store",void 0),this.eventEmitter=q,this.name=K,this.store={}}return O()(n,[{key:"on",value:function(K,J){var y=this;return this.eventEmitter.on(K,J),function(){y.off(K,J)}}},{key:"off",value:function(K,J){this.eventEmitter.off(K,J)}},{key:"emit",value:function(K){for(var J,y=arguments.length,T=new Array(y>1?y-1:0),le=1;le<y;le++)T[le-1]=arguments[le];(J=this.eventEmitter).emit.apply(J,[K].concat(T))}},{key:"removeListener",value:function(K,J){return this.eventEmitter.removeListener(K,J)}},{key:"addListener",value:function(K,J){return this.eventEmitter.addListener(K,J)}},{key:"setMaxListeners",value:function(K){return this.eventEmitter.setMaxListeners(K)}},{key:"removeAllListeners",value:function(K){return this.eventEmitter.removeAllListeners(K)}},{key:"getAllEvents",value:function(){return this.eventEmitter._events}},{key:"setValue",value:function(K,J){this.store[K]=J}},{key:"getValue",value:function(K){return this.store.hasOwnProperty(K)?this.store[K]:""}},{key:"deleteValue",value:function(K){return this.store.hasOwnProperty(K)?(delete this.store[K],!0):!1}}]),n}(),re=function(q,K){var J=new F.Z;return K&&J.setMaxListeners(K),B=new de(J,q||"bailian-canvas"),B}},93185:function(Be,ye,t){t.d(ye,{x:function(){return M},Z:function(){return ae}});var N=t(12323),i=t.n(N),X=t(63260),O=t.n(X),te=t(42035),se=t.n(te),F=t(13311),B=t.n(F),de=t(97108),re=t(56388),n=t(22453),q=t(13341),K=t(76042),J=t(72624),y=t(45753),T=t(11246),le=t(19612),ue=t(2821),l=t(5693),ce=t(2784),oe=t(10289),ne=t(44433),Se=t(86384),G=t(90257),w=t(12524),me=t.n(w),z=t(28879),L=t.n(z),d={"status-tag":"status-tag___Aqq6t",dot:"dot___z1afT","update-time":"update-time___A28YE"},H=t(52322),ie=function(E){var A=E.data,V=E.onClick,$=E.className,pe=A.name,e=A.server_code,ge=A.gmt_modified,ke=A.description,ve=A.status,fe=ve,We=K.w[fe]||K.w[K.YI.DELETED],Ve=We.color,Re=We.text,Ae=(0,ce.useMemo)(function(){return L()(ge).format("YYYY-MM-DD HH:mm:ss")},[ge]),xe=function(Ue){Ue.domEvent.stopPropagation(),V==null||V(Ue.key,A)},Ne=function(Ue,Te){Te.stopPropagation(),V==null||V(Ue,A)},De=function(){var Ue=[];return Ue.push({key:"delete",label:n.Z.get({id:"main.pages.MCP.components.McpCard.index.delete",dm:"\u5220\u9664"}),danger:!0}),(0,H.jsxs)(H.Fragment,{children:[fe===K.YI.ENABLED&&(0,H.jsx)(J.Z,{type:"primary",className:"flex-1",onClick:function(we){return Ne("stop",we)},children:n.Z.get({id:"main.pages.MCP.components.McpCard.index.stopService",dm:"\u505C\u6B62\u670D\u52A1"})}),fe===K.YI.DISABLED&&(0,H.jsx)(J.Z,{type:"primary",className:"flex-1",onClick:function(we){return Ne("start",we)},children:n.Z.get({id:"main.pages.MCP.components.McpCard.index.startService",dm:"\u542F\u52A8\u670D\u52A1"})}),(0,H.jsx)(J.Z,{type:"default",className:"flex-1",onClick:function(we){return Ne("edit",we)},children:n.Z.get({id:"main.pages.MCP.components.McpCard.index.editService",dm:"\u7F16\u8F91\u670D\u52A1"})}),(0,H.jsx)(G.Z,{getPopupContainer:function(we){return we},trigger:["click"],menu:{items:Ue,onClick:xe},children:(0,H.jsx)("div",{onClick:function(we){return we.stopPropagation()},children:(0,H.jsx)(J.Z,{icon:(0,H.jsx)(y.Z,{type:"spark-more-line"})})})})]})};return(0,H.jsx)(Se.Z,{title:pe,logo:"spark-MCP-mcp-line",statusNode:(0,H.jsxs)("div",{className:d["status-tag"],style:{color:Ve},"data-color":Ve,children:[(0,H.jsx)("span",{className:d.dot}),(0,H.jsx)("span",{children:Re})]}),info:[{label:n.Z.get({id:"main.pages.MCP.components.McpCard.index.description",dm:"\u63CF\u8FF0"}),content:ke||"-"},{label:n.Z.get({id:"main.pages.MCP.components.McpCard.index.serviceId",dm:"ID"}),content:e}],footerDescNode:(0,H.jsxs)("div",{className:d["update-time"],children:[n.Z.get({id:"main.pages.MCP.components.McpCard.index.updatedAt",dm:"\u66F4\u65B0\u4E8E"}),Ae]}),footerOperateNode:De(),className:me()(d.container,$),onClick:function(){return V==null?void 0:V("detail",A)}})},Q=ie,ee={container:"container___gHtIi"},M=(0,ce.memo)(function(W){var E=function(){W.isOpenNew?window.open("/mcp/create"):ne.m8.push("/mcp/create")};return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(J.Z,B()(B()({onClick:E,type:"primary",icon:(0,H.jsx)(y.Z,{type:"spark-plus-line"})},W.buttonProps),{},{children:W.text||n.Z.get({id:"main.pages.MCP.Manage.createMcpService",dm:"\u521B\u5EFAMCP\u670D\u52A1"})}))})});function ae(){var W,E=(0,re.d)(),A=E.rightPortal,V=(0,oe.s0)(),$=(0,ue.Z)({list:[],pageNo:1,pageSize:50,total:0,loading:!1}),pe=se()($,2),e=pe[0],ge=pe[1],ke=function(){var Ae=O()(i()().mark(function xe(){var Ne,De,je,Ue,Te,we,Oe=arguments;return i()().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return Ne=Oe.length>0&&Oe[0]!==void 0?Oe[0]:{},ge({loading:!0}),qe.prev=2,Ue={current:(De=Ne.pageNo)!==null&&De!==void 0?De:e.pageNo,size:(je=Ne.pageSize)!==null&&je!==void 0?je:e.pageSize,need_tools:!1},qe.next=6,(0,q.Pk)(Ue);case 6:Te=qe.sent,Te&&Te.data&&(we=Te.data,ge({list:we.records||[],total:we.total||0,pageNo:Ue.current,pageSize:Ue.size}));case 8:return qe.prev=8,ge({loading:!1}),qe.finish(8);case 11:case"end":return qe.stop()}},xe,null,[[2,,8,11]])}));return function(){return Ae.apply(this,arguments)}}();(0,l.Z)(function(){ke()});var ve=function(xe){T.Z.warning({title:n.Z.get({id:"main.pages.MCP.Manage.confirmDeleteThisMcpService",dm:"\u786E\u8BA4\u5220\u9664\u6B64MCP\u670D\u52A1\u5417"}),children:n.Z.get({id:"main.pages.MCP.Manage.deleteWillNotBeRecoverableAlreadyAddedServicesMayFailPleaseProceedWithCaution",dm:"\u5220\u9664\u540E\u5C06\u4E0D\u53EF\u6062\u590D\uFF0C\u5DF2\u7ECF\u6DFB\u52A0\u8BE5\u670D\u52A1\u7684\u667A\u80FD\u4F53\u53EF\u80FD\u4F1A\u5931\u6548\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C"}),danger:!0,onOk:function(){var Ne=O()(i()().mark(function je(){return i()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return Te.next=2,(0,q.c8)(xe.server_code);case 2:le.Z.success(n.Z.get({id:"main.pages.MCP.Manage.deletionSuccessful",dm:"\u5220\u9664\u6210\u529F"})),ke();case 4:case"end":return Te.stop()}},je)}));function De(){return Ne.apply(this,arguments)}return De}()})},fe=function(xe){T.Z.warning({title:n.Z.get({id:"main.pages.MCP.Manage.confirmStopDeploymentOfThisService",dm:"\u786E\u8BA4\u505C\u6B62\u90E8\u7F72\u6B64\u670D\u52A1\u5417"}),cancelText:n.Z.get({id:"main.pages.MCP.Manage.cancel",dm:"\u53D6\u6D88"}),okText:n.Z.get({id:"main.pages.MCP.Manage.stopDeployment",dm:"\u505C\u6B62\u90E8\u7F72"}),onOk:function(){var Ne=O()(i()().mark(function je(){return i()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return Te.next=2,(0,q.if)(B()(B()({},xe),{},{status:K.YI.DISABLED}));case 2:le.Z.success(n.Z.get({id:"main.pages.MCP.Manage.stoppingSuccessful",dm:"\u505C\u6B62\u6210\u529F"})),ke();case 4:case"end":return Te.stop()}},je)}));function De(){return Ne.apply(this,arguments)}return De}()})},We=function(xe){T.Z.warning({title:n.Z.get({id:"main.pages.MCP.Manage.confirmStartDeploymentOfThisService",dm:"\u786E\u8BA4\u542F\u52A8\u90E8\u7F72\u6B64\u670D\u52A1\u5417"}),cancelText:n.Z.get({id:"main.pages.MCP.Manage.cancel",dm:"\u53D6\u6D88"}),okText:n.Z.get({id:"main.pages.MCP.Manage.startDeployment",dm:"\u542F\u52A8\u90E8\u7F72"}),onOk:function(){var Ne=O()(i()().mark(function je(){return i()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return Te.next=2,(0,q.if)(B()(B()({},xe),{},{status:K.YI.ENABLED}));case 2:le.Z.success(n.Z.get({id:"main.pages.MCP.Manage.startingSuccessful",dm:"\u542F\u52A8\u6210\u529F"})),ke();case 4:case"end":return Te.stop()}},je)}));function De(){return Ne.apply(this,arguments)}return De}()})},Ve=function(xe,Ne){if(!(!xe||!Ne))switch(xe){case"delete":ve(Ne);break;case"start":We(Ne);break;case"stop":fe(Ne);break;case"edit":V("/mcp/edit/".concat(Ne.server_code));break;case"detail":V("/mcp/detail/".concat(Ne.server_code));break;default:V("/mcp/detail/".concat(Ne.server_code))}},Re=function(xe,Ne){ke({pageNo:xe,pageSize:Ne})};return(0,H.jsxs)("div",{className:ee.container,children:[(e==null||(W=e.list)===null||W===void 0?void 0:W.length)>0&&A((0,H.jsx)(M,{})),(0,H.jsx)(de.Z,{loading:e.loading,pagination:{current:e.pageNo,total:e.total,pageSize:e.pageSize,onChange:Re},emptyAction:(0,H.jsx)(M,{}),children:e.list.map(function(Ae){return(0,H.jsx)(Q,{data:Ae,onClick:Ve},Ae.server_code)})})]})}},36488:function(Be,ye,t){t.d(ye,{qO:function(){return B},ZP:function(){return de},pC:function(){return se}});var N=t(12323),i=t.n(N),X=t(63260),O=t.n(X),te=t(85545);function se(J){return F.apply(this,arguments)}function F(){return F=O()(i()().mark(function J(y){var T,le;return i()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(T=window.g_config.config.upload_method,T!==B.OSS){l.next=6;break}return l.next=4,(0,te.ZP)({url:"/console/v1/files/get-preview-url",method:"GET",params:{path:y}});case 4:return le=l.sent,l.abrupt("return",le.data.data);case 6:if(T!==B.FILE){l.next=8;break}return l.abrupt("return","".concat(te.v2.get(),"/console/v1/files/download?path=").concat(encodeURIComponent(y),"&preview=true&access_token=").concat(te.nP.get()));case 8:case"end":return l.stop()}},J)})),F.apply(this,arguments)}var B=function(J){return J.OSS="oss",J.FILE="file",J}({});function de(J){var y=window.g_config.config.upload_method;return y===B.OSS?n(J):(y===B.FILE,re(J))}function re(J){var y=new FormData;return y.append("category",J.category),y.append("files",J.file),(0,te.ZP)({method:"POST",url:"/console/v1/files/upload",data:y,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(le){var ue;(ue=J.onProgress)===null||ue===void 0||ue.call(J,{percent:Math.min(1,le.loaded/((le==null?void 0:le.total)||1))})}}).then(function(T){return T.data.data[0]})}function n(J){return q.apply(this,arguments)}function q(){return q=O()(i()().mark(function J(y){var T,le,ue;return i()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,(0,te.ZP)({url:"/console/v1/files/upload-policies",method:"POST",data:{files:[{name:y.file.name}],category:y.category}});case 2:return T=ce.sent,le=T.data.data[0],ue=new FormData,ue.append("OSSAccessKeyId",le.access_id),ue.append("success_action_status","200"),ue.append("policy",le.policy),ue.append("signature",le.signature),ue.append("key",le.path),ue.append("file",y.file),ce.abrupt("return",(0,te.ZP)({method:"POST",url:le.host,data:ue,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(ne){var Se;(Se=y.onProgress)===null||Se===void 0||Se.call(y,{percent:Math.min(1,ne.loaded/((ne==null?void 0:ne.total)||1))})}}).then(function(){return{extension:K(y.file.name),name:y.file.name,path:le.path,size:y.file.size}}));case 12:case"end":return ce.stop()}},J)})),q.apply(this,arguments)}function K(J){var y=J.lastIndexOf(".");return(y>0?J.slice(y):"").replace(/\./,"")}},1905:function(Be,ye,t){t.d(ye,{Df:function(){return q},KT:function(){return B},P2:function(){return F},YI:function(){return K},b1:function(){return n},le:function(){return re},o$:function(){return de},ri:function(){return se},yk:function(){return te}});var N=t(74875),i=t.n(N),X=t(46639),O=["app_id"],te=function(y){return(0,X.W)({url:"/console/v1/apps",method:"GET",params:y}).then(function(T){return T.data.data})},se=function(y){return(0,X.W)({url:"/console/v1/apps",method:"POST",data:y}).then(function(T){return T.data.data})},F=function(y){return(0,X.W)({url:"/console/v1/apps/".concat(y),method:"DELETE"})},B=function(y){var T=y.app_id,le=i()(y,O);return(0,X.W)({url:"/console/v1/apps/".concat(T),method:"PUT",data:le})},de=function(y){return(0,X.W)({url:"/console/v1/apps/".concat(y,"/copy"),method:"POST"})},re=function(y){return(0,X.W)({url:"/console/v1/apps/".concat(y),method:"GET"}).then(function(T){return T.data.data})},n=function(y){return(0,X.W)({url:"/console/v1/apps/".concat(y,"/publish"),method:"POST"})},q=function(y){var T=y.app_id,le=y.current,ue=y.size,l=y.status;return(0,X.W)({url:"/console/v1/apps/".concat(T,"/versions"),method:"GET",params:{current:le,size:ue,status:l}}).then(function(ce){return ce.data})},K=function(y,T){return(0,X.W)({url:"/console/v1/apps/".concat(y,"/versions/").concat(T),method:"GET"}).then(function(le){return le.data})}},76077:function(Be,ye,t){t.d(ye,{Cs:function(){return G},Eq:function(){return y},Et:function(){return n},GZ:function(){return T},Mj:function(){return ue},PU:function(){return ne},XK:function(){return oe},Y6:function(){return w},YN:function(){return l},ZJ:function(){return q},bN:function(){return J},eU:function(){return de},eb:function(){return re},gB:function(){return Se},mB:function(){return K},mU:function(){return le},tH:function(){return ce}});var N=t(74875),i=t.n(N),X=t(46639),O=["kb_id"],te=["doc_id","chunk_id"],se=["doc_id","kb_id"],F=["doc_id"],B=["doc_id"],de=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases",method:"GET",params:z}).then(function(L){return L.data.data})},re=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases",method:"POST",data:z}).then(function(L){return L.data.data})},n=function(z){var L=z.kb_id,d=i()(z,O);return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(L),method:"PUT",data:d}).then(function(H){return H.data})},q=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(z),method:"DELETE"}).then(function(L){return L.data})},K=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(z),method:"GET"}).then(function(L){return L.data.data})},J=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases/retrieve",method:"POST",data:z}).then(function(L){if(L)return L.data.data})},y=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(z.kb_id,"/documents"),method:"GET",params:z}).then(function(L){return L.data.data})},T=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(z.kb_id,"/documents"),method:"POST",data:z}).then(function(L){return L.data.data})},le=function(z,L){return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(z,"/documents/").concat(L),method:"DELETE"}).then(function(d){return d.data.data})},ue=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(z==null?void 0:z.kb_id,"/documents/batch-delete"),method:"DELETE",data:z}).then(function(L){return L.data.data})},l=function(z){var L=z.doc_id,d=z.current,H=z.size;return(0,X.W)({url:"/console/v1/documents/".concat(L,"/chunks"),method:"GET",params:{current:d,size:H}}).then(function(ie){return ie.data.data})},ce=function(z){var L=z.doc_id,d=z.chunk_id;return(0,X.W)({url:"/console/v1/documents/".concat(L,"/chunks/").concat(d),method:"DELETE"}).then(function(H){return H.data.data})},oe=function(z){var L=z.doc_id,d=z.chunk_id,H=i()(z,te);return(0,X.W)({url:"/console/v1/documents/".concat(L,"/chunks/").concat(d),method:"PUT",data:H}).then(function(ie){return ie.data.data})},ne=function(z){var L=z.doc_id,d=z.kb_id,H=i()(z,se);return(0,X.W)({url:"/console/v1/knowledge-bases/".concat(d,"/documents/").concat(L,"/re-index"),method:"PUT",data:H}).then(function(ie){return ie.data.data})},Se=function(z){var L=z.doc_id,d=i()(z,F);return(0,X.W)({url:"/console/v1/documents/".concat(L,"/chunks/preview"),method:"POST",data:d}).then(function(H){return H.data.data})},G=function(z){var L=z.doc_id,d=i()(z,B);return(0,X.W)({url:"/console/v1/documents/".concat(L,"/chunks/update-status"),method:"PUT",data:d}).then(function(H){return H.data.data})},w=function(z){return(0,X.W)({url:"/console/v1/knowledge-bases/query-by-codes",method:"POST",data:{kb_ids:z}}).then(function(L){return L.data.data})}},13341:function(Be,ye,t){t.d(ye,{BF:function(){return se},I9:function(){return ue},Pk:function(){return J},b4:function(){return q},c8:function(){return re},gi:function(){return T},if:function(){return B}});var N=t(12323),i=t.n(N),X=t(63260),O=t.n(X),te=t(46639);function se(ce){return F.apply(this,arguments)}function F(){return F=O()(i()().mark(function ce(oe){var ne;return i()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,te.W)({url:"/console/v1/mcp-servers",method:"POST",data:oe});case 2:return ne=G.sent,G.abrupt("return",ne.data);case 4:case"end":return G.stop()}},ce)})),F.apply(this,arguments)}function B(ce){return de.apply(this,arguments)}function de(){return de=O()(i()().mark(function ce(oe){var ne;return i()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,te.W)({url:"/console/v1/mcp-servers",method:"PUT",data:oe});case 2:return ne=G.sent,G.abrupt("return",ne.data);case 4:case"end":return G.stop()}},ce)})),de.apply(this,arguments)}function re(ce){return n.apply(this,arguments)}function n(){return n=O()(i()().mark(function ce(oe){var ne;return i()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,te.W)({url:"/console/v1/mcp-servers/".concat(oe),method:"DELETE"});case 2:return ne=G.sent,G.abrupt("return",ne.data);case 4:case"end":return G.stop()}},ce)})),n.apply(this,arguments)}function q(ce){return K.apply(this,arguments)}function K(){return K=O()(i()().mark(function ce(oe){var ne;return i()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,te.W)({url:"/console/v1/mcp-servers/".concat(oe.server_code),method:"GET",params:oe});case 2:return ne=G.sent,G.abrupt("return",ne.data);case 4:case"end":return G.stop()}},ce)})),K.apply(this,arguments)}function J(ce){return y.apply(this,arguments)}function y(){return y=O()(i()().mark(function ce(oe){var ne;return i()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,te.W)({url:"/console/v1/mcp-servers",method:"GET",params:oe});case 2:return ne=G.sent,G.abrupt("return",ne.data);case 4:case"end":return G.stop()}},ce)})),y.apply(this,arguments)}function T(ce){return le.apply(this,arguments)}function le(){return le=O()(i()().mark(function ce(oe){var ne;return i()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,te.W)({url:"/console/v1/mcp-servers/query-by-codes",method:"POST",data:oe});case 2:return ne=G.sent,G.abrupt("return",ne.data);case 4:case"end":return G.stop()}},ce)})),le.apply(this,arguments)}function ue(ce){return l.apply(this,arguments)}function l(){return l=O()(i()().mark(function ce(oe){var ne;return i()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,te.W)({url:"/console/v1/mcp-servers/debug-tools",method:"POST",data:oe});case 2:return ne=G.sent,G.abrupt("return",ne.data);case 4:case"end":return G.stop()}},ce)})),l.apply(this,arguments)}},18809:function(Be,ye,t){t.d(ye,{$2:function(){return T},$s:function(){return G},B7:function(){return H},NY:function(){return ce},P0:function(){return re},QB:function(){return ne},Qz:function(){return B},YS:function(){return ue},dm:function(){return q},h1:function(){return me},nd:function(){return Q},vu:function(){return L},xp:function(){return J}});var N=t(13311),i=t.n(N),X=t(12323),O=t.n(X),te=t(63260),se=t.n(te),F=t(46639);function B(M){return de.apply(this,arguments)}function de(){return de=se()(O()().mark(function M(ae){var W;return O()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,F.W)({url:"/console/v1/providers",method:"POST",data:ae});case 2:return W=A.sent,A.abrupt("return",W.data);case 4:case"end":return A.stop()}},M)})),de.apply(this,arguments)}function re(M,ae){return n.apply(this,arguments)}function n(){return n=se()(O()().mark(function M(ae,W){var E,A;return O()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae),method:"PUT",data:i()(i()({},W),{},{supported_model_types:typeof W.supported_model_types=="string"?W.supported_model_types:(E=W.supported_model_types)===null||E===void 0?void 0:E.join(",")})});case 2:return A=$.sent,$.abrupt("return",A.data);case 4:case"end":return $.stop()}},M)})),n.apply(this,arguments)}function q(M){return K.apply(this,arguments)}function K(){return K=se()(O()().mark(function M(ae){var W;return O()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae),method:"DELETE"});case 2:return W=A.sent,A.abrupt("return",W.data);case 4:case"end":return A.stop()}},M)})),K.apply(this,arguments)}function J(M){return y.apply(this,arguments)}function y(){return y=se()(O()().mark(function M(ae){var W;return O()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,F.W)({url:"/console/v1/providers",method:"GET",params:ae});case 2:return W=A.sent,A.abrupt("return",W.data);case 4:case"end":return A.stop()}},M)})),y.apply(this,arguments)}function T(M){return le.apply(this,arguments)}function le(){return le=se()(O()().mark(function M(ae){var W;return O()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae),method:"GET"});case 2:return W=A.sent,A.abrupt("return",W.data);case 4:case"end":return A.stop()}},M)})),le.apply(this,arguments)}function ue(){return l.apply(this,arguments)}function l(){return l=se()(O()().mark(function M(){var ae;return O()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,F.W)({url:"/console/v1/providers/protocols",method:"GET"});case 2:return ae=E.sent,E.abrupt("return",ae.data);case 4:case"end":return E.stop()}},M)})),l.apply(this,arguments)}function ce(M,ae){return oe.apply(this,arguments)}function oe(){return oe=se()(O()().mark(function M(ae,W){var E,A;return O()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae,"/models"),method:"POST",data:i()(i()({},W),{},{model_name:W.name,tags:typeof W.tags=="string"?W.tags:(E=W.tags)===null||E===void 0?void 0:E.join(",")})});case 2:return A=$.sent,$.abrupt("return",A.data);case 4:case"end":return $.stop()}},M)})),oe.apply(this,arguments)}function ne(M,ae,W){return Se.apply(this,arguments)}function Se(){return Se=se()(O()().mark(function M(ae,W,E){var A,V;return O()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return pe.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae,"/models/").concat(W),method:"PUT",data:i()(i()({},E),{},{model_name:E.name,tags:typeof E.tags=="string"?E.tags:(A=E.tags)===null||A===void 0?void 0:A.join(",")})});case 2:return V=pe.sent,pe.abrupt("return",V.data);case 4:case"end":return pe.stop()}},M)})),Se.apply(this,arguments)}function G(M,ae){return w.apply(this,arguments)}function w(){return w=se()(O()().mark(function M(ae,W){var E;return O()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae,"/models/").concat(W),method:"DELETE"});case 2:return E=V.sent,V.abrupt("return",E.data);case 4:case"end":return V.stop()}},M)})),w.apply(this,arguments)}function me(M){return z.apply(this,arguments)}function z(){return z=se()(O()().mark(function M(ae){var W;return O()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae,"/models"),method:"GET"});case 2:return W=A.sent,A.abrupt("return",W.data);case 4:case"end":return A.stop()}},M)})),z.apply(this,arguments)}function L(M,ae){return d.apply(this,arguments)}function d(){return d=se()(O()().mark(function M(ae,W){var E;return O()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae,"/models/").concat(W),method:"GET"});case 2:return E=V.sent,V.abrupt("return",E.data);case 4:case"end":return V.stop()}},M)})),d.apply(this,arguments)}function H(M){return ie.apply(this,arguments)}function ie(){return ie=se()(O()().mark(function M(ae){var W;return O()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,F.W)({url:"/console/v1/models/".concat(ae,"/selector"),method:"GET"});case 2:return W=A.sent,A.abrupt("return",W.data);case 4:case"end":return A.stop()}},M)})),ie.apply(this,arguments)}function Q(M,ae){return ee.apply(this,arguments)}function ee(){return ee=se()(O()().mark(function M(ae,W){var E;return O()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,(0,F.W)({url:"/console/v1/providers/".concat(ae,"/models/").concat(W,"/parameter_rules"),method:"GET"});case 2:return E=V.sent,V.abrupt("return",E.data);case 4:case"end":return V.stop()}},M)})),ee.apply(this,arguments)}},47202:function(Be,ye,t){t.d(ye,{b:function(){return X},w:function(){return i}});var N=t(22453),i={draft:N.Z.get({id:"main.types.appManage.draft",dm:"\u8349\u7A3F"}),published:N.Z.get({id:"main.types.appManage.published",dm:"\u5DF2\u53D1\u5E03"}),published_editing:N.Z.get({id:"main.types.appManage.publishedEditing",dm:"\u5DF2\u53D1\u5E03\u7F16\u8F91\u4E2D"})},X={textDialog:N.Z.get({id:"main.types.appManage.textDialogue",dm:"\u6587\u672C\u5BF9\u8BDD"}),textGenerate:N.Z.get({id:"main.types.appManage.textGeneration",dm:"\u6587\u672C\u751F\u6210"})}},76042:function(Be,ye,t){t.d(ye,{YI:function(){return O},rR:function(){return se},w:function(){return te}});var N=t(87329),i=t.n(N),X=t(22453),O=function(F){return F[F.DISABLED=0]="DISABLED",F[F.ENABLED=1]="ENABLED",F[F.DELETED=3]="DELETED",F}({}),te=i()(i()(i()({},O.DISABLED,{color:"error",text:X.Z.get({id:"main.types.mcp.stopped",dm:"\u5DF2\u505C\u7528"})}),O.ENABLED,{color:"success",text:X.Z.get({id:"main.types.mcp.started",dm:"\u5DF2\u542F\u52A8"})}),O.DELETED,{color:"default",text:X.Z.get({id:"main.types.mcp.deleted",dm:"\u5DF2\u5220\u9664"})}),se=5},53890:function(Be,ye,t){t.d(ye,{Z:function(){return B}});var N=t(42035),i=t.n(N),X=[["0","9"],["a","z"],["A","Z"]].map(function(de){return de.map(function(re){return re.charCodeAt(0)})}).flatMap(function(de){var re=i()(de,2),n=re[0],q=re[1];return Array.from({length:q-n+1},function(K,J){return n+J})}),O=function(re){return String.fromCharCode.apply(String,Array.from({length:re},function(){return X[Math.floor(Math.random()*X.length)]}))},te=0,se=function(re){return te+=1,"".concat(te.toString(16),"######").substring(0,re)},F="random";function B(de){return F==="incremental"?se(de):O(de)}},28842:function(Be,ye){ye.Z={container:"container___FMmcw",title:"title___zoXE9",card:"card___MwD4J","img-con":"img-con___eCYij",name:"name____2Mis",desc:"desc___xXg4v"}}}]);

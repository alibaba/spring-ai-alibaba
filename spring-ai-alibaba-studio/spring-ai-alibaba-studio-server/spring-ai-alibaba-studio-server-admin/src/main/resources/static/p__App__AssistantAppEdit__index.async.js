"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[1248],{29944:function(Ke,Ce,e){e.d(Ce,{Z:function(){return ge}});var f=e(42035),T=e.n(f),U=e(13311),P=e.n(U),ee=e(22453),M=e(18809),A=e(64251),u=e(72624),ne=e(45753),q=e(2821),te=e(5693),t=e(35899),W=e(71938),K=e(73088),L=e(51747),I=e(4513),se=e(94815),oe=e(55432),Z=e(2784),Ee={"model-selector-form-label":"model-selector-form-label___Oy0rU"},V=e(52322),le=function(y){if(y===void 0)return 1;var c=Math.pow(.1,y);return Number(c.toFixed(y))},De=(0,Z.memo)(function(B){var y=B.value,c=B.onChange,X=B.schemaList,Q=B.disabled,R=function(k,m){var j=X.map(function(x){var N=y.find(function(z){return z.key===x.code});return x.code===k?P()({key:x==null?void 0:x.code,type:x.type,value:x.default_value,enable:N==null?void 0:N.enable},m):{key:x==null?void 0:x.code,type:x.type,value:(N==null?void 0:N.value)||x.default_value,enable:(N==null?void 0:N.enable)||!1}});c(j)},b=(0,Z.useMemo)(function(){return X!=null&&X.length?(0,V.jsx)("div",{className:"flex flex-col gap-3",children:X.map(function(S){var k,m=y.find(function(j){return j.key===S.code});return(0,V.jsxs)("div",{className:"flex-justify-between gap-5",children:[(0,V.jsxs)("div",{className:"flex items-center gap-2",children:[(0,V.jsx)(t.Z,{checked:!!(m!=null&&m.enable),disabled:Q,onChange:function(x){return R(S.code,{enable:x.target.checked})}}),(0,V.jsx)(W.Z.Text,{className:Ee["model-selector-form-label"],ellipsis:{tooltip:S.name},style:{width:78},children:S.name})]}),S.type==="Number"&&(0,V.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,V.jsx)(A.Z,{disabled:!(m!=null&&m.enable)||Q,style:{width:236},onChange:function(x){return R(S.code,{value:x})},min:S.min,max:S.max,step:le(S.precision),value:(m==null?void 0:m.value)||S.default_value}),(0,V.jsx)(K.Z,{disabled:!(m!=null&&m.enable)||Q,style:{width:70},precision:S.precision,value:(m==null?void 0:m.value)||S.default_value,onChange:function(x){return R(S.code,{value:x})}})]}),S.type==="String"&&(S.options?(0,V.jsx)(L.Z,{value:(m==null?void 0:m.value)||((k=S.options)===null||k===void 0?void 0:k[0]),disabled:!(m!=null&&m.enable)||Q,className:"w-full",options:S.options.map(function(j){return{label:j,value:j}}),onSelect:function(x){return R(S.code,{value:x})}}):(0,V.jsx)(I.Z,{disabled:!(m!=null&&m.enable)||Q,className:"flex-1",value:(m==null?void 0:m.value)||S.default_value,onChange:function(x){return R(S.code,{value:x.target.value})}})),S.type==="Boolean"&&(0,V.jsx)(se.Z,{disabled:!(m!=null&&m.enable)||Q,checked:(m==null?void 0:m.value)||S.default_value,onChange:function(x){return R(S.code,{value:x})}})]},S.code)})}):ee.Z.get({id:"main.components.ModelConfigForm.index.selectModelFirst",dm:"\u8BF7\u5148\u9009\u62E9\u6A21\u578B"})},[y,c,X]);return(0,V.jsx)(oe.Z,{placement:"bottomLeft",content:b,trigger:["click"],children:(0,V.jsx)(u.Z,{icon:(0,V.jsx)(ne.Z,{type:"spark-modify-line"})})})}),we=(0,Z.memo)(function(B){var y=B.onChange,c=B.onSelect,X=B.value,Q=B.modelOptions,R=Q===void 0?[]:Q,b=B.disabled,S=(0,q.Z)({schemaList:[]}),k=T()(S,2),m=k[0],j=k[1],x=function(z,pe){var ie;!((ie=X.provider)!==null&&ie!==void 0&&ie.length)&&!(pe!=null&&pe.length)||!(z!=null&&z.length)||(0,M.nd)(pe||X.provider,z).then(function(ye){j({schemaList:ye.data})})};return(0,te.Z)(function(){X.model_id&&x(X.model_id)}),(0,V.jsxs)("div",{className:"flex items-center gap-2",children:[(0,V.jsx)(L.Z,{disabled:b,placeholder:ee.Z.get({id:"main.pages.App.Workflow.nodes.ParameterExtractor.schema.selectModel",dm:"\u8BF7\u9009\u62E9\u6A21\u578B"}),className:"flex-1 w-[240px]",value:X.model_id?X.model_id:void 0,options:R,onChange:function(z,pe){var ie=z.split("@@@"),ye=T()(ie,2),be=ye[0],n=ye[1];if(x(n,be),Array.isArray(pe)){var Ae,Ie;c((Ae=pe[0])===null||Ae===void 0?void 0:Ae.extra,(Ie=pe[0])===null||Ie===void 0?void 0:Ie.extra)}else c(pe==null?void 0:pe.extra,pe==null?void 0:pe.extra)}}),(0,V.jsx)(De,{disabled:b,schemaList:m.schemaList,value:X.params,onChange:function(z){y(z)}})]})}),Y=function(y){var c=y.value,X=y.onChange,Q=y.onSelectedModelChange,R=y.disabled,b=(0,Z.useState)(null),S=T()(b,2),k=S[0],m=S[1],j=(0,q.Z)({modelOptions:[]}),x=T()(j,2),N=x[0],z=x[1];return(0,Z.useEffect)(function(){k&&(Q==null||Q(k))},[k]),(0,te.Z)(function(){(0,M.B7)("llm").then(function(pe){var ie=pe.data.map(function(ye){return{label:ye.provider.name,options:ye.models.map(function(be){return{label:be.name||"",value:"".concat(be.provider,"@@@").concat(be.model_id),extra:be}})}});z({modelOptions:ie}),ie.forEach(function(ye){ye.options.forEach(function(be){be.value.split("@@@")[1]===c.model_id&&m(be.extra)})})})}),(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(we,{disabled:R,onSelect:function(ie,ye){m(ye),X({model_id:ie.model_id,provider:ie.provider,params:[]},ye)},onChange:function(ie){X({model_id:k==null?void 0:k.model_id,provider:k==null?void 0:k.provider,params:ie},k)},value:c,modelOptions:N.modelOptions})})},ge=(0,Z.memo)(Y)},19110:function(Ke,Ce){Ce.Z={agentSystemPromptMaxLength:1e4,agentUserPromptMaxLength:1e4,agentAgentComponentMaxLimit:5,agentWorkflowComponentMaxLimit:5,agentKnowledgeBaseMaxLimit:10,agentMcpMaxLimit:5,agentToolMaxLimit:10,agentPresetQuestionMaxLimit:5,agentWelcomeMessageMaxLength:2e3,agentSSETimeout:"180000"}},97948:function(Ke,Ce,e){e.d(Ce,{Z:function(){return y}});var f=e(13311),T=e.n(f),U="/iconfonts/index.js",P=e(22453),ee=e(12323),M=e.n(ee),A=e(63260),u=e.n(A),ne=e(46639);function q(){return te.apply(this,arguments)}function te(){return te=u()(M()().mark(function c(){var X,Q;return M()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,ne.W)({method:"GET",url:"/console/v1/system/global-config"});case 2:X=b.sent,Q=X.data.data,window.g_config.config=Q;case 5:case"end":return b.stop()}},c)})),te.apply(this,arguments)}var t=e(86676),W=e(26771),K=e(40938),L=e(51034),I=e(65741),se=e(13227),oe=e(91030),Z=e(74713),Ee=e(35577),V=e(26600),le=e(98833),De=e(79427),we=e(32963),Y=e(9072),ge=e(52322),B=P.Z.getCurrentLanguage();function y(c){var X=Y.F.get()==="dark",Q={zh:V.Z,en:Z.Z,ja:Ee.Z}[B],R=(X?t:W).theme,b=(0,I.Z)(q),S=b.loading;return S?null:(0,ge.jsx)(De.SV,{FallbackComponent:function(){return(0,ge.jsx)("h1",{children:" something error "})},children:(0,ge.jsx)(K.ZP,T()(T()({},W),{},{button:{autoInsertSpace:!1},theme:T()(T()({},R),{},{algorithm:X?se.Z.darkAlgorithm:se.Z.defaultAlgorithm,cssVar:{prefix:"ag-ant"},hashed:!1}),getPopupContainer:function(){return document.querySelector("#root .ag-ant-app")},prefix:"ag",prefixCls:"ag-ant",iconfont:U,locale:Q,renderEmpty:function(){var m;return(0,ge.jsx)(oe.Z,{justify:"center",children:(0,ge.jsx)(L.Z,{description:Q==null||(m=Q.Empty)===null||m===void 0?void 0:m.description})})},children:(0,ge.jsx)("div",{className:we.Z.main,children:c.children})}))})}},9072:function(Ke,Ce,e){e.d(Ce,{F:function(){return ee},Z:function(){return P}});var f=e(78308),T=e(52322),U="dark";function P(){var M=ee.get();return(0,T.jsx)(f.Z,{bordered:!1,icon:{light:"spark-sun-line",dark:"spark-moon-line"}[M],onClick:function(){ee.set(M==="light"?"dark":"light")},shape:"default"})}var ee={get:function(){var A=localStorage.getItem("data-prefers-color")||U;return A!=="light"&&A!=="dark"?(localStorage.setItem("data-prefers-color",U),U):A},set:function(A){localStorage.setItem("data-prefers-color",A),location.reload()}}},1433:function(Ke,Ce,e){e.d(Ce,{H:function(){return T}});var f=e(2784),T=f.createContext({})},30332:function(Ke,Ce,e){e.d(Ce,{Z:function(){return ne}});var f=e(22453),T=e(47202),U=e(92748),P=e(72580),ee=e(91030),M={appStatus:"appStatus___nP3Su",tagName:"tagName___kc_Ei",backWrap:"backWrap___D7GLU",draft:"draft___CEd7j",publish:"publish___Gi4bv",draftAndPublish:"draftAndPublish____tE0a"},A=e(52322),u=function(q){return q.draft="",q.published="blue",q.published_editing="blue",q}(u||{});function ne(q){var te=q.appStatus,t=q.autoSaveTime;return(0,A.jsxs)(ee.Z,{className:M.appStatus,align:"center",children:[(0,A.jsx)(U.Z,{color:u[te],children:T.w[te]}),!!t&&(0,A.jsx)("div",{className:"text-[12px] leading-[32px]",style:{color:"var(--ag-ant-color-text-quaternary)"},children:(0,A.jsx)(P.Z,{tooltip:f.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppStatus.index.autosavedOn",dm:"\u5DF2\u4E8E{var1}\u81EA\u52A8\u4FDD\u5B58"},{var1:t}),children:f.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppStatus.index.autosavedOn",dm:"\u5DF2\u4E8E{var1}\u81EA\u52A8\u4FDD\u5B58"},{var1:t})})})]})}},95423:function(Ke,Ce,e){e.d(Ce,{Z:function(){return b}});var f=e(49616),T=e.n(f),U=e(12323),P=e.n(U),ee=e(63260),M=e.n(ee),A=e(87329),u=e.n(A),ne=e(42035),q=e.n(ne),te=e(22453),t=e(1905),W=e(3318),K=e(11246),L=e(8822),I=e(19612),se=e(45753),oe=e(72624),Z=e(2821),Ee=e(5693),V=e(91030),le=e(71938),De=e(91569),we=e(12524),Y=e.n(we),ge=e(28879),B=e.n(ge),y=e(2784),c=e(41714),X={historyPanelWrapper:"historyPanelWrapper___CqG_l",header:"header___J9GOr",list:"list___FD4Eg",timelineItemWrapper:"timelineItemWrapper___xrKvt",more:"more___f4JgB",hover:"hover___D2STt",timelineTitle:"timelineTitle___AzIyu",selected:"selected___YwyS9",disabled:"disabled___uTGSK",desc:"desc___FbgyA",inUse:"inUse___xh1Ov",timelineNew:"timelineNew___AUFoo",footer:"footer___BTO8j"},Q=e(52322),R=function(k){var m=k.selected,j=k.onSelect,x=k.version,N=k.versionConfig,z=k.disabled,pe=k.index,ie=(0,y.useState)(!1),ye=q()(ie,2),be=ye[0],n=ye[1];return(0,Q.jsx)("div",{className:Y()(X.timelineItemWrapper,u()(u()(u()({},X.selected,m),X.disabled,z),X.hover,be)),onClick:function(){if(x==="draft")return j("draft");j(x,pe)},onMouseOver:function(){n(!0)},onMouseLeave:function(){n(!1)},children:x==="draft"?(0,Q.jsx)("div",{style:{position:"relative"},children:te.Z.get({id:"main.components.HistoryPanel.index.currentDraft",dm:"\u5F53\u524D\u8349\u7A3F"})}):N&&(0,Q.jsxs)("div",{style:{position:"relative"},children:[(0,Q.jsx)(V.Z,{justify:"space-between",align:"center",children:(0,Q.jsxs)(V.Z,{gap:4,justify:"left",children:[pe===0?(0,Q.jsx)("div",{className:X.timelineTitle,children:te.Z.get({id:"main.components.HistoryPanel.index.liveVersion",dm:"\u7EBF\u4E0A\u7248\u672C"})}):(0,Q.jsxs)("div",{className:X.timelineTitle,children:[B()(N.gmt_modified).format("YYYY-MM-DD"),te.Z.get({id:"main.components.HistoryPanel.index.version",dm:"\u7248\u672C"})]}),pe===0&&(0,Q.jsx)("div",{className:X.timelineNew,children:te.Z.get({id:"main.components.HistoryPanel.index.latest",dm:"\u6700\u65B0"})})]})}),(0,Q.jsx)(V.Z,{className:X.desc,children:B()(N.gmt_modified).format("YYYY-MM-DD HH:mm:ss")}),(0,Q.jsxs)(V.Z,{className:X.desc,children:[(0,Q.jsx)("span",{style:{whiteSpace:"nowrap"},children:te.Z.get({id:"main.components.HistoryPanel.index.versionId",dm:"\u7248\u672CID\uFF1A"})}),N.version]}),(0,Q.jsxs)(V.Z,{className:X.desc,children:[(0,Q.jsx)("span",{style:{whiteSpace:"nowrap"},children:te.Z.get({id:"main.components.HistoryPanel.index.publisher",dm:"\u53D1\u5E03\u4EBA\uFF1A"})}),(0,Q.jsx)(le.Z.Text,{ellipsis:{tooltip:(0,W.rb)(N.modifier||"")},children:N.modifier})]})]})})};function b(S){var k=S.selectedVersion,m=k===void 0?"draft":k,j=S.appDetail,x=S.onSelectVersion,N=(0,Z.Z)({versionConfigList:[],curConfig:null,pageNo:1}),z=q()(N,2),pe=z[0],ie=z[1],ye=(0,y.useCallback)(function(){(0,t.Df)({app_id:j.app_id,current:pe.pageNo,size:10,status:"published"}).then(function(n){ie({versionConfigList:n.data.records})})},[j.app_id]);(0,Ee.Z)(function(){ye()}),(0,c.Z)("history-panel-fresh",ye);var be=function(){K.Z.warning({title:te.Z.get({id:"main.components.HistoryPanel.index.confirmUseVersion",dm:"\u662F\u5426\u786E\u8BA4\u4F7F\u7528\u6B64\u7248\u672C\u5185\u5BB9"}),children:te.Z.get({id:"main.components.HistoryPanel.index.overwriteDraft",dm:"\u786E\u8BA4\u540E\uFF0C\u4F1A\u4F7F\u7528\u6B64\u7248\u672C\u8986\u76D6\u5F53\u524D\u8349\u7A3F\u5185\u5BB9\uFF01"}),onOk:function(){var Ae=M()(P()().mark(function Je(){var Be,Ve,Re,He;return P()().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:if(j){Le.next=2;break}return Le.abrupt("return");case 2:return Le.t1=L.CX,Le.next=5,(0,t.YI)(j.app_id,m);case 5:if(Le.t3=Be=Le.sent,Le.t2=Le.t3===null,Le.t2){Le.next=9;break}Le.t2=Be===void 0;case 9:if(!Le.t2){Le.next=13;break}Le.t4=void 0,Le.next=14;break;case 13:Le.t4=Be.data.config;case 14:if(Le.t5=Le.t4,Le.t0=(0,Le.t1)(Le.t5),Le.t0){Le.next=18;break}Le.t0={};case 18:return Ve=Le.t0,Le.next=21,(0,t.KT)({app_id:j.app_id,name:j.name,description:j.description,config:Ve});case 21:x("draft"),ye(),Re=pe.versionConfigList.find(function(mn){return mn.version===m}),Re&&(He=te.Z.get({id:"main.components.HistoryPanel.index.returnedTo",dm:"\u5DF2\u56DE\u5230"})+B()(Re.gmt_modified).format("YYYY-MM-DD")+te.Z.get({id:"main.components.HistoryPanel.index.version",dm:"\u7248\u672C"}),I.Z.success(He));case 25:case"end":return Le.stop()}},Je)}));function Ie(){return Ae.apply(this,arguments)}return Ie}()})};return(0,Q.jsxs)(V.Z,{className:X.historyPanelWrapper,vertical:!0,children:[(0,Q.jsxs)("div",{className:X.header,children:[(0,Q.jsx)("div",{className:X.title,children:te.Z.get({id:"main.components.HistoryPanel.index.historyVersion",dm:"\u5386\u53F2\u7248\u672C"})}),(0,Q.jsx)(se.Z,{type:"spark-false-line",isCursorPointer:!0,onClick:function(){S.onClose()}})]}),(0,Q.jsx)("div",{className:X.list,children:(0,Q.jsx)(De.Z,{items:[{children:(0,Q.jsx)(R,{selected:m==="draft",onSelect:function(){return S.hasInitData&&x("draft")},version:"draft"}),color:m==="draft"?"var(--ag-ant-color-primary)":"var(--ag-ant-color-text-description)"}].concat(T()(pe.versionConfigList.map(function(n,Ae){return{children:(0,Q.jsx)(R,{selected:m===n.version,onSelect:function(Je){S.hasInitData&&x(Je,Ae)},versionConfig:n,version:n.version,index:Ae}),color:m===n.version?"var(--ag-ant-color-primary)":"var(--ag-ant-color-text-description)"}})))})}),(0,Q.jsx)(V.Z,{className:X.footer,align:"center",children:(0,Q.jsx)(oe.Z,{disabled:m==="draft",type:"primary",onClick:be,children:te.Z.get({id:"main.components.HistoryPanel.index.overwriteDraft",dm:"\u8986\u76D6\u5F53\u524D\u8349\u7A3F"})})})]})}},20585:function(Ke,Ce,e){e.d(Ce,{IM:function(){return Z},ZP:function(){return V}});var f=e(42035),T=e.n(f),U=e(19110),P=e(22453),ee=e(43065),M=e(45753),A=e(69045),u=e(72624),ne=e(2821),q=e(91030),te=e(81596),t=e(12524),W=e.n(t),K=e(2784),L=e(1433),I=e(90390),se={filters:"filters___C4UkM",loading:"loading___CR425",toolSelector:"toolSelector___fnjjS",page:"page___Zpmzi",titleWrap:"titleWrap___YPyUE",title:"title___EEdeZ",right:"right___sNk34",container:"container___D8Qd_",subArea:"subArea___QRYlt",expandBtn:"expandBtn___T5hR5",hidden:"hidden___ooNP0",footer:"footer___t1ciB",left:"left___hTSci",show:"show___Xj8N3",emptyCon:"emptyCon___MjnIA"},oe=e(52322),Z=U.Z.agentToolMaxLimit;function Ee(le){var De=le.tool,we=le.handleRemoveTool;return(0,oe.jsx)(I.Z,{iconType:"spark-plugin-line",name:De.name,rightArea:(0,oe.jsx)(M.Z,{type:"spark-delete-line",isCursorPointer:!0,onClick:function(){we(De)}})})}function V(){var le,De=(0,K.useContext)(L.H),we=De.appState,Y=De.onAppConfigChange,ge=((le=we.appBasicConfig)===null||le===void 0?void 0:le.config)||{},B=ge.tools,y=B===void 0?[]:B,c=(0,ne.Z)({expand:!1,selectVisible:!1}),X=T()(c,2),Q=X[0],R=X[1],b=function(m){Y({tools:m})};(0,K.useEffect)(function(){y.length&&R({expand:!0})},[y]);var S=function(m){b(y.filter(function(j){return j.tool_id!==m.tool_id}))};return(0,oe.jsxs)(q.Z,{vertical:!0,gap:6,className:"mb-[20px]",children:[(0,oe.jsxs)("div",{className:se.titleWrap,children:[(0,oe.jsxs)(q.Z,{gap:8,className:"text-[13px] font-medium leading-[20px]",style:{color:"var(--ag-ant-color-text)"},align:"center",children:[(0,oe.jsxs)(q.Z,{align:"center",children:[(0,oe.jsx)("span",{children:P.Z.get({id:"main.components.PluginSelectorComp.index.plugin",dm:"\u63D2\u4EF6"})}),(0,oe.jsx)(A.Z,{content:P.Z.get({id:"main.components.PluginSelectorComp.index.callOpenApi",dm:"\u667A\u80FD\u4F53\u53EF\u4EE5\u901A\u8FC7\u63D2\u4EF6\u4E3B\u52A8\u8C03\u7528OpenAPI\uFF0C\u4F8B\u5982\u4FE1\u606F\u67E5\u8BE2\u3001\u6570\u636E\u5B58\u50A8\u7B49\u3002"})})]}),(0,oe.jsxs)("span",{className:"text-[12px] leading-[20px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:[y.length,"/",Z]})]}),(0,oe.jsxs)("span",{className:se.right,children:[(0,oe.jsx)(u.Z,{style:{padding:0},onClick:function(){return R({selectVisible:!0})},iconType:"spark-plus-line",type:"text",size:"small",children:P.Z.get({id:"main.components.PluginSelectorComp.index.plugin",dm:"\u63D2\u4EF6"})}),(0,oe.jsx)(te.Z,{type:"vertical",className:"ml-[16px] mr-[16px]"}),(0,oe.jsx)(M.Z,{onClick:function(){return R({expand:!Q.expand})},className:W()(se.expandBtn,!Q.expand&&se.hidden),type:"spark-up-line"})]})]}),Q.expand&&(0,oe.jsx)(q.Z,{vertical:!0,gap:8,children:y.map(function(k){return(0,oe.jsx)(Ee,{handleRemoveTool:function(){return S(k)},tool:k},k.tool_id)})}),Q.selectVisible&&(0,oe.jsx)(ee.U_,{maxLen:Z,value:y,onOk:b,onClose:function(){return R({selectVisible:!1})}})]})}},75438:function(Ke,Ce,e){e.d(Ce,{Z:function(){return se}});var f=e(42035),T=e.n(f),U=e(22453),P=e(84546),ee=e(72624),M=e(45753),A=e(5693),u=e(42991),ne=e(91030),q=e(81596),te=e(12524),t=e.n(te),W=e(2784),K=e(10289),L={successIcon:"successIcon___YIdEs",title:"title___l5oqv",successCon:"successCon___TaLIf",desc:"desc___PG75B",shortTip:"shortTip___b_DsC",actions:"actions___rJJqi",actionCard:"actionCard___dWK7o",icon:"icon___DAQOS",imgCon:"imgCon___Z2w8j"},I=e(52322);function se(oe){var Z=(0,W.useState)(5),Ee=T()(Z,2),V=Ee[0],le=Ee[1],De=(0,W.useRef)(5),we=(0,W.useRef)(null),Y=(0,K.s0)(),ge=function(){we.current&&(clearInterval(we.current),we.current=null)};return(0,A.Z)(function(){ge(),we.current=setInterval(function(){De.current<=0&&(ge(),oe.onClose()),De.current--,le(De.current)},1e3)}),(0,u.Z)(function(){ge()}),(0,I.jsx)(P.Z,{onCancel:oe.onClose,className:L.successModal,open:!0,footer:(0,I.jsx)(ne.Z,{className:"w-full",justify:"flex-end",children:(0,I.jsx)(ee.Z,{onClick:function(){oe.onClose(),Y("/app")},children:U.Z.get({id:"main.components.PublishAppSuccessModal.index.notConfigureReturn",dm:"\u6682\u4E0D\u914D\u7F6E\uFF0C\u8FD4\u56DE\u5E94\u7528\u5217\u8868\uFF08{var1}S\uFF09"},{var1:V})})}),title:U.Z.get({id:"main.components.PublishAppSuccessModal.index.appPublished",dm:"\u5E94\u7528\u53D1\u5E03\u6210\u529F\uFF01"}),width:600,children:(0,I.jsxs)(ne.Z,{align:"center",vertical:!0,children:[(0,I.jsx)(ne.Z,{className:L.successCon,gap:12,vertical:!0,children:(0,I.jsx)(ne.Z,{align:"center",gap:8,className:"mt-[18px]",children:(0,I.jsx)("img",{className:"w-[60px] h-[60px]",src:"/images/congratulations.png"})})}),(0,I.jsx)("div",{className:L.shortTip,children:(0,I.jsx)(q.Z,{children:U.Z.get({id:"main.components.PublishAppSuccessModal.index.quickActions",dm:"\u4F60\u8FD8\u53EF\u4EE5\u8FDB\u884C\u4EE5\u4E0B\u64CD\u4F5C"})})}),(0,I.jsx)(ne.Z,{align:"center",vertical:!0,gap:16,className:t()(L.actions,"w-full"),children:(0,I.jsxs)("div",{className:t()(L.actionCard),children:[(0,I.jsx)("div",{className:L.imgCon,children:(0,I.jsx)(M.Z,{className:L.icon,type:"spark-plugin-line"})}),(0,I.jsxs)("div",{className:"flex-1",children:[(0,I.jsx)("div",{className:L.title,children:U.Z.get({id:"main.components.PublishAppSuccessModal.index.publishAppComponent",dm:"\u53D1\u5E03\u5E94\u7528\u7EC4\u4EF6"})}),(0,I.jsx)("div",{className:L.desc,children:U.Z.get({id:"main.components.PublishAppSuccessModal.index.publishAsAppComponent",dm:"\u53D1\u5E03\u4E3A\u5E94\u7528\u7EC4\u4EF6\uFF0C\u65B9\u4FBF\u5728\u667A\u80FD\u4F53\u6216\u5DE5\u4F5C\u6D41\u4E2D\u76F4\u63A5\u8C03\u7528\uFF01"})})]}),(0,I.jsxs)(ee.Z,{className:"font-medium",type:"text",onClick:function(){return oe.onClickAction("comp")},children:[(0,I.jsx)("span",{children:U.Z.get({id:"main.components.PublishAppSuccessModal.index.immediatelyPublish",dm:"\u7ACB\u5373\u53D1\u5E03"})}),(0,I.jsx)(M.Z,{type:"spark-rightArrow-line"})]})]})})]})})}},90390:function(Ke,Ce,e){var f=e(45753),T=e(3318),U=e(11283),P=e(91030),ee=e(71938),M=e(2784),A=e(52322);Ce.Z=function(u){var ne,q,te;return(0,A.jsxs)(P.Z,{justify:"space-between",style:{background:"var(--ag-ant-color-fill-tertiary)"},className:"w-full height-[32px] rounded-[6px] p-[6px_12px]",children:[(0,A.jsxs)(P.Z,{gap:4,className:"flex flex-1 items-center title",style:{width:"calc(100% - 24px)"},children:[(0,A.jsx)(f.Z,{type:u.iconType,size:"small"}),(0,A.jsx)(ee.Z.Text,{ellipsis:{tooltip:(0,T.rb)(u.name)},style:{color:"var(--ag-ant-color-text-base)",width:"112px"},className:"text-[12px] text-normal leading-[20px]",children:u.name}),(0,A.jsx)(ee.Z.Text,{style:{width:"calc(100% - 140px)",color:"var(--ag-ant-color-text-tertiary)"},ellipsis:{tooltip:(0,T.rb)((u==null?void 0:u.description)||"")},children:u==null?void 0:u.description}),(0,A.jsx)(U.Z,{content:(ne=u.weightInfo)===null||ne===void 0?void 0:ne.description,children:(0,A.jsxs)(ee.Z.Text,{style:{color:"var(--ag-ant-color-text-description)",fontSize:"12px",flexShrink:0,marginRight:"12px"},children:[(q=u.weightInfo)===null||q===void 0?void 0:q.label,(te=u.weightInfo)===null||te===void 0?void 0:te.value]})})]}),u.rightArea]})}},74029:function(Ke,Ce,e){e.d(Ce,{Z:function(){return q}});var f=e(22453),T=e(45753),U=e(62603),P=e(91030),ee=e(12524),M=e.n(ee),A=e(52322),u=function(t){var W=t.modalType,K=t.diameter,L=K===void 0?28:K,I=t.offset,se=I===void 0?-8:I,oe="spark-text-line";return W==="textDialog"&&(oe="spark-text-line"),W==="textGenerate"&&(oe="spark-aiEdit-line"),W==="audio"&&(oe="spark-dial-line"),W==="video"&&(oe="spark-video-line"),(0,A.jsx)("div",{className:"absolute rounded-[14px] flex justify-center items-center border-2 border-white border-solid",style:{width:"".concat(L,"px"),height:"".concat(L,"px"),bottom:"".concat(se,"px"),right:"".concat(se,"px"),backgroundColor:"var(--ag-ant-color-text-base)"},children:(0,A.jsx)(T.Z,{type:oe,style:{color:"var(--ag-ant-color-bg-base)"},size:"small"})})},ne=function(t){var W=t.modalType;return(0,A.jsxs)("div",{className:"relative w-[64px] h-[64px]",children:[(0,A.jsx)("img",{className:"w-full h-full",src:"/images/defaultAvatar.png",alt:""}),(0,A.jsx)(u,{modalType:W,diameter:24,offset:-4})]})};function q(te){var t,W=te.data,K=W.modalType,L=U.ZP.useConfig(),I=L.componentDisabled;return!((t=W.suggested_questions)!==null&&t!==void 0&&t.length)&&!W.prologue?(0,A.jsxs)(P.Z,{justify:"center",align:"center",style:{marginTop:"20vh"},vertical:!0,children:[(0,A.jsx)(ne,{modalType:K}),(0,A.jsx)("div",{className:"text-[16px] text-center font-semibold mt-[24px]",style:{color:"var(--ag-ant-tooltip-bg)"},children:te.title||f.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.components.Welcome.index.inputQuestion",dm:"\u8F93\u5165\u95EE\u9898\u8FDB\u884C\u6D4B\u8BD5\u4F53\u9A8C"})})]}):(0,A.jsx)(P.Z,{justify:"center",align:"center",style:{marginTop:"20vh"},children:(0,A.jsxs)(P.Z,{className:"w-[400px]",vertical:!0,gap:12,align:"center",children:[W.icon?(0,A.jsxs)("div",{className:"relative w-[76px] h-[76px]",children:[(0,A.jsx)("img",{className:"w-full h-full",src:W.icon,alt:""}),(0,A.jsx)(u,{modalType:K})]}):(0,A.jsx)(ne,{modalType:K}),(0,A.jsx)("div",{className:"text-[16px] text-center font-medium",style:{color:"var(--ag-ant-color-text)"},children:W.name}),(0,A.jsx)("div",{className:"text-[14px]",style:{color:"var(--ag-ant-color-text-secondary)"},children:W.prologue}),(W.suggested_questions||[]).map(function(se){return(0,A.jsxs)(P.Z,{className:M()("text-[14px] cursor-pointer px-[16px] py-[10px] rounded-[6px] w-full suggested-questions-item-wrapper",{"cursor-not-allowed":I}),onClick:function(){var Z;I||(Z=te.sparkChatRef)===null||Z===void 0||(Z=Z.current)===null||Z===void 0||Z.onInput.onSubmit({query:se})},gap:12,justify:"space-between",align:"center",children:[(0,A.jsxs)(P.Z,{gap:12,className:"break-all",children:[(0,A.jsx)("img",{src:"/images/suggestQuestion.png",className:"w-[20px] h-[20px]",alt:""}),se]}),(0,A.jsx)("div",{className:"flex items-center justify-center w-[16px] h-[16px] rounded-[4px] suggested_questions-item-icon-wrapper",children:(0,A.jsx)(T.Z,{type:"spark-rightArrow-line",size:"small"})})]},se)})]})})}},44585:function(Ke,Ce,e){e.r(Ce),e.d(Ce,{default:function(){return oi},isTextModal:function(){return Pt},queryComponentsByCodes:function(){return Dn},queryKnowledgeListByCode:function(){return et},queryMCPsByCodes:function(){return qn},queryToolsByCode:function(){return Xn},transformAppData:function(){return Et}});var f=e(12323),T=e.n(f),U=e(63260),P=e.n(U),ee=e(42035),M=e.n(ee),A=e(13311),u=e.n(A),ne=e(74875),q=e.n(ne),te=e(882),t=e(22453),W=e(15127),K=e(1905),L=e(76077),I=e(13341),se=e(18809),oe=e(69163),Z=e(51034),Ee=e(3318),V=e(45753),le=e(2821),De=e(61666),we=e(74465),Y=e(91030),ge=e(71938),B=e(28879),y=e.n(B),c=e(2784),X=e(10289),Q=e(5054),R=e(45642),b=e(1433),S=e(40755),k=e(73306),m=e(72624),j=e(11283),x=e(88133),N=e(35899),z=e(36175),pe=e(84546),ie=e(5693),ye=e(92782),be={desc:"desc___OuOOf",title:"title___YBClS",table:"table___rpJMF",loading:"loading___f2q_O",configLabel:"configLabel___HO8H8"},n=e(52322),Ae=[{label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.modelModelSelection",dm:"\u6A21\u578B/\u6A21\u578B\u9009\u62E9"}),code:"modelSelect"},{label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.modelParameterConfigurationTemperatureCoefficient",dm:"\u6A21\u578B/\u53C2\u6570\u914D\u7F6E/\u6E29\u5EA6\u7CFB\u6570"}),code:"temperature"},{label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.modelParameterConfigurationMaxReplyLength",dm:"\u6A21\u578B/\u53C2\u6570\u914D\u7F6E/\u6700\u957F\u56DE\u590D\u957F\u5EA6"}),code:"maxTokens"},{label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.modelParameterConfigurationContextTurns",dm:"\u6A21\u578B/\u53C2\u6570\u914D\u7F6E/\u643A\u5E26\u4E0A\u4E0B\u6587\u8F6E\u6570"}),code:"dialogRound"},{label:"Prompt",code:"instructions"},{label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.knowledgeRetrievalEnhancementSwitch",dm:"\u77E5\u8BC6\u68C0\u7D22\u589E\u5F3A\u5F00\u5173"}),code:"enableSearch"},{label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.knowledgeRetrievalEnhancementSelectedKnowledgeBase",dm:"\u77E5\u8BC6\u68C0\u7D22\u589E\u5F3A/\u6240\u9009\u77E5\u8BC6\u5E93"}),code:"knowledgeBaseCodeList"},{label:t.Z.get({id:"main.pages.Component.index.plugin",dm:"\u63D2\u4EF6"}),code:"plugins"},{label:t.Z.get({id:"main.components.MCPSelectorComp.index.mcpService",dm:"MCP\u670D\u52A1"}),code:"mcp_servers"},{label:t.Z.get({id:"main.pages.Component.index.intelligentAgent",dm:"\u667A\u80FD\u4F53"}),code:"agent_components"},{label:t.Z.get({id:"main.pages.Component.index.workflow",dm:"\u5DE5\u4F5C\u6D41"}),code:"workflow_components"}];function Ie(o){var a=(0,c.useContext)(b.H),s=a.appState,r=(0,le.Z)({loading:!0,diffList:[],publishConfig:null}),l=M()(r,2),i=l[0],v=l[1],h=function(){var g=P()(T()().mark(function E(){var C,d,D,p,_,he,ue,ce,Se,re,de,$,w,J,F,H,ae,Me;return T()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(p=o.prevConfig,_=(C=s.appBasicConfig)===null||C===void 0?void 0:C.pub_config,he=[],ue=void 0,!(_!=null&&_.model&&_.model_provider)){G.next=8;break}return G.next=7,(0,se.vu)(_.model_provider,_.model);case 7:ue=G.sent.data;case 8:return G.next=11,Xn(_==null?void 0:_.tools);case 11:he=G.sent;case 12:return G.next=14,qn((_==null||(d=_.mcp_servers)===null||d===void 0?void 0:d.map(function(ze){return ze.id}))||[]);case 14:return ce=G.sent,G.next=17,Dn(_==null?void 0:_.agent_components);case 17:return Se=G.sent,G.next=20,Dn(_==null?void 0:_.workflow_components);case 20:return re=G.sent,G.next=23,et(_==null||(D=_.file_search)===null||D===void 0?void 0:D.kb_ids);case 23:de=G.sent,$=u()(u()({},_),{},{tools:he,mcp_servers:ce,agent_components:Se,workflow_components:re,model:ue,file_search:u()(u()({},_==null?void 0:_.file_search),{},{kbs:de})}),w=[],J=p,F=$,H=T()().mark(function ze(){var qe,fe,ve,_e,me,je,We,$e,Ze,Ge,Qe,xe,Te,ke,nn,pn,Sn,jn,Zn,zn,bn,sn,cn,nt,tt,Tt,wt,Un,Fn;return T()().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:Ze=Ae[Me],Fe.t0=Ze.code,Fe.next=Fe.t0==="modelSelect"?4:Fe.t0==="instructions"?8:Fe.t0==="enableSearch"?12:Fe.t0==="knowledgeBaseCodeList"?16:Fe.t0==="plugins"?26:Fe.t0==="mcp_servers"?36:44;break;case 4:if(((qe=J.model)===null||qe===void 0?void 0:qe.model_id)!==((fe=F.model)===null||fe===void 0?void 0:fe.model_id)){Fe.next=6;break}return Fe.abrupt("return",0);case 6:return w.push({title:Ze.label,code:Ze.code,draftCfg:(ve=J.model)===null||ve===void 0?void 0:ve.name,onlineCfg:(_e=F.model)===null||_e===void 0?void 0:_e.name}),Fe.abrupt("break",45);case 8:if(J.instructions!==F.instructions){Fe.next=10;break}return Fe.abrupt("return",0);case 10:return w.push({title:Ze.label,code:Ze.code,draftCfg:J.instructions,onlineCfg:F.instructions}),Fe.abrupt("break",45);case 12:if((((me=J.file_search)===null||me===void 0?void 0:me.enable_search)||!1)!==(((je=F.file_search)===null||je===void 0?void 0:je.enable_search)||!1)){Fe.next=14;break}return Fe.abrupt("return",0);case 14:return w.push({title:Ze.label,code:Ze.code,draftCfg:(We=J.file_search)!==null&&We!==void 0&&We.enable_search?t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.enable",dm:"\u5F00\u542F"}):t.Z.get({id:"main.pages.Knowledge.Detail.components.FileList.index.close",dm:"\u5173\u95ED"}),onlineCfg:($e=F.file_search)!==null&&$e!==void 0&&$e.enable_search?t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.enable",dm:"\u5F00\u542F"}):t.Z.get({id:"main.pages.Knowledge.Detail.components.FileList.index.close",dm:"\u5173\u95ED"})}),Fe.abrupt("break",45);case 16:if(xe=[],Te=[],ke=[],nn=[],(Ge=J.file_search)===null||Ge===void 0||(Ge=Ge.kbs)===null||Ge===void 0||Ge.forEach(function(tn){xe.push(tn.kb_id),Te.push(tn.name)}),(Qe=F.file_search)===null||Qe===void 0||(Qe=Qe.kbs)===null||Qe===void 0||Qe.forEach(function(tn){ke.push(tn.kb_id),nn.push(tn.name)}),!(0,z.R)(xe,ke)){Fe.next=24;break}return Fe.abrupt("return",0);case 24:return w.push({title:Ze.label,code:Ze.code,draftCfg:Te.join("\uFF0C"),onlineCfg:nn.join("\uFF0C")}),Fe.abrupt("break",45);case 26:if(jn=[],Zn=[],zn=[],bn=[],(pn=J.tools)===null||pn===void 0||pn.forEach(function(tn){jn.push(tn.tool_id),Zn.push(tn.name)}),(Sn=F.tools)===null||Sn===void 0||Sn.forEach(function(tn){zn.push(tn.tool_id),bn.push(tn.name)}),!(0,z.R)(jn,zn)){Fe.next=34;break}return Fe.abrupt("return",0);case 34:return w.push({title:Ze.label,code:Ze.code,draftCfg:Zn.join("\uFF0C"),onlineCfg:bn.join("\uFF0C")}),Fe.abrupt("break",45);case 36:if(Tt=(sn=J.mcp_servers)===null||sn===void 0?void 0:sn.map(function(tn){return tn.server_code}),wt=(cn=F.mcp_servers)===null||cn===void 0?void 0:cn.map(function(tn){return tn.server_code}),!(0,z.R)(Tt,wt)){Fe.next=40;break}return Fe.abrupt("return",0);case 40:return Un=(nt=J.mcp_servers)===null||nt===void 0?void 0:nt.map(function(tn){return tn.name}),Fn=(tt=F.mcp_servers)===null||tt===void 0?void 0:tt.map(function(tn){return tn.name}),w.push({title:Ze.label,code:Ze.code,draftCfg:Un==null?void 0:Un.join("\uFF0C"),onlineCfg:Fn==null?void 0:Fn.join("\uFF0C")}),Fe.abrupt("break",45);case 44:return Fe.abrupt("break",45);case 45:case"end":return Fe.stop()}},ze)}),Me=0;case 30:if(!(Me<Ae.length)){G.next=38;break}return G.delegateYield(H(),"t0",32);case 32:if(ae=G.t0,ae!==0){G.next=35;break}return G.abrupt("continue",35);case 35:Me++,G.next=30;break;case 38:v({diffList:w,publishConfig:_,loading:!1});case 39:case"end":return G.stop()}},E)}));return function(){return g.apply(this,arguments)}}();(0,ie.Z)(function(){s.appStatus==="draft"||s.appStatus==="published_editing"?h():v({loading:!1})});var O=(0,c.useMemo)(function(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.adjustedConfigurationItems",dm:"\u5DF2\u8C03\u6574\u914D\u7F6E\u9879\uFF08{var1}\u4E2A\uFF09"},{var1:i.diffList.length})}),(0,n.jsx)("div",{className:be.desc,children:i.diffList.map(function(g){return g.title}).join("\u3001")})]})},[i.diffList]);return(0,n.jsx)(pe.Z,{onCancel:o.onCancel,open:!0,title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.releaseVersion",dm:"\u53D1\u5E03\u7248\u672C"}),width:981,footer:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{onClick:o.onCancel,children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.cancelPublish",dm:"\u53D6\u6D88\u53D1\u5E03"})}),(0,n.jsx)(m.Z,{onClick:function(){return o.onOk()},type:"primary",children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.confirmPublish",dm:"\u786E\u8BA4\u53D1\u5E03"})})]}),children:i.loading?(0,n.jsx)(we.Z,{className:be.loading,spinning:!0}):(0,n.jsxs)(n.Fragment,{children:[O,(s.appStatus==="draft"||s.appStatus==="published_editing")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:be.title,children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.modificationDetails",dm:"\u4FEE\u6539\u8BE6\u60C5"})}),(0,n.jsx)("div",{className:be.table,children:(0,n.jsx)(ye.Z,{columns:[{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.configurationItem",dm:"\u914D\u7F6E\u9879"}),dataIndex:"title",width:240},{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.publishedVersion",dm:"\u5DF2\u53D1\u5E03\u7248\u672C"}),dataIndex:"onlineCfg",render:function(E){return(0,n.jsx)("span",{className:be.configLabel,children:E})}},{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppConfigDiffModal.index.pendingPublishVersion",dm:"\u5F85\u53D1\u5E03\u7248\u672C"}),dataIndex:"draftCfg",render:function(E){return(0,n.jsx)("span",{className:be.configLabel,children:E})}}],dataSource:i.diffList,scroll:{y:320},pagination:{hideOnSinglePage:!0,current:1,pageSize:i.diffList.length,total:i.diffList.length}})})]})]})})}var Je=e(75438),Be={desc:"desc___t_H1a",scaleBtn:"scaleBtn___J9QDm",confirmWrap:"confirmWrap___AC0zT",info:"info___K6SKg",warnIcon:"warnIcon___mdTbq",tipText:"tipText___nOTW3",confirmFooter:"confirmFooter___MAY5v",actions:"actions___tfW0G",checkWrap:"checkWrap___HhKTn"};function Ve(o){var a,s,r=o.activeKey,l=(0,c.useContext)(b.H),i=l.appState,v=l.setAppState,h=l.appCode,O=l.refreshAppDetail,g=(0,le.Z)({visible:!1,tip:"",code:"",checked:!1,showDiffModal:!1,showSuccess:!1}),E=M()(g,2),C=E[0],d=E[1],D=function(){d({showDiffModal:!1})},p=function(){h&&(0,K.b1)(h).then(function(){O(),d({showSuccess:!0}),v({autoSaveTime:"",appStatus:"published",historyRefreshCount:i.historyRefreshCount+1}),D()})},_=function(){d({showDiffModal:!0})},he=function(){var $=P()(T()().mark(function w(){var J,F;return T()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(F=i.appBasicConfig,F!=null&&(J=F.name)!==null&&J!==void 0&&J.trim()){ae.next=4;break}return x.ZP.warning(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.enterApplicationName",dm:"\u8BF7\u586B\u5199\u5E94\u7528\u540D\u79F0"})),ae.abrupt("return");case 4:_();case 5:case"end":return ae.stop()}},w)}));return function(){return $.apply(this,arguments)}}(),ue=function(){if(i.appBasicConfig){var w=i.appBasicConfig.config;if(!w.model){x.ZP.warning(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.selectModel",dm:"\u8BF7\u9009\u62E9\u6A21\u578B\uFF01"}));return}var J=w.file_search,F=w.instructions;if(J!=null&&J.enable_search){var H,ae;if(!F||((H=F.match(/\${documents}/g))===null||H===void 0?void 0:H.length)!==1){x.ZP.warning(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.knowledgeRetrievalEnhancementFunctionNotFilledOrMultipleVariables",dm:"\u60A8\u5F00\u542F\u4E86\u3010\u77E5\u8BC6\u68C0\u7D22\u589E\u5F3A\u3011\u529F\u80FD\uFF0C\u4F46\u5728Prompt\u4E2D\u672A\u586B\u5199\u6216\u8005\u586B\u5199\u4E86\u591A\u4E2A${documents}\u53D8\u91CF\uFF0C\u4E3A\u4E86\u4FDD\u8BC1\u6548\u679C\uFF0C\u8BF7\u4FDD\u8BC1Prompt\u4E2D\u53EA\u51FA\u73B0\u4E00\u6B21"}));return}if(!((ae=J.kbs)!==null&&ae!==void 0&&ae.length)){d({visible:!0,tip:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.knowledgeRetrievalEnhancementNotAddedKnowledgeBase",dm:"\u5DF2\u5F00\u542F\u77E5\u8BC6\u68C0\u7D22\u589E\u5F3A\uFF0C\u4F46\u672A\u6DFB\u52A0\u77E5\u8BC6\u5E93\uFF0C\u68C0\u7D22\u589E\u5F3A\u4E0D\u4F1A\u751F\u6548\u3002\u662F\u5426\u786E\u5B9A\u53D1\u5E03\uFF1F"}),code:"no_select_knowledge_tip"});return}}he()}},ce=function(){d({visible:!1,checked:!1,code:""})},Se=function(){ce(),he()},re=function(){x.ZP.info(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.notImplementedYet",dm:"\u6682\u672A\u5B9E\u73B0"}))},de=function(w){v({activeKey:"share"}),d({showSuccess:!1}),w==="comp"&&S.e.emit("openCompCfg")};return(0,n.jsxs)(Y.Z,{align:"center",justify:"flex-end",gap:8,children:[r==="config"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.Z,{trigger:"hover",title:i.flushing?t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.dialogProcessingProhibitedSwitchVersion",dm:"\u5BF9\u8BDD\u8FDB\u884C\u4E2D\uFF0C\u7981\u6B62\u5207\u6362\u7248\u672C"}):t.Z.get({id:"main.components.HistoryPanel.index.historyVersion",dm:"\u5386\u53F2\u7248\u672C"}),children:(0,n.jsx)(m.Z,{iconType:"spark-auditLog-line",onClick:function(){v(function(w){return{showHistoryPanel:!w.showHistoryPanel}})},disabled:i.flushing,children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.versionManagement",dm:"\u7248\u672C\u7BA1\u7406"})})}),i.selectedVersion==="draft"?(0,n.jsx)(j.Z,{onOpenChange:function(w){w||ce()},overlayClassName:Be.confirmWrap,trigger:["click"],open:C.visible,content:(0,n.jsxs)("div",{className:Be.info,children:[(0,n.jsx)(V.Z,{className:Be.warnIcon,type:"spark-warningCircle-line"}),(0,n.jsxs)("div",{className:Be.tipContent,children:[(0,n.jsx)("div",{className:Be.tipText,children:C.tip}),(0,n.jsxs)("div",{className:Be.confirmFooter,children:[(0,n.jsxs)("span",{className:Be.checkWrap,children:[(0,n.jsx)(N.Z,{onChange:function(w){return d({checked:w.target.checked})},checked:C.checked}),t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.dontPromptAgain",dm:"\u4E0D\u518D\u63D0\u793A"})]}),(0,n.jsxs)("div",{className:Be.actions,children:[(0,n.jsx)(m.Z,{onClick:function(){return ce()},children:t.Z.get({id:"main.pages.Setting.ModelService.components.ProviderInfoForm.index.cancel",dm:"\u53D6\u6D88"})}),(0,n.jsx)(m.Z,{type:"primary",onClick:function(){return Se()},children:t.Z.get({id:"main.pages.App.Workflow.index.index.publish",dm:"\u53D1\u5E03"})})]})]})]})]}),rootClassName:Be.confirmWrap111,children:(0,n.jsx)(m.Z,{iconType:"spark-send-line",onClick:function(){ue()},type:"primary",children:t.Z.get({id:"main.pages.App.Workflow.index.index.publish",dm:"\u53D1\u5E03"})})}):(0,n.jsx)(m.Z,{icon:(0,n.jsx)(V.Z,{type:"spark-processOutput-line"}),onClick:P()(T()().mark(function $(){return T()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(h){J.next=2;break}return J.abrupt("return");case 2:v({selectedVersion:"draft",isReleaseVersion:!1}),x.ZP.success(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.returnedToCurrentVersion",dm:"\u5DF2\u56DE\u5230\u5F53\u524D\u7248\u672C"}));case 4:case"end":return J.stop()}},$)})),children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AppActions.index.returnToCurrentVersion",dm:"\u56DE\u5230\u5F53\u524D\u7248\u672C"})})]}),C.showDiffModal&&h&&((a=i.appBasicConfig)===null||a===void 0?void 0:a.config)&&(0,n.jsx)(Ie,{handleReset:re,prevConfig:(s=i.appBasicConfig)===null||s===void 0?void 0:s.config,code:h,onOk:p,onCancel:D}),C.showSuccess&&(0,n.jsx)(Je.Z,{onClickAction:de,onClose:function(){return d({showSuccess:!1})}})]})}var Re=e(30332),He=e(19110),en=e(62603),Le=e(91569),mn=e(12524),Ye=e.n(mn),vn=e(28245),Xe=e(95641),on=e(69045),ln=e(81596),Ue=e(49616),Oe=e.n(Ue),an=e(87329),Ne=e.n(an),gn=e(65803),wn=e(95559),hn=e(4513),Mt=e(9454),_n={checkItem:"checkItem____8i1z",selected:"selected___sL0F4",desc:"desc___WJYk1",title:"title___EEFPT",footerDesc:"footerDesc___PFDck",search:"search___huPP4"},Nt=["isSelected"],kt=function(a){return(0,n.jsxs)(Y.Z,{className:Ye()(_n.checkItem,Ne()({},_n.selected,a.selected)),onClick:function(){a.onChange(!a.selected)},align:"center",gap:8,children:[(0,n.jsx)(N.Z,{checked:a.selected}),(0,n.jsx)("img",{src:gn.ek[a.data.type],alt:""}),(0,n.jsxs)("div",{className:"flex-1 w-1",children:[(0,n.jsx)(Y.Z,{align:"center",gap:8,children:(0,n.jsx)("div",{className:_n.title,children:a.data.name})}),(0,n.jsx)(ge.Z.Text,{ellipsis:{tooltip:a.data.description},className:_n.desc,children:a.data.description})]})]})};function at(o){var a=o.maxLength,s=a===void 0?10:a,r=(0,c.useState)(o.selected),l=M()(r,2),i=l[0],v=l[1],h=(0,le.Z)({list:[],loading:!0,total:0,size:10,current:1,name:""}),O=M()(h,2),g=O[0],E=O[1],C=(0,c.useRef)(!1),d=(0,c.useMemo)(function(){return o.type===W.zd.AGENT?t.Z.get({id:"main.components.ComponentSelectorDrawer.index.selectAgent",dm:"\u9009\u62E9\u667A\u80FD\u4F53"}):t.Z.get({id:"main.components.ComponentSelectorDrawer.index.selectWorkflow",dm:"\u9009\u62E9\u5DE5\u4F5C\u6D41"})},[o.type]),D=(0,c.useMemo)(function(){return(0,n.jsxs)(Y.Z,{className:"w-full",justify:"space-between",align:"center",children:[(0,n.jsxs)("span",{className:_n.footerDesc,children:[o.type===W.zd.AGENT?t.Z.get({id:"main.components.ComponentSelectorDrawer.index.addedAgents",dm:"\u5DF2\u6DFB\u52A0\u667A\u80FD\u4F53\u6570\uFF1A"}):t.Z.get({id:"main.components.ComponentSelectorDrawer.index.addedWorkflows",dm:"\u5DF2\u6DFB\u52A0\u5DE5\u4F5C\u6D41\u6570\uFF1A"}),i.length||0," / ",s]}),(0,n.jsxs)(Y.Z,{align:"center",gap:12,children:[(0,n.jsx)(m.Z,{onClick:o.onClose,children:t.Z.get({id:"main.components.ComponentSelectorDrawer.index.cancel",dm:"\u53D6\u6D88"})}),(0,n.jsx)(m.Z,{type:"primary",onClick:function(){return o.onSelect(i)},children:t.Z.get({id:"main.components.ComponentSelectorDrawer.index.confirm",dm:"\u786E\u8BA4"})})]})]})},[i,s]),p=function(){var re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},de=C.current?{name:g.name}:{};(0,W.l9)(u()(u()({current:g.current,size:g.size,type:o.type,app_code:o.appCode},re),de)).then(function($){E({list:$.records,total:$.total,loading:!1})})},_=function(){C.current=!0,E({current:1}),p({current:1})};(0,ie.Z)(function(){p()});var he=(0,c.useMemo)(function(){return g.list.map(function(Se){return u()(u()({},Se),{},{isSelected:i.some(function(re){return re.code===Se.code})})})},[g.list,i]),ue=function(re,de){if(re){if(i.length>=s){x.ZP.warning(t.Z.get({id:"main.components.ComponentSelectorDrawer.index.agentLimit",dm:"{var1}\u7EC4\u4EF6\u6570\u91CF\u5DF2\u8FBE\u4E0A\u9650"},{var1:ce}));return}v([].concat(Oe()(i),[de]))}else v(i.filter(function($){return $.code!==de.code}))},ce=(0,c.useMemo)(function(){return o.type===W.zd.AGENT?t.Z.get({id:"main.components.ComponentSelectorDrawer.index.agent",dm:"\u667A\u80FD\u4F53"}):t.Z.get({id:"main.components.ComponentSelectorDrawer.index.workflow",dm:"\u5DE5\u4F5C\u6D41"})},[o.type]);return(0,n.jsx)(wn.Z,{width:640,onClose:o.onClose,footer:D,open:!0,title:d,children:(0,n.jsxs)(Y.Z,{className:"h-full",vertical:!0,gap:16,children:[(0,n.jsxs)(Y.Z,{justify:"space-between",align:"center",children:[(0,n.jsx)(hn.Z.Search,{className:_n.search,placeholder:t.Z.get({id:"main.components.ComponentSelectorDrawer.index.searchComponent",dm:"\u641C\u7D22\u7EC4\u4EF6\u540D\u79F0"}),value:g.name,onChange:function(re){return E({name:re.target.value})},onSearch:_}),(0,n.jsxs)(m.Z,{icon:(0,n.jsx)(V.Z,{type:"spark-plus-line"}),onClick:function(){window.open("/component/".concat(o.type===W.zd.AGENT?"agent":"flow"))},children:[t.Z.get({id:"main.components.ComponentSelectorDrawer.index.create",dm:"\u521B\u5EFA"}),ce,t.Z.get({id:"main.components.ComponentSelectorDrawer.index.component",dm:"\u7EC4\u4EF6"})]})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:g.loading?(0,n.jsx)(we.Z,{className:"loading-center",spinning:!0}):g.list.length?(0,n.jsx)(Y.Z,{vertical:!0,gap:16,children:he.map(function(Se){var re=Se.isSelected,de=q()(Se,Nt);return(0,n.jsx)(kt,{onChange:function(w){return ue(w,de)},selected:re,data:de},de.code)})}):(0,n.jsx)("div",{className:"loading-center",children:(0,n.jsx)(Z.Z,{title:C.current?t.Z.get({id:"main.components.ComponentSelectorDrawer.index.noSearchResult",dm:"\u672A\u641C\u7D22\u5230{var1}\u7EC4\u4EF6"},{var1:ce}):t.Z.get({id:"main.components.ComponentSelectorDrawer.index.noComponents",dm:"\u6682\u65E0{var1}\u7EC4\u4EF6"},{var1:ce}),description:C.current?t.Z.get({id:"main.components.ComponentSelectorDrawer.index.tryAnotherSearch",dm:"\u6362\u4E2A\u641C\u7D22\u6761\u4EF6\u8BD5\u8BD5"}):t.Z.get({id:"main.pages.App.Workflow.components.ComponentSelectorModal.index.index.goToComponentManagementPageCreate",dm:"\u8BF7\u524D\u5F80\u7EC4\u4EF6\u7BA1\u7406\u9875\u9762\u8FDB\u884C\u7EC4\u4EF6\u521B\u5EFA"}),children:!C.current&&(0,n.jsx)(m.Z,{type:"primary",className:"mt-4",onClick:function(){window.open("/component/".concat(o.type===W.zd.AGENT?"agent":"flow"))},children:t.Z.get({id:"main.components.ComponentSelectorDrawer.index.goToCreate",dm:"\u524D\u5F80\u521B\u5EFA"})})})})}),(0,n.jsx)(Mt.Z,{hideOnSinglePage:!0,pageSize:g.size,current:g.current,total:g.total,onChange:function(re,de){E({current:re,size:de}),p({current:re,size:de})}})]})})}var Ln=e(90390),it={expandBtn:"expandBtn___lqp3G",hidden:"hidden___Hp7o5"},st=He.Z.agentAgentComponentMaxLimit;function Dt(){var o,a=(0,c.useContext)(b.H),s=a.appState,r=a.onAppConfigChange,l=a.appCode,i=((o=s.appBasicConfig)===null||o===void 0?void 0:o.config)||{},v=i.agent_components,h=v===void 0?[]:v,O=(0,le.Z)({expand:!1,selectVisible:!1}),g=M()(O,2),E=g[0],C=g[1],d=function(_){r({agent_components:_}),C({selectVisible:!1})};(0,c.useEffect)(function(){h.length&&C({expand:!0})},[h]);var D=function(_){d(h.filter(function(he){return he.code!==_}))};return(0,n.jsxs)(Y.Z,{vertical:!0,gap:6,className:"mb-[20px]",children:[(0,n.jsxs)(Y.Z,{justify:"space-between",children:[(0,n.jsxs)(Y.Z,{gap:8,className:"text-[13px] font-medium leading-[20px]",style:{color:"var(--ag-ant-color-text-base)"},align:"center",children:[(0,n.jsxs)(Y.Z,{align:"center",children:[(0,n.jsx)("span",{children:t.Z.get({id:"main.pages.Component.index.intelligentAgent",dm:"\u667A\u80FD\u4F53"})}),(0,n.jsx)(on.Z,{content:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AgentCompSelector.index.configuredAgentApplicationCanBePublishedAsAgentComponent",dm:"\u914D\u7F6E\u597D\u7684\u667A\u80FD\u4F53\u5E94\u7528\u53EF\u53D1\u5E03\u4E3A\u667A\u80FD\u4F53\u7EC4\u4EF6\uFF0C\u4ECE\u800C\u5B9E\u73B0\u7279\u5B9A\u573A\u666F\u4E0B\u7684\u667A\u80FD\u5904\u7406\u3002"})})]}),(0,n.jsxs)("span",{className:"text-[12px] leading-[20px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:[h.length,"/",st]})]}),(0,n.jsxs)("span",{children:[(0,n.jsx)(m.Z,{style:{padding:0},onClick:function(){return C({selectVisible:!0})},iconType:"spark-plus-line",type:"text",size:"small",children:t.Z.get({id:"main.pages.Component.index.intelligentAgent",dm:"\u667A\u80FD\u4F53"})}),(0,n.jsx)(ln.Z,{type:"vertical",className:"ml-[16px] mr-[16px]"}),(0,n.jsx)(V.Z,{onClick:function(){return C({expand:!E.expand})},className:Ye()(it.expandBtn,!E.expand&&it.hidden),type:"spark-up-line",isCursorPointer:!0})]})]}),E.expand&&(0,n.jsx)(Y.Z,{vertical:!0,gap:8,children:h.map(function(p){return p&&(0,n.jsx)(Ln.Z,{iconType:"spark-dataAugmentation-line",name:p.name,rightArea:(0,n.jsx)(V.Z,{type:"spark-delete-line",isCursorPointer:!0,onClick:function(){D(p.code)}})},p.code)})}),E.selectVisible&&(0,n.jsx)(at,{maxLength:st,selected:h,onClose:function(){C({selectVisible:!1})},type:W.zd.AGENT,onSelect:d,appCode:l||""})]})}var ot=e(42991),Bn=e(92748),rt=e(90257),Lt=e(74573),Bt=e(66520),Ot=e(96100),rn=(0,Ot.n)("bailian-prompt-editor"),un={promptEditor:"promptEditor___YVoIn",noHead:"noHead___GSA_d",editorContent:"editorContent___IwJnc",loading:"loading___Q4pk6",loadingIcon:"loadingIcon___P15vH",header:"header___jg5eg",tag:"tag___e7RLh",disabled:"disabled____JR4R",footer:"footer___AHmwm",right:"right___Q6N73",popover:"popover___G67oW",popoverCon:"popoverCon___fxMWZ",copyBtn:"copyBtn___d4mWX"},Wt=(0,c.forwardRef)(function(o,a){var s,r=en.ZP.useConfig(),l=r.componentDisabled,i=o.variables,v=o.bindId,h=(0,le.Z)({expand:!1,items:[],visibleCount:0}),O=M()(h,2),g=O[0],E=O[1],C=(0,c.useRef)(null),d=(0,c.useRef)(null),D=(0,c.useCallback)(function(re){var de;if(C.current){if("${".concat(re,"}").length>o.maxTokenContext){x.ZP.warning(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.editor.maxInputCharacters",dm:"\u6700\u591A\u53EF\u8F93\u5165{var1}\u5B57"},{var1:o.maxTokenContext}));return}(de=C.current)===null||de===void 0||de._insertNodes({type:"var",label:"label",code:re,children:[{text:""}]})}},[]),p=function(de){var $;($=C.current)===null||$===void 0||$._setEditorContentByStr(de),o.setPrompt(de)};(0,c.useImperativeHandle)(a,function(){return{setEditorCon:p}});var _=(0,c.useCallback)(function(re,de){var $=32;if(de.length<2)return 0;for(var w=de[0].offsetWidth,J=0,F=1;F<de.length;F++)if(!de[F].classList.contains("dropdown-menu-trigger")){var H=de[F].currentStyle||window.getComputedStyle(de[F]),ae=de[F].offsetWidth+parseFloat(H.marginRight);if(w+ae+$>re.offsetWidth)break;w+=ae,J++}return Math.min(J,i.length)},[i]),he=(0,c.useCallback)(function(re){return o.prompt?o.prompt.includes(re):!1},[o.prompt]),ue=(0,c.useCallback)(function(){if(!d.current){setTimeout(function(){ue()},100);return}var re=d.current,de=Array.from(re.children),$=_(re,de);if($<i.length){var w=i.slice($).map(function(J){return{key:J.code,label:J.label,disabled:he(J.label),onClick:function(){D(J.code)}}});E({items:w,visibleCount:$})}else E({items:[],visibleCount:i.length})},[i,he,D,_]),ce=(0,c.useCallback)((0,Bt.Z)(ue,50),[ue]);(0,c.useEffect)(function(){g.items.length!==0&&E(function(re){return{items:re.items.map(function(de){return u()(u()({},de),{},{disabled:he(de.label)})})}})},[o.prompt]),(0,c.useLayoutEffect)(function(){var re=new ResizeObserver(ce);return d.current&&re.observe(d.current),function(){d.current&&re.unobserve(d.current)}},[ce]),(0,ie.Z)(function(){v==="main"&&(rn.on("insertPromptFragment",function(re){var de,$;(de=C.current)===null||de===void 0||($=de._insertFragment)===null||$===void 0||$.call(de,re,!0)}),rn.on("setEditorCon",p))}),(0,ot.Z)(function(){v==="main"&&rn.removeAllListeners()});var Se=function(de,$){var w=he(de.label)||l;return(0,n.jsx)(Bn.Z,{color:w?"mauve":"purple",onClick:function(){w||$||D(de.code)},className:Ye()(un.tag,Ne()({},un.disabled,w)),style:{visibility:$?"hidden":"visible",position:$?"absolute":"static",pointerEvents:$?"none":"auto"},children:de.label},$?"hidden-".concat(de.code):de.code)};return(0,c.useEffect)(function(){ue()},[i]),(0,n.jsxs)(Y.Z,{className:Ye()(un.promptEditor,Ne()(Ne()({},un.expanded,g.expand),un.noHead,!i.length)),vertical:!0,children:[!!i.length&&(0,n.jsxs)("div",{className:un.header,ref:d,children:[(0,n.jsx)("span",{className:un.desc,children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.editor.introduceVariables",dm:"\u53EF\u5F15\u5165{var1}\u9879\u53D8\u91CF\uFF08\u53EF\u901A\u8FC7\u70B9\u51FB\u6DFB\u52A0\uFF09\uFF1A"},{var1:i.length})}),i.slice(0,g.visibleCount).map(function(re){return Se(re,!1)}),g.items.length>0&&(0,n.jsx)(rt.Z,{menu:{items:g.items},className:"dropdown-menu-trigger",children:(0,n.jsx)(Bn.Z,{color:"mauve",className:"px-[3px]",children:(0,n.jsx)(V.Z,{type:"spark-more-line",size:"small"})})}),i.slice(g.visibleCount).map(function(re){return Se(re,!0)})]}),(0,n.jsx)("div",{className:"overflow-y-auto m-[12px_0]",children:(0,n.jsx)(Lt.Z,{disabled:l,ref:C,value:o.prompt,onChange:function(de){o.setPrompt(de||"")},wordLimit:o.maxTokenContext,renderVarLabel:function(de){return"${".concat(de,"}")},placeholder:t.Z.get({id:"work-station-app.pages.App.AssistantAppEdit.components.AssistantPromptEditor.editor.writeSystemPromptIncludingRoleSettingTaskObjectiveAbilityAndReplyRequirements",dm:"\u5728\u8FD9\u91CC\u7F16\u5199\u7CFB\u7EDF\u63D0\u793A\u8BCD\uFF0C\u5305\u62EC\u89D2\u8272\u8BBE\u5B9A\u3001\u4EFB\u52A1\u76EE\u6807\u3001\u5177\u5907\u7684\u80FD\u529B\u53CA\u56DE\u590D\u7684\u8981\u6C42\u4E0E\u9650\u5236\u7B49\uFF0C\u597D\u7684\u63D0\u793A\u8BCD\u4F1A\u76F4\u63A5\u5F71\u54CD\u667A\u80FD\u4F53\u6548\u679C"})})}),(0,n.jsxs)("div",{className:Ye()("text-[12px] leading-[20px] w-full text-right"),style:{color:"var(--ag-ant-color-text-quaternary)"},children:[(s=o.prompt)===null||s===void 0?void 0:s.length,"\xA0/\xA0",o.maxTokenContext]})]})}),xn=e(58541),It=e(98022),lt=e.n(It),En={variablesWrapper:"variablesWrapper___NPe6h",form:"form___Hf005",expandBtn:"expandBtn___bO9bo",hidden:"hidden___asNAJ"},Vt=function(o){var a,s=o.variables,r=(0,c.useContext)(b.H),l=r.appState,i=r.onAppConfigChange,v=((a=l.appBasicConfig)===null||a===void 0?void 0:a.config.prompt_variables)||[],h=(0,c.useState)(!0),O=M()(h,2),g=O[0],E=O[1],C=(0,c.useState)([]),d=M()(C,2),D=d[0],p=d[1],_=(0,c.useState)([]),he=M()(_,2),ue=he[0],ce=he[1],Se=(0,c.useState)(!1),re=M()(Se,2),de=re[0],$=re[1];(0,c.useEffect)(function(){!de&&l.hasInitData&&(v!=null&&v.length)&&(p(v.map(function(H){return u()(u()({},H),{},{key:lt()(8)})})),ce(new Array(v.length).fill({name:{help:""}})),$(!0))},[l.hasInitData,v,de]);var w=function(ae){var Me=D.filter(function(ze,qe){return qe!==ae}),Pe=ue.filter(function(ze,qe){return qe!==ae});p(Me),ce(Pe);var G=Me.filter(function(ze,qe){var fe,ve;return!!((fe=ze.name)!==null&&fe!==void 0&&fe.length)&&((ve=Pe[qe].name)===null||ve===void 0?void 0:ve.validateStatus)!=="error"});i({prompt_variables:G})},J=function(ae,Me,Pe){if(Me==="name"){var G=Oe()(ue);if(!/^[a-zA-Z0-9]*$/.test(Pe)){G[ae].name.validateStatus="error",G[ae].name.help=t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.Variables.index.variableNameOnlyContainsEnglishAndNumbers",dm:"\u53D8\u91CF\u540D\u53EA\u80FD\u5305\u542B\u82F1\u6587\u548C\u6570\u5B57"}),ce(G);return}if(!Pe.length)G[ae].name.validateStatus="error",G[ae].name.help=t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.Variables.index.variableNameCannotBeEmpty",dm:"\u53D8\u91CF\u540D\u4E0D\u80FD\u4E3A\u7A7A"}),ce(G);else{var ze=new Set;s.forEach(function(qe){ze.add(qe.code)}),ze.has(Pe)?(G[ae].name.validateStatus="error",G[ae].name.help=t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.Variables.index.variableNameCannotRepeat",dm:"\u53D8\u91CF\u540D\u4E0D\u80FD\u91CD\u590D"}),ce(G)):(G[ae].name.validateStatus=void 0,G[ae].name.help="",ce(G))}}p(function(qe){return qe.map(function(fe,ve){return ve===ae?u()(u()({},fe),{},Ne()({},Me,Pe)):fe})})},F=function(){var ae=D.filter(function(Me,Pe){var G,ze;return!!((G=Me.name)!==null&&G!==void 0&&G.length)&&((ze=ue[Pe].name)===null||ze===void 0?void 0:ze.validateStatus)!=="error"});i({prompt_variables:ae})};return(0,n.jsxs)("div",{className:"mb-[20px]",children:[(0,n.jsxs)(Y.Z,{justify:"space-between",children:[(0,n.jsx)(Y.Z,{gap:8,align:"center",className:En.title,children:(0,n.jsx)("span",{className:"text-[13px] text-medium leading-[20px]",style:{color:"var(--ag-ant-color-text)"},children:t.Z.get({id:"main.pages.App.Workflow.nodes.VariableHandle.schema.variable",dm:"\u53D8\u91CF"})})}),(0,n.jsxs)(Y.Z,{gap:16,align:"center",className:En.actions,children:[(0,n.jsx)(m.Z,{style:{padding:0},size:"small",type:"text",iconType:"spark-plus-line",onClick:function(){p(function(ae){return[].concat(Oe()(ae),[{description:"",name:"",default_value:"",key:lt()(8),type:"string"}])}),ce(function(ae){return[].concat(Oe()(ae),[{name:{help:""}}])}),E(!0)},children:t.Z.get({id:"main.pages.App.Workflow.nodes.Start.panel.customVariables",dm:"\u81EA\u5B9A\u4E49\u53D8\u91CF"})}),(0,n.jsx)(ln.Z,{type:"vertical"}),(0,n.jsx)(V.Z,{onClick:function(){return E(function(ae){return!ae})},className:Ye()(En.expandBtn,!g&&En.hidden),type:"spark-up-line"})]})]}),g&&!!D.length&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-[12px] text-normal leading-[24px] mt-[4px] mb-[8px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:[t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.Variables.index.canBeFilledThroughParameterFormOr",dm:"\u53EF\u901A\u8FC7\u5165\u53C2\u53D8\u91CF\u8868\u5355\u586B\u5199\uFF0C\u6216"}),(0,n.jsx)(Bn.Z,{color:"mauve",style:{marginInlineStart:"var(--ag-ant-margin-xs)"},children:"biz_params"}),t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.Variables.index.fieldPassage",dm:"\u5B57\u6BB5\u4F20\u9012\uFF0C\u4F20\u5165\u53D8\u91CF\u503C\u5C06\u66FF\u6362\u63D0\u793A\u8BCD\u4E2D\u5BF9\u5E94\u7684\u53D8\u91CF\u4F4D\u7F6E\u3002"})]}),(0,n.jsx)("div",{className:En.variablesWrapper,children:(0,n.jsxs)(Y.Z,{vertical:!0,gap:8,children:[(0,n.jsxs)(Y.Z,{style:{width:"100%"},gap:8,children:[(0,n.jsx)("div",{className:"text-[12px] text-normal leading-[20px]",style:{flex:3,color:"var(--ag-ant-color-text-secondary)"},children:t.Z.get({id:"main.pages.App.Workflow.components.IteratorVariableForm.index.variableName",dm:"\u53D8\u91CF\u540D"})}),(0,n.jsx)("div",{className:"text-[12px] text-normal leading-[20px]",style:{flex:5,color:"var(--ag-ant-color-text-secondary)"},children:t.Z.get({id:"main.pages.App.Workflow.components.ExtractParamEditModal.index.description",dm:"\u63CF\u8FF0"})}),(0,n.jsx)("div",{className:"text-[12px] text-normal leading-[20px]",style:{flex:2,color:"var(--ag-ant-color-text-secondary)"},children:t.Z.get({id:"main.pages.Component.AppComponent.components.InputParamsComp.index.defaultValue",dm:"\u9ED8\u8BA4\u503C"})})]}),(0,n.jsx)(xn.Z,{className:En.form,children:D.map(function(H,ae){var Me,Pe;return(0,n.jsxs)(Y.Z,{style:{width:"100%"},gap:8,children:[(0,n.jsx)("div",{className:"text-[12px] text-normal leading-[20px]",style:{flex:3,color:"var(--ag-ant-color-text-secondary)"},children:(0,n.jsx)(xn.Z.Item,{validateStatus:(Me=ue[ae])===null||Me===void 0?void 0:Me.name.validateStatus,help:(Pe=ue[ae])===null||Pe===void 0?void 0:Pe.name.help,children:(0,n.jsx)(hn.Z,{value:H.name,onBlur:function(){F()},onPressEnter:function(){F()},onChange:function(ze){J(ae,"name",ze.target.value)}})})}),(0,n.jsx)("div",{className:"text-[12px] text-normal leading-[20px]",style:{flex:5,color:"var(--ag-ant-color-text-secondary)"},children:(0,n.jsx)(xn.Z.Item,{children:(0,n.jsx)(hn.Z,{value:H.description,onBlur:function(){F()},onPressEnter:function(){F()},onChange:function(ze){J(ae,"description",ze.target.value)}})})}),(0,n.jsx)("div",{className:"text-[12px] text-normal leading-[20px]",style:{flex:2,color:"var(--ag-ant-color-text-secondary)"},children:(0,n.jsxs)(Y.Z,{gap:8,align:"center",children:[(0,n.jsx)(xn.Z.Item,{children:(0,n.jsx)(hn.Z,{value:H.default_value,onBlur:function(){F()},onPressEnter:function(){F()},onChange:function(ze){J(ae,"default_value",ze.target.value)}})}),(0,n.jsx)(V.Z,{className:"mb-[16px]",onClick:function(){return w(ae)},type:"spark-delete-line",isCursorPointer:!0})]})})]},H.key)})})]})})]})]})};function Rt(o){var a=o.prompt,s=a===void 0?"":a,r=o.appBasicConfig,l=(0,c.useRef)(null),i=(0,c.useRef)(s),v=(0,c.useState)([]),h=M()(v,2),O=h[0],g=h[1];(0,c.useEffect)(function(){i.current=s},[s]);var E=(r==null?void 0:r.config)||{},C=E.prompt_variables,d=(0,c.useMemo)(function(){var ue=O.map(function(re){return{label:"${".concat(re.label,"}"),code:re.code}}),ce=(r==null?void 0:r.config)||{},Se=ce.file_search;return Se!=null&&Se.enable_search&&ue.push({label:"${documents}",code:"documents"}),ue},[r,O]),D=function(){var ce,Se=(ce=l.current)===null||ce===void 0?void 0:ce.getSSML();rn.setValue("getEditorValue",Se)},p=function(ce){var Se;(Se=l.current)===null||Se===void 0||Se.setEditorCon(ce)},_=(0,c.useCallback)(function(){var ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];g(ue)},[g]);(0,ie.Z)(function(){p(s),rn.on("getEditorValue",D),rn.on("setEditorValue",p),rn.on("userDefinedVariablesChange",_)}),(0,ot.Z)(function(){rn.removeListener("getEditorValue",D),rn.removeListener("setEditorValue",p),rn.removeListener("userDefinedVariablesChange",_)}),(0,c.useEffect)(function(){rn.setValue("getVariables",d)},[d]);var he=function(ce){i.current!==ce&&(i.current=ce,o.changePrompt(ce))};return(0,c.useEffect)(function(){g((C==null?void 0:C.map(function(ue){return{label:ue.name,code:ue.name}}))||[])},[C]),(0,n.jsxs)("div",{className:Ye()(o.className,un.formItem,un[o.size||""]),children:[(0,n.jsx)(Y.Z,{className:Ye()(un.label,"mb-[6px]"),justify:"space-between",children:(0,n.jsx)("div",{className:"text-[13px] font-medium leading-[20px]",style:{color:"var(--ag-ant-color-text)"},children:t.Z.get({id:"main.pages.MCP.Detail.promptWords",dm:"\u63D0\u793A\u8BCD"})})}),(0,n.jsx)(Wt,{prompt:o.prompt,setPrompt:he,ref:l,variables:d,maxTokenContext:o.maxTokenContext,bindId:"main"}),(0,n.jsx)("div",{className:"text-[12px] font-normal leading-[24px] mt-[4px] mb-[24px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantPromptEditor.index.variablesOptionsComeFromBelowVariableConfiguration",dm:"\u63D0\u793A\u8BCD\u4E2D\u53D8\u91CF\u7684\u9009\u9879\u6765\u81EA\u4E0B\u65B9\u201C\u53D8\u91CF\u914D\u7F6E\u201D\uFF0C\u5982\u9700\u65B0\u589E\u8BF7\u5728\u4E0B\u65B9\u64CD\u4F5C"})}),(0,n.jsx)(Vt,{variables:d,userDefinedVariables:O,setUserDefinedVariables:g})]})}var Kn=e(47202),On=e(78308),zt=e(64309),Wn={section:"section___PtRPl",sectionTitle:"sectionTitle___eF3a5"},dt={textAreaWrapper:"textAreaWrapper___UxryL",textArea:"textArea___JdLIr"},Ut=function(a){var s=a.prologue,r=a.onChange,l=function(v){var h=v.target.value;h.length<=2e3&&r(h)};return(0,n.jsxs)("div",{className:Wn.section,children:[(0,n.jsx)("div",{className:Wn.sectionTitle,children:t.Z.get({id:"main.components.ExperienceConfigDrawer.components.guideText.index.welcomeMessage",dm:"\u6B22\u8FCE\u8BED"})}),(0,n.jsx)("div",{className:dt.textAreaWrapper,children:(0,n.jsx)(hn.Z.TextArea,{value:s,onChange:l,placeholder:t.Z.get({id:"main.components.ExperienceConfigDrawer.components.guideText.index.enterWelcomeMessage",dm:"\u8BF7\u8F93\u5165\u6B22\u8FCE\u8BED"}),rows:3,maxLength:He.Z.agentWelcomeMessageMaxLength,showCount:!0,className:dt.textArea})})]})},Ft=Ut,Cn=e(23094),ct=e(88366),Mn=e(66548),Kt=e(82851),yn=e(19612),An={questionList:"questionList___eZ7ss",empty:"empty___CF1r7",questionItem:"questionItem___KNCso",dragHandle:"dragHandle___sg00r",dragIcon:"dragIcon___RmPQT",highlighted:"highlighted___hAKjt",deleteIcon:"deleteIcon___nMcTm",addButton:"addButton___RUcrw",addIcon:"addIcon___fAwsf"},Nn=He.Z.agentPresetQuestionMaxLimit;function $t(o){var a=o.id,s=o.content,r=o.onDelete,l=o.onChange,i=(0,Mn.nB)({id:a}),v=i.attributes,h=i.listeners,O=i.setNodeRef,g=i.transform,E=i.transition,C={transform:Kt.ux.Transform.toString(g),transition:E},d=function(p){l(a,p.target.value)};return(0,n.jsxs)("div",{ref:O,style:C,className:An.questionItem,children:[(0,n.jsx)("div",u()(u()(u()({className:An.dragHandle},v),h),{},{children:(0,n.jsx)(V.Z,{type:"spark-dragDot-line",className:An.dragIcon})})),(0,n.jsx)(hn.Z,{value:s,onChange:d,placeholder:t.Z.get({id:"main.components.ExperienceConfigDrawer.components.presetQuestions.index.inputPresetQuestion",dm:"\u8F93\u5165\u9884\u8BBE\u95EE\u9898"})}),(0,n.jsx)(V.Z,{type:"spark-delete-line",className:An.deleteIcon,onClick:function(){return r(a)}})]})}var Ht=function(a){var s=a.questions,r=a.onQuestionsChange,l=(0,c.useRef)(null),i=(0,Cn.Dy)((0,Cn.VT)(Cn.we,{activationConstraint:{distance:5}}),(0,Cn.VT)(Cn.Lg,{coordinateGetter:Mn.is}));function v(E){var C=E.active,d=E.over;d&&C.id!==d.id&&r((0,Mn.Rp)(s,s.findIndex(function(D){return D.id===C.id}),s.findIndex(function(D){return D.id===d.id})))}function h(){if(s.length>=Nn){yn.Z.warning(t.Z.get({id:"main.components.ExperienceConfigDrawer.components.presetQuestions.index.maxFiveQuestions",dm:"\u6700\u591A\u53EA\u80FD\u6DFB\u52A05\u4E2A\u9884\u8BBE\u95EE\u9898"}));return}var E={id:"".concat(Date.now()),content:""};r([].concat(Oe()(s),[E]))}function O(E){r(s.filter(function(C){return C.id!==E}))}function g(E,C){r(s.map(function(d){return d.id===E?u()(u()({},d),{},{content:C}):d}))}return(0,n.jsxs)("div",{className:Wn.section,children:[(0,n.jsxs)("div",{className:Wn.sectionTitle,children:[t.Z.get({id:"main.components.ExperienceConfigDrawer.components.presetQuestions.index.presetQuestions",dm:"\u9884\u8BBE\u95EE\u9898"}),(0,n.jsxs)("span",{style:{color:"var(--efm_ant-color-text-tertiary)"},children:["(",s.length,"/",Nn,")"]})]}),s.length>0?(0,n.jsx)("div",{className:An.questionList,ref:l,children:(0,n.jsx)(Cn.LB,{sensors:i,collisionDetection:Cn.pE,onDragEnd:v,modifiers:[ct.DL,ct.F4],children:(0,n.jsx)(Mn.Fo,{items:s.map(function(E){return E.id}),strategy:Mn.qw,children:s.map(function(E){return(0,n.jsx)($t,{id:E.id,content:E.content,onDelete:O,onChange:g},E.id)})})})}):(0,n.jsx)("div",{className:An.questionList,children:(0,n.jsx)("div",{className:An.empty,children:t.Z.get({id:"main.components.ExperienceConfigDrawer.components.presetQuestions.index.noPresetQuestions",dm:"\u6682\u65E0\u9884\u8BBE\u95EE\u9898\uFF0C\u901A\u8FC7\u4E0B\u65B9\u6309\u94AE\u6DFB\u52A0"})})}),(0,n.jsx)(m.Z,{disabled:s.length>=Nn,onClick:h,iconType:"spark-plus-line",tooltipContent:s.length>=Nn?t.Z.get({id:"main.components.ExperienceConfigDrawer.components.presetQuestions.index.maxQuestions",dm:"\u6700\u591A\u53EA\u80FD\u6DFB\u52A0{var1}\u4E2A\u9884\u8BBE\u95EE\u9898"},{var1:Nn}):"",children:t.Z.get({id:"main.components.ExperienceConfigDrawer.components.presetQuestions.index.addQuestion",dm:"\u6DFB\u52A0\u95EE\u9898"})})]})},Gt=Ht,Jt=function(a){var s=a.componentNames,r=a.config,l=a.onChange,i=function(h){switch(h){case"PresetQuestions":return(0,n.jsx)(Gt,{questions:r.questions,onQuestionsChange:function(g){l({questions:g})}},"presetQuestions");case"GuideText":return(0,n.jsx)(Ft,{prologue:r.prologue,onChange:function(g){l({prologue:g})}},"prologue");default:return null}};return(0,n.jsx)(n.Fragment,{children:s.map(i)})},Qt=Jt,Yt=(0,c.forwardRef)(function(o,a){var s,r=(0,c.useContext)(b.H),l=r.appState,i=r.onAppChange,v=(l==null||(s=l.appBasicConfig)===null||s===void 0?void 0:s.config)||{},h=v.prologue,O=(0,le.Z)({prologue:(h==null?void 0:h.prologue_text)||"",questions:((h==null?void 0:h.suggested_questions)||[]).map(function(p,_){return{id:String(_+1),content:p}})}),g=M()(O,2),E=g[0],C=g[1];(0,c.useImperativeHandle)(a,function(){return{onClear:function(){C({questions:[]})}}});var d=function(_){C(u()(u()({},E),_))};function D(){var p=E.questions.filter(function(_){return _.content.trim()}).map(function(_){return _.content});i({config:{prologue:{prologue_text:E.prologue,suggested_questions:p}}}),o.onClose()}return(0,n.jsx)(wn.Z,{title:t.Z.get({id:"main.components.ExperienceConfigDrawer.index.experienceConfiguration",dm:"\u4F53\u9A8C\u914D\u7F6E\uFF1A{var1}"},{var1:Kn.b[l==null?void 0:l.modalType]}),width:480,onClose:o.onClose,open:!0,footer:(0,n.jsxs)(Y.Z,{className:"w-full",justify:"flex-end",align:"center",gap:12,children:[(0,n.jsx)(m.Z,{type:"default",onClick:function(){o.onClose()},children:t.Z.get({id:"main.components.ExperienceConfigDrawer.index.cancel",dm:"\u53D6\u6D88"})}),(0,n.jsx)(m.Z,{type:"primary",onClick:D,children:t.Z.get({id:"main.components.ExperienceConfigDrawer.index.confirm",dm:"\u786E\u8BA4"})})]}),children:(0,n.jsx)("div",{children:(0,n.jsx)(Qt,{componentNames:["GuideText","PresetQuestions"],config:E,onChange:d})})})}),Xt=Yt,ut=e(41431),kn=e(11424),pt=e(87252),qt=e(32248),ea=e(28342),mt=e(36488),gt=e(41669),In=e(8822),Vn=e(1261),Pn={assistantModule:"assistantModule___csjCZ",header:"header___K7_V8",title:"title___Ser4p",content:"content___Zq9wJ",con:"con___c0fR_",value:"value___Ndih3",expandBtn:"expandBtn___na459",resultItem:"resultItem___a08Wf",imageList:"imageList___KT1V7",textNull:"textNull___QZcW0",scoreDesc:"scoreDesc___kk3W3",runningAnim:"runningAnim___Q1xAq"},na=function(a){var s=a.item;return(0,n.jsx)("div",{className:Pn.resultItem,children:(0,n.jsx)(gt.Z,{title:(0,n.jsx)(ge.Z.Text,{ellipsis:{tooltip:(0,Ee.rb)(s.doc_name)},style:{maxWidth:"400px"},children:s.doc_name}),rightChildren:(0,n.jsxs)("div",{className:Pn.header,children:[(0,n.jsx)("span",{style:{width:"max-content"},children:t.Z.get({id:"main.components.SparkChat.components.Steps.Knowledge.index.score",dm:"\u5F97\u5206\uFF1A"})}),s.score?Number(s.score).toFixed(2):"0%"]}),bodyStyle:{backgroundColor:"var(--ag-ant-color-bg-base)"},children:(0,n.jsx)("div",{className:"p-[8px_12px]",children:(0,n.jsx)("div",{className:Ye()(Pn.resultCon,Pn.textContent),children:(0,n.jsx)(Vn.Z,{content:s.text||""})})})})})};function ta(o){var a,s=o.data;return(0,n.jsx)("div",{className:Pn.content,children:(s==null?void 0:s.length)>0?(a=s.map)===null||a===void 0?void 0:a.call(s,function(r,l){return(0,n.jsx)(na,{item:r},l)}):(0,n.jsx)("span",{className:Pn.textNull,children:"-"})})}var ft=e(77751),vt=e(12901),aa={container:"container___AzoiJ",jsonContainer:"jsonContainer___tYgBA",header:"header___tNR5h",codeMirror:"codeMirror___qgc1I"},$n=function(o){var a,s,r=o.params,l=r.arguments?(0,In.CX)(r.arguments,!1,!0)!==null:!1,i=r.output?(0,In.CX)(r.output,!1,!0)!==null:!1,v=function(){var h=P()(T()().mark(function O(g){return T()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.prev=0,C.next=3,navigator.clipboard.writeText(g);case 3:yn.Z.success(t.Z.get({id:"main.components.SparkChat.components.Steps.Plugin.index.copySuccess",dm:"\u590D\u5236\u6210\u529F"})),C.next=9;break;case 6:C.prev=6,C.t0=C.catch(0),yn.Z.error(t.Z.get({id:"main.components.SparkChat.components.Steps.Plugin.index.copyFailed",dm:"\u590D\u5236\u5931\u8D25"}));case 9:case"end":return C.stop()}},O,null,[[0,6]])}));return function(g){return h.apply(this,arguments)}}();return(0,n.jsxs)("div",{className:aa.container,children:[!!((a=r.arguments)!==null&&a!==void 0&&a.length)&&(0,n.jsx)(ft.Z,{title:t.Z.get({id:"main.components.SparkChat.components.Steps.Plugin.index.inputParameters",dm:"\u8F93\u5165\u53C2\u6570"}),collapsedHeight:64,expandedHeight:200,expandOnPanelClick:!0,extra:(0,n.jsx)(V.Z,{type:"spark-copy-line",style:{fontSize:"16px"},onClick:function(){return v(r.arguments)}}),children:l?(0,n.jsx)(vt.ZP,{language:"json",value:r.arguments}):(0,n.jsx)("div",{className:"p-[12px]",children:(0,n.jsx)(Vn.Z,{content:r.arguments||"",baseFontSize:12})})}),!!((s=r.output)!==null&&s!==void 0&&s.length)&&(0,n.jsx)(ft.Z,{title:t.Z.get({id:"main.components.SparkChat.components.Steps.Plugin.index.outputParameters",dm:"\u8F93\u51FA\u53C2\u6570"}),collapsedHeight:64,expandedHeight:200,expandOnPanelClick:!0,extra:(0,n.jsx)(V.Z,{type:"spark-copy-line",style:{fontSize:"16px"},onClick:function(){return v(r.output)}}),children:i?(0,n.jsx)(vt.ZP,{language:"json",value:r.output}):(0,n.jsx)("div",{className:"p-[12px]",children:(0,n.jsx)(Vn.Z,{content:r.output||"",baseFontSize:12})})})]})},ia=function(o){return(0,n.jsx)(Vn.Z,{content:o.reasoning||"",baseFontSize:12})},sa={finished:t.Z.get({id:"main.components.SparkChat.components.Steps.index.completed",dm:"\u6267\u884C\u5B8C\u6210"}),generating:t.Z.get({id:"main.components.SparkChat.components.Steps.index.inProgress",dm:"\u6267\u884C\u4E2D"}),interrupted:t.Z.get({id:"main.components.SparkChat.components.Steps.index.stopped",dm:"\u5DF2\u505C\u6B62"}),error:t.Z.get({id:"main.components.SparkChat.components.Steps.index.error",dm:"\u9519\u8BEF"})},oa=function(o){var a,s,r=o.data;if(!((a=r.content)!==null&&a!==void 0&&a.length)&&!((s=r.reasoning_content)!==null&&s!==void 0&&s.length))return null;var l=function(h){var O=[];return h!=null&&h.length&&h.forEach(function(g,E){if(g.type==="file_search_result"&&O.push({icon:(0,n.jsx)(V.Z,{type:"spark-document-line",size:"small"}),title:t.Z.get({id:"main.components.SparkChat.components.Steps.index.knowledgeRetrieval",dm:"\u77E5\u8BC6\u5E93\u68C0\u7D22"}),children:(0,n.jsx)(ta,{data:(0,In.CX)(g.function.output)},"".concat(g.type,"-").concat(g.id))}),g.type==="tool_call"){var C,d,D,p=h.find(function($,w){return w>E&&$.type==="tool_result"&&$.id===g.id});O.push({icon:(0,n.jsx)(V.Z,{type:"spark-plugin-line",size:"small"}),title:t.Z.get({id:"main.components.SparkChat.components.Steps.index.plugin",dm:"\u63D2\u4EF6\uFF1A{var1}"},{var1:(C=g.function)===null||C===void 0?void 0:C.name}),children:(0,n.jsx)($n,{params:{arguments:((d=g.function)===null||d===void 0?void 0:d.arguments)||"",output:(p==null||(D=p.function)===null||D===void 0?void 0:D.output)||""}})})}if(g.type==="mcp_tool_call"){var _,he,ue=h.find(function($,w){return w>E&&$.type==="mcp_tool_result"&&$.id===g.id});O.push({icon:(0,n.jsx)(V.Z,{type:"spark-MCP-mcp-line",size:"small"}),title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.components.Steps.index.mcp",dm:"MCP\uFF1A{var1}"},{var1:g.function.name}),children:(0,n.jsx)($n,{params:{arguments:(_=g.function)===null||_===void 0?void 0:_.arguments,output:ue==null||(he=ue.function)===null||he===void 0?void 0:he.output}})})}if(g.type==="component_tool_call"){var ce,Se,re,de=h.find(function($,w){return w>E&&$.type==="component_tool_result"&&$.id===g.id});O.push({icon:(0,n.jsx)(V.Z,{type:"spark-doubleStar-line",size:"small"}),title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.components.Steps.component",dm:"\u7EC4\u4EF6\uFF1A{var1}"},{var1:(ce=g.function)===null||ce===void 0?void 0:ce.name}),children:(0,n.jsx)($n,{params:{arguments:(Se=g.function)===null||Se===void 0?void 0:Se.arguments,output:de==null||(re=de.function)===null||re===void 0?void 0:re.output}})})}}),O},i=function(){var h,O=l(r.content);return(h=r.reasoning_content)!==null&&h!==void 0&&h.length&&O.unshift({icon:(0,n.jsx)(V.Z,{type:"spark-deepThink-line",size:"small"}),title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.components.Steps.index.deepThinking",dm:"\u6DF1\u5EA6\u601D\u8003"}),children:(0,n.jsx)(ia,{reasoning:r.reasoning_content})}),O};return(0,n.jsx)(gt.Z,{title:sa[r.msgStatus],status:r.msgStatus,steps:i(),defaultOpen:!0})},ra=e(74029),ht=function(a){var s,r,l,i;return{id:a.request_id,cards:[{code:"Steps",data:{content:((s=a.message)===null||s===void 0?void 0:s.tool_calls)||[],reasoning_content:(r=a.message)===null||r===void 0?void 0:r.reasoning_content,msgStatus:(l=a.message)!==null&&l!==void 0&&(l=l.content)!==null&&l!==void 0&&l.length?"finished":"generating",defaultOpen:!0}},{code:"Text",data:{content:(i=a.message)===null||i===void 0?void 0:i.content,msgStatus:"generating"}}],content:"",role:"assistant",msgStatus:"generating",usage:a.usage}},la=e(324),xt=e.n(la),da=e(80828),Ct=e.n(da),ca=e(93917),dn=e.n(ca),ua=e(8227),pa=e.n(ua),ma=e(40445),ga=e.n(ma),fa=e(30686),va=e(96111),ha=e.n(va),yt=e(85545);function xa(o,a){return Hn.apply(this,arguments)}function Hn(){return Hn=P()(T()().mark(function o(a,s){var r,l;return T()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r=a.getReader();case 1:return v.next=3,r.read();case 3:if((l=v.sent).done){v.next=7;break}s(l.value),v.next=1;break;case 7:case"end":return v.stop()}},o)})),Hn.apply(this,arguments)}function Ca(o){var a,s,r,l=!1;return function(v){a===void 0?(a=v,s=0,r=-1):a=Aa(a,v);for(var h=a.length,O=0;s<h;){l&&(a[s]===10&&(O=++s),l=!1);for(var g=-1;s<h&&g===-1;++s)switch(a[s]){case 58:r===-1&&(r=s-O);break;case 13:l=!0;case 10:g=s;break}if(g===-1)break;o(a.subarray(O,g),r),O=s,r=-1}O===h?a=void 0:O!==0&&(a=a.subarray(O),s-=O)}}function ya(o,a,s){var r=At(),l=new TextDecoder;return function(v,h){if(v.length===0)s==null||s(r),r=At();else if(h>0){var O=l.decode(v.subarray(0,h)),g=h+(v[h+1]===32?2:1),E=l.decode(v.subarray(g));switch(O){case"data":r.data=r.data?r.data+`
`+E:E;break;case"event":r.event=E;break;case"id":o(r.id=E);break;case"retry":var C=parseInt(E,10);isNaN(C)||a(r.retry=C);break}}}}function Aa(o,a){var s=new Uint8Array(o.length+a.length);return s.set(o),s.set(a,o.length),s}function At(){return{data:"",event:"",id:"",retry:void 0}}var Sa=["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"],St="last-event-id";function ja(o){var a=o.headers.get("content-type");if(!(a!=null&&a.startsWith(Gn)))throw new Error("Expected content-type to be ".concat(Gn,", Actual: ").concat(a))}var Gn="text/event-stream";function Za(o,a){var s=a.signal,r=a.headers,l=a.onopen,i=a.onmessage,v=a.onclose,h=a.onerror,O=a.openWhenHidden,g=a.fetch,E=q()(a,Sa);return new Promise(function(C,d){var D=u()({},r);D.accept||(D.accept=Gn);var p;function _(){p.abort(),document.hidden||de()}O||document.addEventListener("visibilitychange",_);var he=0;function ue(){document.removeEventListener("visibilitychange",_),window.clearTimeout(he),p.abort()}function ce(w){p.signal.aborted||(h==null||h({errorMsg:w}),v==null||v(),ue(),d(w))}s==null||s.addEventListener("abort",function(){ue(),C()});var Se=g!=null?g:window.fetch,re=l!=null?l:ja;function de(){return $.apply(this,arguments)}function $(){return $=P()(T()().mark(function w(){var J,F,H,ae;return T()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:return p=new AbortController,J=null,Pe.prev=2,Pe.next=5,Se(o,u()(u()({},E),{},{headers:D,signal:p.signal})).then(function(G){if(!G.ok)throw new Error(G.statusText);return G});case 5:return J=Pe.sent,Pe.next=8,re(J);case 8:Pe.next=14;break;case 10:return Pe.prev=10,Pe.t0=Pe.catch(2),ce(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.libs.fetchEventSource.networkError",dm:"\u7F51\u7EDC\u5F02\u5E38\uFF0C\u60A8\u53EF\u4EE5\u7A0D\u540E\u91CD\u65B0\u5C1D\u8BD5\uFF0C\u8C22\u8C22"})),Pe.abrupt("return");case 14:if(F=null,Pe.prev=15,F=((H=J)===null||H===void 0?void 0:H.body)||((ae=J)===null||ae===void 0||(ae=ae._bodyBlob)===null||ae===void 0?void 0:ae.stream()),F){Pe.next=19;break}throw new Error("rs is null");case 19:return Pe.next=21,xa(F,Ca(ya(function(G){G?D[St]=G:delete D[St]},function(){},i)));case 21:v==null||v(),ue(),C(),Pe.next=29;break;case 26:Pe.prev=26,Pe.t1=Pe.catch(15),ce(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.libs.fetchEventSource.unknownError",dm:"\u672A\u77E5\u5F02\u5E38\uFF0C\u60A8\u53EF\u4EE5\u7A0D\u540E\u91CD\u65B0\u5C1D\u8BD5\uFF0C\u8C22\u8C22"}));case 29:case"end":return Pe.stop()}},w,null,[[2,10],[15,26]])})),$.apply(this,arguments)}de()})}var ba=function(){function o(a){xt()(this,o),Ne()(this,"baseApi","".concat(yt.v2.get(),"/console/v1/apps/chat/completions")),Ne()(this,"control",null),Ne()(this,"action","DialogForTestWindow"),a!=null&&a.action&&(this.action=a.action)}return Ct()(o,[{key:"close",value:function(){var s,r;(s=this.control)===null||s===void 0||(r=s.abort)===null||r===void 0||r.call(s),this.control=null}},{key:"destroy",value:function(){this.close()}},{key:"conversation",value:function(){var a=P()(T()().mark(function r(l,i){var v,h,O,g,E,C;return T()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return v=i.onopen,h=i.onmessage,O=i.onerror,g=i.onclose,E=new AbortController,D.next=4,yt.nP.asyncGet();case 4:return C=D.sent,this.control=E,D.prev=6,D.next=9,Za(this.baseApi,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(C)},body:JSON.stringify(l),credentials:"include",onopen:v,onmessage:h,onerror:O,onclose:g,signal:E.signal,openWhenHidden:!0});case 9:D.next=14;break;case 11:D.prev=11,D.t0=D.catch(6),O(D.t0);case 14:case"end":return D.stop()}},r,this,[[6,11]])}));function s(r,l){return a.apply(this,arguments)}return s}()}]),o}(),_a=function(o){pa()(s,o);var a=ga()(s);function s(r){var l;return xt()(this,s),l=a.call(this),Ne()(dn()(l),"conversation_id",void 0),Ne()(dn()(l),"configParams",void 0),Ne()(dn()(l),"countTime",0),Ne()(dn()(l),"timer",void 0),Ne()(dn()(l),"rpc",void 0),Ne()(dn()(l),"draft",void 0),Ne()(dn()(l),"cacheMessage",null),Ne()(dn()(l),"messages",[]),Ne()(dn()(l),"destroy",function(){l.rpc.destroy()}),Ne()(dn()(l),"changeConfigParams",function(i){l.configParams=u()(u()({},l.configParams),i)}),Ne()(dn()(l),"changeDraft",function(i){l.draft=i}),Ne()(dn()(l),"resetSession",function(){l.messages=[],l.cacheMessage=null}),l.conversation_id=r.conversation_id||"",l.configParams=r.configParams||{},l.draft=r.draft||!1,l.rpc=new ba,l}return Ct()(s,[{key:"updateConversationId",value:function(l){this.conversation_id=l}},{key:"normalGenerate",value:function(l){var i,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!((i=v.imageList)!==null&&i!==void 0&&i.length))this.messages.push({role:"user",content:l,content_type:"text"});else{var h,O=[{type:"text",text:l}].concat(Oe()((h=v.imageList)===null||h===void 0?void 0:h.map(function(g){return{type:"image",path:g}})));this.messages.push({role:"user",content:O,content_type:"multimodal"})}return this.sendMessage({app_id:v.app_id,messages:this.messages,stream:!0,timeout:He.Z.agentSSETimeout})}},{key:"close",value:function(){var l,i;this.messages.push({role:"assistant",content:(l=this.cacheMessage)===null||l===void 0||(l=l.message)===null||l===void 0?void 0:l.content,content_type:((i=this.cacheMessage)===null||i===void 0||(i=i.message)===null||i===void 0?void 0:i.content_type)||"text"}),this.cacheMessage=null,this.rpc.close()}},{key:"sendMessage",value:function(l){var i=this;return clearInterval(this.timer),this.rpc.conversation(u()(u()({},l),{},{extra_params:this.configParams.bizVars.user_defined_params,prompt_variables:this.configParams.bizVars.prompt_variables,is_draft:this.draft}),{onopen:function(){i.cacheMessage=null,i.timer=setInterval(function(){if(i.countTime++,i.countTime===l.timeout){var h;clearInterval(i.timer),(h=i.rpc.control)===null||h===void 0||h.abort(),i.countTime=0}},1e3)},onmessage:function(h){clearInterval(i.timer);var O=h.data,g;try{if(g=ha().parse(O),g.conversation_id&&(i.conversation_id=g.conversation_id),!g.request_id||g.error&&!g.content){var E,C;clearInterval(i.timer),console.log("[sse]error",g),i.emit("error",((E=g.error)===null||E===void 0?void 0:E.errorMsg)||((C=g.error)===null||C===void 0?void 0:C.message)||t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.libs.chat.unknownError",dm:"\u672A\u77E5\u9519\u8BEF"}))}else{if(i.cacheMessage){var D,p,_;i.cacheMessage.usage=g.usage,(D=g.message.reasoning_content)!==null&&D!==void 0&&D.length&&(i.cacheMessage.message.reasoning_content=(i.cacheMessage.message.reasoning_content||"")+(g.message.reasoning_content||"")),(p=g.message.content)!==null&&p!==void 0&&p.length&&(i.cacheMessage.message.content=(i.cacheMessage.message.content||"")+(g.message.content||"")),(_=g.message.tool_calls)!==null&&_!==void 0&&_.length&&(i.cacheMessage.message.tool_calls=[].concat(Oe()(i.cacheMessage.message.tool_calls||[]),Oe()(g.message.tool_calls)))}else{var d;i.cacheMessage=g,(d=i.cacheMessage)!==null&&d!==void 0&&d.message||(i.cacheMessage.message={})}var he=u()(u()({},g),i.cacheMessage);i.cacheMessage=he,i.emit("message",he)}}catch(ue){i.emit("error",t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.libs.chat.messageParseError",dm:"\u6D88\u606F\u89E3\u6790\u9519\u8BEF"}),h.data),console.error(ue,h.data);return}},onclose:function(){var h,O;console.log("[sse]close"),i.messages.push({role:"assistant",content:(h=i.cacheMessage)===null||h===void 0||(h=h.message)===null||h===void 0?void 0:h.content,content_type:((O=i.cacheMessage)===null||O===void 0||(O=O.message)===null||O===void 0?void 0:O.content_type)||"text"}),i.emit("close",i.cacheMessage),i.cacheMessage=null},onerror:function(h){clearInterval(i.timer),console.log("[sse]error",h),i.cacheMessage=null,i.emit("error",(h==null?void 0:h.errorMsg)||h)}})}}]),s}(fa.Z),Ea=_a,Pa=(0,c.forwardRef)(function(o,a){var s,r,l,i,v,h,O=(0,c.useContext)(b.H),g=O.appCode,E=O.appState,C=O.setAppState,d=E.appBasicConfig,D=E.flushing,p=(0,c.useRef)(),_=(0,c.useRef)(null),he=(0,c.useRef)(!1),ue=(0,c.useState)(!1),ce=M()(ue,2),Se=ce[0],re=ce[1],de=ea.Z.useNotification(),$=M()(de,2),w=$[0],J=$[1],F=(0,c.useCallback)(function(){Se||(re(!0),w.info({message:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.tip",dm:"\u63D0\u793A"}),description:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.configVariables",dm:"\u60A8\u8FD8\u672A\u8FDB\u884C\u5165\u53C2\u53D8\u91CF\u914D\u7F6E\uFF0C\u53EF\u80FD\u4F1A\u5F71\u54CD\u667A\u80FD\u4F53\u6548\u679C\uFF0C\u5EFA\u8BAE\u60A8\u8FDB\u884C\u5B8C\u5584\uFF01"})}),(0,n.jsx)(m.Z,{type:"link",onClick:function(){o.openVarDrawer(),w.destroy()},className:"float-right",children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.configureNow",dm:"\u7ACB\u5373\u914D\u7F6E"})})]}),duration:0}))},[Se]),H=(0,c.useRef)({}),ae=(0,c.useCallback)(function(){var fe=P()(T()().mark(function ve(_e){var me,je,We,$e,Ze,Ge,Qe,xe,Te,ke,nn,pn,Sn,jn,Zn=arguments;return T()().wrap(function(bn){for(;;)switch(bn.prev=bn.next){case 0:$e=Zn.length>1&&Zn[1]!==void 0?Zn[1]:!1,o.isBizVarsComplete||F(),he.current||((Ze=p.current)===null||Ze===void 0||Ze.removeAllMessages(),he.current=!0),H.current.answer&&(H.current.answer.cards=(Ge=H.current.answer.cards)===null||Ge===void 0?void 0:Ge.map(function(sn){if(sn.code==="Footer"){var cn;return G(((cn=H.current.query)===null||cn===void 0?void 0:cn.id)||"",H.current.answer,!1)}return sn}),(Qe=p.current)===null||Qe===void 0||Qe.updateMessage(H.current.answer)),$e||(H.current.answer=void 0,H.current.query={id:(0,ut.Z)(),cards:[],content:_e.query,role:"user",msgStatus:"finished"},(xe=_e.fileList)!==null&&xe!==void 0&&xe.length&&(ke=_e.fileList[0],nn=_e.fileList[1],nn!=null&&nn.length&&((pn=H.current.query.cards)===null||pn===void 0||pn.push((0,kn.LH)("Images",nn.map(function(sn){return{url:sn.response.url,originalFileData:sn}})))),ke!=null&&ke.length&&((Sn=H.current.query.cards)===null||Sn===void 0||Sn.push((0,kn.LH)("Files",ke.map(function(sn){return{filename:sn.name,bytes:sn.size,originalFileData:sn}}))))),(Te=p.current)===null||Te===void 0||Te.updateMessage(H.current.query)),(me=p.current)===null||me===void 0||me.setLoading(!0),H.current.answer={id:(0,ut.Z)(),content:"",role:"assistant",msgStatus:"generating"},jn=((je=_e.fileList)===null||je===void 0?void 0:je[0])||[],(We=_.current)===null||We===void 0||We.normalGenerate(_e==null?void 0:_e.query,{imageList:jn.length?jn.map(function(sn){var cn;return(cn=sn.response)===null||cn===void 0?void 0:cn.downloadUrl}):void 0,app_id:g}),C({flushing:!0});case 10:case"end":return bn.stop()}},ve)}));return function(ve){return fe.apply(this,arguments)}}(),[F,o.isBizVarsComplete]),Me=(0,c.useCallback)(function(){var fe,ve;if((fe=_.current)===null||fe===void 0||fe.close(),H.current.answer){var _e,me,je,We;H.current.answer.msgStatus="interrupted",H.current.answer.cards=(_e=H.current.answer.cards)===null||_e===void 0?void 0:_e.map(function($e){return u()(u()({},$e),{},{data:u()(u()({},$e.data),{},{msgStatus:$e.data.msgStatus==="generating"?"interrupted":$e.data.msgStatus})})}),(me=H.current.answer.cards)===null||me===void 0||me.push(G((je=_.current)===null||je===void 0||(je=je.cacheMessage)===null||je===void 0?void 0:je.request_id,H.current.answer,!0)),(We=p.current)===null||We===void 0||We.updateMessage(H.current.answer)}(ve=p.current)===null||ve===void 0||ve.setLoading(!1),C({flushing:!1})},[]),Pe=(0,c.useCallback)(function(fe){var ve,_e,me,je,We;(ve=p.current)===null||ve===void 0||ve.removeMessage(fe);var $e=(_e=p.current)===null||_e===void 0?void 0:_e.getMessages();if($e){var Ze=$e[$e.length-1],Ge=((me=Ze.cards)===null||me===void 0||(me=me.find(function(xe){return xe.code==="Images"}))===null||me===void 0||(me=me.data)===null||me===void 0?void 0:me.map(function(xe){return xe.originalFileData}))||[],Qe=((je=Ze.cards)===null||je===void 0||(je=je.find(function(xe){return xe.code==="Files"}))===null||je===void 0||(je=je.data)===null||je===void 0?void 0:je.map(function(xe){return xe.originalFileData}))||[];H.current.answer=void 0,ae({query:(We=$e[$e.length-1])===null||We===void 0?void 0:We.content,fileList:[Qe,Ge]},!0)}},[ae]),G=function(ve,_e){var me,je,We,$e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(0,kn.LH)("Footer",{left:(0,n.jsx)(pt.p4,{data:[{icon:(0,n.jsx)(k.Z,{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.copy",dm:"\u590D\u5236"}),trigger:"hover",children:(0,n.jsx)(V.Z,{type:"spark-copy-line",size:"small"})}),label:"",onClick:function(){var Ge;(0,Ee.JG)((Ge=_e.cards)===null||Ge===void 0||(Ge=Ge.find(function(Qe){return Qe.code==="Text"}))===null||Ge===void 0||(Ge=Ge.data)===null||Ge===void 0?void 0:Ge.content),yn.Z.success(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.copySuccess",dm:"\u590D\u5236\u6210\u529F"}))}},$e?{icon:(0,n.jsx)(k.Z,{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.regenerate",dm:"\u91CD\u65B0\u751F\u6210"}),trigger:"hover",children:(0,n.jsx)(V.Z,{type:"spark-replace-line",size:"small"})}),label:"",onClick:function(){var Ge,Qe=(Ge=p.current)===null||Ge===void 0?void 0:Ge.getMessage(_e.id);Qe&&Pe(Qe)}}:void 0,{icon:(0,n.jsx)(k.Z,{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.clickCopyRequestId",dm:"\u70B9\u51FB\u590D\u5236Request ID"}),trigger:"hover",children:(0,n.jsx)(V.Z,{type:"spark-ID-line",size:"small"})}),label:"",onClick:function(){(0,Ee.JG)(ve),yn.Z.success(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.copySuccess",dm:"\u590D\u5236\u6210\u529F"}))}}].filter(function(Ze){return!!Ze})}),right:(0,n.jsx)(pt.hw,{data:[[t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.wordCount",dm:"\u5B57\u6570"}),(me=_e.cards)===null||me===void 0||(me=me.find(function(Ze){return Ze.code==="Text"}))===null||me===void 0||(me=me.data)===null||me===void 0||(me=me.content)===null||me===void 0?void 0:me.length],[t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.inputToken",dm:"\u8F93\u5165token"}),(je=_e.usage)===null||je===void 0?void 0:je.prompt_tokens],[t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.outputToken",dm:"\u8F93\u51FAtoken"}),(We=_e.usage)===null||We===void 0?void 0:We.completion_tokens]]})})},ze=(0,c.useCallback)(function(){var fe,ve;(fe=_.current)===null||fe===void 0||fe.resetSession(),(ve=p.current)===null||ve===void 0||ve.removeAllMessages(),H.current.answer=void 0},[]),qe=(0,c.useCallback)(function(){var fe,ve=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(D){yn.Z.warning(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.generatingDialog",dm:"\u5BF9\u8BDD\u6B63\u5728\u751F\u6210\u4E2D\uFF0C\u8BF7\u5148\u505C\u6B62\u518D\u91CD\u7F6E\u5BF9\u8BDD\uFF01"}));return}ze(),(fe=_.current)===null||fe===void 0||fe.updateConversationId(""),he.current=!1,ve||yn.Z.success(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.resetSuccess",dm:"\u91CD\u7F6E\u5BF9\u8BDD\u6210\u529F\uFF0C\u8BF7\u7EE7\u7EED\u6D4B\u8BD5"}))},[D,d]);return(0,c.useEffect)(function(){if(!(_.current||!(g!=null&&g.length)))return _.current=new Ea({type:"dialog",draft:!0,configParams:{appId:g,bizVars:{}}}),_.current.on("message",function(fe){var ve,_e=ht(fe);H.current.answer=_e,(ve=p.current)===null||ve===void 0||ve.updateMessage(H.current.answer)}),_.current.on("close",function(fe){var ve;if(C({flushing:!1}),H.current.answer){var _e,me;if(H.current.answer.cards=(_e=H.current.answer.cards)===null||_e===void 0?void 0:_e.map(function($e){return $e.code==="Text"?u()(u()({},$e),{},{data:u()(u()({},$e.data),{},{msgStatus:"finished"})}):$e}),fe){var je,We=ht(fe);(je=H.current.answer.cards)===null||je===void 0||je.push(G(fe==null?void 0:fe.request_id,We,!0))}(me=p.current)===null||me===void 0||me.updateMessage(H.current.answer)}(ve=p.current)===null||ve===void 0||ve.setLoading(!1)}),_.current.on("error",function(fe){var ve;if(C({flushing:!1}),H.current.answer){var _e;H.current.answer.cards=[(0,kn.LH)("Text",{content:"",typing:!0,msgStatus:"generating"}),(0,kn.LH)("Interrupted",{type:"error",title:"Error",desc:String(fe)})],(_e=p.current)===null||_e===void 0||_e.updateMessage(H.current.answer)}(ve=p.current)===null||ve===void 0||ve.setLoading(!1)}),function(){var fe;(fe=_.current)===null||fe===void 0||fe.destroy(),_.current=null}},[g]),(0,c.useEffect)(function(){if(E.canChat){var fe;(fe=p.current)===null||fe===void 0||fe.setDisabled(!1)}else{var ve;(ve=p.current)===null||ve===void 0||ve.setDisabled(!0)}},[E.canChat]),(0,c.useEffect)(function(){return function(){ze()}},[]),(0,c.useEffect)(function(){var fe;(fe=_.current)===null||fe===void 0||fe.changeDraft(!E.isReleaseVersion)},[E.isReleaseVersion]),(0,c.useEffect)(function(){var fe;(fe=p.current)===null||fe===void 0||fe.reload()},[d==null||(s=d.config.prologue)===null||s===void 0?void 0:s.prologue_text,d==null||(r=d.config.prologue)===null||r===void 0?void 0:r.suggested_questions,d==null?void 0:d.name,d==null?void 0:d.config.modality_type]),(0,c.useImperativeHandle)(a,function(){return{onClear:ze,resetSession:qe,chat:_.current}}),(0,n.jsxs)(n.Fragment,{children:[J,(0,n.jsx)("div",{style:{height:"100%"},children:(0,n.jsx)(qt.Z,{ref:p,onInput:{onSubmit:ae,beforeSubmit:function(){return Promise.resolve(!0)},maxLength:o.maxTokenContext,zoomable:!0},uiConfig:{welcome:(0,n.jsx)(ra.Z,{data:{modalType:(d==null?void 0:d.config.modality_type)||"textDialog",prologue:(d==null||(l=d.config.prologue)===null||l===void 0?void 0:l.prologue_text)||"",suggested_questions:d!=null&&(i=d.config.prologue)!==null&&i!==void 0&&(i=i.suggested_questions)!==null&&i!==void 0&&i.length?d==null||(v=d.config.prologue)===null||v===void 0?void 0:v.suggested_questions:[],name:(d==null?void 0:d.name)||"",icon:""},sparkChatRef:p,title:d==null?void 0:d.name}),mobile:!0,background:"transparent"},onStop:Me,cardConfig:{Steps:oa},onUpload:[{multiple:!0,icon:(0,n.jsx)(k.Z,{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.SparkChat.index.uploadImage",dm:"\u4E0A\u4F20\u56FE\u7247\u8FDB\u884C\u89C6\u89C9\u7406\u89E3\u6216\u56FE\u7247\u641C\u7D22"}),children:(0,n.jsx)(On.Z,{icon:(0,n.jsx)(V.Z,{type:"spark-addPicture-line",size:"small"}),bordered:!1,size:"small",disabled:!(d!=null&&(h=d.config.model)!==null&&h!==void 0&&(h=h.tags)!==null&&h!==void 0&&h.includes("vision"))})}),accept:"image/*",customRequest:function(ve){(0,mt.ZP)({file:ve.file,category:"image",onProgress:function(me){var je;ve==null||(je=ve.onProgress)===null||je===void 0||je.call(ve,me)}}).then(function(){var _e=P()(T()().mark(function me(je){var We;return T()().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:if(Ze.t0=ve==null||(We=ve.onSuccess)===null||We===void 0,Ze.t0){Ze.next=10;break}return Ze.t1=We,Ze.t2=ve,Ze.next=6,(0,mt.pC)(je.path);case 6:Ze.t3=Ze.sent,Ze.t4=je.path,Ze.t5={url:Ze.t3,downloadUrl:Ze.t4},Ze.t1.call.call(Ze.t1,Ze.t2,Ze.t5);case 10:case"end":return Ze.stop()}},me)}));return function(me){return _e.apply(this,arguments)}}())},maxCount:10}]})},g)]})}),Ta=e(86093),wa=e.n(Ta),Ma=e(51747),Na=e(73088),fn={parameterWrapper:"parameterWrapper___agH52",title:"title___n4Qc8",paramItem:"paramItem___DGtrr",labelMulti:"labelMulti___qLAQl",keyHeader:"keyHeader___anFRW",emptyWrap:"emptyWrap___FDBlZ",loading:"loading___rCArN",tabs:"tabs___ysjPc",subTitle:"subTitle___So506",configFormConMulti:"configFormConMulti___IP_l0"};function ka(o){var a=o.item.params,s=function(l){switch(l){case"Boolean":return(0,n.jsx)(Ma.Z,{options:[{value:"true",label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.yes",dm:"\u662F"})},{value:"false",label:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.no",dm:"\u5426"})}],placeholder:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.select",dm:"\u8BF7\u9009\u62E9"})});case"Number":return(0,n.jsx)(Na.Z,{placeholder:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.enterValue",dm:"\u8BF7\u8F93\u5165\u53C2\u6570\u503C"})});default:return(0,n.jsx)(hn.Z,{placeholder:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.enterValue",dm:"\u8BF7\u8F93\u5165\u53C2\u6570\u503C"})})}};return(0,n.jsx)("div",{className:fn.configFormConMulti,children:a.map(function(r){return(0,n.jsx)("div",{className:fn.paramItem,children:(0,n.jsx)(xn.Z.Item,{label:(0,n.jsx)(ge.Z.Text,{ellipsis:{tooltip:(0,Ee.rb)(r.field)},className:fn.labelMulti,children:r.field}),name:["user_defined_params",o.item.code,r.field],layout:"vertical",children:s(r.type)})},r.field)})})}function Da(o){var a=o.loading,s=o.bizVarList,r=o.userPromptParamsList,l=o.bizVars,i=o.onBizVarsFormValuesChange;return a?(0,n.jsx)(we.Z,{spinning:!0,className:fn.loading}):!s.length&&!r.length?(0,n.jsx)(Y.Z,{justify:"center",className:"mt-[20px]",children:(0,n.jsx)(Z.Z,{description:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.noVariables",dm:"\u6CA1\u6709\u9700\u8981\u586B\u5199\u7684\u53D8\u91CF"})})}):(0,n.jsxs)(xn.Z,{onValuesChange:i,labelCol:{flex:"140px"},initialValues:l,children:[!!r.length&&(0,n.jsxs)("div",{className:"mb-[24px]",children:[(0,n.jsx)("p",{className:"text-[14px] leading-[24px] font-medium m-[20px_0_12px]",children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.customVariable",dm:"\u81EA\u5B9A\u4E49\u53D8\u91CF"})}),(0,n.jsx)(n.Fragment,{children:r.map(function(v){return(0,n.jsx)("div",{className:fn.parameterWrapper,children:(0,n.jsx)("div",{className:fn.paramItem,children:(0,n.jsx)(xn.Z.Item,{label:(0,n.jsxs)(Y.Z,{vertical:!0,gap:4,children:[(0,n.jsx)(ge.Z.Text,{className:"text-[13px] leading-[20px] font-medium",ellipsis:{tooltip:(0,Ee.rb)(v.name)},children:v.name}),(0,n.jsx)(ge.Z.Text,{className:"text-[12px] leading-[20px]",style:{color:"var(--ag-ant-color-text-tertiary)"},ellipsis:{tooltip:(0,Ee.rb)(v.description)},children:v.description})]}),name:["prompt_variables",v.name],layout:"vertical",children:(0,n.jsx)(hn.Z,{className:fn.input})})})},"".concat(v.name))})})]}),!!s.length&&(0,n.jsxs)("div",{className:"mb-[24px]",children:[(0,n.jsx)("p",{className:"text-[14px] leading-[24px] font-medium m-[20px_0_12px]",children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.form.builtinVariable",dm:"\u5185\u7F6E\u53D8\u91CF"})}),(0,n.jsx)(n.Fragment,{children:s.map(function(v){return(0,n.jsxs)("div",{className:fn.parameterWrapper,children:[(0,n.jsx)("div",{className:fn.title,children:v.name}),(0,n.jsx)(ka,{item:v})]},"".concat(v.code))})})]})]})}var La={desc:"desc___azOUG"};function Rn(o){return o==null||o===""}function jt(o){return Object.entries(o).every(function(a){var s=M()(a,2),r=s[1];return Rn(r)?!1:wa()(r)==="object"&&r!==null?jt(r):!0})}var Ba=function(a){var s=a.bizVars,r=a.pluginToolsList,l=a.userPromptParams,i=a.workflowComponentList,v=a.agentComponentList,h=(0,c.useState)([]),O=M()(h,2),g=O[0],E=O[1],C=(0,c.useState)([]),d=M()(C,2),D=d[0],p=d[1],_=(0,c.useState)(!0),he=M()(_,2),ue=he[0],ce=he[1],Se=(0,c.useRef)(null),re=function(J){Se.current===null&&a.onBizVarsUpdate(J),Se.current=J,a.needLocalStorage&&localStorage.setItem("".concat(a.code,"-bizVars"),JSON.stringify(J))},de=function(){var w=P()(T()().mark(function J(){var F,H,ae,Me,Pe,G,ze,qe,fe,ve,_e,me,je,We,$e,Ze=arguments;return T()().wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:if(H=Ze.length>0&&Ze[0]!==void 0?Ze[0]:{},ae=H.pluginToolsList,Me=ae===void 0?[]:ae,Pe=H.userPromptParams,G=Pe===void 0?[]:Pe,ze=H.agentComponentList,qe=ze===void 0?[]:ze,fe=H.workflowComponentList,ve=fe===void 0?[]:fe,_e=(0,In.CX)(localStorage.getItem("".concat(a.code,"-bizVars"))||""),me=!0,je={},We={},!(qe.length||ve.length)){Qe.next=9;break}return Qe.next=8,(0,W.T$)([].concat(Oe()(qe.map(function(xe){return xe.code||""}).filter(Boolean)),Oe()(ve.map(function(xe){return xe.code||""}).filter(Boolean))));case 8:We=Qe.sent;case 9:return Object.keys(We).forEach(function(xe){We[xe].input.forEach(function(Te){if(je[xe]||(je[xe]={}),Te.display&&Te.source!=="model"){var ke,nn=(_e==null||(ke=_e.user_defined_params[xe])===null||ke===void 0?void 0:ke[Te.field])||void 0;Rn(nn)&&(me=!1),je[xe]=u()(u()({},je[xe]),{},Ne()({},Te.field,nn))}})}),Me.forEach(function(xe){var Te;xe.tool_id&&((Te=xe.config)===null||Te===void 0||(Te=Te.input_params)===null||Te===void 0||Te.forEach(function(ke){if(je[xe.tool_id]||(je[xe.tool_id]={}),ke.user_input){var nn,pn=(_e==null||(nn=_e.user_defined_params[xe.tool_id])===null||nn===void 0?void 0:nn[ke.key])||void 0;Rn(pn)&&(me=!1),je[xe.tool_id]=u()(u()({},je[xe.tool_id]),{},Ne()({},ke.key,pn))}}))}),$e=G==null?void 0:G.reduce(function(xe,Te){var ke,nn=(_e==null||(ke=_e.prompt_variables)===null||ke===void 0?void 0:ke[Te.name])||Te.default_value;return Rn(nn)&&(me=!1),u()(u()({},xe),{},Ne()({},Te.name,nn))},{}),(F=a.onIsBizVarsCompleteChange)===null||F===void 0||F.call(a,me),E([].concat(Oe()(Me.filter(function(xe){var Te;return xe.tool_id&&((Te=xe.config)===null||Te===void 0||(Te=Te.input_params)===null||Te===void 0?void 0:Te.some(function(ke){return ke.user_input}))}).map(function(xe){var Te;return{code:xe.tool_id,name:xe.name,params:((Te=xe.config)===null||Te===void 0||(Te=Te.input_params)===null||Te===void 0?void 0:Te.map(function(ke){return{field:ke.key,type:ke.type,description:ke.description}}))||[]}})||[]),Oe()(qe.filter(function(xe){return!!xe.code}).map(function(xe){var Te;return{code:xe.code,name:xe.name,params:(Te=We[xe.code])===null||Te===void 0?void 0:Te.input.filter(function(ke){return ke.display&&ke.source!=="model"}).map(function(ke){return{field:ke.field,type:ke.type,description:ke.description}})}}).filter(function(xe){return xe.params.length>0})),Oe()(ve.filter(function(xe){return!!xe.code}).map(function(xe){var Te;return{code:xe.code,name:xe.name,params:(Te=We[xe.code])===null||Te===void 0?void 0:Te.input.filter(function(ke){return ke.display&&ke.source!=="model"}).map(function(ke){return{field:ke.field,type:ke.type,description:ke.description}})}}).filter(function(xe){return xe.params.length>0})))),p(G.map(function(xe){return u()(u()({},xe),{},{key:xe.name})})),ce(!1),Qe.abrupt("return",{user_defined_params:je,prompt_variables:$e});case 17:case"end":return Qe.stop()}},J)}));return function(){return w.apply(this,arguments)}}();(0,c.useEffect)(function(){var w=function(){var J=P()(T()().mark(function F(){var H;return T()().wrap(function(Me){for(;;)switch(Me.prev=Me.next){case 0:return Me.next=2,de({pluginToolsList:r||[],userPromptParams:l||[],agentComponentList:v||[],workflowComponentList:i||[]});case 2:H=Me.sent,re(H);case 4:case"end":return Me.stop()}},F)}));return function(){return J.apply(this,arguments)}}();w()},[r,l,v,i]);var $=function(J,F){var H=F.user_defined_params,ae=F.prompt_variables;Se.current={user_defined_params:H,prompt_variables:ae}};return{loading:ue,bizVarList:g,userPromptParamsList:D,bizVars:s,onBizVarsFormValuesChange:$,cachedBizVars:Se}},Oa=(0,c.forwardRef)(function(o,a){var s=o.loading,r=o.bizVarList,l=o.userPromptParamsList,i=o.bizVars,v=o.onBizVarsFormValuesChange,h=o.cachedBizVars;return(0,c.useImperativeHandle)(a,function(){return{get cachedBizVars(){return h.current}}},[h.current]),(0,n.jsx)(Da,{loading:s,bizVarList:r,userPromptParamsList:l,bizVars:i,onBizVarsFormValuesChange:v})});function Wa(o){var a=(0,c.useRef)(null),s=Ba(u()(u()({},o),{},{needLocalStorage:!0}));return(0,n.jsxs)(wn.Z,{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.index.paramConfig",dm:"\u5165\u53C2\u53D8\u91CF\u914D\u7F6E"}),width:480,open:o.open,onClose:o.onCancel,style:o.style,className:Ye()(o.className),destroyOnClose:!0,footer:(0,n.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,n.jsx)(m.Z,{type:"default",onClick:function(){o.onCancel()},children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.index.cancel",dm:"\u53D6\u6D88"})}),(0,n.jsx)(m.Z,{type:"primary",onClick:function(){var l;if((l=a.current)!==null&&l!==void 0&&l.cachedBizVars){var i;o.onBizVarsUpdate(a.current.cachedBizVars);var v=jt(a.current.cachedBizVars);(i=o.onIsBizVarsCompleteChange)===null||i===void 0||i.call(o,v)}o.onCancel()},children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.index.confirm",dm:"\u786E\u8BA4"})})]})}),children:[(0,n.jsx)("div",{className:La.desc,children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.VarConfigDrawer.index.description",dm:"\u8BF7\u586B\u5199\u672C\u8F6E\u5BF9\u8BDD\u9700\u8981\u4F20\u5165\u7684\u53D8\u91CF\u503C\uFF0C\u8FD9\u4E9B\u53C2\u6570\u6765\u81EA\u60A8\u8BBE\u7F6E\u7684\u81EA\u5B9A\u4E49\u53D8\u91CF\u6216\u6280\u80FD\u4E2D\u7684\u4E1A\u52A1\u900F\u4F20\u53C2\u6570\u3002\u6BCF\u6B21\u4FEE\u6539\u540E\uFF0C\u4F1A\u5728\u65B0\u4E00\u8F6E\u5BF9\u8BDD\u4E2D\u751F\u6548\u3002"})}),(0,n.jsx)(Oa,u()({ref:a},s))]})}var Jn={container:"container___nCsxt",actions:"actions___eWjAY",titleWrapper:"titleWrapper___McwEf",title:"title___gE5_z",tab:"tab___Cb6_D",headerTools:"headerTools___t5S_v",alert:"alert___CTxC6",inputModalWrapper:"inputModalWrapper___pcNHL",audioModalWrapper:"audioModalWrapper___Qyqxx",actionsWrapper:"actionsWrapper___kL6D2",debug:"debug___hCA1n",debugInfo:"debugInfo___Su8MH",sessionId:"sessionId___JEEyY",fold:"fold___wnmFE",btn:"btn___I53_V",popover:"popover___yMNnI",tooltipTitle:"tooltipTitle___okje7",qrCode:"qrCode___NqAjn",qrCodeContainer:"qrCodeContainer___BCeQQ",copyBtn:"copyBtn___ATbQq",popconfirm:"popconfirm___ZyVK2",divider:"divider___h4CcJ",resizeHandle:"resizeHandle___mmFWu",refreshBtn:"refreshBtn___V6OlE",textOverflow:"textOverflow___WwBS0",urlContainer:"urlContainer___sSgOl"};function Ia(o){var a,s,r,l,i,v,h=en.ZP.useConfig(),O=h.componentDisabled,g=(0,c.useContext)(b.H),E=g.appCode,C=g.appState,d=g.setAppState,D=g.sparkChatComponentRef,p=C.appBasicConfig,_=(0,le.Z)({showExperienceConfigDrawer:!1,showVarDrawer:!1,bizVars:{},showVarDrawerTipBtn:!1,isBizVarsComplete:!0}),he=M()(_,2),ue=he[0],ce=he[1],Se=(0,c.useRef)(null),re=(0,c.useRef)(null),de=function(w){d({modalType:w})};return(0,c.useEffect)(function(){var $,w,J,F;p!=null&&($=p.config)!==null&&$!==void 0&&($=$.tools)!==null&&$!==void 0&&$.length||p!=null&&(w=p.config)!==null&&w!==void 0&&w.prompt_variables||p!=null&&(J=p.config)!==null&&J!==void 0&&(J=J.agent_components)!==null&&J!==void 0&&J.length||p!=null&&(F=p.config)!==null&&F!==void 0&&(F=F.workflow_components)!==null&&F!==void 0&&F.length?ce({showVarDrawerTipBtn:!0}):ce({showVarDrawerTipBtn:!1})},[p==null||(a=p.config)===null||a===void 0||(a=a.tools)===null||a===void 0?void 0:a.length,p==null||(s=p.config)===null||s===void 0||(s=s.agent_components)===null||s===void 0?void 0:s.length,p==null||(r=p.config)===null||r===void 0||(r=r.workflow_components)===null||r===void 0?void 0:r.length,p==null||(l=p.config)===null||l===void 0?void 0:l.prompt_variables]),(0,n.jsxs)("div",{className:Jn.container,ref:re,children:[(0,n.jsxs)("div",{className:"py-[12px] px-[20px] flex items-center justify-between",style:{background:"var(--ag-ant-color-fill-tertiary)",height:"48px"},children:[(0,n.jsx)(rt.Z,{overlayStyle:{width:380},menu:{items:[{key:"textDialog",label:(0,n.jsxs)(Y.Z,{align:"top",justify:"space-between",className:"w-full",gap:8,onClick:function(){de("textDialog")},children:[(0,n.jsx)(V.Z,{className:"w-[24px] h-[24px] rounded-[12px]",style:{background:"var(--ag-ant-color-mauve-bg)"},type:"spark-text-line"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("div",{className:"text-[12px] font-medium leading-[20px]",style:{marginBottom:"2px"},children:Kn.b.textDialog}),(0,n.jsx)("div",{className:"text-[12px] font-normal leading-[20px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:t.Z.get({id:"main.components.AssistantTestWindow.index.conversationBased",dm:"\u57FA\u4E8ELLM\u7684\u5BF9\u8BDD\u578B\u4EA4\u4E92\uFF0C\u9002\u5408\u8FDB\u884C\u590D\u6742\u7684\u591A\u8F6E\u5BF9\u8BDD"})})]})]})}]},disabled:O,children:(0,n.jsxs)(Y.Z,{align:"center",className:"text-[16px] font-medium leading-[24px]",children:[Kn.b[C.modalType],(0,n.jsx)(V.Z,{className:"ml-[8px]",type:"spark-down-line"})]})}),(0,n.jsxs)("span",{className:Jn.actions,style:{padding:0},ref:Se,children:[ue.showVarDrawerTipBtn&&!O&&(0,n.jsx)(k.Z,{title:t.Z.get({id:"main.components.AssistantTestWindow.index.parameterConfiguration",dm:"\u5165\u53C2\u53D8\u91CF\u914D\u7F6E"}),placement:"bottom",children:(0,n.jsx)(On.Z,{icon:(0,n.jsx)(zt.Z,{showZero:!1,count:ue.isBizVarsComplete?0:1,dot:!0,children:(0,n.jsx)(V.Z,{type:"spark-modify-line",size:"small"})}),bordered:!1,onClick:function(){ce({showVarDrawer:!0})}})}),C.modalType==="textDialog"&&(0,n.jsx)(k.Z,{placement:"bottom",overlayStyle:{maxWidth:320},title:t.Z.get({id:"main.components.AssistantTestWindow.index.experienceConfiguration",dm:"\u4F53\u9A8C\u914D\u7F6E"}),children:(0,n.jsx)(On.Z,{icon:(0,n.jsx)(V.Z,{type:"spark-setting-line",size:"small"}),bordered:!1,onClick:function(){return ce({showExperienceConfigDrawer:!0})}})}),C.modalType==="textDialog"&&(0,n.jsx)(k.Z,{title:t.Z.get({id:"main.components.AssistantTestWindow.index.clearHistory",dm:"\u6E05\u7A7A\u8BB0\u5F55"}),children:(0,n.jsx)(On.Z,{icon:(0,n.jsx)(V.Z,{type:"spark-clear-line",size:"small"}),bordered:!1,onClick:function(){var w;return(w=D.current)===null||w===void 0?void 0:w.resetSession()}})})]})]}),C.modalType==="textDialog"&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:Jn.inputModalWrapper,children:(0,n.jsx)(Pa,{ref:D,maxTokenContext:o.maxTokenContext,isBizVarsComplete:ue.isBizVarsComplete,openVarDrawer:function(){ce({showVarDrawer:!0})}})})}),ue.showExperienceConfigDrawer&&(0,n.jsx)(Xt,{onClose:function(){return ce({showExperienceConfigDrawer:!1})}}),E&&(0,n.jsx)(Wa,{code:E,bizVars:ue.bizVars,pluginToolsList:p==null||(i=p.config)===null||i===void 0?void 0:i.tools,agentComponentList:p==null?void 0:p.config.agent_components,workflowComponentList:p==null?void 0:p.config.workflow_components,userPromptParams:p==null||(v=p.config)===null||v===void 0?void 0:v.prompt_variables,onBizVarsUpdate:function(w){if(C.modalType==="textDialog"||C.modalType==="textGenerate"){var J;(J=D.current)===null||J===void 0||(J=J.chat)===null||J===void 0||J.changeConfigParams({bizVars:w})}ce({bizVars:w})},onCancel:function(){return ce({showVarDrawer:!1})},open:ue.showVarDrawer,onIsBizVarsCompleteChange:function(w){ce({isBizVarsComplete:w})}})]})}var Va=e(95423),Ra=e(21141),za=e(17932),Qn={"expand-btn":"expand-btn___SO4a9",hidden:"hidden___mVNgZ",desc:"desc___rNtVb",tag:"tag___sUHEK",btn:"btn___nzCb1"},Ua=He.Z.agentKnowledgeBaseMaxLimit;function Fa(o){var a=o.item,s=o.handleRemoveKnowledge;return(0,n.jsx)(Ln.Z,{iconType:"spark-readingPreview-line",name:a.name,rightArea:(0,n.jsx)(Y.Z,{gap:12,children:(0,n.jsx)(V.Z,{type:"spark-delete-line",isCursorPointer:!0,onClick:function(){s(a)}})})})}function Ka(){var o,a=(0,c.useContext)(b.H),s=a.appState,r=a.onAppConfigChange,l=((o=s.appBasicConfig)===null||o===void 0?void 0:o.config)||{},i=l.file_search,v=i||{},h=v.kbs,O=h===void 0?[]:h,g=(0,le.Z)({expand:!1,selectVisible:!1}),E=M()(g,2),C=E[0],d=E[1],D=function(he){var ue;r({file_search:u()(u()({},(ue=s.appBasicConfig)===null||ue===void 0?void 0:ue.config.file_search),{},{kbs:he,enable_search:he.length>0?i==null?void 0:i.enable_search:!1})}),d({selectVisible:!1})};(0,c.useEffect)(function(){O.length&&d({expand:!0})},[O]);var p=function(he){D(O.filter(function(ue){return ue.kb_id!==he}))};return(0,n.jsxs)(Y.Z,{vertical:!0,gap:6,className:"mb-[20px]",children:[(0,n.jsxs)(Y.Z,{justify:"space-between",children:[(0,n.jsxs)(Y.Z,{gap:8,className:"text-[13px] font-medium leading-[20px]",style:{color:"var(--ag-ant-color-text)"},align:"center",children:[(0,n.jsx)("span",{children:t.Z.get({id:"main.components.KnowledgeSelectorComp.index.knowledgeBase",dm:"\u77E5\u8BC6\u5E93"})}),(0,n.jsxs)("span",{className:"text-[12px] leading-[20px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:[O.length,"/",Ua]}),(0,n.jsx)(za.Z,{size:"small",className:"ml-[8px]",checked:i==null?void 0:i.enable_search,onChange:function(he){var ue,ce,Se=((ue=s.appBasicConfig)===null||ue===void 0?void 0:ue.config.instructions)||"",re=(ce=s.appBasicConfig)===null||ce===void 0?void 0:ce.config.file_search;he&&!Se.includes("${documents}")&&rn.emit("insertPromptFragment",ai),r({file_search:u()(u()({},re),{},{enable_search:he})})}})]}),(0,n.jsxs)("span",{children:[(0,n.jsx)(m.Z,{style:{padding:0},onClick:function(){return d({selectVisible:!0})},iconType:"spark-plus-line",type:"text",size:"small",disabled:!(i!=null&&i.enable_search),children:t.Z.get({id:"main.components.KnowledgeSelectorComp.index.knowledgeBase",dm:"\u77E5\u8BC6\u5E93"})}),(0,n.jsx)(ln.Z,{type:"vertical",className:"ml-[16px] mr-[16px]"}),(0,n.jsx)(V.Z,{onClick:function(){return d({expand:!C.expand})},className:Ye()(Qn["expand-btn"],!C.expand&&Qn.hidden),type:"spark-up-line",isCursorPointer:!0})]})]}),C.expand&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:Qn.desc,children:[t.Z.get({id:"main.components.KnowledgeSelectorComp.index.addVariable",dm:"\u63D0\u793A\u8BCD\u4E2D\u9700\u8981\u589E\u52A0"}),(0,n.jsx)(Bn.Z,{color:"mauve",className:"ml-[8px]",children:"${documents}"}),t.Z.get({id:"main.components.KnowledgeSelectorComp.index.variableToEnable",dm:"\u7684\u53D8\u91CF\uFF0C\u4EE5\u5B9E\u73B0\u57FA\u4E8E\u77E5\u8BC6\u5E93\u5207\u7247\u7684\u5927\u6A21\u578B\u751F\u6210\u3002"})]}),(0,n.jsx)(Y.Z,{vertical:!0,gap:8,children:O.map(function(_){return _&&(0,n.jsx)(Fa,{handleRemoveKnowledge:function(){return p(_.kb_id)},item:_},_.kb_id)})})]}),C.selectVisible&&(0,n.jsx)(Ra.Sc,{value:O,onClose:function(){d({selectVisible:!1})},onOk:D})]})}var $a=e(518),Zt={"expand-btn":"expand-btn___G04gG",hidden:"hidden___DIGYE"},Ha=He.Z.agentMcpMaxLimit;function Ga(o){var a,s=o.item,r=o.handleRemoveMCP;return(0,n.jsx)(Ln.Z,{iconType:"spark-MCP-mcp-line",name:s.name,rightArea:(0,n.jsxs)(Y.Z,{gap:12,children:[(0,n.jsx)("div",{style:{color:"var(--ag-ant-color-text-tertiary)"},children:(a=s.tools)===null||a===void 0?void 0:a.length}),(0,n.jsx)(V.Z,{type:"spark-delete-line",isCursorPointer:!0,onClick:function(){r(s)}})]})})}function Ja(){var o,a=(0,c.useContext)(b.H),s=a.appState,r=a.onAppConfigChange,l=((o=s.appBasicConfig)===null||o===void 0?void 0:o.config)||{},i=l.mcp_servers,v=i===void 0?[]:i,h=(0,le.Z)({expand:!1,selectVisible:!1}),O=M()(h,2),g=O[0],E=O[1],C=function(p){r({mcp_servers:p})};(0,c.useEffect)(function(){v.length&&E({expand:!0})},[v]);var d=function(p){C(v.filter(function(_){return _.server_code!==p}))};return(0,n.jsxs)(Y.Z,{vertical:!0,gap:6,className:"mb-[20px]",children:[(0,n.jsxs)(Y.Z,{justify:"space-between",align:"center",children:[(0,n.jsxs)(Y.Z,{gap:8,className:"text-[13px] font-medium leading-[20px]",style:{color:"var(--ag-ant-color-text)"},align:"center",children:[(0,n.jsxs)(Y.Z,{align:"center",children:[(0,n.jsx)("span",{children:t.Z.get({id:"main.components.MCPSelectorComp.index.mcpService",dm:"MCP\u670D\u52A1"})}),(0,n.jsx)(on.Z,{content:t.Z.get({id:"main.components.MCPSelectorComp.index.connectInternalServices",dm:"\u667A\u80FD\u4F53\u53EF\u4EE5\u901A\u8FC7\u6807\u51C6\u5316\u534F\u8BAE\uFF08MCP\uFF09\u8FDE\u63A5\u4F01\u4E1A\u5185\u90E8\u670D\u52A1API\u5E76\u53D1\u8D77\u8C03\u7528\u3002"})})]}),(0,n.jsxs)("span",{className:"text-[12px] leading-[20px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:[v.length,"/",Ha]})]}),(0,n.jsxs)("span",{children:[(0,n.jsx)(m.Z,{style:{padding:0},onClick:function(){return E({selectVisible:!0})},iconType:"spark-plus-line",type:"text",size:"small",children:"MCP"}),(0,n.jsx)(ln.Z,{type:"vertical",className:"ml-[16px] mr-[16px]"}),(0,n.jsx)(V.Z,{onClick:function(){return E({expand:!g.expand})},className:Ye()(Zt["expand-btn"],!g.expand&&Zt.hidden),type:"spark-up-line",isCursorPointer:!0})]})]}),g.expand&&(0,n.jsx)(Y.Z,{vertical:!0,gap:8,children:v.map(function(D){return D&&(0,n.jsx)(Ga,{handleRemoveMCP:function(){return d(D.server_code)},item:D},D.server_code)})}),g.selectVisible&&(0,n.jsx)($a.Oy,{selectedServers:v,onOk:C,onClose:function(){E({selectVisible:!1})}})]})}var Qa=e(20585),bt={expandBtn:"expandBtn___uJvPs",hidden:"hidden___V59uX"},_t=He.Z.agentWorkflowComponentMaxLimit;function Ya(){var o,a=(0,c.useContext)(b.H),s=a.appState,r=a.onAppConfigChange,l=a.appCode,i=((o=s.appBasicConfig)===null||o===void 0?void 0:o.config)||{},v=i.workflow_components,h=v===void 0?[]:v,O=(0,le.Z)({expand:!1,selectVisible:!1}),g=M()(O,2),E=g[0],C=g[1],d=function(_){r({workflow_components:_}),C({selectVisible:!1})};(0,c.useEffect)(function(){h.length&&C({expand:!0})},[h]);var D=function(_){d(h.filter(function(he){return he.code!==_}))};return(0,n.jsxs)(Y.Z,{vertical:!0,gap:6,className:"mb-[20px]",children:[(0,n.jsxs)(Y.Z,{justify:"space-between",children:[(0,n.jsxs)(Y.Z,{gap:8,className:"text-[13px] font-medium leading-[20px]",style:{color:"var(--ag-ant-color-text-base)"},align:"center",children:[(0,n.jsxs)(Y.Z,{align:"center",children:[(0,n.jsx)("span",{children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.WorkFlowSelectorComp.index.workflow",dm:"\u5DE5\u4F5C\u6D41"})}),(0,n.jsx)(on.Z,{content:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.WorkFlowSelectorComp.index.workflowDescription",dm:"\u7F16\u6392\u597D\u7684\u5DE5\u4F5C\u6D41\u5E94\u7528\u53EF\u53D1\u5E03\u4E3A\u5DE5\u4F5C\u6D41\u7EC4\u4EF6\uFF0C\u4ECE\u800C\u5B9E\u73B0\u590D\u6742\u3001\u7A33\u5B9A\u7684\u4E1A\u52A1\u6D41\u7A0B\u3002"})})]}),(0,n.jsxs)("span",{className:"text-[12px] leading-[24px]",style:{color:"var(--ag-ant-color-text-tertiary)"},children:[h.length,"/",_t]})]}),(0,n.jsxs)("span",{children:[(0,n.jsx)(m.Z,{style:{padding:0},onClick:function(){return C({selectVisible:!0})},iconType:"spark-plus-line",type:"text",size:"small",children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.WorkFlowSelectorComp.index.workflow",dm:"\u5DE5\u4F5C\u6D41"})}),(0,n.jsx)(ln.Z,{type:"vertical",className:"ml-[16px] mr-[16px]"}),(0,n.jsx)(V.Z,{onClick:function(){return C({expand:!E.expand})},className:Ye()(bt.expandBtn,!E.expand&&bt.hidden),type:"spark-up-line",isCursorPointer:!0})]})]}),E.expand&&(0,n.jsx)(Y.Z,{vertical:!0,gap:8,children:h.map(function(p){return p&&(0,n.jsx)(Ln.Z,{iconType:"spark-processJudgment-line",name:p.name,rightArea:(0,n.jsx)(V.Z,{type:"spark-delete-line",isCursorPointer:!0,onClick:function(){D(p.code)}})},p.code)})}),E.selectVisible&&(0,n.jsx)(at,{maxLength:_t,selected:h,onClose:function(){C({selectVisible:!1})},type:W.zd.WORKFLOW,onSelect:d,appCode:l||""})]})}var Tn={configTimeline:"configTimeline___tRO1N",config:"config___jJvF1",container:"container___MaaPJ",divider:"divider___gcLcV",titleWrapper:"titleWrapper___yu914",header1:"header1___YGqGo",testWindow:"testWindow___Q0pbS",title:"title___h8VgY",formTitle:"formTitle___jAw32",expandBtn:"expandBtn___dfb6j",hidden:"hidden___pqfEG",debugIcon:"debugIcon____5uT5",divider1:"divider1___f4OUO",resizeHandle:"resizeHandle___IFs36"},Xa=e(29944),qa=e(71275),ei=function(a){var s;return a?{model_id:((s=a.model)===null||s===void 0?void 0:s.model_id)||"",provider:a.model_provider||"",params:a.parameter?Object.keys(a.parameter).map(function(r){var l;return{key:r,type:"Number",value:(l=a.parameter)===null||l===void 0?void 0:l[r],enable:!0}}):[]}:qa.pt},ni=function(a,s){return!a.model_id||!a.provider?{}:{model:s,model_provider:a.provider,parameter:a.params?a.params.filter(function(r){return r.enable}).reduce(function(r,l){return r[l.key]=l.value,r},{}):new Object}},ti=function(){var o=(0,c.useContext)(b.H),a=o.appState,s=o.onAppConfigChange,r=a.appBasicConfig;return(0,n.jsx)(Xa.Z,{value:ei(r==null?void 0:r.config),onChange:function(i,v){s(ni(i,v))}})},ai=t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantConfig.index.knowledgeBaseTip",dm:"# \u77E5\u8BC6\u5E93\\n\u8BF7\u8BB0\u4F4F\u4EE5\u4E0B\u6750\u6599\uFF0C\u4ED6\u4EEC\u53EF\u80FD\u5BF9\u56DE\u7B54\u95EE\u9898\u6709\u5E2E\u52A9\u3002\\n${documents}"});function ii(){var o=(0,c.useContext)(b.H),a=o.appState,s=o.setAppState,r=o.appCode,l=o.onAppConfigChange,i=a.appBasicConfig,v=i==null?void 0:i.config.instructions,h=(0,c.useRef)(null),O=(0,le.Z)({leftWidth:33.3,rightWidth:66.7}),g=M()(O,2),E=g[0],C=g[1],d=function(){var he;return i!=null&&(he=i.config)!==null&&he!==void 0&&he.model?!0:(x.ZP.warning(t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantConfig.index.selectModelFirst",dm:"\u8BF7\u5148\u9009\u62E9\u6A21\u578B\uFF01"})),!1)},D=function(){return{left:"".concat(a.modalType,"_").concat(E.leftWidth.toString()),right:"".concat(a.modalType,"_").concat(E.rightWidth.toString())}};(0,c.useLayoutEffect)(function(){Pt(a.modalType)?C({leftWidth:50,rightWidth:50}):C({leftWidth:33.3,rightWidth:66.7})},[a.modalType]);var p=function(){var _=P()(T()().mark(function he(ue,ce){return T()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(r){re.next=2;break}return re.abrupt("return");case 2:s(ue==="draft"?{selectedVersion:"draft",isReleaseVersion:!1}:{selectedVersion:ue,isReleaseVersion:ce===0});case 3:case"end":return re.stop()}},he)}));return function(ue,ce){return _.apply(this,arguments)}}();return(0,n.jsxs)("div",{id:"agent_".concat(r),ref:h,className:Tn.container,style:{background:"var(--ag-ant-color-bg-base)"},children:[(0,n.jsxs)(Xe.eh,{direction:"horizontal",id:"group",children:[(0,n.jsx)(Xe.s_,{minSizePixels:340,defaultSizePercentage:E.leftWidth,id:D().left,order:1,style:{overflowY:"auto"},children:(0,n.jsxs)(en.ZP,{componentDisabled:a.readonly,children:[(0,n.jsx)("div",{className:"p-[8px_20px]",children:(0,n.jsxs)(Y.Z,{justify:"space-between",className:Ye()(Tn.title,"w-full"),children:[t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantConfig.index.apiConfiguration",dm:"API\u914D\u7F6E"}),(0,n.jsx)(ti,{})]})}),(0,n.jsx)(Le.Z,{className:Tn.configTimeline,style:{padding:"0 20px",marginTop:8},items:(0,vn.Z)([{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-[14px] font-medium leading-[24px] mb-[10px]",style:{color:"var(--ag-ant-color-text)"},children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantConfig.index.instruction",dm:"\u6307\u4EE4"})}),(0,n.jsx)(Rt,{maxTokenContext:He.Z.agentSystemPromptMaxLength,appBasicConfig:i,changePrompt:function(he){return l({instructions:he})},prompt:v||""})]}),dot:(0,n.jsx)(V.Z,{className:"width-[20px] height-[20px] rounded-[50%]",type:"spark-code02-line"})},{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-[14px] font-medium leading-[24px] mb-[10px]",style:{color:"var(--ag-ant-color-text)"},children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantConfig.index.knowledge",dm:"\u77E5\u8BC6"})}),(0,n.jsx)(Ka,{})]}),dot:(0,n.jsx)(V.Z,{type:"spark-paper-line"})},{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-[14px] font-medium leading-[24px] mb-[10px]",style:{color:"var(--ag-ant-color-text)"},children:t.Z.get({id:"main.pages.App.AssistantAppEdit.components.AssistantConfig.index.skill",dm:"\u6280\u80FD"})}),(0,n.jsx)(Ja,{}),(0,n.jsx)(Qa.ZP,{}),(0,n.jsx)(Dt,{}),(0,n.jsx)(Ya,{})]}),dot:(0,n.jsx)(V.Z,{type:"spark-toolbox-line"})}])})]})}),(0,n.jsx)(Xe.OT,{className:Tn.resizeHandle,children:(0,n.jsx)("div",{className:Tn.divider1,children:(0,n.jsx)("img",{draggable:!1,src:"/images/panelResizeHandle.svg",alt:""})})}),(0,n.jsx)(Xe.s_,{minSizePixels:600,defaultSizePercentage:E.rightWidth,order:2,id:D().right,children:(0,n.jsx)(en.ZP,{componentDisabled:!a.canChat,children:(0,n.jsx)("div",{className:Tn.testWindow,children:(0,n.jsx)(Ia,{appStatus:a.appStatus,beforeSendValidate:d,maxTokenContext:He.Z.agentUserPromptMaxLength,assistantId:r})})})})]}),a.showHistoryPanel&&r&&i&&(0,n.jsx)(Va.Z,{hasInitData:!0,appDetail:i,onSelectVersion:p,selectedVersion:a.selectedVersion,onClose:function(){s({showHistoryPanel:!1})}})]})}var Yn={page:"page___vh3Ba",tab:"tab___xcsLa",fullScreen:"fullScreen___bOzZz"},si=["tools","mcp_servers","file_search","agent_components","workflow_components"],Xn=function(a){return a!=null&&a.length?(0,oe.gv)(a.map(function(s){return s.id})).then(function(s){return s.data.filter(function(r){return!!r})||[]}):Promise.resolve([])},qn=function(a){return a!=null&&a.length?(0,I.gi)({server_codes:a,need_tools:!0}).then(function(s){return s.data.filter(function(r){return!!r})||[]}):Promise.resolve([])},Dn=function(a){return a!=null&&a.length?(0,W.ot)(a).then(function(s){return s}):Promise.resolve([])},et=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return a.length?(0,L.Y6)(a):Promise.resolve([])},Et=function(a){var s,r,l=a.tools,i=a.mcp_servers,v=a.file_search,h=a.agent_components,O=a.workflow_components,g=q()(a,si),E=u()(u()({},g),{},{model:(s=g.model)===null||s===void 0?void 0:s.model_id,tools:(l==null?void 0:l.map(function(C){return{id:C.tool_id}}))||[],mcp_servers:(i==null?void 0:i.map(function(C){return{id:C.server_code}}))||[],agent_components:(h==null?void 0:h.map(function(C){return C.code}))||[],workflow_components:(O==null?void 0:O.map(function(C){return C.code}))||[],file_search:u()(u()({},v),{},{kb_ids:(v==null||(r=v.kbs)===null||r===void 0?void 0:r.map(function(C){return C.kb_id}))||[],kbs:void 0})});return E};function Pt(o){return["textDialog","textGenerate"].includes(o)}function oi(){var o,a,s,r,l,i=(0,X.UO)(),v=i.id,h=(0,X.UO)(),O=h.tabKey,g=O===void 0?"config":O,E=(0,le.Z)({activeKey:g,appBasicConfig:null,loading:!0,modelList:[],saveLoading:!1,appStatus:"draft",autoSaveTime:"",modalType:"textDialog",showHistoryPanel:!1,selectedVersion:"draft",historyRefreshCount:0,flushing:!1,hasInitData:!1,showEditNameModal:!1,isReleaseVersion:!1,readonly:!1,canChat:!0}),C=M()(E,2),d=C[0],D=C[1],p=(0,c.useRef)(null),_=(0,c.useRef)(null),he=function(){return p.current?Et(p.current.config):null},ue=function(){var w=P()(T()().mark(function J(F){var H,ae,Me,Pe,G,ze,qe,fe,ve;return T()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(Me=[],Pe=void 0,!(F.config.model&&F.config.model_provider)){me.next=6;break}return me.next=5,(0,se.vu)(F.config.model_provider,F.config.model);case 5:Pe=me.sent.data;case 6:return me.next=9,Xn(F.config.tools);case 9:Me=me.sent;case 10:return me.next=12,qn(((H=F.config.mcp_servers)===null||H===void 0?void 0:H.map(function(je){return je.id}))||[]);case 12:return G=me.sent,me.next=15,Dn(F.config.agent_components);case 15:return ze=me.sent,me.next=18,Dn(F.config.workflow_components);case 18:return qe=me.sent,me.next=21,et((ae=F.config.file_search)===null||ae===void 0?void 0:ae.kb_ids);case 21:fe=me.sent,ve=u()(u()({},F),{},{config:u()(u()({},F.config),{},{tools:Me,mcp_servers:G,agent_components:ze,workflow_components:qe,model:Pe,file_search:u()(u()({},F.config.file_search),{},{kbs:fe})})}),p.current=ve,D({appBasicConfig:ve,appStatus:F.status,loading:!1});case 25:case"end":return me.stop()}},J)}));return function(F){return w.apply(this,arguments)}}(),ce=function(){var w=P()(T()().mark(function J(){var F,H,ae,Me;return T()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(v!=null&&v.length){G.next=2;break}return G.abrupt("return");case 2:if(D({hasInitData:!1}),d.selectedVersion!=="draft"){G.next=9;break}return G.next=6,(0,K.le)(v);case 6:H=G.sent,G.next=16;break;case 9:if(d.appBasicConfig){G.next=11;break}return G.abrupt("return");case 11:return G.next=13,(0,K.YI)(v,d.selectedVersion);case 13:ae=G.sent,Me=JSON.parse(ae.data.config),H={app_id:v,name:d.appBasicConfig.name,description:d.appBasicConfig.description,status:d.appBasicConfig.status,gmt_modified:ae.data.gmt_modified,config:Me,type:W.zd.AGENT,pub_config:d.appBasicConfig.pub_config};case 16:return D({modalType:((F=H)===null||F===void 0||(F=F.config)===null||F===void 0?void 0:F.modality_type)||"textDialog"}),rn.emit("setEditorCon",H.config.instructions),G.next=20,ue(H);case 20:D({hasInitData:!0});case 21:case"end":return G.stop()}},J)}));return function(){return w.apply(this,arguments)}}(),Se=(0,De.Z)(function(w){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.current;if(!(d.saveLoading||!v)){D(function(Me){return u()(u()({},Me),{},{saveLoading:!0,autoSaveTime:y()().format("HH:mm:ss"),appStatus:Me.appStatus==="published"?"published_editing":Me.appStatus})});var F=he();if(F){var H,ae;(0,K.KT)({app_id:v,name:(H=p.current)===null||H===void 0?void 0:H.name,description:(ae=p.current)===null||ae===void 0?void 0:ae.description,config:F}).then(function(){w&&ce()}).finally(function(){D({saveLoading:!1})})}}},{wait:300}),re=Se.run,de=function(J){var F,H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ae=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Me=u()(u()(u()({},p.current),J),{},{config:u()(u()({},(F=p.current)===null||F===void 0?void 0:F.config),J.config)});p.current=Me,D({appBasicConfig:Me,appStatus:Me.status}),H||re(ae)},$=function(J){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;d.readonly||de({config:J},F,H)};return(0,c.useEffect)(function(){d.flushing&&D({showHistoryPanel:!1})},[d.flushing]),(0,c.useEffect)(function(){var w;d.hasInitData&&((w=d.appBasicConfig)===null||w===void 0?void 0:w.config.modality_type)!==d.modalType&&$({modality_type:d.modalType},!1,!0)},[d.modalType,d.hasInitData]),(0,c.useEffect)(function(){var w;D({canChat:(d.isReleaseVersion||d.selectedVersion==="draft")&&!!((w=d.appBasicConfig)!==null&&w!==void 0&&(w=w.config)!==null&&w!==void 0&&(w=w.model)!==null&&w!==void 0&&(w=w.model_id)!==null&&w!==void 0&&w.length),readonly:d.selectedVersion!=="draft"})},[d.isReleaseVersion,d.selectedVersion,(o=d.appBasicConfig)===null||o===void 0||(o=o.config)===null||o===void 0||(o=o.model)===null||o===void 0?void 0:o.model_id]),(0,c.useEffect)(function(){ce()},[d.selectedVersion]),(0,n.jsx)(b.H.Provider,{value:{appState:d,setAppState:D,onAppConfigChange:$,onAppChange:de,autoSave:re,appCode:v,getSaveData:he,refreshAppDetail:ce,sparkChatComponentRef:_},children:(0,n.jsxs)("div",{className:Yn.page,children:[(0,n.jsx)(we.Z,{spinning:d.loading,rootClassName:Yn.loading,children:!d.loading&&!d.appBasicConfig?(0,n.jsx)(Z.Z,{description:t.Z.get({id:"main.pages.App.AssistantAppEdit.index.appNotExists",dm:"\u5E94\u7528\u4E0D\u5B58\u5728\uFF0C\u8BF7\u8FD4\u56DE"})}):(0,n.jsx)(te.Z,{loading:d.loading,onTabChange:function(J){D({activeKey:J})},activeTab:d.activeKey,right:(0,n.jsx)(Ve,{activeKey:d.activeKey,updateAppDetailWithInfos:ue}),breadcrumbLinks:[{title:t.Z.get({id:"main.pages.App.AssistantAppEdit.index.appManagement",dm:"\u5E94\u7528\u7BA1\u7406"}),path:"/app/agent"},{title:(0,n.jsxs)(Y.Z,{align:"center",gap:8,children:[(0,n.jsx)(ge.Z.Text,{ellipsis:{tooltip:(0,Ee.rb)(((a=d.appBasicConfig)===null||a===void 0?void 0:a.name)||"",{getPopupContainer:function(){return document.body}})},children:(0,n.jsx)("span",{className:"text-[16px]",children:(s=d.appBasicConfig)===null||s===void 0||(s=s.name)===null||s===void 0?void 0:s.trim()})}),(0,n.jsx)(V.Z,{className:Yn.icon,onClick:function(){D({showEditNameModal:!0})},type:"spark-edit-line"})]})}],left:(0,n.jsx)(Re.Z,{appStatus:d.appStatus,autoSaveTime:d.autoSaveTime}),tabs:[{key:"config",label:t.Z.get({id:"main.pages.App.AssistantAppEdit.index.appConfig",dm:"\u914D\u7F6E"}),children:!d.loading&&(0,n.jsx)(ii,{})},{key:"share",label:t.Z.get({id:"main.pages.App.AssistantAppEdit.index.publishChannels",dm:"\u53D1\u5E03"}),children:!d.loading&&(0,n.jsx)(Q.Z,{app_id:v||"",status:d.appStatus,type:W.zd.AGENT})}]})}),d.showEditNameModal&&(0,n.jsx)(R.a,{app_id:v||"",name:(r=d.appBasicConfig)===null||r===void 0?void 0:r.name,description:(l=d.appBasicConfig)===null||l===void 0?void 0:l.description,onOk:function(){ce(),D({showEditNameModal:!1})},onClose:function(){D({showEditNameModal:!1})},maxLength:50})]})})}},71275:function(Ke,Ce,e){e.d(Ce,{Dw:function(){return q},IW:function(){return U},Jp:function(){return u},PH:function(){return P},W6:function(){return A},Yj:function(){return te},_i:function(){return T},km:function(){return M},pt:function(){return t},x9:function(){return ne},yM:function(){return ee}});var f=e(22453),T=[{key:"name",type:"String",desc:""},{key:"age",type:"Number",desc:""}],U=[{key:"output",value_from:"refer",type:"String",value:void 0}],P=[{key:"output",type:"String",desc:f.Z.get({id:"main.pages.App.Workflow.constant.index.textOutput",dm:"\u6587\u672C\u8F93\u51FA"})}],ee=[{key:"output",type:"String",desc:f.Z.get({id:"main.pages.App.Workflow.constant.index.textOutput",dm:"\u6587\u672C\u8F93\u51FA"})},{key:"reasoning_content",type:"String",desc:f.Z.get({id:"main.pages.App.Workflow.constant.index.depthThinkingContent",dm:"\u6DF1\u5EA6\u601D\u8003\u5185\u5BB9"})}],M=[{key:"input1",value_from:"input",value:"1",type:"Number"},{key:"input2",value_from:"input",value:"2",type:"Number"}],A=[{key:"output",type:"Number",desc:f.Z.get({id:"main.pages.App.Workflow.constant.index.twoNumbersSum",dm:"\u4E24\u6570\u76F8\u52A0\u7684\u7ED3\u679C"})}],u={retry_enabled:!1,max_retries:3,retry_interval:500},ne={strategy:"noop"},q=function(L){return{strategy:"noop",default_values:L}},te={enabled:!1,type:"self",round:3,param:{key:"historyList",type:"Array<String>",value_from:"refer",value:void 0}},t={model_id:"",model_name:"",mode:"chat",provider:"",params:[],vision_config:{enable:!1,params:[{key:"imageContent",value_from:"refer",type:"File",value:void 0}]}},W={Number:[{label:f.Z.get({id:"main.pages.App.Workflow.constant.equal",dm:"\u7B49\u4E8E"}),value:"equals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEqual",dm:"\u4E0D\u7B49\u4E8E"}),value:"notEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.greaterThan",dm:"\u5927\u4E8E"}),value:"greater"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.greaterThanOrEqual",dm:"\u5927\u4E8E\u7B49\u4E8E"}),value:"greaterAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lessThan",dm:"\u5C0F\u4E8E"}),value:"less"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lessThanOrEqual",dm:"\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lessAndEqual"}],"Array<Boolean>":[{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],Boolean:[{label:f.Z.get({id:"main.pages.App.Workflow.constant.equal",dm:"\u7B49\u4E8E"}),value:"equals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEqual",dm:"\u4E0D\u7B49\u4E8E"}),value:"notEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.isTrue",dm:"\u4E3Atrue"}),value:"isTrue"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.isFalse",dm:"\u4E3Afalse"}),value:"isFalse"}],"Array<File>":[{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"}],"Array<Object>":[{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"}],String:[{label:f.Z.get({id:"main.pages.App.Workflow.constant.equal",dm:"\u7B49\u4E8E"}),value:"equals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEqual",dm:"\u4E0D\u7B49\u4E8E"}),value:"notEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],File:[{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"}],"Array<String>":[{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],"Array<Number>":[{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthEqual",dm:"\u957F\u5EA6\u7B49\u4E8E"}),value:"lengthEquals"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThan",dm:"\u957F\u5EA6\u5927\u4E8E"}),value:"lengthGreater"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthGreaterThanOrEqual",dm:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E"}),value:"lengthGreaterAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThan",dm:"\u957F\u5EA6\u5C0F\u4E8E"}),value:"lengthLess"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.lengthLessThanOrEqual",dm:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E"}),value:"lengthLessAndEqual"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}],Object:[{label:f.Z.get({id:"main.pages.App.Workflow.constant.empty",dm:"\u4E3A\u7A7A"}),value:"isNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notEmpty",dm:"\u4E0D\u4E3A\u7A7A"}),value:"isNotNull"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.contains",dm:"\u5305\u542B"}),value:"contains"},{label:f.Z.get({id:"main.pages.App.Workflow.constant.notContains",dm:"\u4E0D\u5305\u542B"}),value:"notContains"}]}},40755:function(Ke,Ce,e){e.d(Ce,{e:function(){return Ee}});var f=e(87329),T=e.n(f),U=e(42035),P=e.n(U),ee=e(23939),M=e(87629),A=e(15127),u=e(45753),ne=e(2821),q=e(5693),te=e(35276),t=e(81596),W=e(12524),K=e.n(W),L=e(2784),I=e(28842),se=e(22453),oe=e(96100),Z=e(52322),Ee=(0,oe.n)("channel-config");Ce.Z=(0,L.memo)(function(le){var De=le.app_id,we=le.disabled,Y=we===void 0?!1:we,ge=le.type,B=(0,ne.Z)({referVisible:!1,editVisible:!1,createVisible:!1,detail:null}),y=P()(B,2),c=y[0],X=y[1],Q=function(){(0,A.AE)(De).then(function(b){X(b?{detail:b}:{detail:null})})};return(0,q.Z)(function(){Q()}),(0,L.useEffect)(function(){return Ee.on("openCompCfg",function(){X({createVisible:!0})}),function(){Ee.removeAllListeners()}},[]),(0,Z.jsxs)("div",{className:K()(I.Z.card,T()({},I.Z.disabled,Y)),children:[(0,Z.jsx)("div",{className:I.Z["img-con"],children:(0,Z.jsx)("img",{alt:"appComponent",src:"/images/appComponent.svg"})}),(0,Z.jsxs)("div",{className:"flex flex-col gap-[4px] flex-1",children:[(0,Z.jsx)("div",{className:I.Z.name,children:se.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.component",dm:"\u7EC4\u4EF6"})}),(0,Z.jsx)("div",{className:I.Z.desc,children:se.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.configureInput",dm:"\u4EE5\u7EC4\u4EF6\u7684\u5F62\u5F0F\u53D1\u5E03\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u5E94\u7528\uFF0C\u9700\u8981\u914D\u7F6E\u5165\u53C2\uFF0C\u53D1\u5E03\u540E\u7528\u6237\u53EF\u4EE5\u901A\u8FC7\u7EC4\u4EF6\u7684\u65B9\u5F0F\u5728\u5176\u4ED6\u5E94\u7528\u4E2D\u9ED1\u76D2\u7684\u5F15\u7528\u8FD9\u4E2A\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u7684\u5185\u5BB9"})})]}),Y?null:c.detail?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(te.ZP,{onClick:function(){return X({referVisible:!0})},size:"small",type:"text",icon:(0,Z.jsx)(u.Z,{type:"spark-projectNo-line"}),className:"self-center",children:se.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.referenceDetails",dm:"\u7EC4\u4EF6\u5F15\u7528\u8BE6\u60C5"})}),(0,Z.jsx)(t.Z,{className:"self-center",type:"vertical",style:{margin:0}}),(0,Z.jsx)(te.ZP,{onClick:function(){return X({editVisible:!0})},size:"small",type:"text",icon:(0,Z.jsx)(u.Z,{type:"spark-edit-line"}),className:"self-center",children:se.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.edit",dm:"\u7F16\u8F91"})})]}):(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(te.ZP,{onClick:function(){X({createVisible:!0})},size:"small",type:"text",className:"self-center",icon:(0,Z.jsx)(u.Z,{type:"spark-plus-line"}),children:se.Z.get({id:"main.pages.App.components.ChannelConfig.PublishComponentCard.create",dm:"\u521B\u5EFA"})})}),c.referVisible&&c.detail&&(0,Z.jsx)(M.Z,{data:c.detail,onClose:function(){return X({referVisible:!1})}}),c.editVisible&&c.detail&&(0,Z.jsx)(ee.Z,{onOk:function(){X({editVisible:!1})},data:c.detail,onClose:function(){return X({editVisible:!1})}}),c.createVisible&&(0,Z.jsx)(ee.Z,{onOk:function(){Q(),X({createVisible:!1})},onClose:function(){X({createVisible:!1})},data:{app_id:De,type:ge}})]})})},5054:function(Ke,Ce,e){e.d(Ce,{Z:function(){return De}});var f=e(87329),T=e.n(f),U=e(22453),P=e(12524),ee=e.n(P),M=e(2784),A=e(42035),u=e.n(A),ne=e(85545),q=e(15127),te=e(72624),t=e(45753),W=e(95559),K=e(77751),L=e(19612),I=e(12901),se=e(50381),oe=e.n(se),Z=e(52322);function Ee(we){var Y=(0,M.useState)(!1),ge=u()(Y,2),B=ge[0],y=ge[1],c=U.Z.get({id:"main.pages.App.components.ChannelConfig.index.viewApi",dm:"\u67E5\u770BAPI"}),X=(0,M.useMemo)(function(){return we.type===q.zd.WORKFLOW?`curl -X 'POST' \\
'`.concat(ne.v2.get(),`/api/v1/apps/workflow/completions' \\
-H 'accept: */*' \\
-H 'Authorization: Bearer sk-xxxxxxxxxxxxxxxxxx' \\
-H 'Content-Type: application/json' \\
-d '{
  "app_id": "`).concat(we.appId,`",
  "inputParams": [
    {
      "key": "query",
      "type": "String",
      "desc": "user questions",
      "required": false,
      "source": "sys",
      "value": "What is Spring AI Alibaba?"
    }
  ],
  "stream": true
}'`):`curl -X 'POST' \\
'`.concat(ne.v2.get(),`/api/v1/apps/chat/completions' \\
-H 'accept: */*' \\
-H 'Authorization: Bearer sk-xxxxxxxxxxxxxxxxxx' \\
-H 'Content-Type: application/json' \\
-d '{
  "app_id": "`).concat(we.appId,`",
  "messages": [
    {
      "role": "user",
      "content": "What is Spring AI Alibaba?",
      "content_type": "text"
    }
  ],
  "stream": true
}'`)},[we.appId,we.type]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(te.Z,{onClick:function(){return y(!0)},type:"text",size:"small",className:"self-center",icon:(0,Z.jsx)(t.Z,{type:"spark-fileCode-line"}),children:c}),(0,Z.jsx)(W.Z,{open:B,onClose:function(){return y(!1)},width:640,title:c,children:(0,Z.jsx)(K.Z,{title:"curl",expandOnPanelClick:!1,extra:(0,Z.jsx)(t.Z,{type:"spark-copy-line",size:"small",onClick:function(){oe()(X),L.Z.success(U.Z.get({id:"main.pages.App.index.copySuccess",dm:"\u590D\u5236\u6210\u529F"}))}}),children:(0,Z.jsx)(I.ZP,{language:[],value:X,readOnly:!0})})})]})}var V=e(28842),le=e(40755),De=(0,M.memo)(function(Y){var ge=(0,M.useMemo)(function(){return Y.status==="draft"},[Y.status]);return(0,Z.jsxs)("div",{className:V.Z.container,children:[(0,Z.jsx)("div",{className:V.Z.title,children:U.Z.get({id:"main.pages.App.components.ChannelConfig.index.callMethod",dm:"\u8C03\u7528\u65B9\u5F0F"})}),(0,Z.jsxs)("div",{className:ee()(V.Z.card,T()({},V.Z.disabled,ge)),children:[(0,Z.jsx)("div",{className:V.Z["img-con"],children:(0,Z.jsx)("img",{alt:"applicationApi",src:"/images/applicationApi.svg"})}),(0,Z.jsxs)("div",{className:"flex flex-col gap-[4px] flex-1",children:[(0,Z.jsx)("div",{className:V.Z.name,children:U.Z.get({id:"main.pages.App.components.ChannelConfig.index.apiCall",dm:"API\u8C03\u7528"})}),(0,Z.jsx)("div",{className:V.Z.desc,children:U.Z.get({id:"main.pages.App.components.ChannelConfig.index.callWithApiKey",dm:`\u4EE5API\u7684\u5F62\u5F0F\u8C03\u7528\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u5E94\u7528\uFF0C\u9700\u8981\u4F20\u5165\u5E94\u7528ID\u3001API-KEY\u7B49\u53C2\u6570\u503C\uFF0C\u652F\u6301\u901A\u8FC7\u517C\u5BB9
            OpenAI \u534F\u8BAE\u7684 Http \u534F\u8BAE\u53D1\u8D77\u8BF7\u6C42`})})]}),(0,Z.jsx)(Ee,{type:Y.type,appId:Y.app_id})]}),(0,Z.jsx)(le.Z,{type:Y.type,disabled:ge,app_id:Y.app_id})]})})},45642:function(Ke,Ce,e){e.d(Ce,{a:function(){return q}});var f=e(42035),T=e.n(f),U=e(22453),P=e(1905),ee=e(58541),M=e(19612),A=e(84546),u=e(4513),ne=e(52322),q=function(t){var W=ee.Z.useForm(),K=T()(W,1),L=K[0],I=function(){L.validateFields().then(function(oe){(0,P.KT)({app_id:t.app_id,name:oe.name,description:oe.description}).then(function(){M.Z.success(U.Z.get({id:"main.pages.App.components.EditNameModal.index.updateSuccess",dm:"\u66F4\u65B0\u6210\u529F"})),t.onOk()})})};return(0,ne.jsx)(A.Z,{open:!0,onCancel:t.onClose,onOk:I,title:U.Z.get({id:"main.pages.App.components.EditNameModal.index.editAppName",dm:"\u7F16\u8F91\u5E94\u7528\u540D\u79F0"}),children:(0,ne.jsxs)(ee.Z,{initialValues:{name:t.name,description:t.description},form:L,layout:"vertical",children:[(0,ne.jsx)(ee.Z.Item,{required:!0,rules:[{required:!0,message:U.Z.get({id:"main.pages.App.components.EditNameModal.index.enterAppName",dm:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0"})}],label:U.Z.get({id:"main.pages.App.components.EditNameModal.index.appName",dm:"\u5E94\u7528\u540D\u79F0"}),name:"name",children:(0,ne.jsx)(u.Z,{style:{height:36,marginBottom:12},maxLength:(t==null?void 0:t.maxLength)||50,showCount:{formatter:function(oe){var Z=oe.count,Ee=oe.maxLength;return(0,ne.jsxs)(ne.Fragment,{children:[Z,"/",Ee]})}},placeholder:U.Z.get({id:"main.pages.App.components.EditNameModal.index.enterAppName",dm:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0"})})}),(0,ne.jsx)(ee.Z.Item,{label:U.Z.get({id:"main.pages.App.components.EditNameModal.index.appDescription",dm:"\u5E94\u7528\u63CF\u8FF0"}),name:"description",children:(0,ne.jsx)(u.Z.TextArea,{style:{height:150},maxLength:200,placeholder:U.Z.get({id:"main.pages.App.components.EditNameModal.index.enterAppDescription",dm:"\u8BF7\u8F93\u5165\u5E94\u7528\u63CF\u8FF0"})})})]})})}},21141:function(Ke,Ce,e){e.d(Ce,{Sc:function(){return b},d7:function(){return R}});var f=e(49616),T=e.n(f),U=e(13311),P=e.n(U),ee=e(42035),M=e.n(ee),A=e(87329),u=e.n(A),ne=e(6927),q=e(22453),te=e(76077),t=e(19612),W=e(72624),K=e(45753),L=e(51034),I=e(84546),se=e(95559),oe=e(2821),Z=e(5693),Ee=e(35899),V=e(71938),le=e(74465),De=e(9454),we=e(12524),Y=e.n(we),ge=e(2784),B={card:"card___SGuz7",active:"active___ILvDd",title:"title___CAZdV",desc:"desc___szLOw","list-wrap":"list-wrap___c3haO",drawer:"drawer___d4qTy",page:"page___tSPMe","drawer-wrap":"drawer-wrap___btfkL","modal-wrap":"modal-wrap___GmyAo"},y=e(52322),c=10;function X(S){var k=(0,ge.useMemo)(function(){return S.value.some(function(m){return m.kb_id===S.item.kb_id})},[S.value,S.item.kb_id]);return(0,y.jsxs)("div",{className:Y()(B.card,u()({},B.active,k)),onClick:function(){return S.onCheckChange(!k)},children:[(0,y.jsx)(Ee.Z,{checked:k,onChange:function(j){return S.onCheckChange(j.target.checked)}}),(0,y.jsx)("img",{src:"/images/knowledge.svg",alt:""}),(0,y.jsxs)("div",{className:"flex flex-col flex-1 w-[1px] gap-[4px]",children:[(0,y.jsxs)("div",{className:"flex gap-[8px]",children:[(0,y.jsx)(V.Z.Text,{ellipsis:!0,className:B.title,children:S.item.name}),(0,y.jsx)("span",{children:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.knowledgeCount",dm:"{var1}\u4E2A\u77E5\u8BC6"},{var1:S.item.total_docs})})]}),(0,y.jsx)(V.Z.Text,{ellipsis:{tooltip:S.item.description},className:B.desc,children:S.item.description})]})]})}function Q(S){var k=S.mode,m=k===void 0?"modal":k,j=(0,oe.Z)({list:[],loading:!1,current:1,size:10,name:"",total:0}),x=M()(j,2),N=x[0],z=x[1],pe=(0,ge.useRef)(!1),ie=function(){var Ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};z({loading:!0});var Ie=pe.current?{name:N.name}:{};(0,te.eU)(P()(P()({current:N.current,size:N.size},Ae),Ie)).then(function(Je){z({list:Je.records,total:Je.total,loading:!1})}).catch(function(){z({loading:!1})})},ye=function(){pe.current=!!N.name,z({current:1}),ie({current:1})},be=function(Ae,Ie){if(Ae){if(S.value.length>=c){t.Z.warning(q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.maxTenKnowledge",dm:"\u6700\u591A\u53EA\u80FD\u9009\u62E910\u4E2A\u77E5\u8BC6\u5E93"}));return}S.onChange([].concat(T()(S.value),[Ie]))}else S.onChange(S.value.filter(function(Je){return Ie.kb_id!==Je.kb_id}))};return(0,Z.Z)(function(){ie()}),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"flex-justify-between px-[24px]",children:[(0,y.jsx)(ne.Z,{onSearch:ye,placeholder:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.enterKnowledgeName",dm:"\u8BF7\u8F93\u5165\u77E5\u8BC6\u5E93\u540D\u79F0"}),onChange:function(Ae){return z({name:Ae})},value:N.name,className:B.search}),(0,y.jsx)(W.Z,{onClick:function(){return window.open("/knowledge")},icon:(0,y.jsx)(K.Z,{type:"spark-plus-line"}),children:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.createNewKnowledge",dm:"\u521B\u5EFA\u65B0\u77E5\u8BC6\u5E93"})})]}),(0,y.jsx)("div",{className:Y()(B["list-wrap"],B[m]),children:N.loading?(0,y.jsx)("div",{className:"loading-center",children:(0,y.jsx)(le.Z,{className:"loading-center",spinning:!0})}):N.list.length?(0,y.jsx)("div",{className:"flex flex-col gap-[16px]",children:N.list.map(function(n){return(0,y.jsx)(X,{item:n,value:S.value,onCheckChange:function(Ie){be(Ie,n)}},n.kb_id)})}):(0,y.jsx)("div",{className:"loading-center",children:(0,y.jsx)(L.Z,{title:pe.current?q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.noSearchResult",dm:"\u672A\u641C\u7D22\u51FA\u6765\u7B26\u5408\u6761\u4EF6\u7684\u77E5\u8BC6\u5E93"}):q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.noKnowledge",dm:"\u6682\u65E0\u77E5\u8BC6\u5E93"}),description:pe.current?q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.tryAnotherSearch",dm:"\u6362\u4E2A\u641C\u7D22\u6761\u4EF6\u8BD5\u8BD5"}):q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.goCreateFirst",dm:"\u8BF7\u5148\u524D\u5F80\u77E5\u8BC6\u5E93\u7BA1\u7406\u521B\u5EFA\u77E5\u8BC6\u5E93"}),children:!pe.current&&(0,y.jsx)(W.Z,{className:"mt-[12px]",onClick:function(){return window.open("/knowledge")},type:"primary",children:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.goCreate",dm:"\u524D\u5F80\u521B\u5EFA"})})})})}),(0,y.jsx)(De.Z,{className:B.page,current:N.current,pageSize:N.size,total:N.total,hideOnSinglePage:!0,onChange:function(Ae,Ie){z({current:Ae,size:Ie}),ie({current:Ae,size:Ie})}})]})}function R(S){var k=(0,ge.useState)(S.value||[]),m=M()(k,2),j=m[0],x=m[1];return(0,y.jsx)(I.Z,{title:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.selectKnowledge",dm:"\u9009\u62E9\u77E5\u8BC6\u5E93"}),onOk:function(){return S.onOk(j)},open:!0,width:640,className:B["modal-wrap"],onCancel:S.onClose,children:(0,y.jsx)("div",{className:"py-[18px] gap-[12px] flex flex-col",children:(0,y.jsx)(Q,{value:j,onChange:x})})})}function b(S){var k=(0,ge.useState)(S.value||[]),m=M()(k,2),j=m[0],x=m[1];return(0,y.jsx)(se.Z,{title:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.selectKnowledge",dm:"\u9009\u62E9\u77E5\u8BC6\u5E93"}),footer:(0,y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"w-full",children:[(0,y.jsx)("div",{style:{color:"var(--ag-ant-color-text-tertiary)",fontSize:"14px",fontWeight:"normal",lineHeight:"24px"},children:!!(j!=null&&j.length)&&q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.addedKnowledgeBase",dm:"\u5DF2\u6DFB\u52A0\u77E5\u8BC6\u5E93{var1}/{var2}\u4E2A"},{var1:j==null?void 0:j.length,var2:c})}),(0,y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,y.jsx)(W.Z,{onClick:S.onClose,children:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,y.jsx)(W.Z,{type:"primary",onClick:function(){return S.onOk(j)},children:q.Z.get({id:"main.pages.App.components.KnowledgeSelector.index.confirm",dm:"\u786E\u5B9A"})})]})]}),onClose:S.onClose,open:!0,width:640,className:B["drawer-wrap"],children:(0,y.jsx)("div",{className:"py-[18px] h-full overflow-y-auto flex flex-col gap-[12px]",children:(0,y.jsx)(Q,{mode:"drawer",value:j,onChange:x})})})}},518:function(Ke,Ce,e){e.d(Ce,{Oy:function(){return m},gj:function(){return x}});var f=e(49616),T=e.n(f),U=e(42035),P=e.n(U),ee=e(22453),M=e(97948),A=e(93185),u=e(13341),ne=e(76042),q=e(4513),te=e(45753),t=e(19612),W=e(63781),K=e(51034),L=e(95559),I=e(72624),se=e(84546),oe=e(2821),Z=e(91030),Ee=e(74465),V=e(66520),le=e(2784),De=e(17029),we=e(87329),Y=e.n(we),ge=e(3318),B=e(35899),y=e(71938),c=e(56733),X=e(12524),Q=e.n(X),R={"mcp-server-wrapper":"mcp-server-wrapper___gIbje",active:"active___zojjr",expanded:"expanded___BQbUP","fold-icon":"fold-icon___bcvV1",rotated:"rotated___NtW1a","tools-container":"tools-container___aRfg6",desc:"desc___H4ivZ"},b=e(52322),S=function(N){var z,pe,ie=N.item,ye=N.selectMode,be=N.selectedServers,n=be===void 0?[]:be,Ae=N.selectedTool,Ie=(0,le.useState)(!1),Je=P()(Ie,2),Be=Je[0],Ve=Je[1],Re=(0,le.useState)(!0),He=P()(Re,2),en=He[0],Le=He[1],mn=(0,le.useState)(0),Ye=P()(mn,2),vn=Ye[0],Xe=Ye[1],on=(0,le.useRef)(null);(0,le.useEffect)(function(){var Ue;Ve(ye==="server"?!!n.find(function(Oe){return Oe.server_code===ie.server_code}):!!((Ue=ie.tools)!==null&&Ue!==void 0&&Ue.find(function(Oe){return Oe.name===(Ae==null?void 0:Ae.name)})))},[ie,ye,Ae,n]),(0,le.useEffect)(function(){ye==="tool"&&Be&&Le(!1)},[Be,ye]),(0,le.useEffect)(function(){on.current&&Xe(en?0:on.current.scrollHeight)},[en,ie.tools]);var ln=function(){Le(!en)};return(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:Q()(R["mcp-server-wrapper"],Y()(Y()({},R.active,Be),R.expanded,!en)),style:{padding:"12px 16px"},children:(0,b.jsxs)(Z.Z,{gap:8,children:[ye==="server"&&(0,b.jsx)(B.Z,{checked:Be,onChange:function(Oe){if(Oe.target.checked){var an;(an=N.onSelectServer)===null||an===void 0||an.call(N,ie)}else{var Ne;(Ne=N.onRemoveServer)===null||Ne===void 0||Ne.call(N,ie.server_code)}},disabled:ie.status===ne.YI.DISABLED}),(0,b.jsxs)(Z.Z,{gap:8,className:"w-full h-[52px] flex-1",align:"center",children:[(0,b.jsx)(Z.Z,{align:"center",className:"h-[40px] w-[40px]",children:(0,b.jsx)(Z.Z,{align:"center",justify:"center",className:"h-[40px] w-[40px] rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)"},children:(0,b.jsx)(te.Z,{className:"h-full w-full rounded-[6px]",type:"spark-MCP-mcp-line"})})}),(0,b.jsxs)("div",{style:{width:"calc(100% - 48px)"},children:[(0,b.jsxs)(Z.Z,{justify:"space-between",className:"header leading-[22px] h-[22px]",children:[(0,b.jsx)("div",{className:"text-[16px] font-semibold  mr-[4px] ",style:{color:"var(--ag-ant-color-text-base)",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",width:0,flex:1},children:ie.name}),(0,b.jsxs)(Z.Z,{style:{color:"var(--ag-ant-color-text)"},children:[!!((z=ie.tools)!==null&&z!==void 0&&z.length)&&(0,b.jsxs)("span",{className:"mr-[4px] cursor-pointer",onClick:ln,children:[ee.Z.get({id:"main.pages.App.components.MCPSelector.MCPServerListItem.index.tool",dm:"\u5DE5\u5177"}),ie.tools.length]}),ie.status===ne.YI.DISABLED?null:(0,b.jsx)(te.Z,{type:"spark-down-line",isCursorPointer:!0,className:"".concat(R["fold-icon"]," ").concat(en?"":R.rotated),onClick:ln})]})]}),(0,b.jsx)(y.Z.Paragraph,{className:R.desc,style:{marginBottom:0},ellipsis:{rows:1,tooltip:(0,ge.rb)(ie.description)},children:ie.description})]})]})]})}),!en&&!!((pe=ie.tools)!==null&&pe!==void 0&&pe.length)&&(0,b.jsx)("div",{ref:on,className:"".concat(R["tools-container"]),style:{borderTop:"none",padding:"8px 12px",maxHeight:"".concat(vn,"px"),overflow:"hidden",display:en?"none":"block"},children:(0,b.jsx)(Z.Z,{gap:9,style:{marginLeft:20},vertical:!0,children:ie.tools.map(function(Ue){return(0,b.jsxs)(Z.Z,{className:"h-[60px] flex-1 rounded-[6px]",align:"center",children:[ye==="tool"&&(0,b.jsx)(c.ZP,{checked:(Ae==null?void 0:Ae.name)===Ue.name,onChange:function(an){if(an.target.checked){var Ne;(Ne=N.onSelectTool)===null||Ne===void 0||Ne.call(N,Ue,ie)}},disabled:ie.status===ne.YI.DISABLED}),ye==="server"&&(0,b.jsxs)(Z.Z,{gap:8,className:"h-[60px] flex-1 rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)",padding:"8px 12px"},align:"center",children:[(0,b.jsx)(Z.Z,{align:"center",className:"h-[20px] w-[20px] rounded-[4px]",style:{backgroundColor:"var(--ag-ant-color-text-base)"},children:(0,b.jsx)(te.Z,{className:"w-full h-full rounded-[4px]",type:"spark-tool-line",style:{color:"var(--ag-ant-color-bg-base)"}})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(Z.Z,{justify:"space-between",className:"header",children:(0,b.jsx)("div",{className:"text-[16px] font-semibold leading-6",style:{color:"var(--ag-ant-color-text-base)"},children:(0,b.jsx)(y.Z.Paragraph,{className:R.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,ge.rb)(Ue.name)},children:Ue.name})})}),(0,b.jsx)(y.Z.Paragraph,{className:R.desc,style:{marginBottom:0},ellipsis:{rows:1,tooltip:(0,ge.rb)(Ue.description)},children:Ue.description})]})]}),ye==="tool"&&(0,b.jsxs)(Z.Z,{gap:8,className:"h-[72px] flex-1 rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)",padding:"8px 12px"},vertical:!0,children:[(0,b.jsxs)(Z.Z,{align:"center",gap:12,className:"h-[28px]",children:[(0,b.jsx)(Z.Z,{align:"center",className:"h-[20px] w-[20px] rounded-[4px]",style:{backgroundColor:"var(--ag-ant-color-text-base)"},children:(0,b.jsx)(te.Z,{className:"w-full h-full rounded-[4px]",type:"spark-tool-line",style:{color:"var(--ag-ant-color-bg-base)"}})}),(0,b.jsx)("div",{className:"text-[16px] font-semibold leading-6",style:{color:"var(--ag-ant-color-text-base)"},children:(0,b.jsx)(y.Z.Paragraph,{className:R.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,ge.rb)(Ue.name)},children:Ue.name})})]}),(0,b.jsx)(y.Z.Paragraph,{className:R.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,ge.rb)(Ue.description)},children:Ue.description})]})]},Ue.name)})})})]})},k=function(z){var pe,ie,ye=(0,oe.Z)({need_tools:!0,status:ne.YI.ENABLED,current:1,size:10,name:""}),be=P()(ye,2),n=be[0],Ae=be[1],Ie=(0,le.useState)(0),Je=P()(Ie,2),Be=Je[0],Ve=Je[1],Re=(0,le.useState)([]),He=P()(Re,2),en=He[0],Le=He[1],mn=(0,le.useState)(!1),Ye=P()(mn,2),vn=Ye[0],Xe=Ye[1],on=function(){Xe(!0),(0,u.Pk)(n).then(function(Oe){Le(Oe.data.records),Ve(Oe.data.total)}).finally(function(){Xe(!1)})};(0,le.useEffect)(function(){on()},[n]);var ln=(0,V.Z)(function(Ue){Ae({current:1,name:Ue.target.value})},500);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(Z.Z,{justify:"space-between",className:"mb-[16px]",children:[(0,b.jsx)(q.Z,{onChange:ln,prefix:(0,b.jsx)(te.Z,{type:"spark-search-line"}),placeholder:ee.Z.get({id:"main.pages.App.components.MCPSelector.index.inputHere",dm:"\u5728\u6B64\u8F93\u5165"}),allowClear:!0,style:{width:220}}),(0,b.jsx)(A.x,{isOpenNew:!0,buttonProps:{type:"default"}})]}),vn?(0,b.jsx)(Ee.Z,{className:"w-full h-full"}):(0,b.jsx)(Z.Z,{vertical:!0,gap:16,children:en.length?(0,b.jsxs)(b.Fragment,{children:[en.map(function(Ue){return(0,b.jsx)(S,{item:Ue,selectedServers:z.selectedServers,onSelectServer:function(an){var Ne;if(z.selectedServers&&z.selectedServers.length>=ne.rR){t.Z.warning(ee.Z.get({id:"main.pages.App.components.MCPSelector.index.reachedMaxLimit",dm:"\u5DF2\u8FBE\u5230\u6700\u5927\u6570\u91CF\u9650\u5236"}));return}(Ne=z.onMcpServersChange)===null||Ne===void 0||Ne.call(z,[].concat(T()(z.selectedServers||[]),[an]))},onRemoveServer:function(an){var Ne,gn;(Ne=z.onMcpServersChange)===null||Ne===void 0||Ne.call(z,(gn=z.selectedServers||[])===null||gn===void 0?void 0:gn.filter(function(wn){return wn.server_code!==an}))},selectMode:z.mode,onSelectTool:function(an,Ne){var gn;(gn=z.onSelectTool)===null||gn===void 0||gn.call(z,an,Ne)},selectedTool:z.selectedTool,fetchList:on},Ue.server_code)}),(0,b.jsx)(W.Z,{pageSize:n.size,current:n.current,total:Be,hideOnSinglePage:!0,hideTips:!0,onChange:function(Oe,an){Ae({current:Oe,size:an})},pageSizeOptions:[10,20]})]}):(0,b.jsx)(Z.Z,{className:"h-full",align:"center",justify:"center",children:(0,b.jsx)(K.Z,{title:(pe=n.name)!==null&&pe!==void 0&&pe.length?ee.Z.get({id:"main.pages.App.components.MCPSelector.index.noSearchResult",dm:"\u6682\u65E0\u641C\u7D22\u7ED3\u679C"}):ee.Z.get({id:"main.pages.App.components.MCPSelector.index.noCustomMcpService",dm:"\u6682\u65E0\u81EA\u5B9A\u4E49MCP\u670D\u52A1"}),description:!((ie=n.name)!==null&&ie!==void 0&&ie.length)&&(0,b.jsx)(A.x,{isOpenNew:!0,text:ee.Z.get({id:"main.pages.App.components.MCPSelector.index.goCreate",dm:"\u53BB\u521B\u5EFA"})})})})})]})},m=function(z){var pe=(0,le.useState)(T()(z.selectedServers||[])),ie=P()(pe,2),ye=ie[0],be=ie[1];return(0,b.jsx)(L.Z,{title:ee.Z.get({id:"main.pages.App.components.MCPSelector.index.selectMcpService",dm:"\u9009\u62E9MCP\u670D\u52A1"}),open:!0,width:640,onClose:z.onClose,footer:(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"w-full",children:[(0,b.jsx)("div",{style:{color:"var(--ag-ant-color-text-tertiary)",fontSize:"14px",fontWeight:"normal",lineHeight:"24px"},children:!!ye.length&&ee.Z.get({id:"main.pages.App.components.MCPSelector.index.addedMcpVar1Var2",dm:"\u5DF2\u6DFB\u52A0MCP{var1}/{var2}"},{var1:ye.length,var2:ne.rR})}),(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,b.jsx)(I.Z,{type:"default",onClick:function(){z.onClose()},children:ee.Z.get({id:"main.pages.App.components.MCPSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,b.jsx)(I.Z,{type:"primary",onClick:function(){z.onOk(ye),z.onClose(),t.Z.success(ee.Z.get({id:"main.pages.App.components.MCPSelector.index.addSuccess",dm:"\u6DFB\u52A0\u6210\u529F\uFF01"}))},children:ee.Z.get({id:"main.pages.Setting.ModelService.components.ModelServiceProviderModal.index.confirm",dm:"\u786E\u8BA4"})})]})]}),children:(0,b.jsx)(k,{mode:"server",onMcpServersChange:be,selectedServers:ye})})},j=function(z){var pe=(0,le.useState)(z.selectedMcpTool),ie=P()(pe,2),ye=ie[0],be=ie[1],n=(0,le.useState)(void 0),Ae=P()(n,2),Ie=Ae[0],Je=Ae[1];return(0,b.jsx)(se.Z,{width:740,title:ee.Z.get({id:"main.pages.App.components.MCPSelector.index.11",dm:"\u9009\u62E9MCP\u5DE5\u5177"}),open:!0,onCancel:z.onClose,bodyProps:{style:{padding:0}},footer:(0,b.jsxs)("div",{className:"justify-end flex gap-[8px]",children:[(0,b.jsx)(I.Z,{onClick:z.onClose,children:ee.Z.get({id:"main.pages.App.components.MCPSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,b.jsx)(I.Z,{type:"primary",onClick:function(){if(!ye||!Ie){t.Z.warning(ee.Z.get({id:"main.pages.App.components.MCPSelector.index.selectMcpTool",dm:"\u8BF7\u9009\u62E9MCP\u5DE5\u5177"}));return}z.onOk(ye,Ie),z.onClose()},children:ee.Z.get({id:"main.pages.App.components.MCPSelector.index.confirm",dm:"\u786E\u5B9A"})})]}),children:(0,b.jsx)("div",{className:"p-[16px_24px] max-h-[400px] overflow-y-auto",children:(0,b.jsx)(k,{mode:"tool",onSelectTool:function(Ve,Re){be(Ve),Je(Re)},selectedTool:ye})})})},x={show:function(z){var pe=document.createElement("div");document.body.appendChild(pe);var ie=(0,De.createRoot)(pe),ye=function(){var Ae;ie.unmount(),pe.remove(),(Ae=z.onCancel)===null||Ae===void 0||Ae.call(z)},be=function(Ae,Ie){var Je;(Je=z.onOk)===null||Je===void 0||Je.call(z,Ae,Ie),ye()};ie.render((0,b.jsx)(M.Z,{children:(0,b.jsx)(j,{selectedMcpTool:z.selectedMcpTool,onClose:ye,onOk:be})}))}}},43065:function(Ke,Ce,e){e.d(Ce,{U_:function(){return m},hW:function(){return k}});var f=e(49616),T=e.n(f),U=e(13311),P=e.n(U),ee=e(42035),M=e.n(ee),A=e(22453),u=e(69163),ne=e(4513),q=e(72624),te=e(84546),t=e(95559),W=e(2821),K=e(5693),L=e(88133),I=e(91030),se=e(74465),oe=e(77813),Z=e(9454),Ee=e(12524),V=e.n(Ee),le=e(2784),De=e(20585),we={topDesc:"topDesc___cXyfX"},Y=e(87329),ge=e.n(Y),B=e(45753),y=e(3318),c=e(71938),X=e(35899),Q={"plugin-list-wrapper":"plugin-list-wrapper___Tzd3H",expanded:"expanded___fSdub","fold-icon":"fold-icon___obQyN",rotated:"rotated___MEe30","tools-container":"tools-container___FjWqX","check-item":"check-item___QuVRZ",desc:"desc___I0YEJ"},R=e(52322),b=function(j){var x=j.item,N=j.selectedTools,z=(0,le.useState)([]),pe=M()(z,2),ie=pe[0],ye=pe[1],be=(0,le.useState)(!1),n=M()(be,2),Ae=n[0],Ie=n[1],Je=(0,le.useState)(!0),Be=M()(Je,2),Ve=Be[0],Re=Be[1],He=(0,le.useState)(0),en=M()(He,2),Le=en[0],mn=en[1],Ye=(0,le.useRef)(null);(0,le.useEffect)(function(){x.plugin_id&&(0,u.cy)(x.plugin_id).then(function(Xe){ye(Xe.data.records)})},[x]),(0,le.useEffect)(function(){Ie(!!(N!=null&&N.find(function(Xe){return Xe.plugin_id===x.plugin_id})))},[x,N]),(0,le.useEffect)(function(){Ae&&Re(!1)},[Ae]),(0,le.useEffect)(function(){Ye.current&&mn(Ve?0:Ye.current.scrollHeight)},[Ve]);var vn=function(){Re(!Ve)};return(0,R.jsxs)("div",{children:[(0,R.jsx)("div",{className:V()(Q["plugin-list-wrapper"],ge()({},Q.expanded,!Ve)),style:{padding:"12px 16px"},children:(0,R.jsx)(I.Z,{gap:8,children:(0,R.jsxs)(I.Z,{gap:8,className:"w-full h-[52px] flex-1",align:"center",children:[(0,R.jsx)(I.Z,{align:"center",className:"h-[40px] w-[40px]",children:(0,R.jsx)(I.Z,{align:"center",justify:"center",className:V()("h-[40px] w-[40px] rounded-[6px]",Q["check-item"]),style:{border:"1px solid var(--ag-ant-color-border-secondary)"},children:(0,R.jsx)("img",{src:"/images/plugin.svg",alt:""})})}),(0,R.jsxs)("div",{style:{width:"calc(100% - 48px)"},children:[(0,R.jsxs)(I.Z,{justify:"space-between",className:"header leading-[22px] h-[22px]",children:[(0,R.jsx)("div",{className:"text-[16px] font-semibold  mr-[4px] ",style:{color:"var(--ag-ant-color-text-base)",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",width:0,flex:1},children:x.name}),(0,R.jsxs)(I.Z,{style:{color:"var(--ag-ant-color-text)"},children:[!!(ie!=null&&ie.length)&&(0,R.jsxs)("span",{className:"mr-[4px] cursor-pointer",onClick:vn,children:[A.Z.get({id:"main.pages.App.components.PluginSelector.PluginListItem.index.tool",dm:"\u5DE5\u5177"}),ie.length]}),(0,R.jsx)(B.Z,{type:"spark-down-line",isCursorPointer:!0,className:"".concat(Q["fold-icon"]," ").concat(Ve?"":Q.rotated),onClick:vn})]})]}),(0,R.jsx)(c.Z.Paragraph,{className:Q.desc,style:{marginBottom:0},ellipsis:{rows:1,tooltip:(0,y.rb)(x.description)},children:x.description})]})]})})}),!Ve&&!!(ie!=null&&ie.length)&&(0,R.jsx)("div",{ref:Ye,className:"".concat(Q["tools-container"]),style:{borderTop:"none",padding:"8px 12px",maxHeight:"".concat(Le,"px"),overflow:"hidden",display:Ve?"none":"block"},children:(0,R.jsx)(I.Z,{gap:9,style:{marginLeft:20},vertical:!0,children:ie.map(function(Xe){return(0,R.jsx)(I.Z,{className:"h-[60px] flex-1 rounded-[6px]",align:"center",children:(0,R.jsxs)(I.Z,{gap:8,flex:1,children:[(0,R.jsx)(X.Z,{checked:!!(N!=null&&N.find(function(on){return on.tool_id===Xe.tool_id})),onChange:function(ln){if(ln.target.checked){var Ue;(Ue=j.onSelectTool)===null||Ue===void 0||Ue.call(j,Xe)}else{var Oe;(Oe=j.onRemoveTool)===null||Oe===void 0||Oe.call(j,Xe)}},disabled:!Xe.enabled}),(0,R.jsxs)(I.Z,{flex:1,gap:8,className:"h-[72px] flex-1 rounded-[6px]",style:{border:"1px solid var(--ag-ant-color-border-secondary)",padding:"8px 12px"},vertical:!0,children:[(0,R.jsx)(I.Z,{align:"center",gap:12,className:"h-[28px]",children:(0,R.jsx)("div",{className:"text-[16px] font-semibold leading-6",style:{color:"var(--ag-ant-color-text-base)"},children:(0,R.jsx)(c.Z.Paragraph,{className:Q.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,y.rb)(Xe.name)},children:Xe.name})})}),(0,R.jsx)(c.Z.Paragraph,{className:Q.desc,style:{marginBottom:0,marginTop:0},ellipsis:{rows:1,tooltip:(0,y.rb)(Xe.description)},children:Xe.description})]})]})},Xe.tool_id)})})})]})};function S(j){var x=j.value,N=x===void 0?[]:x,z=j.maxLength,pe=z===void 0?De.IM:z,ie=(0,W.Z)({current:1,size:10,name:"",loading:!0,list:[],total:0}),ye=M()(ie,2),be=ye[0],n=ye[1],Ae=function(){var Ve=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Re=P()({current:be.current,size:be.size},Ve);n({loading:!0}),(0,u.hZ)(Re).then(function(He){n({list:He.data.records,total:He.data.total,loading:!1})})};(0,K.Z)(function(){Ae()});var Ie=function(Ve){var Re;if(N.length>=pe){L.ZP.warning(A.Z.get({id:"main.pages.App.components.PluginSelector.index.reachMaxLimit",dm:"\u5DF2\u8FBE\u5230\u6700\u5927\u6570\u91CF\u9650\u5236"}));return}var He=[].concat(T()(N),T()(Ve));(Re=j.onChange)===null||Re===void 0||Re.call(j,He)},Je=function(Ve){var Re;(Re=j.onChange)===null||Re===void 0||Re.call(j,N.filter(function(He){return He.tool_id!==Ve.tool_id}))};return(0,R.jsxs)(I.Z,{className:V()("p-[8px]",j.className),vertical:!0,children:[(0,R.jsxs)(I.Z,{justify:"space-between",align:"center",children:[(0,R.jsx)(ne.Z.Search,{style:{width:280},width:280,value:be.name,onChange:function(Ve){return n({name:Ve.target.value})},placeholder:A.Z.get({id:"main.pages.App.components.PluginSelector.index.searchPluginName",dm:"\u641C\u7D22\u63D2\u4EF6\u540D\u79F0"}),onSearch:function(){n({current:1}),Ae({current:1,name:be.name})}}),(0,R.jsx)(q.Z,{style:{flexShrink:0},onClick:function(){return window.open("/component/plugin/create")},iconType:"spark-plus-line",children:A.Z.get({id:"main.pages.App.components.PluginSelector.index.createPlugin",dm:"\u521B\u5EFA\u63D2\u4EF6"})})]}),(0,R.jsxs)("span",{className:we.topDesc,children:[A.Z.get({id:"main.pages.App.components.PluginSelector.index.publishedPluginSupportAddToSmartAgentWorkflowApp",dm:"\u5DF2\u53D1\u5E03\u7684\u63D2\u4EF6\u652F\u6301\u6DFB\u52A0\u5230\u667A\u80FD\u4F53/\u5DE5\u4F5C\u6D41\u5E94\u7528\u4E2D\uFF0C\u53EF\u524D\u5F80"}),"\xA0",(0,R.jsx)("a",{target:"_blank",href:"/component/plugin",children:A.Z.get({id:"main.pages.App.components.PluginSelector.index.pluginList",dm:"\u63D2\u4EF6\u5217\u8868"})}),"\xA0",A.Z.get({id:"main.pages.App.components.PluginSelector.index.manage",dm:"\u7BA1\u7406"})]}),(0,R.jsx)(I.Z,{vertical:!0,gap:12,className:V()(we.list),children:be.loading?(0,R.jsx)(se.Z,{spinning:!0}):be.list.length?be.list.map(function(Be){return(0,R.jsx)(b,{item:Be,selectedTools:N,onSelectTool:function(Re){return Ie([Re])},onRemoveTool:function(Re){return Je(Re)}},Be.plugin_id)}):(0,R.jsx)(oe.Z,{description:A.Z.get({id:"main.pages.App.components.PluginSelector.index.noAvailablePlugin",dm:"\u6682\u65E0\u53EF\u7528\u63D2\u4EF6"}),style:{marginTop:90}})}),(0,R.jsx)(Z.Z,{hideOnSinglePage:!0,style:{justifyContent:"flex-end",paddingTop:12},pageSize:be.size,current:be.current,total:be.total,onChange:function(Ve,Re){n({current:Ve,size:Re}),Ae({current:Ve,size:Re})}})]})}function k(j){var x,N=j.maxLen,z=N===void 0?1:N,pe=(0,W.Z)({selectedTools:j.value||[]}),ie=M()(pe,2),ye=ie[0],be=ie[1];return(0,R.jsx)(te.Z,{width:880,onCancel:j.onClose,open:!0,title:A.Z.get({id:"main.pages.App.components.PluginSelector.index.selectPlugin",dm:"\u9009\u62E9\u63D2\u4EF6"}),onOk:function(){var Ae;return(Ae=j.onOk)===null||Ae===void 0?void 0:Ae.call(j,ye.selectedTools)},okButtonProps:{disabled:((x=ye.selectedTools)===null||x===void 0?void 0:x.length)>z},children:(0,R.jsx)("div",{className:"h-[400px] overflow-y-auto",children:(0,R.jsx)(S,{className:we.modelCon,value:ye.selectedTools,maxLength:z,onChange:function(Ae){return be({selectedTools:Ae})}})})})}function m(j){var x=(0,le.useState)(j.value||[]),N=M()(x,2),z=N[0],pe=N[1],ie=(0,le.useMemo)(function(){return(0,R.jsx)(I.Z,{align:"center",className:we.drawerTitle,gap:4,children:A.Z.get({id:"main.pages.App.components.PluginSelector.index.selectPlugin",dm:"\u9009\u62E9\u63D2\u4EF6"})})},[j]);return(0,R.jsx)(t.Z,{className:we.toolSelectDrawer,width:640,open:!0,onClose:j.onClose,title:ie,footer:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"w-full",children:[(0,R.jsx)("div",{style:{color:"var(--ag-ant-color-text-tertiary)",fontSize:"14px",fontWeight:"normal",lineHeight:"24px"},children:!!z.length&&A.Z.get({id:"main.pages.App.components.PluginSelector.index.addedToolVar1Var2",dm:"\u5DF2\u6DFB\u52A0\u5DE5\u5177{var1}/{var2}"},{var1:(z==null?void 0:z.length)||0,var2:j.maxLen||10})}),(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,R.jsx)(q.Z,{type:"default",onClick:function(){j.onClose()},children:A.Z.get({id:"main.pages.App.components.PluginSelector.index.cancel",dm:"\u53D6\u6D88"})}),(0,R.jsx)(q.Z,{type:"primary",onClick:function(){j.onOk(z),j.onClose(),L.ZP.success(A.Z.get({id:"main.pages.App.components.PluginSelector.index.addSuccess",dm:"\u6DFB\u52A0\u6210\u529F\uFF01"}))},children:A.Z.get({id:"main.pages.App.components.PluginSelector.index.confirm",dm:"\u786E\u8BA4"})})]})]}),children:(0,R.jsx)(S,{value:z,onChange:function(be){return pe(be)},className:we.listWrap})})}},96100:function(Ke,Ce,e){e.d(Ce,{n:function(){return q}});var f=e(324),T=e.n(f),U=e(80828),P=e.n(U),ee=e(87329),M=e.n(ee),A=e(30686),u,ne=function(){function te(t,W){T()(this,te),M()(this,"eventEmitter",void 0),M()(this,"name",void 0),M()(this,"store",void 0),this.eventEmitter=t,this.name=W,this.store={}}return P()(te,[{key:"on",value:function(W,K){var L=this;return this.eventEmitter.on(W,K),function(){L.off(W,K)}}},{key:"off",value:function(W,K){this.eventEmitter.off(W,K)}},{key:"emit",value:function(W){for(var K,L=arguments.length,I=new Array(L>1?L-1:0),se=1;se<L;se++)I[se-1]=arguments[se];(K=this.eventEmitter).emit.apply(K,[W].concat(I))}},{key:"removeListener",value:function(W,K){return this.eventEmitter.removeListener(W,K)}},{key:"addListener",value:function(W,K){return this.eventEmitter.addListener(W,K)}},{key:"setMaxListeners",value:function(W){return this.eventEmitter.setMaxListeners(W)}},{key:"removeAllListeners",value:function(W){return this.eventEmitter.removeAllListeners(W)}},{key:"getAllEvents",value:function(){return this.eventEmitter._events}},{key:"setValue",value:function(W,K){this.store[W]=K}},{key:"getValue",value:function(W){return this.store.hasOwnProperty(W)?this.store[W]:""}},{key:"deleteValue",value:function(W){return this.store.hasOwnProperty(W)?(delete this.store[W],!0):!1}}]),te}(),q=function(t,W){var K=new A.Z;return W&&K.setMaxListeners(W),u=new ne(K,t||"bailian-canvas"),u}},36175:function(Ke,Ce,e){e.d(Ce,{Q:function(){return ee},R:function(){return M}});var f=e(22453),T=e(53890),U=function(){return{nodes:[{id:"Start_".concat((0,T.Z)(4)),name:f.Z.get({id:"main.pages.App.utils.index.start",dm:"\u5F00\u59CB"}),type:"Start",position:{x:0,y:0},config:{input_params:[],output_params:[{key:"city",type:"String",desc:f.Z.get({id:"main.pages.App.utils.index.city",dm:"\u57CE\u5E02"})},{key:"date",type:"String",desc:f.Z.get({id:"main.pages.App.utils.index.date",dm:"\u65E5\u671F"})}],node_param:{}},width:320},{id:"End_".concat((0,T.Z)(4)),name:f.Z.get({id:"main.pages.App.utils.index.end",dm:"\u7ED3\u675F"}),type:"End",position:{x:450,y:0},config:{input_params:[],output_params:[],node_param:{output_type:"text",text_template:"",json_params:[],stream_switch:!1}},width:320}],edges:[],global_config:{history_config:{history_max_round:5,history_switch:!1},variable_config:{conversation_params:[]}}}},P=function(){return{instructions:"",tools:{},file_search:{},mcp_servers:[],agent_components:[],workflow_components:[]}},ee=function(u){switch(u){case"workflow":return U();case"basic":return P();default:return{}}};function M(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(A.length!==u.length)return!1;for(var ne=0;ne<A.length;ne++)if(A[ne]!==u[ne])return!1;return JSON.stringify(A)===JSON.stringify(u)}},36488:function(Ke,Ce,e){e.d(Ce,{qO:function(){return u},ZP:function(){return ne},pC:function(){return M}});var f=e(12323),T=e.n(f),U=e(63260),P=e.n(U),ee=e(85545);function M(K){return A.apply(this,arguments)}function A(){return A=P()(T()().mark(function K(L){var I,se;return T()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(I=window.g_config.config.upload_method,I!==u.OSS){Z.next=6;break}return Z.next=4,(0,ee.ZP)({url:"/console/v1/files/get-preview-url",method:"GET",params:{path:L}});case 4:return se=Z.sent,Z.abrupt("return",se.data.data);case 6:if(I!==u.FILE){Z.next=8;break}return Z.abrupt("return","".concat(ee.v2.get(),"/console/v1/files/download?path=").concat(encodeURIComponent(L),"&preview=true&access_token=").concat(ee.nP.get()));case 8:case"end":return Z.stop()}},K)})),A.apply(this,arguments)}var u=function(K){return K.OSS="oss",K.FILE="file",K}({});function ne(K){var L=window.g_config.config.upload_method;return L===u.OSS?te(K):(L===u.FILE,q(K))}function q(K){var L=new FormData;return L.append("category",K.category),L.append("files",K.file),(0,ee.ZP)({method:"POST",url:"/console/v1/files/upload",data:L,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(se){var oe;(oe=K.onProgress)===null||oe===void 0||oe.call(K,{percent:Math.min(1,se.loaded/((se==null?void 0:se.total)||1))})}}).then(function(I){return I.data.data[0]})}function te(K){return t.apply(this,arguments)}function t(){return t=P()(T()().mark(function K(L){var I,se,oe;return T()().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return Ee.next=2,(0,ee.ZP)({url:"/console/v1/files/upload-policies",method:"POST",data:{files:[{name:L.file.name}],category:L.category}});case 2:return I=Ee.sent,se=I.data.data[0],oe=new FormData,oe.append("OSSAccessKeyId",se.access_id),oe.append("success_action_status","200"),oe.append("policy",se.policy),oe.append("signature",se.signature),oe.append("key",se.path),oe.append("file",L.file),Ee.abrupt("return",(0,ee.ZP)({method:"POST",url:se.host,data:oe,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(le){var De;(De=L.onProgress)===null||De===void 0||De.call(L,{percent:Math.min(1,le.loaded/((le==null?void 0:le.total)||1))})}}).then(function(){return{extension:W(L.file.name),name:L.file.name,path:se.path,size:L.file.size}}));case 12:case"end":return Ee.stop()}},K)})),t.apply(this,arguments)}function W(K){var L=K.lastIndexOf(".");return(L>0?K.slice(L):"").replace(/\./,"")}},1905:function(Ke,Ce,e){e.d(Ce,{Df:function(){return t},KT:function(){return u},P2:function(){return A},YI:function(){return W},b1:function(){return te},le:function(){return q},o$:function(){return ne},ri:function(){return M},yk:function(){return ee}});var f=e(74875),T=e.n(f),U=e(46639),P=["app_id"],ee=function(L){return(0,U.W)({url:"/console/v1/apps",method:"GET",params:L}).then(function(I){return I.data.data})},M=function(L){return(0,U.W)({url:"/console/v1/apps",method:"POST",data:L}).then(function(I){return I.data.data})},A=function(L){return(0,U.W)({url:"/console/v1/apps/".concat(L),method:"DELETE"})},u=function(L){var I=L.app_id,se=T()(L,P);return(0,U.W)({url:"/console/v1/apps/".concat(I),method:"PUT",data:se})},ne=function(L){return(0,U.W)({url:"/console/v1/apps/".concat(L,"/copy"),method:"POST"})},q=function(L){return(0,U.W)({url:"/console/v1/apps/".concat(L),method:"GET"}).then(function(I){return I.data.data})},te=function(L){return(0,U.W)({url:"/console/v1/apps/".concat(L,"/publish"),method:"POST"})},t=function(L){var I=L.app_id,se=L.current,oe=L.size,Z=L.status;return(0,U.W)({url:"/console/v1/apps/".concat(I,"/versions"),method:"GET",params:{current:se,size:oe,status:Z}}).then(function(Ee){return Ee.data})},W=function(L,I){return(0,U.W)({url:"/console/v1/apps/".concat(L,"/versions/").concat(I),method:"GET"}).then(function(se){return se.data})}},76077:function(Ke,Ce,e){e.d(Ce,{Cs:function(){return we},Eq:function(){return L},Et:function(){return te},GZ:function(){return I},Mj:function(){return oe},PU:function(){return le},XK:function(){return V},Y6:function(){return Y},YN:function(){return Z},ZJ:function(){return t},bN:function(){return K},eU:function(){return ne},eb:function(){return q},gB:function(){return De},mB:function(){return W},mU:function(){return se},tH:function(){return Ee}});var f=e(74875),T=e.n(f),U=e(46639),P=["kb_id"],ee=["doc_id","chunk_id"],M=["doc_id","kb_id"],A=["doc_id"],u=["doc_id"],ne=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases",method:"GET",params:B}).then(function(y){return y.data.data})},q=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases",method:"POST",data:B}).then(function(y){return y.data.data})},te=function(B){var y=B.kb_id,c=T()(B,P);return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(y),method:"PUT",data:c}).then(function(X){return X.data})},t=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(B),method:"DELETE"}).then(function(y){return y.data})},W=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(B),method:"GET"}).then(function(y){return y.data.data})},K=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases/retrieve",method:"POST",data:B}).then(function(y){if(y)return y.data.data})},L=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(B.kb_id,"/documents"),method:"GET",params:B}).then(function(y){return y.data.data})},I=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(B.kb_id,"/documents"),method:"POST",data:B}).then(function(y){return y.data.data})},se=function(B,y){return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(B,"/documents/").concat(y),method:"DELETE"}).then(function(c){return c.data.data})},oe=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(B==null?void 0:B.kb_id,"/documents/batch-delete"),method:"DELETE",data:B}).then(function(y){return y.data.data})},Z=function(B){var y=B.doc_id,c=B.current,X=B.size;return(0,U.W)({url:"/console/v1/documents/".concat(y,"/chunks"),method:"GET",params:{current:c,size:X}}).then(function(Q){return Q.data.data})},Ee=function(B){var y=B.doc_id,c=B.chunk_id;return(0,U.W)({url:"/console/v1/documents/".concat(y,"/chunks/").concat(c),method:"DELETE"}).then(function(X){return X.data.data})},V=function(B){var y=B.doc_id,c=B.chunk_id,X=T()(B,ee);return(0,U.W)({url:"/console/v1/documents/".concat(y,"/chunks/").concat(c),method:"PUT",data:X}).then(function(Q){return Q.data.data})},le=function(B){var y=B.doc_id,c=B.kb_id,X=T()(B,M);return(0,U.W)({url:"/console/v1/knowledge-bases/".concat(c,"/documents/").concat(y,"/re-index"),method:"PUT",data:X}).then(function(Q){return Q.data.data})},De=function(B){var y=B.doc_id,c=T()(B,A);return(0,U.W)({url:"/console/v1/documents/".concat(y,"/chunks/preview"),method:"POST",data:c}).then(function(X){return X.data.data})},we=function(B){var y=B.doc_id,c=T()(B,u);return(0,U.W)({url:"/console/v1/documents/".concat(y,"/chunks/update-status"),method:"PUT",data:c}).then(function(X){return X.data.data})},Y=function(B){return(0,U.W)({url:"/console/v1/knowledge-bases/query-by-codes",method:"POST",data:{kb_ids:B}}).then(function(y){return y.data.data})}},18809:function(Ke,Ce,e){e.d(Ce,{$2:function(){return I},$s:function(){return we},B7:function(){return X},NY:function(){return Ee},P0:function(){return q},QB:function(){return le},Qz:function(){return u},YS:function(){return oe},dm:function(){return t},h1:function(){return ge},nd:function(){return R},vu:function(){return y},xp:function(){return K}});var f=e(13311),T=e.n(f),U=e(12323),P=e.n(U),ee=e(63260),M=e.n(ee),A=e(46639);function u(S){return ne.apply(this,arguments)}function ne(){return ne=M()(P()().mark(function S(k){var m;return P()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,A.W)({url:"/console/v1/providers",method:"POST",data:k});case 2:return m=x.sent,x.abrupt("return",m.data);case 4:case"end":return x.stop()}},S)})),ne.apply(this,arguments)}function q(S,k){return te.apply(this,arguments)}function te(){return te=M()(P()().mark(function S(k,m){var j,x;return P()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k),method:"PUT",data:T()(T()({},m),{},{supported_model_types:typeof m.supported_model_types=="string"?m.supported_model_types:(j=m.supported_model_types)===null||j===void 0?void 0:j.join(",")})});case 2:return x=z.sent,z.abrupt("return",x.data);case 4:case"end":return z.stop()}},S)})),te.apply(this,arguments)}function t(S){return W.apply(this,arguments)}function W(){return W=M()(P()().mark(function S(k){var m;return P()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k),method:"DELETE"});case 2:return m=x.sent,x.abrupt("return",m.data);case 4:case"end":return x.stop()}},S)})),W.apply(this,arguments)}function K(S){return L.apply(this,arguments)}function L(){return L=M()(P()().mark(function S(k){var m;return P()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,A.W)({url:"/console/v1/providers",method:"GET",params:k});case 2:return m=x.sent,x.abrupt("return",m.data);case 4:case"end":return x.stop()}},S)})),L.apply(this,arguments)}function I(S){return se.apply(this,arguments)}function se(){return se=M()(P()().mark(function S(k){var m;return P()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k),method:"GET"});case 2:return m=x.sent,x.abrupt("return",m.data);case 4:case"end":return x.stop()}},S)})),se.apply(this,arguments)}function oe(){return Z.apply(this,arguments)}function Z(){return Z=M()(P()().mark(function S(){var k;return P()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,A.W)({url:"/console/v1/providers/protocols",method:"GET"});case 2:return k=j.sent,j.abrupt("return",k.data);case 4:case"end":return j.stop()}},S)})),Z.apply(this,arguments)}function Ee(S,k){return V.apply(this,arguments)}function V(){return V=M()(P()().mark(function S(k,m){var j,x;return P()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k,"/models"),method:"POST",data:T()(T()({},m),{},{model_name:m.name,tags:typeof m.tags=="string"?m.tags:(j=m.tags)===null||j===void 0?void 0:j.join(",")})});case 2:return x=z.sent,z.abrupt("return",x.data);case 4:case"end":return z.stop()}},S)})),V.apply(this,arguments)}function le(S,k,m){return De.apply(this,arguments)}function De(){return De=M()(P()().mark(function S(k,m,j){var x,N;return P()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return pe.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k,"/models/").concat(m),method:"PUT",data:T()(T()({},j),{},{model_name:j.name,tags:typeof j.tags=="string"?j.tags:(x=j.tags)===null||x===void 0?void 0:x.join(",")})});case 2:return N=pe.sent,pe.abrupt("return",N.data);case 4:case"end":return pe.stop()}},S)})),De.apply(this,arguments)}function we(S,k){return Y.apply(this,arguments)}function Y(){return Y=M()(P()().mark(function S(k,m){var j;return P()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k,"/models/").concat(m),method:"DELETE"});case 2:return j=N.sent,N.abrupt("return",j.data);case 4:case"end":return N.stop()}},S)})),Y.apply(this,arguments)}function ge(S){return B.apply(this,arguments)}function B(){return B=M()(P()().mark(function S(k){var m;return P()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k,"/models"),method:"GET"});case 2:return m=x.sent,x.abrupt("return",m.data);case 4:case"end":return x.stop()}},S)})),B.apply(this,arguments)}function y(S,k){return c.apply(this,arguments)}function c(){return c=M()(P()().mark(function S(k,m){var j;return P()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k,"/models/").concat(m),method:"GET"});case 2:return j=N.sent,N.abrupt("return",j.data);case 4:case"end":return N.stop()}},S)})),c.apply(this,arguments)}function X(S){return Q.apply(this,arguments)}function Q(){return Q=M()(P()().mark(function S(k){var m;return P()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,A.W)({url:"/console/v1/models/".concat(k,"/selector"),method:"GET"});case 2:return m=x.sent,x.abrupt("return",m.data);case 4:case"end":return x.stop()}},S)})),Q.apply(this,arguments)}function R(S,k){return b.apply(this,arguments)}function b(){return b=M()(P()().mark(function S(k,m){var j;return P()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,(0,A.W)({url:"/console/v1/providers/".concat(k,"/models/").concat(m,"/parameter_rules"),method:"GET"});case 2:return j=N.sent,N.abrupt("return",j.data);case 4:case"end":return N.stop()}},S)})),b.apply(this,arguments)}},47202:function(Ke,Ce,e){e.d(Ce,{b:function(){return U},w:function(){return T}});var f=e(22453),T={draft:f.Z.get({id:"main.types.appManage.draft",dm:"\u8349\u7A3F"}),published:f.Z.get({id:"main.types.appManage.published",dm:"\u5DF2\u53D1\u5E03"}),published_editing:f.Z.get({id:"main.types.appManage.publishedEditing",dm:"\u5DF2\u53D1\u5E03\u7F16\u8F91\u4E2D"})},U={textDialog:f.Z.get({id:"main.types.appManage.textDialogue",dm:"\u6587\u672C\u5BF9\u8BDD"}),textGenerate:f.Z.get({id:"main.types.appManage.textGeneration",dm:"\u6587\u672C\u751F\u6210"})}},53890:function(Ke,Ce,e){e.d(Ce,{Z:function(){return u}});var f=e(42035),T=e.n(f),U=[["0","9"],["a","z"],["A","Z"]].map(function(ne){return ne.map(function(q){return q.charCodeAt(0)})}).flatMap(function(ne){var q=T()(ne,2),te=q[0],t=q[1];return Array.from({length:t-te+1},function(W,K){return te+K})}),P=function(q){return String.fromCharCode.apply(String,Array.from({length:q},function(){return U[Math.floor(Math.random()*U.length)]}))},ee=0,M=function(q){return ee+=1,"".concat(ee.toString(16),"######").substring(0,q)},A="random";function u(ne){return A==="incremental"?M(ne):P(ne)}},32963:function(Ke,Ce){Ce.Z={main:"main___bxqJI",header:"header___vCPcP",body:"body___wZ9Xk","header-logo":"header-logo___GaV39","header-right":"header-right___YclAV",avatar:"avatar___Tv1Un","menu-list":"menu-list___w2rTR","menu-item":"menu-item___vZBAT",right:"right___fyDUZ"}},28842:function(Ke,Ce){Ce.Z={container:"container___FMmcw",title:"title___zoXE9",card:"card___MwD4J","img-con":"img-con___eCYij",name:"name____2Mis",desc:"desc___xXg4v"}}}]);
